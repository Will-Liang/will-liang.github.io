<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/kouzhaopng">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/kouzhao.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="永远相信美好的事情即将发生">
<meta property="og:type" content="website">
<meta property="og:title" content="LiAng的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="LiAng的博客">
<meta property="og:description" content="永远相信美好的事情即将发生">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="LiAng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>LiAng的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="LiAng的博客" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
      <a target="_blank" rel="noopener" href="https://github.com/fengye97" class="github-corner" aria-label="View source on GitHub">

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">LiAng的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/13/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LiAng">
      <meta itemprop="description" content="永远相信美好的事情即将发生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiAng的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/13/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
          
            <i class="fa fa-thumb-tack"></i>
            <font color=7D26CD>置顶</font>
            <span class="post-meta-divider">|</span>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-13 17:41:48" itemprop="dateCreated datePublished" datetime="2022-07-13T17:41:48+08:00">2022-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-20 20:31:34" itemprop="dateModified" datetime="2022-07-20T20:31:34+08:00">2022-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>欢迎来到我的博客！这也是我搭建的第一个博客网站，使用了Hexo+Node.js+md文档。在这里准备记录学习过程中记录的笔记和知识点，方便自己复习的同时也方便大家学习。本人小白有问题欢迎大家指出。</p>
<h2 id="搭建的第一个博客"><a href="#搭建的第一个博客" class="headerlink" title="搭建的第一个博客"></a>搭建的第一个博客</h2><h3 id="使用Hexo-Node-js"><a href="#使用Hexo-Node-js" class="headerlink" title="使用Hexo+Node.js"></a>使用Hexo+Node.js</h3><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s</span><br></pre></td></tr></table></figure>

<p>静态生成本地 hexo 界面</p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g</span><br></pre></td></tr></table></figure>

<p>生成静态文件</p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo d</span><br></pre></td></tr></table></figure>

<p>提交到GitHub仓库</p>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/20/Scala/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LiAng">
      <meta itemprop="description" content="永远相信美好的事情即将发生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiAng的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/20/Scala/" class="post-title-link" itemprop="url">Scala</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-20 21:15:02 / 修改时间：21:15:53" itemprop="dateCreated datePublished" datetime="2022-07-20T21:15:02+08:00">2022-07-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<h1 id="Scala-入门"><a href="#Scala-入门" class="headerlink" title="Scala 入门"></a>Scala 入门</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="为什么学习-Scala"><a href="#为什么学习-Scala" class="headerlink" title="为什么学习 Scala"></a>为什么学习 Scala</h3><ol>
<li>Spark—新一代内存级大数据计算框架，是大数据的重要内容。 </li>
<li>Spark就是使用Scala编写的。因此为了更好的学习Spark, 需要掌握Scala这门语言。 </li>
<li>Spark的兴起，带动Scala语言的发展！</li>
</ol>
<h3 id="Scala-和-Java-关系"><a href="#Scala-和-Java-关系" class="headerlink" title="Scala 和 Java 关系"></a>Scala 和 Java 关系</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658019409566-79cccc2f-8d13-4173-ab66-84e2292c3250.png#clientId=ue5f03637-5720-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=635&id=u0e1558e1&margin=%5Bobject%20Object%5D&name=image-20220717085100663.png&originHeight=635&originWidth=1086&originalType=binary&ratio=1&rotation=0&showTitle=false&size=120687&status=done&style=none&taskId=u30e7e741-489b-4013-8733-38f9d458325&title=&width=1086" alt="image-20220717085100663.png"></p>
<h3 id="Scala-语言特点"><a href="#Scala-语言特点" class="headerlink" title="Scala 语言特点"></a>Scala 语言特点</h3><p>Scala是一门以Java虚拟机（JVM）为运行环境并将面向对象和函数式编程的最佳特性结合在一起的静态类型编程语言（静态语言需要提前编译的如：Java、c、c++等，动态语言如：js）。</p>
<ol>
<li>Scala是一门多范式的编程语言，Scala支持面向对象和函数式编程。（多范式，就是多种编程方法的意思。有面向过程、面向对象、泛型、函数式四种程序设计方法。）</li>
<li>Scala源代码（.scala）会被编译成Java字节码（.class），然后运行于JVM之上，并可以调用现有的Java类库，实现两种语言的无缝对接。</li>
<li>Scala单作为一门语言来看，非常的简洁高效。</li>
<li>Scala在设计时，马丁·奥德斯基是参考了Java的设计思想，可以说Scala是源于Java，同时马丁·奥德斯基也加入了自己的思想，将函数式编程语言的特点融合到JAVA中, 因此，对于学习过Java的同学，只要在学习Scala的过程中，搞清楚Scala和Java相同点和不同点，就可以快速的掌握Scala这门语言。</li>
</ol>
<h2 id="Scala-环境搭建"><a href="#Scala-环境搭建" class="headerlink" title="Scala 环境搭建"></a>Scala 环境搭建</h2><h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><p>（1）首先确保 JDK1.8 安装成功<br>（2）下载对应的 Scala 安装文件 scala-2.12.11.zip<br>（3）解压 scala-2.12.11.zip，我这里解压到 D:\Environment<br>（4）配置 Scala 的环境变量<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658019960896-6fc368dd-c647-4299-97c7-e30d0837795b.png#clientId=ue5f03637-5720-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=178&id=ud190ab49&margin=%5Bobject%20Object%5D&name=image.png&originHeight=178&originWidth=648&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8581&status=done&style=none&taskId=u79b82a57-5752-4d19-8d66-e4e461be3b8&title=&width=648" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658020048327-8f5028ad-3cfe-4b45-8f91-ac64c3d58771.png#clientId=ue5f03637-5720-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=544&id=u48924ffa&margin=%5Bobject%20Object%5D&name=image.png&originHeight=544&originWidth=512&originalType=binary&ratio=1&rotation=0&showTitle=false&size=37654&status=done&style=none&taskId=u4a371ee1-2d74-4262-afe2-94d4b1a5161&title=&width=512" alt="image.png"><br>注意 1：解压路径不能有任何中文路径，最好不要有空格。<br>注意 2：环境变量要大写 SCALA_HOME</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>需求：计算两数 a 和 b 的和。<br>（1）在键盘上同时按 win+r 键，并在运行窗口输入 cmd 命令<br>（2）输入 Scala 并按回车键，启动 Scala 环境。然后定义两个变量，并计算求和。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658020231676-27f949bb-47dd-40a6-8c46-2066eb6026a4.png#clientId=ue5f03637-5720-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=69&id=ub28700c5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=69&originWidth=696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8455&status=done&style=none&taskId=u44ad8869-fdc5-4bea-9a0a-e72ace5d14e&title=&width=696" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658020258691-cbd3dd15-1b5c-4878-8d96-17f1990427fa.png#clientId=ue5f03637-5720-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=200&id=uea280fdf&margin=%5Bobject%20Object%5D&name=image.png&originHeight=200&originWidth=259&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7476&status=done&style=none&taskId=uc43804ee-fa07-48cb-9a6b-29d2aef76a4&title=&width=259" alt="image.png"></p>
<h2 id="Scala插件安装"><a href="#Scala插件安装" class="headerlink" title="Scala插件安装"></a>Scala插件安装</h2><p>File-Setting-Plugins<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658020733173-d5ef9708-ece7-4e4e-b4db-a55c5357b793.png#clientId=ue5f03637-5720-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=712&id=u6fc82ca8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=712&originWidth=998&originalType=binary&ratio=1&rotation=0&showTitle=false&size=80261&status=done&style=none&taskId=u4590eefc-dc32-434c-9f31-1a6aca63c32&title=&width=998" alt="image.png"><br>安装完重启IDEA（安装可能比较慢）</p>
<h2 id="HelloWorld-案例"><a href="#HelloWorld-案例" class="headerlink" title="HelloWorld 案例"></a>HelloWorld <strong>案例</strong></h2><h3 id="创建一个Maven工程"><a href="#创建一个Maven工程" class="headerlink" title="创建一个Maven工程"></a>创建一个Maven工程</h3><p>并添加Scala框架支持<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658041029219-be2d79fd-cbf7-4744-830c-9598a9d9236e.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=629&id=u404e87e2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=629&originWidth=878&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48266&status=done&style=none&taskId=u543e3018-1357-482d-9509-f47f5f84356&title=&width=878" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658041161587-cbfe1b3e-55b1-4366-bdff-7067b99c54f2.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=148&id=u4eb2c83b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=148&originWidth=338&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5790&status=done&style=none&taskId=ub472aa5b-d925-44c9-a9a1-4f1489f3a49&title=&width=338" alt="image.png"></p>
<h3 id="创建-HelloWorld-scala"><a href="#创建-HelloWorld-scala" class="headerlink" title="创建 HelloWorld.scala"></a>创建 HelloWorld.scala</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter01</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   object: 关键字，声明一个单例对象（伴生对象）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    main 方法：从外部可以直接调用执行的方法</span></span><br><span class="line"><span class="comment">    def 方法名称(参数名称: 参数类型): 返回值类型 = &#123; 方法体 &#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;Hello world&quot;</span>)</span><br><span class="line">    <span class="type">System</span>.out.println(<span class="string">&quot;Hello world-java&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658041371133-8bc34069-79df-490c-95cd-fd91eb57f691.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=63&id=u84e97197&margin=%5Bobject%20Object%5D&name=image.png&originHeight=63&originWidth=210&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3252&status=done&style=none&taskId=u0ec614f6-be6f-40bf-9b91-086ba52097e&title=&width=210" alt="image.png"><br>说明：Java 中部分代码也是可以在 Scala 中运行。</p>
<h2 id="官方编程指南"><a href="#官方编程指南" class="headerlink" title="官方编程指南"></a>官方编程指南</h2><p>在线查看：<a target="_blank" rel="noopener" href="https://www.scala-lang.org/">https://www.scala-lang.org/</a></p>
<h1 id="变量和数据类型"><a href="#变量和数据类型" class="headerlink" title="变量和数据类型"></a>变量和数据类型</h1><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>Scala 注释使用和 Java 完全一样。<br>注释是一个程序员必须要具有的良好编程习惯。将自己的思想通过注释先整理出来，再用代码去体现。</p>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p>（1）单行注释：&#x2F;&#x2F;<br>（2）多行注释：&#x2F;* <em>&#x2F;<br>（3）文档注释：&#x2F;</em>* </p>
<p>   * </p>
<pre><code>                  */
</code></pre>
<h3 id="代码规范"><a href="#代码规范" class="headerlink" title="代码规范"></a>代码规范</h3><p>（1）使用一次 tab 操作，实现缩进，默认整体向右边移动，用 shift+tab 整体向左移<br>（2）或者使用 ctrl + alt + L 来进行格式化<br>（3）运算符两边习惯性各加一个空格。比如：2 + 4 * 5。<br>（4）一行最长不超过 80 个字符，超过的<strong>请使用换行展示</strong>，尽量保持格式优雅</p>
<h2 id="变量和常量（重点）"><a href="#变量和常量（重点）" class="headerlink" title="变量和常量（重点）"></a>变量和常量（重点）</h2><p>常量：在程序执行的过程中，其值不会被改变的变量</p>
<h3 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h3><p>Java 变量和常量语法<br>变量类型 变量名称 &#x3D; 初始值	int a &#x3D; 10<br>final 常量类型 常量名称 &#x3D; 初始值	final int b &#x3D; 20 </p>
<h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><p>var 变量名 [: 变量类型] &#x3D; 初始值	var i:Int &#x3D; 10<br>val 常量名 [: 常量类型] &#x3D; 初始值	val j:Int &#x3D; 20<br>注意：能用常量的地方不用变量</p>
<h3 id="案例实操"><a href="#案例实操" class="headerlink" title="案例实操"></a>案例实操</h3><p>（1）声明变量时，类型可以省略，编译器自动推导，即类型推导<br>（2）类型确定后，就不能修改，说明 Scala 是强数据类型语言。<br>（3）变量声明时，必须要有初始值<br>（4）在声明&#x2F;定义一个变量时，可以使用 var 或者 val 来修饰，var 修饰的变量可改变， val 修饰的变量不可改。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter02</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestVar</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args:<span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//（1）声明变量时，类型可以省略，编译器自动推导，即类型推导</span></span><br><span class="line">    <span class="keyword">var</span> age = <span class="number">18</span></span><br><span class="line">    age = <span class="number">30</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//（2）类型确定后，就不能修改，说明 Scala 是强数据类型语言。</span></span><br><span class="line">    <span class="comment">//age = &quot;tom&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//（3）变量声明时，必须要有初始值</span></span><br><span class="line">    <span class="comment">//var name //错误</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//（4）在声明/定义一个变量时，可以使用var或者val来修饰，var修饰的变量可改变，val修饰的变量不可改。</span></span><br><span class="line">    <span class="keyword">var</span> num1 = <span class="number">10</span> <span class="comment">//可变</span></span><br><span class="line">    <span class="keyword">val</span> num2 = <span class="number">20</span> <span class="comment">//不可变</span></span><br><span class="line">    num1 = <span class="number">30</span> <span class="comment">// 正确</span></span><br><span class="line">    <span class="comment">//num2 = 40 //错误，因为 num2 是 val 修饰的</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（5）var 修饰的对象引用可以改变，val 修饰的对象则不可改变，但对象的状态（值）却是可以改变的。（比如：自定义对象、数组、集合等等）</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter01</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">name:<span class="type">String</span>,var age:<span class="type">Int</span></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>():<span class="type">Unit</span> = &#123;</span><br><span class="line">    println(name + <span class="string">&quot; &quot;</span> + age + <span class="string">&quot; &quot;</span> + <span class="type">Student</span>.school)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">  <span class="keyword">val</span> school: <span class="type">String</span> = <span class="string">&quot;atguigu&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> alice = <span class="keyword">new</span> <span class="type">Student</span>(<span class="string">&quot;alice&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    <span class="keyword">val</span> bob = <span class="keyword">new</span> <span class="type">Student</span>(<span class="string">&quot;bob&quot;</span>, <span class="number">23</span>)</span><br><span class="line"></span><br><span class="line">    alice.printInfo()</span><br><span class="line">    bob.printInfo()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter02</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> chapter01.<span class="type">Student</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestVar</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args:<span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">var</span> alice = <span class="keyword">new</span> <span class="type">Student</span>(<span class="string">&quot;alice&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    alice = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">val</span> bob = <span class="keyword">new</span> <span class="type">Student</span>(<span class="string">&quot;bob&quot;</span>, <span class="number">23</span>)</span><br><span class="line">    bob.age = <span class="number">24</span></span><br><span class="line">    <span class="comment">//bob = null //错误</span></span><br><span class="line">    bob.printInfo()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="标识符的命名规范"><a href="#标识符的命名规范" class="headerlink" title="标识符的命名规范"></a>标识符的命名规范</h2><p>Scala 对各种变量、方法、函数等命名时使用的字符序列称为标识符。即：凡是自己可 以起名字的地方都叫标识符。</p>
<h3 id="命名规则"><a href="#命名规则" class="headerlink" title="命名规则"></a>命名规则</h3><p>Scala 中的标识符声明，基本和 Java 是一致的，但是细节上会有所变化，有以下三种规则：<br>（1）以字母或者下划线开头，后接字母、数字、下划线<br>（2）以操作符开头，且只包含操作符（+ - * &#x2F; # !等）<br>（3）用反引号<code>....</code>包括的任意字符串，即使是 Scala 关键字（39 个）也可以<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658044402829-262f7c79-c48d-4a0b-b36c-1f0f6464349b.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=446&id=u53de3594&margin=%5Bobject%20Object%5D&name=image.png&originHeight=446&originWidth=716&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85456&status=done&style=none&taskId=u355e56fd-decb-4037-a282-dae903f946c&title=&width=716" alt="image.png"></p>
<h3 id="案例实操-1"><a href="#案例实操-1" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter02</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestIdentifier</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//（1）以字母或者下划线开头，后接字母、数字、下划线</span></span><br><span class="line">    <span class="keyword">val</span> hello: <span class="type">String</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> <span class="type">Hello123</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">val</span> _abc = <span class="number">123</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//    val h-b = &quot;&quot; //错误</span></span><br><span class="line">    <span class="comment">//    val 123abc = 234 //错误</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//（2）以操作符开头，且只包含操作符（+ - * / # !等）</span></span><br><span class="line">    <span class="keyword">val</span> -+/% = <span class="string">&quot;hello&quot;</span></span><br><span class="line">    println(-+/%)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//（3）用反引号`....`包括的任意字符串，即使是Scala关键字（39个）也可以</span></span><br><span class="line">    <span class="keyword">val</span> `<span class="keyword">if</span>` = <span class="string">&quot;if&quot;</span></span><br><span class="line">    println(`<span class="keyword">if</span>`)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="字符串输出"><a href="#字符串输出" class="headerlink" title="字符串输出"></a>字符串输出</h2><h3 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h3><p>（1）字符串，通过+号连接<br>（2）printf 用法：字符串，通过%传值。<br>（3）字符串模板（插值字符串）：通过$获取变量值 </p>
<h3 id="案例实操-2"><a href="#案例实操-2" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter02</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestString</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//（1）字符串，通过+号连接</span></span><br><span class="line">    <span class="keyword">val</span> name: <span class="type">String</span> = <span class="string">&quot;alice&quot;</span></span><br><span class="line">    <span class="keyword">val</span> age: <span class="type">Int</span> = <span class="number">18</span></span><br><span class="line">    println(age + <span class="string">&quot;岁的&quot;</span> + name + <span class="string">&quot;在尚硅谷学习&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// *用于将一个字符串复制多次并拼接</span></span><br><span class="line">    println(name * <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//（2）printf用法：字符串，通过%传值。</span></span><br><span class="line">    printf(<span class="string">&quot;%d岁的%s在尚硅谷学习&quot;</span>, age, name)</span><br><span class="line">    println()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//（3）字符串模板（插值字符串）：通过$获取变量值</span></span><br><span class="line">    println(<span class="string">s&quot;<span class="subst">$&#123;age&#125;</span>岁的<span class="subst">$&#123;name&#125;</span>在尚硅谷学习&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> num: <span class="type">Double</span> = <span class="number">2.3456</span></span><br><span class="line">    println(<span class="string">f&quot;The num is <span class="subst">$&#123;num&#125;</span>%2.2f&quot;</span>)    <span class="comment">// 格式化模板字符串</span></span><br><span class="line">    println(<span class="string">raw&quot;The num is <span class="subst">$&#123;num&#125;</span>%2.2f&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 三引号表示字符串，保持多行字符串的原格式输出</span></span><br><span class="line">    <span class="keyword">val</span> sql = <span class="string">s&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">                 |select *</span></span><br><span class="line"><span class="string">                 |from</span></span><br><span class="line"><span class="string">                 |  student</span></span><br><span class="line"><span class="string">                 |where</span></span><br><span class="line"><span class="string">                 |  name = $&#123;name&#125;</span></span><br><span class="line"><span class="string">                 |and</span></span><br><span class="line"><span class="string">                 |  age &gt; $&#123;age&#125;</span></span><br><span class="line"><span class="string">                 |&quot;</span><span class="string">&quot;&quot;</span>.stripMargin</span><br><span class="line">    println(sql)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658044798785-42b65ab4-09a9-43c1-888c-a19270d0ee7b.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=448&id=u45456ec6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=448&originWidth=289&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32961&status=done&style=none&taskId=u56008463-2104-4bda-a836-a2def9541ce&title=&width=289" alt="image.png"></p>
<h2 id="键盘输入"><a href="#键盘输入" class="headerlink" title="键盘输入"></a>键盘输入</h2><h3 id="基本语法-3"><a href="#基本语法-3" class="headerlink" title="基本语法"></a>基本语法</h3><p>StdIn.readLine()、StdIn.readShort()、StdIn.readDouble()</p>
<h3 id="案例实操-3"><a href="#案例实操-3" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter02</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.io.<span class="type">StdIn</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestInput</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;请输入您的名字:&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> name = <span class="type">StdIn</span>.readLine()</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;请输入您的年龄：&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> age: <span class="type">Int</span> = <span class="type">StdIn</span>.readInt()</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;请输入您的薪水:&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> sal = <span class="type">StdIn</span>.readDouble()</span><br><span class="line">    println(<span class="string">s&quot;<span class="subst">$&#123;name&#125;</span>,<span class="subst">$&#123;age&#125;</span>,<span class="subst">$&#123;sal&#125;</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658045099806-2b0bd8e1-64d0-4185-891d-8b4de9c29004.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=222&id=u4b01875c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=222&originWidth=216&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14789&status=done&style=none&taskId=u262df1bd-0b68-43ce-81f6-3de1bc274f3&title=&width=216" alt="image.png"></p>
<h2 id="从文件读取数据"><a href="#从文件读取数据" class="headerlink" title="从文件读取数据"></a>从文件读取数据</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658045327663-d948f930-2d18-41fe-ab8e-0a409b3ccef1.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=142&id=u9e223740&margin=%5Bobject%20Object%5D&name=image.png&originHeight=142&originWidth=330&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6806&status=done&style=none&taskId=u507f3bf0-6080-4f3a-9626-c5ae3bc8222&title=&width=330" alt="image.png"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br><span class="line">hello scala</span><br><span class="line">hello java!</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter02</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.&#123;<span class="type">File</span>, <span class="type">PrintWriter</span>&#125;</span><br><span class="line"><span class="keyword">import</span> scala.io.<span class="type">Source</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestFileIO</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 从文件中读取数据</span></span><br><span class="line">    <span class="type">Source</span>.fromFile(<span class="string">&quot;src/main/resources/test.txt&quot;</span>).foreach(print)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 将数据写入文件</span></span><br><span class="line">    <span class="keyword">val</span> writer = <span class="keyword">new</span> <span class="type">PrintWriter</span>(<span class="keyword">new</span> <span class="type">File</span>(<span class="string">&quot;src/main/resources/output.txt&quot;</span>))</span><br><span class="line">    writer.write(<span class="string">&quot;hello scala from java writer&quot;</span>)</span><br><span class="line">    writer.close()</span><br><span class="line">    println(<span class="string">&quot;写入成功&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658045515250-674f29ca-7176-46c0-9e24-425171b79d75.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=98&id=u9d4a7cdd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=98&originWidth=231&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6189&status=done&style=none&taskId=u73cd3c5d-fdce-4681-9180-592538174d1&title=&width=231" alt="image.png"></p>
<h2 id="数据类型（重点）"><a href="#数据类型（重点）" class="headerlink" title="数据类型（重点）"></a>数据类型（重点）</h2><h3 id="Java数据类型"><a href="#Java数据类型" class="headerlink" title="Java数据类型"></a>Java数据类型</h3><p>Java基本类型：char、byte、short、int、long、float、double、boolean<br>Java引用类型：（对象类型）<br>由于Java有基本类型，而且基本类型不是真正意义的对象，即使后面产生了基本类型的包装类，但是仍然存在基本数据类型，所以Java语言并不是真正意思的面向对象。<br>Java基本类型的包装类：Character、Byte、Short、Integer、Long、Float、Double、Boolean<br>注意：Java中基本类型和引用类型没有共同的祖先。</p>
<h3 id="Scala数据类型"><a href="#Scala数据类型" class="headerlink" title="Scala数据类型"></a>Scala数据类型</h3><p>1）Scala中一切数据都是对象，都是Any的子类。<br>2）Scala中数据类型分为两大类：数值类型（AnyVal）、 引用类型（AnyRef），不管是值类型还是引用类型都是对象。<br>3）Scala数据类型仍然遵守，低精度的值类型向高精 度值类型，自动转换（隐式转换）。<br>4）Scala中的StringOps是对Java中的String增强。<br>5）Unit：对应Java中的void，用于方法返回值的位置，表 示方法没有返回值。Unit是 一个数据类型，只有一个对象 就是()。Void不是数据类型，只是一个关键字。<br>6）Null是一个类型，只 有一个对 象就 是null。它是 所有引用类型（AnyRef）的子类。<br>7）Nothing，是所有数据类型的子类，主要用在一个函数没有明确返回值时使 用，因为这样我们可以把抛出的返回值，返回给任何的变量或者函数。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658045781589-736957fe-6ff6-4a6a-a6f4-220dcb8fe77e.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=638&id=u8c78a88d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=638&originWidth=966&originalType=binary&ratio=1&rotation=0&showTitle=false&size=223171&status=done&style=none&taskId=u12848af3-6476-4748-b06b-b8799e3ce29&title=&width=966" alt="image.png"></p>
<h2 id="整数类型（Byte、Short、Int、Long）"><a href="#整数类型（Byte、Short、Int、Long）" class="headerlink" title="整数类型（Byte、Short、Int、Long）"></a>整数类型（Byte、Short、Int、Long）</h2><h3 id="整型分类"><a href="#整型分类" class="headerlink" title="整型分类"></a>整型分类</h3><table>
<thead>
<tr>
<th>**数据类型 **</th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Byte [1]</td>
<td>8 位有符号补码整数。数值区间为-128 到 127</td>
</tr>
<tr>
<td>Short [2]</td>
<td>16 位有符号补码整数。数值区间为 -32768 到 32767</td>
</tr>
<tr>
<td>Int [4]</td>
<td>32 位有符号补码整数。数值区间为 -2147483648 到 2147483647</td>
</tr>
<tr>
<td>Long [8]</td>
<td>64 位有符号补码整数。数值区间为 -9223372036854775808 到</td>
</tr>
<tr>
<td>9223372036854775807 &#x3D; 2 的(64-1)次方-1</td>
<td></td>
</tr>
</tbody></table>
<h3 id="案例实操-4"><a href="#案例实操-4" class="headerlink" title="案例实操"></a>案例实操</h3><p>（1）Scala 各整数类型有固定的表示范围和字段长度，不受具体操作的影响，以保证 Scala 程序的可移植性。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter02</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestDataType</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 正确</span></span><br><span class="line">    <span class="keyword">var</span> n1:<span class="type">Byte</span> = <span class="number">127</span></span><br><span class="line">    <span class="keyword">var</span> n2:<span class="type">Byte</span> = <span class="number">-128</span></span><br><span class="line">    <span class="comment">// 错误</span></span><br><span class="line">    <span class="comment">// var n3:Byte = 128</span></span><br><span class="line">    <span class="comment">// var n4:Byte = -129</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）Scala 的整型，默认为 Int 型，声明 Long 型，须后加‘l’或‘L’</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter02</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestDataType</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">var</span> n5 = <span class="number">10</span></span><br><span class="line">    println(n5)</span><br><span class="line">    <span class="keyword">var</span> n6 = <span class="number">9223372036854775807</span>L</span><br><span class="line">    println(n6)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）Scala 程序中变量常声明为 Int 型，除非不足以表示大数，才使用 Long</p>
<h2 id="浮点类型（Float、Double-）"><a href="#浮点类型（Float、Double-）" class="headerlink" title="浮点类型（Float、Double**） **"></a><strong>浮点类型（</strong>Float<strong>、</strong>Double**） **</h2><h3 id="浮点型分类"><a href="#浮点型分类" class="headerlink" title="浮点型分类"></a>浮点型分类</h3><table>
<thead>
<tr>
<th><strong>数据类型</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Float [4]</td>
<td>32 位 IEEE 754 标准的单精度浮点数</td>
</tr>
<tr>
<td>Double [8]</td>
<td>64 位 IEEE 754 标准的双精度浮点数</td>
</tr>
</tbody></table>
<h3 id="案例实操-5"><a href="#案例实操-5" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f1: <span class="type">Float</span> = <span class="number">1.2345</span>f</span><br><span class="line"><span class="keyword">val</span> d1 = <span class="number">34.2245</span></span><br><span class="line">println(d1.getClass)</span><br></pre></td></tr></table></figure>

<p>默认Double类型</p>
<h2 id="字符类型（Char）"><a href="#字符类型（Char）" class="headerlink" title="字符类型（Char）"></a>字符类型（Char）</h2><h3 id="基本说明"><a href="#基本说明" class="headerlink" title="基本说明"></a>基本说明</h3><p>字符类型可以表示单个字符，字符类型是 Char。 </p>
<h3 id="案例实操-6"><a href="#案例实操-6" class="headerlink" title="案例实操"></a>案例实操</h3><p>（1）字符常量是用单引号 ‘ ‘ 括起来的单个字符。<br>（2）\t ：一个制表位，实现对齐的功能<br>（3）\n ：换行符<br>（4）\ ：表示\<br>（5）&quot; ：表示”</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter02</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestCharType</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">var</span> c1: <span class="type">Char</span> = &#x27;a&#x27;</span><br><span class="line">    println(<span class="string">&quot;c1=&quot;</span> + c1)</span><br><span class="line">    <span class="comment">//注意：这里涉及自动类型提升，其实编译器可以自定判断是否超出范围，</span></span><br><span class="line">    <span class="comment">//不过 idea 提示报错</span></span><br><span class="line">    <span class="keyword">var</span> c2:<span class="type">Char</span> = &#x27;a&#x27; + <span class="number">1</span></span><br><span class="line">    println(c2)</span><br><span class="line">    <span class="comment">//字符类型底层保存ASCII码</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658047103709-3ab80bb2-f017-40ad-b742-91c8f071dbf2.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=62&id=u11c505a2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=62&originWidth=78&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1397&status=done&style=none&taskId=ucacba9ab-be18-4671-b50a-b1cb3b50b2f&title=&width=78" alt="image.png"></p>
<h2 id="布尔类型（Boolean）"><a href="#布尔类型（Boolean）" class="headerlink" title="布尔类型（Boolean）"></a>布尔类型（Boolean）</h2><h3 id="基本说明-1"><a href="#基本说明-1" class="headerlink" title="基本说明"></a>基本说明</h3><p>（1）布尔类型也叫 Boolean 类型，Booolean 类型数据只允许取值 true 和 false<br>（2）boolean 类型占 1 个字节。</p>
<h3 id="案例实操-7"><a href="#案例实操-7" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> isTrue: <span class="type">Boolean</span> = <span class="literal">true</span></span><br><span class="line">println(isTrue)</span><br></pre></td></tr></table></figure>

<h2 id="Unit-类型、Null-类型和-Nothing-类型（重点）"><a href="#Unit-类型、Null-类型和-Nothing-类型（重点）" class="headerlink" title="Unit 类型、Null 类型和 Nothing 类型（重点）"></a>Unit 类型、Null 类型和 Nothing 类型（重点）</h2><h3 id="基本说明-2"><a href="#基本说明-2" class="headerlink" title="基本说明"></a>基本说明</h3><table>
<thead>
<tr>
<th><strong>数据类型</strong></th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Unit</strong></td>
<td>表示无值，和其他语言中 void 等同。用作不返回任何结果的方法的结果 类型。Unit 只有一个实例值，写成()。</td>
</tr>
<tr>
<td>**Null **</td>
<td>null , Null 类型只有一个实例值 null</td>
</tr>
<tr>
<td><strong>Nothing</strong></td>
<td>Nothing 类型在 Scala 的类层级最低端；它是任何其他类型的子类型。 当一个函数，我们确定没有正常的返回值，可以用 Nothing 来指定返回类 型，这样有一个好处，就是我们可以把返回的值（异常）赋给其它的函数 或者变量（兼容性）</td>
</tr>
</tbody></table>
<h3 id="案例实操-8"><a href="#案例实操-8" class="headerlink" title="案例实操"></a>案例实操</h3><p>（1）Unit 类型用来标识过程，也就是没有明确返回值的函数。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">m1</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">  println(<span class="string">&quot;m1被调用执行&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> a: <span class="type">Unit</span> = m1()</span><br><span class="line">println(<span class="string">&quot;a: &quot;</span> + a) <span class="comment">//()</span></span><br></pre></td></tr></table></figure>

<p>（2）Null 类只有一个实例对象，Null 类似于 Java 中的 null 引用。Null <strong>可以赋值给任 意引用类型（</strong>AnyRef<strong>），但是不能赋值给值类型（</strong>AnyVal<strong>）</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jack = <span class="keyword">new</span> <span class="type">Student</span>(<span class="string">&quot;jack&quot;</span>,<span class="number">21</span>);</span><br><span class="line">jack = <span class="literal">null</span> <span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">var</span> n1: <span class="type">Int</span> = <span class="literal">null</span> <span class="comment">// 错误</span></span><br><span class="line">println(<span class="string">&quot;n1:&quot;</span> + n1)</span><br></pre></td></tr></table></figure>

<p>（3）Nothing，可以作为没有正常返回值的方法的返回类型，非常直观的告诉你这个方法不会正常返回，而且由于 Nothing 是其他任意类型的子类，他还能跟要求返回值的方法兼容。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">m2</span></span>(n: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">NullPointerException</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> b: <span class="type">Int</span> = m2(<span class="number">2</span>)</span><br><span class="line">println(<span class="string">&quot;b: &quot;</span> + b) <span class="comment">//b：2</span></span><br></pre></td></tr></table></figure>

<h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><h3 id="数值类型自动转换"><a href="#数值类型自动转换" class="headerlink" title="数值类型自动转换"></a>数值类型自动转换</h3><p>当 Scala 程序在进行赋值或者运算时，精度小的类型自动转换为精度大的数值类型，这 个就是自动类型转换（隐式转换）。数据类型按精度（容量）大小排序为：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658049877752-fbfc4a80-669f-4ce1-94e3-c1c24fd12809.png#clientId=uc7666ae1-fc7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=378&id=u8f9a0675&margin=%5Bobject%20Object%5D&name=image.png&originHeight=378&originWidth=434&originalType=binary&ratio=1&rotation=0&showTitle=false&size=91175&status=done&style=none&taskId=u67f0387e-b2bd-4709-937f-5b702a0e5ed&title=&width=434" alt="image.png"></p>
<h4 id="基本说明-3"><a href="#基本说明-3" class="headerlink" title="基本说明"></a>基本说明</h4><p>（1）自动提升原则：有多种类型的数据混合运算时，系统首先自动将所有数据转换成 精度大的那种数据类型，然后再进行计算。<br>（2）把精度大的数值类型赋值给精度小的数值类型时，就会报错，反之就会进行自动 类型转换。<br>（3）（byte，short）和 char 之间不会相互自动转换。<br>（4）byte，short，char 他们三者可以计算，在计算时首先转换为 int 类型。</p>
<h4 id="案例实操-9"><a href="#案例实操-9" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter02</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestValueTransfer</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 1. 自动类型转换</span></span><br><span class="line">  <span class="comment">//    （1）自动提升原则：有多种类型的数据混合运算时，系统首先自动将所有数据转换成精度大的那种数据类型，然后再进行计算。</span></span><br><span class="line">  <span class="keyword">val</span> a1: <span class="type">Byte</span> = <span class="number">10</span></span><br><span class="line">  <span class="keyword">val</span> b1: <span class="type">Long</span> = <span class="number">2353</span></span><br><span class="line">  <span class="keyword">val</span> result1: <span class="type">Long</span> = a1 + b1</span><br><span class="line">  <span class="keyword">val</span> result11: <span class="type">Int</span> = (a1 + b1.toInt) <span class="comment">// 强转</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//    （2）把精度大的数值类型赋值给精度小的数值类型时，就会报错，反之就会进行自动类型转换。</span></span><br><span class="line">  <span class="keyword">val</span> a2: <span class="type">Byte</span> = <span class="number">10</span></span><br><span class="line">  <span class="keyword">val</span> b2: <span class="type">Int</span> = a2</span><br><span class="line">  <span class="comment">//    val c2: Byte = b2    // error</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//    （3）（byte，short）和char之间不会相互自动转换。</span></span><br><span class="line">  <span class="keyword">val</span> a3: <span class="type">Byte</span> = <span class="number">10</span></span><br><span class="line">  <span class="keyword">val</span> b3: <span class="type">Char</span> = &#x27;b&#x27;</span><br><span class="line">  <span class="comment">//    val c3: Byte = b3    // error</span></span><br><span class="line">  <span class="keyword">val</span> c3: <span class="type">Int</span> = b3</span><br><span class="line">  println(c3)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//    （4）byte，short，char他们三者可以计算，在计算时首先转换为int类型。</span></span><br><span class="line">  <span class="keyword">val</span> a4: <span class="type">Byte</span> = <span class="number">12</span></span><br><span class="line">  <span class="keyword">val</span> b4: <span class="type">Short</span> = <span class="number">25</span></span><br><span class="line">  <span class="keyword">val</span> c4: <span class="type">Char</span> = &#x27;c&#x27;</span><br><span class="line">  <span class="keyword">val</span> result4: <span class="type">Int</span> = a4 + b4</span><br><span class="line">  <span class="keyword">val</span> result44: <span class="type">Int</span> = a4 + b4 + c4</span><br><span class="line">  println(result44)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h3><h4 id="基本说明-4"><a href="#基本说明-4" class="headerlink" title="基本说明"></a>基本说明</h4><p>自动类型转换的逆过程，将精度大的数值类型转换为精度小的数值类型。使用时要加上强制转函数，但可能造成精度降低或溢出，格外要注意。</p>
<h4 id="案例实操-10"><a href="#案例实操-10" class="headerlink" title="案例实操"></a>案例实操</h4><p>（1）将数据由高精度转换为低精度，就需要使用到强制转换<br>（2）强转符号只针对于最近的操作数有效，往往会使用小括号提升优先级<br>（3）基本类型转 String 类型（语法：将基本类型的值+”” 即可）<br>（4）String 类型转基本数值类型（语法：s1.toInt、s1.toFloat、s1.toDouble、s1.toByte、s1.toLong、s1.toShort）</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 强制类型转换</span></span><br><span class="line"><span class="comment">//    （1）将数据由高精度转换为低精度，就需要使用到强制转换</span></span><br><span class="line"><span class="keyword">val</span> n1: <span class="type">Int</span> = <span class="number">-2.9</span>.toInt</span><br><span class="line">println(<span class="string">&quot;n1: &quot;</span> + n1) <span class="comment">//取整数部分，直接省去小数点后的数字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    （2）强转符号只针对于最近的操作数有效，往往会使用小括号提升优先级</span></span><br><span class="line"><span class="keyword">val</span> n2: <span class="type">Int</span> = <span class="number">2.6</span>.toInt + <span class="number">3.7</span>.toInt</span><br><span class="line"><span class="keyword">val</span> n3: <span class="type">Int</span> = (<span class="number">2.6</span> + <span class="number">3.7</span>).toInt</span><br><span class="line">println(<span class="string">&quot;n2: &quot;</span> + n2)</span><br><span class="line">println(<span class="string">&quot;n3: &quot;</span> + n3)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 数值类型和String类型的转换</span></span><br><span class="line"><span class="comment">// (1) 数值转String</span></span><br><span class="line"><span class="keyword">val</span> n: <span class="type">Int</span> = <span class="number">27</span></span><br><span class="line"><span class="keyword">val</span> s: <span class="type">String</span> = n + <span class="string">&quot;&quot;</span></span><br><span class="line">println(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// (2) String转数值</span></span><br><span class="line"><span class="keyword">val</span> m: <span class="type">Int</span> = <span class="string">&quot;12&quot;</span>.toInt</span><br><span class="line"><span class="keyword">val</span> f: <span class="type">Float</span> = <span class="string">&quot;12.3&quot;</span>.toFloat</span><br><span class="line"><span class="keyword">val</span> f2: <span class="type">Int</span> = <span class="string">&quot;12.3&quot;</span>.toDouble.toInt</span><br><span class="line">println(f2)</span><br></pre></td></tr></table></figure>

<p>在将 String 类型转成基本数值类型时，要确保 String 类型能够转成有效的数据，比如我 们可以把”123”，转成一个整数，但是不能把”hello”转成一个整数。<br>var n5:Int &#x3D; “12.6”.toInt 会出现 NumberFormatException 异常。</p>
<h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><p>Scala 运算符的使用和 Java 运算符的使用基本相同，只有个别细节上不同。</p>
<h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><h3 id="基本语法-4"><a href="#基本语法-4" class="headerlink" title="基本语法"></a>基本语法</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658057259403-43b705b5-1407-443a-9fef-a834f4cd13f7.png#clientId=u4502deb3-8ff0-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=546&id=u92f38744&margin=%5Bobject%20Object%5D&name=image.png&originHeight=546&originWidth=1039&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71332&status=done&style=none&taskId=ue98d7d6f-9f33-4406-93a9-eeb6d3d97d2&title=&width=1039" alt="image.png"><br>（1）对于除号“&#x2F;”，它的整数除和小数除是有区别的：整数之间做除法时，只保留整 数部分而舍弃小数部分。<br>（2）对一个数取模 a%b，和 Java 的取模规则一样。</p>
<h3 id="案例实操-11"><a href="#案例实操-11" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter03</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestArithmetic</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//（1）对于除号“/”，它的整数除和小数除是有区别的：整数之间做除法时，只保留整数部分而舍弃小数部分。</span></span><br><span class="line">    <span class="keyword">var</span> r1: <span class="type">Int</span> = <span class="number">10</span> / <span class="number">3</span> <span class="comment">// 3</span></span><br><span class="line">    println(<span class="string">&quot;r1=&quot;</span> + r1)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> r2: <span class="type">Double</span> = <span class="number">10</span> / <span class="number">3</span> <span class="comment">// 3.0</span></span><br><span class="line">    println(<span class="string">&quot;r2=&quot;</span> + r2)</span><br><span class="line">    <span class="keyword">var</span> r3: <span class="type">Double</span> = <span class="number">10.0</span> / <span class="number">3</span> <span class="comment">// 3.3333</span></span><br><span class="line">    println(<span class="string">&quot;r3=&quot;</span> + r3)</span><br><span class="line">    println(<span class="string">&quot;r3=&quot;</span> + r3.formatted(<span class="string">&quot;%.2f&quot;</span>)) <span class="comment">// 含义：保留小数点 2位，使用四舍五入</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//（2）对一个数取模 a%b，和 Java 的取模规则一样。</span></span><br><span class="line">    <span class="keyword">var</span> r4 = <span class="number">10</span> % <span class="number">3</span> <span class="comment">// 1</span></span><br><span class="line">    println(<span class="string">&quot;r4=&quot;</span> + r4)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="关系运算符（比较运算符）"><a href="#关系运算符（比较运算符）" class="headerlink" title="关系运算符（比较运算符）"></a>关系运算符（比较运算符）</h2><h3 id="基本语法-5"><a href="#基本语法-5" class="headerlink" title="基本语法"></a>基本语法</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658057437077-73124d6f-4739-45f5-9055-e3ba9fae3488.png#clientId=u4502deb3-8ff0-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=430&id=u292e29c4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=430&originWidth=1015&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60817&status=done&style=none&taskId=u63dadc7a-e57c-46ba-8663-d130f1bd8da&title=&width=1015" alt="image.png"></p>
<h3 id="案例实操-12"><a href="#案例实操-12" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter03</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestRelation</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 测试：&gt;、&gt;=、&lt;=、&lt;、==、!=</span></span><br><span class="line">    <span class="keyword">var</span> a: <span class="type">Int</span> = <span class="number">2</span></span><br><span class="line">    <span class="keyword">var</span> b: <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line">    println(a &gt; b) <span class="comment">// true</span></span><br><span class="line">    println(a &gt;= b) <span class="comment">// true</span></span><br><span class="line">    println(a &lt;= b) <span class="comment">// false</span></span><br><span class="line">    println(a &lt; b) <span class="comment">// false</span></span><br><span class="line">    println(<span class="string">&quot;a==b&quot;</span> + (a == b)) <span class="comment">// false</span></span><br><span class="line">    println(a != b) <span class="comment">// true</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> s1: <span class="type">String</span> = <span class="string">&quot;hello&quot;</span></span><br><span class="line">    <span class="keyword">val</span> s2: <span class="type">String</span> = <span class="keyword">new</span> <span class="type">String</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"></span><br><span class="line">    println(s1 == s2) <span class="comment">//true</span></span><br><span class="line">    println(s1.equals(s2)) <span class="comment">//true</span></span><br><span class="line">    println(s1.eq(s2)) <span class="comment">//判断s1,s2的引用地址是否相等  false</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;===================&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Java-和-Scala-中关于-x3D-x3D-的区别"><a href="#Java-和-Scala-中关于-x3D-x3D-的区别" class="headerlink" title="Java 和 Scala 中关于&#x3D;&#x3D;的区别"></a>Java 和 Scala 中关于&#x3D;&#x3D;的区别</h3><p>Java：<br>&#x3D;&#x3D;比较两个变量本身的值，即两个对象在内存中的首地址；<br>equals 比较字符串中所包含的内容是否相同。<br>Scala：&#x3D;&#x3D;更加类似于 Java 中的 equals</p>
<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><h3 id="基本语法-6"><a href="#基本语法-6" class="headerlink" title="基本语法"></a>基本语法</h3><p>用于连接多个条件（一般来讲就是关系表达式），最终的结果也是一个 Boolean 值。<br>假定：变量 A 为 true，B 为 false<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658057818386-6aedd455-97ff-417b-aa89-d371bb20aaea.png#clientId=u4502deb3-8ff0-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=324&id=ud46821f0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=324&originWidth=957&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71676&status=done&style=none&taskId=u7fbd2855-c889-4805-803c-3760ad9f0c9&title=&width=957" alt="image.png"></p>
<h3 id="案例实操-13"><a href="#案例实操-13" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter03</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestLogic</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 测试：&amp;&amp;、||、!</span></span><br><span class="line">    <span class="keyword">var</span> a = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">var</span> b = <span class="literal">false</span></span><br><span class="line">    println(<span class="string">&quot;a&amp;&amp;b=&quot;</span> + (a &amp;&amp; b)) <span class="comment">// a&amp;&amp;b=false</span></span><br><span class="line">    println(<span class="string">&quot;a||b=&quot;</span> + (a || b)) <span class="comment">// a||b=true</span></span><br><span class="line">    println(<span class="string">&quot;!(a&amp;&amp;b)=&quot;</span> + (!(a &amp;&amp; b))) <span class="comment">// !(a&amp;&amp;b)=true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h2><h3 id="基本语法-7"><a href="#基本语法-7" class="headerlink" title="基本语法"></a>基本语法</h3><p>赋值运算符就是将某个运算后的值，赋给指定的变量。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658057973398-75a6ad09-fb6f-4395-9c13-6ede7373fd8c.png#clientId=u4502deb3-8ff0-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=691&id=u8c789868&margin=%5Bobject%20Object%5D&name=image.png&originHeight=691&originWidth=627&originalType=binary&ratio=1&rotation=0&showTitle=false&size=139126&status=done&style=none&taskId=u280706ae-1430-42a2-9bc6-0db21bff806&title=&width=627" alt="image.png"><br>注意：Scala 中没有++、–操作符，可以通过+&#x3D;、-&#x3D;来实现同样的效果；</p>
<h3 id="案例实操-14"><a href="#案例实操-14" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter03</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestAssignment</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">var</span> r1 = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    r1 += <span class="number">1</span> <span class="comment">// 没有++</span></span><br><span class="line">    r1 -= <span class="number">2</span> <span class="comment">// 没有--</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h2><h3 id="基本语法-8"><a href="#基本语法-8" class="headerlink" title="基本语法"></a>基本语法</h3><p>下表中变量 a 为 60，b 为 13。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658058069671-2ef4bd17-7fc0-446e-b872-f4a4434e20ff.png#clientId=u4502deb3-8ff0-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=600&id=ua5df442b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=600&originWidth=832&originalType=binary&ratio=1&rotation=0&showTitle=false&size=196858&status=done&style=none&taskId=udf9d29a3-4880-4a4e-9120-25ba01b0443&title=&width=832" alt="image.png"></p>
<h3 id="案例实操-15"><a href="#案例实操-15" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter03</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestPosition</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 测试：1000 &lt;&lt; 1 =&gt;10000</span></span><br><span class="line">    <span class="keyword">var</span> n1 :<span class="type">Int</span> =<span class="number">8</span></span><br><span class="line">    n1 = n1 &lt;&lt; <span class="number">1</span></span><br><span class="line">    println(n1)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Scala-运算符本质"><a href="#Scala-运算符本质" class="headerlink" title="Scala 运算符本质"></a>Scala 运算符本质</h2><p>在 Scala 中其实是没有运算符的，所有运算符都是方法。<br>1）当调用对象的方法时，点.可以省略<br>2）如果函数参数只有一个，或者没有参数，()可以省略</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter03</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestOpt</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 标准的加法运算</span></span><br><span class="line">    <span class="keyword">val</span> i:<span class="type">Int</span> = <span class="number">1.</span>+(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">// （1）当调用对象的方法时，.可以省略</span></span><br><span class="line">    <span class="keyword">val</span> j:<span class="type">Int</span> = <span class="number">1</span> + (<span class="number">1</span>)</span><br><span class="line">    <span class="comment">// （2）如果函数参数只有一个，或者没有参数，()可以省略</span></span><br><span class="line">    <span class="keyword">val</span> k:<span class="type">Int</span> = <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    println(<span class="number">1.</span>toString())</span><br><span class="line">    println(<span class="number">1</span> toString())</span><br><span class="line">    println(<span class="number">1</span> toString)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="分支控制-if-else"><a href="#分支控制-if-else" class="headerlink" title="分支控制 if-else"></a>分支控制 if-else</h2><p>让程序有选择的的执行，分支控制有三种：单分支、双分支、多分支。</p>
<h3 id="单分支"><a href="#单分支" class="headerlink" title="单分支"></a>单分支</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter04</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.io.<span class="type">StdIn</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestIfElse</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//需求：输入人的年龄，如果该同志的年龄小于 18 岁，则输出“童年”</span></span><br><span class="line">    println(<span class="string">&quot;input age:&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> age = <span class="type">StdIn</span>.readShort()</span><br><span class="line">    <span class="comment">//当条件表达式为 ture 时，就会执行&#123; &#125;的代码</span></span><br><span class="line">    <span class="keyword">if</span> (age &lt; <span class="number">18</span>)&#123; </span><br><span class="line">      println(<span class="string">&quot;童年&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="双分支"><a href="#双分支" class="headerlink" title="双分支"></a>双分支</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需求：输入年龄，如果年龄小于 18 岁，则输出“童年”。否则，输出“成年”。</span></span><br><span class="line">println(<span class="string">&quot;input age:&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> age = <span class="type">StdIn</span>.readShort()</span><br><span class="line"><span class="keyword">if</span> (age &lt; <span class="number">18</span>)&#123;</span><br><span class="line">  println(<span class="string">&quot;童年&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  println(<span class="string">&quot;成年&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多分支"><a href="#多分支" class="headerlink" title="多分支"></a>多分支</h3><p>（1）需求：输入年龄，如果年龄小于 18 岁，则输出“童年”。如果年龄大于等于 18 且小于等于 30，则输出“中年”，否则，输出“老年”。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">println(<span class="string">&quot;input age&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> age = <span class="type">StdIn</span>.readInt()</span><br><span class="line"><span class="keyword">if</span> (age &lt; <span class="number">18</span>)&#123;</span><br><span class="line">  println(<span class="string">&quot;童年&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(age&gt;=<span class="number">18</span> &amp;&amp; age&lt;<span class="number">30</span>)&#123;</span><br><span class="line">  println(<span class="string">&quot;中年&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  println(<span class="string">&quot;老年&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）Scala 中 if else 表达式其实是有返回值的，具体返回值取决于满足条件的 代码体的最后一行内容。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">println(<span class="string">&quot;input age&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> age = <span class="type">StdIn</span>.readInt()</span><br><span class="line"><span class="keyword">val</span> res :<span class="type">String</span> = <span class="keyword">if</span> (age &lt; <span class="number">18</span>)&#123;</span><br><span class="line">  <span class="string">&quot;童年&quot;</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(age&gt;=<span class="number">18</span> &amp;&amp; age&lt;<span class="number">30</span>)&#123;</span><br><span class="line">  <span class="string">&quot;中年&quot;</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="string">&quot;老年&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">println(res)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658058679174-87453710-9519-4006-8c6c-58fe5506c8a3.png#clientId=u4502deb3-8ff0-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=99&id=u7cae0af3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=99&originWidth=124&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3464&status=done&style=none&taskId=u56c0a49c-708f-4f25-b226-b11fabadc15&title=&width=124" alt="image.png"><br>（3）Scala 中返回值类型不一致，取它们共同的祖先类型。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">println(<span class="string">&quot;input age&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> age = <span class="type">StdIn</span>.readInt()</span><br><span class="line"><span class="keyword">val</span> res:<span class="type">Any</span> = <span class="keyword">if</span> (age &lt; <span class="number">18</span>)&#123;</span><br><span class="line">  <span class="string">&quot;童年&quot;</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(age&gt;=<span class="number">18</span> &amp;&amp; age&lt;<span class="number">30</span>)&#123;</span><br><span class="line">  <span class="string">&quot;中年&quot;</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line">println(res)</span><br><span class="line">println(res.getClass)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658058783589-95c2f361-be3e-4bee-b729-e8c2a3953352.png#clientId=u4502deb3-8ff0-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=131&id=ua0d469d2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=131&originWidth=293&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7128&status=done&style=none&taskId=ua7c03708-ca77-444b-98a8-d39dbbd1080&title=&width=293" alt="image.png"><br>（4）Java 中的三元运算符可以用 if else 实现<br>如果大括号{}内的逻辑代码只有一行，大括号可以省略。如果省略大括号，if 只对最近 的一行逻辑代码起作用。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line"><span class="comment">// int result = flag?1:0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Scala</span></span><br><span class="line">println(<span class="string">&quot;input age&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> age = <span class="type">StdIn</span>.readInt()</span><br><span class="line"><span class="keyword">val</span> res:<span class="type">Any</span> = <span class="keyword">if</span> (age &lt; <span class="number">18</span>) <span class="string">&quot;童年&quot;</span> <span class="keyword">else</span> <span class="string">&quot;成年&quot;</span> </span><br><span class="line"><span class="string">&quot;不起作用&quot;</span></span><br><span class="line">println(res)</span><br></pre></td></tr></table></figure>

<h2 id="嵌套分支"><a href="#嵌套分支" class="headerlink" title="嵌套分支"></a>嵌套分支</h2><p>在一个分支结构中又完整的嵌套了另一个完整的分支结构，里面的分支的结构称为内层。<br>分支外面的分支结构称为外层分支。嵌套分支不要超过 3 层。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需求：如果输入的年龄小于 18，返回“童年”。如果输入的年龄大于等于 18，需要再判</span></span><br><span class="line"><span class="comment">//断：如果年龄大于等于 18 且小于 30，返回“中年”；如果其他，返回“老年”。    </span></span><br><span class="line">println(<span class="string">&quot;input age&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> age = <span class="type">StdIn</span>.readInt()</span><br><span class="line"><span class="keyword">val</span> res :<span class="type">String</span> = <span class="keyword">if</span> (age &lt; <span class="number">18</span>)&#123;</span><br><span class="line">  <span class="string">&quot;童年&quot;</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(age&gt;=<span class="number">18</span> &amp;&amp; age&lt;<span class="number">30</span>)&#123;</span><br><span class="line">    <span class="string">&quot;中年&quot;</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="string">&quot;老年&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">println(res)</span><br></pre></td></tr></table></figure>

<h2 id="Switch-分支结构"><a href="#Switch-分支结构" class="headerlink" title="Switch 分支结构"></a>Switch 分支结构</h2><p>在 Scala 中没有 Switch，而是使用模式匹配来处理。（在后文）</p>
<h2 id="For-循环控制"><a href="#For-循环控制" class="headerlink" title="For 循环控制"></a>For 循环控制</h2><p>Scala 也为 for 循环这一常见的控制结构提供了非常多的特性，这些 for 循环的特性被称为 for 推导式或 for 表达式。</p>
<h3 id="范围数据循环（To-）"><a href="#范围数据循环（To-）" class="headerlink" title="范围数据循环（To**） **"></a><strong>范围数据循环（</strong>To**） **</h3><h4 id="基本语法-9"><a href="#基本语法-9" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658059218178-f2cd8e02-b935-45f5-9bda-cd1fe9c88036.png#clientId=u4502deb3-8ff0-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=100&id=u0652e6e5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=100&originWidth=237&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11484&status=done&style=none&taskId=u91d0d102-b091-4713-98ee-88631ab9bc1&title=&width=237" alt="image.png"><br>（1）i 表示循环的变量，&lt;- 规定 to<br>（2）i 将会从 1-3 循环，前后闭合</p>
<h4 id="案例实操-16"><a href="#案例实操-16" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter04</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ForLoop</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">for</span> (i &lt;- <span class="number">1</span> to <span class="number">3</span>)&#123;</span><br><span class="line">      println(i + <span class="string">&quot;. hello world&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="范围数据循环（Until）"><a href="#范围数据循环（Until）" class="headerlink" title="范围数据循环（Until）"></a>范围数据循环（Until）</h3><h4 id="基本语法-10"><a href="#基本语法-10" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658065450484-5db5a67a-8987-4641-a58a-a1a5955f8d15.png#clientId=ua387e599-b9da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=101&id=uf51b6bd8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=101&originWidth=280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11770&status=done&style=none&taskId=u1d13eb6a-5d78-4efa-b689-e4654ecb0c7&title=&width=280" alt="image.png"><br>（1）这种方式和前面的区别在于 i 是从 1 到 3-1<br>（2）即前闭后开的范围</p>
<h4 id="案例实操-17"><a href="#案例实操-17" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i &lt;- <span class="number">1</span> until <span class="number">4</span>)&#123;</span><br><span class="line">  println(i + <span class="string">&quot;. hello world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="循环守卫"><a href="#循环守卫" class="headerlink" title="循环守卫"></a>循环守卫</h3><h4 id="基本语法-11"><a href="#基本语法-11" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658065593441-ed3b4b4e-382f-4933-a8f9-9152d48d431b.png#clientId=ua387e599-b9da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=102&id=u5a499d8a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=102&originWidth=373&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13366&status=done&style=none&taskId=ue22c64b3-7290-4a28-b36c-cf021e16ac2&title=&width=373" alt="image.png"><br>（1）循环守卫，即循环保护式（也称条件判断式，守卫）。保护式为 true 则进入循环<br>体内部，为 false 则跳过，类似于 continue。<br>（2）上面的代码等价<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658065621337-8c5d2218-cedb-4f69-8d93-625cc7f4f1b3.png#clientId=ua387e599-b9da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=121&id=u6740844c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=121&originWidth=275&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12049&status=done&style=none&taskId=uac9a18e9-e08c-4f6b-901d-90b19dc6a6b&title=&width=275" alt="image.png"></p>
<h4 id="案例实操-18"><a href="#案例实操-18" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i &lt;- <span class="number">1</span> to <span class="number">3</span> <span class="keyword">if</span> i != <span class="number">2</span>)&#123;</span><br><span class="line">  println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="循环步长"><a href="#循环步长" class="headerlink" title="循环步长"></a>循环步长</h3><h4 id="基本语法-12"><a href="#基本语法-12" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658065711580-10366331-ac28-4063-b7d6-5ee1ec9a6ed1.png#clientId=ua387e599-b9da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=72&id=ue680a83a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=72&originWidth=341&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10719&status=done&style=none&taskId=ucf68a169-a7ab-483b-add7-b2b4fee1150&title=&width=341" alt="image.png"><br>by 表示步长</p>
<h4 id="案例实操-19"><a href="#案例实操-19" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出 1 到 10 以内的所有奇数</span></span><br><span class="line"><span class="keyword">for</span> (i &lt;- <span class="number">1</span> to <span class="number">10</span> by <span class="number">2</span>)&#123;</span><br><span class="line">  println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="嵌套循环"><a href="#嵌套循环" class="headerlink" title="嵌套循环"></a>嵌套循环</h3><h4 id="基本语法-13"><a href="#基本语法-13" class="headerlink" title="基本语法"></a>基本语法</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式1：</span></span><br><span class="line"><span class="comment">//说明：没有关键字，所以范围后一定要加；来隔断逻辑</span></span><br><span class="line"><span class="keyword">for</span> (i &lt;- <span class="number">1</span> to <span class="number">3</span>; j &lt;- <span class="number">1</span> to <span class="number">4</span>)&#123;</span><br><span class="line">  println(<span class="string">&quot;i = &quot;</span> + i + <span class="string">&quot;, j = &quot;</span> + j)</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">&quot;-------------------&quot;</span>)</span><br><span class="line"><span class="comment">//方式2：</span></span><br><span class="line"><span class="keyword">for</span> (i &lt;- <span class="number">1</span> to <span class="number">3</span>)&#123;</span><br><span class="line">  <span class="keyword">for</span> (j &lt;- <span class="number">1</span> to <span class="number">4</span>)&#123;</span><br><span class="line">    println(<span class="string">&quot;i = &quot;</span> + i + <span class="string">&quot;, j = &quot;</span> + j)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="引入变量"><a href="#引入变量" class="headerlink" title="引入变量"></a>引入变量</h3><h4 id="基本语法-14"><a href="#基本语法-14" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658066038001-be3e53bb-7dbf-4a0e-b3a6-db5dad13bc42.png#clientId=ua387e599-b9da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=75&id=u2cab816f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=75&originWidth=425&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12190&status=done&style=none&taskId=u4f6802a1-2584-47f3-b7ce-8c553bd25d9&title=&width=425" alt="image.png"><br>（1）for 推导式一行中有多个表达式时，所以要加 ; 来隔断逻辑<br>（2）for 推导式有一个不成文的约定：当 for 推导式仅包含单一表达式时使用圆括号， 当包含多个表达式时，一般每行一个表达式，并用花括号代替圆括号，如下<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658066066834-03afcf6c-8b47-4e7e-86ff-09f4a57ad1f1.png#clientId=ua387e599-b9da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=146&id=uf7d37c7d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=146&originWidth=430&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13063&status=done&style=none&taskId=u9a360397-4879-4e07-8adf-58721369038&title=&width=430" alt="image.png"></p>
<h4 id="案例实操-20"><a href="#案例实操-20" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i &lt;- <span class="number">1</span> to <span class="number">5</span>; j = <span class="number">5</span> - i)&#123;</span><br><span class="line">  println(<span class="string">&quot;i = &quot;</span> + i + <span class="string">&quot;, j = &quot;</span> + j)</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">&quot;-------------------&quot;</span>)</span><br><span class="line"><span class="keyword">for</span>&#123;i &lt;- <span class="number">1</span> to <span class="number">5</span></span><br><span class="line">    j = <span class="number">5</span> - i</span><br><span class="line">    &#125;&#123;</span><br><span class="line">  println(<span class="string">&quot;i = &quot;</span> + i + <span class="string">&quot;, j = &quot;</span> + j)</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">&quot;-------------------&quot;</span>)</span><br><span class="line"><span class="keyword">for</span>(i &lt;- <span class="number">1</span> to <span class="number">5</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> j = <span class="number">5</span> - i</span><br><span class="line">  println(<span class="string">&quot;i = &quot;</span> + i + <span class="string">&quot;, j = &quot;</span> + j)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="循环返回值"><a href="#循环返回值" class="headerlink" title="循环返回值"></a>循环返回值</h3><h4 id="基本语法-15"><a href="#基本语法-15" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658066280380-ebd87f46-cfed-47d6-bd4a-08bc324e8a0c.png#clientId=ua387e599-b9da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=54&id=u954a8194&margin=%5Bobject%20Object%5D&name=image.png&originHeight=54&originWidth=470&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12495&status=done&style=none&taskId=u005a9a4d-4fe5-42bd-9f9e-b432fca2a8d&title=&width=470" alt="image.png"><br>说明：将遍历过程中处理的结果返回到一个新 Vector 集合中，使用 yield 关键字。<br>注意：开发中很少使用。</p>
<h4 id="案例实操-21"><a href="#案例实操-21" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.collection.immutable    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> a = <span class="keyword">for</span> (i &lt;- <span class="number">1</span> to <span class="number">5</span>) <span class="keyword">yield</span> &#123;</span><br><span class="line">      i * i</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;a = &quot;</span> + a)</span><br><span class="line">    println(<span class="string">&quot;-------------------&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> b: immutable.<span class="type">IndexedSeq</span>[<span class="type">Int</span>] = <span class="keyword">for</span> (i &lt;- <span class="number">1</span> to <span class="number">5</span>) <span class="keyword">yield</span> i * i</span><br><span class="line">    println(<span class="string">&quot;b = &quot;</span> + b)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658066757090-186d069c-429b-46d0-a3b0-99e304cbb033.png#clientId=ua387e599-b9da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=103&id=ud23c5edd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=103&originWidth=345&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9640&status=done&style=none&taskId=u2f9ed1fb-e463-4ada-b0c9-69c3c383892&title=&width=345" alt="image.png"></p>
<h3 id="倒序打印"><a href="#倒序打印" class="headerlink" title="倒序打印"></a>倒序打印</h3><p>说明：如果想倒序打印一组数据，可以用 reverse。 </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//倒叙打印1到5</span></span><br><span class="line"><span class="keyword">for</span>(i &lt;- <span class="number">1</span> to <span class="number">5</span> reverse)&#123;</span><br><span class="line">  print(i + <span class="string">&quot;\t&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="While-和-do-While-循环控制"><a href="#While-和-do-While-循环控制" class="headerlink" title="While 和 do..While 循环控制"></a>While 和 do..While 循环控制</h2><p>While 和 do..While 的使用和 Java 语言中用法相同。</p>
<h3 id="While-循环控制"><a href="#While-循环控制" class="headerlink" title="While 循环控制"></a>While 循环控制</h3><h4 id="基本语法-16"><a href="#基本语法-16" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658067252307-c5dbea1c-3170-45ec-a71f-8fefe20966c3.png#clientId=ua387e599-b9da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=288&id=ua60c91de&margin=%5Bobject%20Object%5D&name=image.png&originHeight=288&originWidth=259&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31770&status=done&style=none&taskId=uf00c7363-ab9d-4817-a04e-d1196bede54&title=&width=259" alt="image.png"><br>说明：<br>（1）循环条件是返回一个布尔值的表达式<br>（2）while 循环是先判断再执行语句<br>（3）与 for 语句不同，while 语句没有返回值，即整个 while 语句的结果是 Unit 类型()<br>（4）因为 while 中没有返回值，所以当要用该语句来计算并返回结果时，就不可避免 的使用变量，而变量需要声明在 while 循环的外部，那么就等同于循环的内部对外部的变量 造成了影响，所以不推荐使用，而是推荐使用 for 循环。 </p>
<h4 id="案例实操-22"><a href="#案例实操-22" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter04</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WhileLoop</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">      println(i)</span><br><span class="line">      i += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="do-while-循环控制"><a href="#do-while-循环控制" class="headerlink" title="do..while 循环控制"></a>do..while 循环控制</h3><h4 id="基本语法-17"><a href="#基本语法-17" class="headerlink" title="基本语法"></a>基本语法</h4><p>do{<br>循环体(语句)<br>循环变量迭代<br>}while(循环条件)<br>说明：<br>（1）循环条件是返回一个布尔值的表达式<br>（2）do..while 循环是先执行，再判断</p>
<h4 id="案例实操-23"><a href="#案例实操-23" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  println(i)</span><br><span class="line">  i += <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">while</span> (i &lt; <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h2 id="循环中断"><a href="#循环中断" class="headerlink" title="循环中断"></a>循环中断</h2><h3 id="基本说明-5"><a href="#基本说明-5" class="headerlink" title="基本说明"></a>基本说明</h3><p>Scala 内置控制结构特地**去掉了 **break <strong>和 <strong>continue，是为了更好的适应</strong>函数式编程</strong>，推荐使用函数式的风格解决break和continue的功能，而不是一个关键字。Scala中使用breakable 控制结构来实现 break 和 continue 功能。</p>
<h3 id="案例实操-24"><a href="#案例实操-24" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter04</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.util.control.<span class="type">Breaks</span></span><br><span class="line"><span class="keyword">import</span> scala.util.control.<span class="type">Breaks</span>._</span><br><span class="line"><span class="comment">//import scala.util.control.Breaks.&#123;break, breakable&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Break</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 采用抛出异常的方式，退出循环</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (i &lt;- <span class="number">0</span> until <span class="number">5</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">3</span>)</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">RuntimeException</span></span><br><span class="line">        println(i)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> e: <span class="type">Exception</span> =&gt;    <span class="comment">// 什么都不做，只是退出循环</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 使用Scala中的Breaks类的break方法，实现异常的抛出和捕捉</span></span><br><span class="line">    <span class="type">Breaks</span>.breakable(</span><br><span class="line">      <span class="keyword">for</span> (i &lt;- <span class="number">0</span> until <span class="number">5</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">3</span>)</span><br><span class="line">          <span class="type">Breaks</span>.<span class="keyword">break</span>()</span><br><span class="line">        println(i)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    breakable(</span><br><span class="line">      <span class="keyword">for</span> (i &lt;- <span class="number">0</span> until <span class="number">5</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">3</span>)</span><br><span class="line">          <span class="keyword">break</span>()</span><br><span class="line">        println(i)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;这是循环外的代码&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h1><p>1）面向对象编程<br>解决问题，分解对象，行为，属性，然后通过对象的关系以及行为的调用来解决问题。<br>对象：用户<br>行为：登录、连接 JDBC、读取数据库<br>属性：用户名、密码<br>Scala 语言是一个完全面向对象编程语言。万物皆对象<br>对象的本质：对数据和行为的一个封装<br>2）函数式编程<br>解决问题时，将问题分解成一个一个的步骤，将每个步骤进行封装（函数），通过调用这些封装好的步骤，解决问题。<br>例如：请求-&gt;用户名、密码-&gt;连接 JDBC-&gt;读取数据库<br>Scala 语言是一个完全函数式编程语言。万物皆函数。<br>函数的本质：函数可以当做一个值进行传递<br>3）在 Scala 中函数式编程和面向对象编程完美融合在一起了。</p>
<h2 id="函数基础"><a href="#函数基础" class="headerlink" title="函数基础"></a>函数基础</h2><h3 id="函数基本语法"><a href="#函数基本语法" class="headerlink" title="函数基本语法"></a>函数基本语法</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658104297831-4c5025c8-0138-4b89-9ada-427dc0f7b4b9.png#clientId=uf03642c9-c7e5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=274&id=u512aafa5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=274&originWidth=558&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46488&status=done&style=none&taskId=ubff9ecf1-38c5-48e1-9812-3b04a4359b4&title=&width=558" alt="image.png"></p>
<h3 id="函数和方法的区别"><a href="#函数和方法的区别" class="headerlink" title="函数和方法的区别"></a>函数和方法的区别</h3><h4 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h4><p>（1）为完成某一功能的程序语句的集合，称为函数。<br>（2）类中的函数称之方法。</p>
<h4 id="案例实操-25"><a href="#案例实操-25" class="headerlink" title="案例实操"></a>案例实操</h4><p>（1）Scala 语言可以在任何的语法结构中声明任何的语法<br>（2）函数没有重载和重写的概念；方法可以进行重载和重写<br>（3）Scala 中函数可以嵌套定义</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test01_FunctionAndMethod</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 定义函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sayHi</span></span>(name: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;hi, &quot;</span> + name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 调用函数</span></span><br><span class="line">    sayHi(<span class="string">&quot;alice&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用对象方法</span></span><br><span class="line">    <span class="type">Test01_FunctionAndMethod</span>.sayHi(<span class="string">&quot;jack&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取方法返回值</span></span><br><span class="line">    <span class="keyword">val</span> result = <span class="type">Test01_FunctionAndMethod</span>.sayHello(<span class="string">&quot;cary&quot;</span>)</span><br><span class="line">    println(result)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义对象的方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sayHi</span></span>(name: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;Hi~, &quot;</span> + name)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sayHello</span></span>(name: <span class="type">String</span>): <span class="type">String</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;Hello, &quot;</span> + name)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h3><h4 id="函数定义-1"><a href="#函数定义-1" class="headerlink" title="函数定义"></a>函数定义</h4><p>（1）函数 1：无参，无返回值<br>（2）函数 2：无参，有返回值<br>（3）函数 3：有参，无返回值<br>（4）函数 4：有参，有返回值<br>（5）函数 5：多参，无返回值<br>（6）函数 6：多参，有返回值</p>
<h4 id="案例实操-26"><a href="#案例实操-26" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test02_FunctionDefine</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （1）函数1：无参，无返回值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;1. 无参，无返回值&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    f1()</span><br><span class="line">    println(f1())</span><br><span class="line">    println(<span class="string">&quot;=========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （2）函数2：无参，有返回值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span></span>(): <span class="type">Int</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;2. 无参，有返回值&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(f2())</span><br><span class="line">    println(<span class="string">&quot;=========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （3）函数3：有参，无返回值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f3</span></span>(name: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;3：有参，无返回值 &quot;</span> + name)</span><br><span class="line">    &#125;</span><br><span class="line">    println(f3(<span class="string">&quot;alice&quot;</span>))</span><br><span class="line">    println(<span class="string">&quot;=========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （4）函数4：有参，有返回值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f4</span></span>(name: <span class="type">String</span>): <span class="type">String</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;4：有参，有返回值 &quot;</span> + name)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;hi, &quot;</span> + name</span><br><span class="line">    &#125;</span><br><span class="line">    println(f4(<span class="string">&quot;alice&quot;</span>))</span><br><span class="line">    println(<span class="string">&quot;=========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （5）函数5：多参，无返回值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f5</span></span>(name1: <span class="type">String</span>, name2: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;5：多参，无返回值&quot;</span>)</span><br><span class="line">      println(<span class="string">s&quot;<span class="subst">$&#123;name1&#125;</span>和<span class="subst">$&#123;name2&#125;</span>都是我的好朋友&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    f5(<span class="string">&quot;alice&quot;</span>,<span class="string">&quot;bob&quot;</span>)</span><br><span class="line">    println(<span class="string">&quot;=========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （6）函数6：多参，有返回值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f6</span></span>(a: <span class="type">Int</span>, b: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;6：多参，有返回值&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span> a + b</span><br><span class="line">    &#125;</span><br><span class="line">    println(f6(<span class="number">12</span>, <span class="number">37</span>))</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h3><p>（1）可变参数<br>（2）如果参数列表中存在多个参数，那么可变参数一般放置在最后<br>（3）参数默认值，一般将有默认值的参数放置在参数列表的后面<br>（4）带名参数</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test03_FunctionParameter</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//    （1）可变参数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span></span>(str: <span class="type">String</span>*): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(str)</span><br><span class="line">    &#125;</span><br><span class="line">    f1(<span class="string">&quot;alice&quot;</span>)</span><br><span class="line">    f1(<span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;bbb&quot;</span>, <span class="string">&quot;ccc&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （2）如果参数列表中存在多个参数，那么可变参数一般放置在最后</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span></span>(str1: <span class="type">String</span>, str2: <span class="type">String</span>*): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;str1: &quot;</span> + str1 + <span class="string">&quot; str2: &quot;</span> + str2)</span><br><span class="line">    &#125;</span><br><span class="line">    f2(<span class="string">&quot;alice&quot;</span>)</span><br><span class="line">    f2(<span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;bbb&quot;</span>, <span class="string">&quot;ccc&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （3）参数默认值，一般将有默认值的参数放置在参数列表的后面</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f3</span></span>(name: <span class="type">String</span> = <span class="string">&quot;清华大学&quot;</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;My school is &quot;</span> + name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    f3(<span class="string">&quot;school&quot;</span>)</span><br><span class="line">    f3()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （4）带名参数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f4</span></span>(name: <span class="type">String</span> = <span class="string">&quot;LiAng&quot;</span>, age: <span class="type">Int</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">s&quot;<span class="subst">$&#123;age&#125;</span>岁的<span class="subst">$&#123;name&#125;</span>在学习Scala&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    f4(<span class="string">&quot;alice&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    f4(age = <span class="number">23</span>, name = <span class="string">&quot;bob&quot;</span>)</span><br><span class="line">    f4(age = <span class="number">21</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="函数至简原则（重点）"><a href="#函数至简原则（重点）" class="headerlink" title="函数至简原则（重点）"></a>函数至简原则（重点）</h3><p>函数至简原则：能省则省</p>
<h4 id="至简原则细节"><a href="#至简原则细节" class="headerlink" title="至简原则细节"></a>至简原则细节</h4><p>（1）return 可以省略，Scala 会使用函数体的最后一行代码作为返回值<br>（2）如果函数体只有一行代码，可以省略花括号<br>（3）返回值类型如果能够推断出来，那么可以省略（:和返回值类型一起省略）<br>（4）如果有 return，则不能省略返回值类型，必须指定<br>（5）如果函数明确声明 unit，那么即使函数体中使用 return 关键字也不起作用<br>（6）Scala 如果期望是无返回值类型，可以省略等号<br>（7）如果函数无参，但是声明了参数列表，那么调用时，小括号，可加可不加<br>（8）如果函数没有参数列表，那么小括号可以省略，调用时小括号必须省略<br>（9）如果不关心名称，只关心逻辑处理，那么函数名（def）可以省略</p>
<h4 id="案例实操-27"><a href="#案例实操-27" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test04_Simplify</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f0</span></span>(name: <span class="type">String</span>): <span class="type">String</span> = &#123;</span><br><span class="line">      <span class="keyword">return</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    println(f0(<span class="string">&quot;LiAng&quot;</span>))</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （1）return可以省略，Scala会使用函数体的最后一行代码作为返回值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span></span>(name: <span class="type">String</span>): <span class="type">String</span> = &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">    println(f1(<span class="string">&quot;LiAng&quot;</span>))</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （2）如果函数体只有一行代码，可以省略花括号</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span></span>(name: <span class="type">String</span>): <span class="type">String</span> = name</span><br><span class="line">    println(f2(<span class="string">&quot;LiAng&quot;</span>))</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （3）返回值类型如果能够推断出来，那么可以省略（:和返回值类型一起省略）</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f3</span></span>(name: <span class="type">String</span>) = name</span><br><span class="line">    println(f3(<span class="string">&quot;LiAng&quot;</span>))</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （4）如果有return，则不能省略返回值类型，必须指定</span></span><br><span class="line"><span class="comment">//        def f4(name: String) = &#123;</span></span><br><span class="line"><span class="comment">//          return name</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        println(f4(&quot;LiAng&quot;))</span></span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （5）如果函数明确声明unit，那么即使函数体中使用return关键字也不起作用</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f5</span></span>(name: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      <span class="keyword">return</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    println(f5(<span class="string">&quot;LiAng&quot;</span>))</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （6）Scala如果期望是无返回值类型，可以省略等号</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f6</span></span>(name: <span class="type">String</span>) &#123;</span><br><span class="line">      println(name)</span><br><span class="line">    &#125;</span><br><span class="line">    println(f6(<span class="string">&quot;LiAng&quot;</span>))</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （7）如果函数无参，但是声明了参数列表，那么调用时，小括号，可加可不加</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f7</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;LiAng&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    f7()</span><br><span class="line">    f7</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （8）如果函数没有参数列表，那么小括号可以省略，调用时小括号必须省略</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f8</span></span>: <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;LiAng&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//    f8()</span></span><br><span class="line">    f8</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （9）如果不关心名称，只关心逻辑处理，那么函数名（def）可以省略</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f9</span></span>(name: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 匿名函数，lambda表达式</span></span><br><span class="line">    (name: <span class="type">String</span>) =&gt; &#123;println(name)&#125;</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="函数高级"><a href="#函数高级" class="headerlink" title="函数高级"></a>函数高级</h2><h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>没有名字的函数就是匿名函数。<br>(x:Int)&#x3D;&gt;{函数体}<br>x：表示输入参数类型；Int：表示输入参数类型；函数体：表示具体代码逻辑</p>
<h4 id="案例实操-28"><a href="#案例实操-28" class="headerlink" title="案例实操"></a>案例实操</h4><p>需求 1：传递的函数有一个参数<br>传递匿名函数至简原则：<br>（1）参数的类型可以省略，会根据形参进行自动的推导<br>（2）类型省略之后，发现只有一个参数，则圆括号可以省略；其他情况：没有参数和参数超过 1 的永远不能省略圆括号。<br>（3）匿名函数如果只有一行，则大括号也可以省略<br>（4）如果参数只出现一次，则参数省略且后面参数可以用_代替</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test05_Lambda</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> fun = (name: <span class="type">String</span>) =&gt; &#123;println(name)&#125;</span><br><span class="line">    fun(<span class="string">&quot;LiAng&quot;</span>)</span><br><span class="line">    println(<span class="string">&quot;========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个函数，以函数作为参数输入</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span></span>(func: <span class="type">String</span> =&gt; <span class="type">Unit</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      func(<span class="string">&quot;lzw&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    f(fun)</span><br><span class="line">    println(<span class="string">&quot;========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 匿名函数的简化原则</span></span><br><span class="line">    <span class="comment">//    （1）参数的类型可以省略，会根据形参进行自动的推导</span></span><br><span class="line">    f((name) =&gt; &#123;</span><br><span class="line">      println(name)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （2）类型省略之后，发现只有一个参数，则圆括号可以省略；其他情况：没有参数和参数超过1的永远不能省略圆括号。</span></span><br><span class="line">    f( name =&gt; &#123;</span><br><span class="line">      println(name)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （3）匿名函数如果只有一行，则大括号也可以省略</span></span><br><span class="line">    f( name =&gt; println(name) )</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （4）如果参数只出现一次，则参数省略且后面参数可以用_代替</span></span><br><span class="line">    f( println(_) )</span><br><span class="line"></span><br><span class="line">    <span class="comment">//     (5) 如果可以推断出，当前传入的println是一个函数体，而不是调用语句，可以直接省略下划线</span></span><br><span class="line">    f( println )</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;=========================&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实际示例，定义一个”二元运算“函数，只操作1和2两个数，但是具体运算通过参数传入</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dualFunctionOneAndTwo</span></span>(fun: (<span class="type">Int</span>, <span class="type">Int</span>)=&gt;<span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      fun(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> add = (a: <span class="type">Int</span>, b: <span class="type">Int</span>) =&gt; a + b</span><br><span class="line">    <span class="keyword">val</span> minus = (a: <span class="type">Int</span>, b: <span class="type">Int</span>) =&gt; a - b</span><br><span class="line"></span><br><span class="line">    println(dualFunctionOneAndTwo(add))</span><br><span class="line">    println(dualFunctionOneAndTwo(minus))</span><br><span class="line"></span><br><span class="line">    println(dualFunctionOneAndTwo((a: <span class="type">Int</span>,b: <span class="type">Int</span>)=&gt; a * b))</span><br><span class="line">    println(dualFunctionOneAndTwo((a,b) =&gt; a+b))</span><br><span class="line">    println(dualFunctionOneAndTwo(_+_))</span><br><span class="line"></span><br><span class="line">    println(dualFunctionOneAndTwo((a, b) =&gt; b - a))</span><br><span class="line">    println(dualFunctionOneAndTwo( -_ + _))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><p>在 Scala 中，函数是一等公民。怎么体现的呢？<br>对于一个函数我们可以：定义函数、调用函数<br>但是其实函数还有更高阶的用法<br>1）函数可以作为值进行传递<br>2）函数可以作为参数进行传递<br>3）函数可以作为函数返回值返回</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test06_HighOrderFunction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span></span>(n: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;f调用&quot;</span>)</span><br><span class="line">      n + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun</span></span>(): <span class="type">Int</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;fun调用&quot;</span>)</span><br><span class="line">      <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> result: <span class="type">Int</span> = f(<span class="number">123</span>)</span><br><span class="line">    println(result)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 函数作为值进行传递</span></span><br><span class="line">    <span class="keyword">val</span> f1: <span class="type">Int</span>=&gt;<span class="type">Int</span> = f</span><br><span class="line">    <span class="keyword">val</span> f2 = f _</span><br><span class="line"></span><br><span class="line">    println(f1)</span><br><span class="line">    println(f1(<span class="number">12</span>))</span><br><span class="line">    println(f2)</span><br><span class="line">    println(f2(<span class="number">35</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> f3: ()=&gt;<span class="type">Int</span> = fun</span><br><span class="line">    <span class="keyword">val</span> f4 = fun _</span><br><span class="line">    println(f3)</span><br><span class="line">    println(f4)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 函数作为参数进行传递</span></span><br><span class="line">    <span class="comment">// 定义二元计算函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dualEval</span></span>(op: (<span class="type">Int</span>, <span class="type">Int</span>)=&gt;<span class="type">Int</span>, a: <span class="type">Int</span>, b: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      op(a, b)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(a: <span class="type">Int</span>, b: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      a + b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(dualEval(add,<span class="number">6</span>,<span class="number">8</span>))</span><br><span class="line">    println(dualEval((a,b)=&gt;a+b,<span class="number">8</span>,<span class="number">6</span>))</span><br><span class="line">    println(dualEval(_ + _, <span class="number">12</span>, <span class="number">35</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 函数作为函数的返回值返回</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f5</span></span>(): <span class="type">Int</span>=&gt;<span class="type">Unit</span> = &#123;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">f6</span></span>(a: <span class="type">Int</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">        println(<span class="string">&quot;f6调用 &quot;</span> + a)</span><br><span class="line">      &#125;</span><br><span class="line">      f6    <span class="comment">// 将函数直接返回</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> f6 = f5()</span><br><span class="line">    println(f6)</span><br><span class="line">    println(f6(<span class="number">25</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//等价上面</span></span><br><span class="line">    println(f5()(<span class="number">25</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="高阶函数案例"><a href="#高阶函数案例" class="headerlink" title="高阶函数案例"></a>高阶函数案例</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test07_Practice_CollectionOperation</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> arr: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">12</span>, <span class="number">45</span>, <span class="number">75</span>, <span class="number">98</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对数组进行处理，将操作抽象出来，处理完毕之后的结果返回一个新的数组</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">arrayOperation</span></span>(array: <span class="type">Array</span>[<span class="type">Int</span>], op: <span class="type">Int</span>=&gt;<span class="type">Int</span>):<span class="type">Array</span>[<span class="type">Int</span>] = &#123;</span><br><span class="line">      <span class="keyword">for</span> (elem &lt;- array) <span class="keyword">yield</span> op(elem)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个加一操作</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addOne</span></span>(elem: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      elem + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用函数</span></span><br><span class="line">    <span class="keyword">val</span> newArray:<span class="type">Array</span>[<span class="type">Int</span>] = arrayOperation(arr,addOne)</span><br><span class="line"></span><br><span class="line">    println(newArray.mkString(<span class="string">&quot;,&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 传入匿名函数，实现元素翻倍</span></span><br><span class="line">    <span class="keyword">val</span> newArray2 = arrayOperation(arr, _ * <span class="number">2</span>)</span><br><span class="line">    println(newArray2.mkString(<span class="string">&quot;, &quot;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="匿名函数扩展练习"><a href="#匿名函数扩展练习" class="headerlink" title="匿名函数扩展练习"></a>匿名函数扩展练习</h3><p>练习 1：定义一个匿名函数，并将它作为值赋给变量 fun。函数有三个参数，类型分别为 Int，String，Char，返回值类型为 Boolean。<br>要求调用函数 fun(0, “”, ‘0’)得到返回值为 false，其它情况均返回 true。<br>练习 2： 定义一个函数 func，它接收一个 Int 类型的参数，返回一个函数（记作 f1）。 它返回的函数 f1，接收一个 String 类型的参数，同样返回一个函数（记作 f2）。函数 f2 接 收一个 Char 类型的参数，返回一个 Boolean 的值。<br>要求调用函数 func(0) (“”) (‘0’)得到返回值为 false，其它情况均返回 true。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test08_Practice</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 练习1</span></span><br><span class="line">    <span class="keyword">val</span> fun = (i:<span class="type">Int</span>,s:<span class="type">String</span>, c:<span class="type">Char</span>) =&gt; &#123;<span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; s == <span class="string">&quot;&quot;</span> &amp;&amp; c == &#x27;<span class="number">0</span>&#x27;) <span class="literal">false</span> <span class="keyword">else</span> <span class="literal">true</span>&#125;</span><br><span class="line">    println(fun(<span class="number">0</span>, <span class="string">&quot;&quot;</span>, &#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(fun(<span class="number">0</span>, <span class="string">&quot;&quot;</span>, &#x27;<span class="number">1</span>&#x27;))</span><br><span class="line">    println(fun(<span class="number">23</span>, <span class="string">&quot;&quot;</span>, &#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(fun(<span class="number">0</span>, <span class="string">&quot;hello&quot;</span>, &#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(<span class="string">&quot;===========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 练习2</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span></span>(i:<span class="type">Int</span>): <span class="type">String</span>=&gt;(<span class="type">Char</span>=&gt;<span class="type">Boolean</span>) = &#123;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">f1</span></span>(s:<span class="type">String</span>): <span class="type">Char</span>=&gt;<span class="type">Boolean</span> = &#123;</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f2</span></span>(c:<span class="type">Char</span>): <span class="type">Boolean</span> = &#123;</span><br><span class="line">          <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; s == <span class="string">&quot;&quot;</span> &amp;&amp; c == &#x27;<span class="number">0</span>&#x27;) <span class="literal">false</span> <span class="keyword">else</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        f2</span><br><span class="line">      &#125;</span><br><span class="line">      f1</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(func(<span class="number">0</span>)(<span class="string">&quot;&quot;</span>)(&#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(func(<span class="number">0</span>)(<span class="string">&quot;&quot;</span>)(&#x27;<span class="number">1</span>&#x27;))</span><br><span class="line">    println(func(<span class="number">23</span>)(<span class="string">&quot;&quot;</span>)(&#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(func(<span class="number">0</span>)(<span class="string">&quot;hello&quot;</span>)(&#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 匿名函数简写</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func1</span></span>(i: <span class="type">Int</span>): <span class="type">String</span>=&gt;(<span class="type">Char</span>=&gt;<span class="type">Boolean</span>) = &#123;</span><br><span class="line">      s =&gt; c =&gt; <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; s == <span class="string">&quot;&quot;</span> &amp;&amp; c == &#x27;<span class="number">0</span>&#x27;) <span class="literal">false</span> <span class="keyword">else</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(func1(<span class="number">0</span>)(<span class="string">&quot;&quot;</span>)(&#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(func1(<span class="number">0</span>)(<span class="string">&quot;&quot;</span>)(&#x27;<span class="number">1</span>&#x27;))</span><br><span class="line">    println(func1(<span class="number">23</span>)(<span class="string">&quot;&quot;</span>)(&#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(func1(<span class="number">0</span>)(<span class="string">&quot;hello&quot;</span>)(&#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 柯里化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func2</span></span>(i: <span class="type">Int</span>)(s: <span class="type">String</span>)(c: <span class="type">Char</span>): <span class="type">Boolean</span> = &#123;</span><br><span class="line">      <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; s == <span class="string">&quot;&quot;</span> &amp;&amp; c == &#x27;<span class="number">0</span>&#x27;) <span class="literal">false</span> <span class="keyword">else</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(func2(<span class="number">0</span>)(<span class="string">&quot;&quot;</span>)(&#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(func2(<span class="number">0</span>)(<span class="string">&quot;&quot;</span>)(&#x27;<span class="number">1</span>&#x27;))</span><br><span class="line">    println(func2(<span class="number">23</span>)(<span class="string">&quot;&quot;</span>)(&#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">    println(func2(<span class="number">0</span>)(<span class="string">&quot;hello&quot;</span>)(&#x27;<span class="number">0</span>&#x27;))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数柯里化-amp-闭包"><a href="#函数柯里化-amp-闭包" class="headerlink" title="函数柯里化&amp;闭包"></a>函数柯里化&amp;闭包</h3><p>闭包：函数式编程的标配</p>
<h4 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h4><p>闭包：如果一个函数，访问到了它的外部（局部）变量的值，那么这个函数和他所处的 环境，称为闭包。<br>函数柯里化：把一个参数列表的多个参数，变成多个参数列表。 </p>
<h4 id="案例实操-29"><a href="#案例实操-29" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test09_ClosureAndCurrying</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(a: <span class="type">Int</span>, b: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      a + b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 考虑固定一个加数的场景</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addByFour</span></span>(b: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      <span class="number">4</span> + b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 扩展固定加数改变的情况</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addByFive</span></span>(b: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      <span class="number">5</span> + b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 将固定加数作为另一个参数传入，但是是作为”第一层参数“传入</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addByFour1</span></span>(): <span class="type">Int</span>=&gt;<span class="type">Int</span> = &#123;</span><br><span class="line">      <span class="keyword">val</span> a = <span class="number">4</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">addB</span></span>(b: <span class="type">Int</span>):<span class="type">Int</span> = &#123;</span><br><span class="line">        a + b</span><br><span class="line">      &#125;</span><br><span class="line">      addB</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addByA</span></span>(a: <span class="type">Int</span>): <span class="type">Int</span>=&gt;<span class="type">Int</span> = &#123;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">addB</span></span>(b: <span class="type">Int</span>):<span class="type">Int</span> = &#123;</span><br><span class="line">        a + b</span><br><span class="line">      &#125;</span><br><span class="line">      addB</span><br><span class="line">    &#125;</span><br><span class="line">    println(addByA(<span class="number">35</span>)(<span class="number">24</span>))</span><br><span class="line">    <span class="keyword">val</span> addByFour2 = addByA(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">val</span> addByFive2 = addByA(<span class="number">5</span>)</span><br><span class="line">    println(addByFour2(<span class="number">13</span>))</span><br><span class="line">    println(addByFive2(<span class="number">25</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. lambda表达式简写</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addByA1</span></span>(a: <span class="type">Int</span>): <span class="type">Int</span>=&gt;<span class="type">Int</span>= &#123;</span><br><span class="line">      (b: <span class="type">Int</span>) =&gt; &#123;</span><br><span class="line">        a + b</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addByA2</span></span>(a: <span class="type">Int</span>): <span class="type">Int</span>=&gt;<span class="type">Int</span>= &#123;</span><br><span class="line">      b =&gt; a + b</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addByA3</span></span>(a: <span class="type">Int</span>): <span class="type">Int</span>=&gt;<span class="type">Int</span>= a + _</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> addByFour3 = addByA3(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">val</span> addByFive3 = addByA3(<span class="number">5</span>)</span><br><span class="line">    println(addByFour3(<span class="number">13</span>))</span><br><span class="line">    println(addByFive3(<span class="number">25</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 柯里化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addCurrying</span></span>(a: <span class="type">Int</span>)(b: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      a + b</span><br><span class="line">    &#125;</span><br><span class="line">    println(addCurrying(<span class="number">35</span>)(<span class="number">24</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h3><h4 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h4><p>一个函数&#x2F;方法在函数&#x2F;方法体内又调用了本身，我们称之为递归调用。</p>
<h4 id="案例实操-30"><a href="#案例实操-30" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.annotation.tailrec</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test10_Recursion</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(fact(<span class="number">5</span>))</span><br><span class="line">    println(tailFact(<span class="number">5</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 递归实现计算阶乘</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">fact</span></span>(n: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span>(n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    fact(n - <span class="number">1</span>) * n</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 尾递归实现</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">tailFact</span></span>(n: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    <span class="meta">@tailrec</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loop</span></span>(n: <span class="type">Int</span>, currRes: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      <span class="keyword">if</span>(n == <span class="number">0</span>) <span class="keyword">return</span> currRes</span><br><span class="line">      loop(n<span class="number">-1</span>, currRes * n)</span><br><span class="line">    &#125;</span><br><span class="line">    loop(n,<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="控制抽象"><a href="#控制抽象" class="headerlink" title="控制抽象"></a>控制抽象</h3><p>1）值调用：把计算后的值传递过去</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test11_ControlAbstraction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 传值参数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f0</span></span>(a: <span class="type">Int</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;a: &quot;</span> + a)</span><br><span class="line">      println(<span class="string">&quot;a: &quot;</span> + a)</span><br><span class="line">    &#125;</span><br><span class="line">    f0(<span class="number">23</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span></span>(): <span class="type">Int</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;f1调用&quot;</span>)</span><br><span class="line">      <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">    f0(f1())</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;========================&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）名调用：把代码传递过去</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 传名参数，传递的不再是具体的值，而是代码块</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span></span>(a: =&gt;<span class="type">Int</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">  println(<span class="string">&quot;a: &quot;</span> + a)</span><br><span class="line">  println(<span class="string">&quot;a: &quot;</span> + a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f2(<span class="number">23</span>)</span><br><span class="line">f2(f1())</span><br><span class="line"></span><br><span class="line">f2(&#123;</span><br><span class="line">  println(<span class="string">&quot;这是一个代码块&quot;</span>)</span><br><span class="line">  <span class="number">29</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>注意：Java 只有值调用；Scala 既有值调用，又有名调用。<br>3）自定义一个 While 循环</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.<span class="type">Condition</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test12_MyWhile</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">var</span> n = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// 1. 常规的while循环</span></span><br><span class="line">    <span class="keyword">while</span> (n &gt;= <span class="number">1</span>)&#123;</span><br><span class="line">      println(n)</span><br><span class="line">      n -= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 用闭包实现一个函数，将代码块作为参数传入，递归调用</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">myWhile</span></span>(condition: =&gt;<span class="type">Boolean</span>): (=&gt;<span class="type">Unit</span>)=&gt;<span class="type">Unit</span> = &#123;</span><br><span class="line">      <span class="comment">// 内层函数需要递归调用，参数就是循环体</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">doLoop</span></span>(op: =&gt;<span class="type">Unit</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">        <span class="keyword">if</span>(condition)&#123;</span><br><span class="line">          op</span><br><span class="line">          myWhile(condition)(op)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      doLoop _</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;=================&quot;</span>)</span><br><span class="line">    n = <span class="number">10</span></span><br><span class="line">    myWhile(n &gt;= <span class="number">1</span>)&#123;</span><br><span class="line">      println(n)</span><br><span class="line">      n -= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 用匿名函数实现</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">myWhile2</span></span>(condition: =&gt;<span class="type">Boolean</span>): (=&gt;<span class="type">Unit</span>)=&gt;<span class="type">Unit</span> = &#123;</span><br><span class="line">      <span class="comment">// 内层函数需要递归调用，参数就是循环体</span></span><br><span class="line">      op =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(condition)&#123;</span><br><span class="line">          op</span><br><span class="line">          myWhile2(condition)(op)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;=================&quot;</span>)</span><br><span class="line">    n = <span class="number">10</span></span><br><span class="line">    myWhile2(n &gt;= <span class="number">1</span>)&#123;</span><br><span class="line">      println(n)</span><br><span class="line">      n -= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 用柯里化实现</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">myWhile3</span></span>(condition: =&gt;<span class="type">Boolean</span>)(op: =&gt;<span class="type">Unit</span>):<span class="type">Unit</span> = &#123;</span><br><span class="line">      <span class="keyword">if</span> (condition)&#123;</span><br><span class="line">        op</span><br><span class="line">        myWhile3(condition)(op)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;=================&quot;</span>)</span><br><span class="line">    n = <span class="number">10</span></span><br><span class="line">    myWhile3(n &gt;= <span class="number">1</span>)&#123;</span><br><span class="line">      println(n)</span><br><span class="line">      n -= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="惰性加载"><a href="#惰性加载" class="headerlink" title="惰性加载"></a>惰性加载</h3><h4 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h4><p>当<strong>函数返回值被声明为 <strong>lazy <strong>时</strong>，函数的</strong>执行将被推迟</strong>，直到我们<strong>首次对此取值，该函数才会执行</strong>。这种函数我们称之为惰性函数。</p>
<h4 id="案例实操-31"><a href="#案例实操-31" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter05</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test13_Lazy</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">val</span> result: <span class="type">Int</span> = sum(<span class="number">13</span>, <span class="number">47</span>)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;1. 函数调用&quot;</span>)</span><br><span class="line">    println(<span class="string">&quot;2. result = &quot;</span> + result)</span><br><span class="line">    println(<span class="string">&quot;4. result = &quot;</span> + result)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(a: <span class="type">Int</span>, b: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;3. sum调用&quot;</span>)</span><br><span class="line">    a + b</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：lazy 不能修饰 var 类型的变量</p>
<h1 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h1><p>Scala 的面向对象思想和 Java 的面向对象思想和概念是一致的。<br>Scala 中语法和 Java 不同，补充了更多的功能。</p>
<h2 id="Scala-包"><a href="#Scala-包" class="headerlink" title="Scala 包"></a>Scala 包</h2><p>1）基本语法<br>package 包名<br>2）Scala 包的三大作用（和 Java 一样）<br>（1）区分相同名字的类<br>（2）当类很多时，可以很好的管理类<br>（3）控制访问范围</p>
<h3 id="包的命名"><a href="#包的命名" class="headerlink" title="包的命名"></a>包的命名</h3><p>1）命名规则<br>只能包含数字、字母、下划线、小圆点.，但不能用数字开头，也不要使用关键字。<br>2）案例实操<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658127476460-301cdb56-0ba9-4fc4-9d87-fc47b6a5bda3.png#clientId=u4359b270-aa67-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=51&id=u7503c61f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=51&originWidth=421&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13069&status=done&style=none&taskId=ua6558f69-6938-426e-bb58-8da320e2976&title=&width=421" alt="image.png"><br>3）命名规范<br>一般是小写字母+小圆点<br>com.<strong>公司名</strong>.<strong>项目名</strong>.<strong>业务模块名</strong></p>
<h3 id="包说明（包语句）"><a href="#包说明（包语句）" class="headerlink" title="包说明（包语句）"></a>包说明（包语句）</h3><p>1）说明<br>Scala 有两种包的管理风格，一种方式和 Java 的包管理风格相同，每个源文件一个包（包名和源文件所在路径不要求必须一致），包名用“.”进行分隔以表示的层级关系，如 com.lzw.scala。另一种风格，通过嵌套的风格表示层级关系，如下</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com&#123;</span><br><span class="line">  <span class="keyword">package</span> lzw&#123;</span><br><span class="line">    <span class="keyword">package</span> scala&#123;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二种风格有以下特点：<br>（1）一个源文件中可以声明多个 package<br>（2）子包中的类可以直接访问父包中的内容，而无需导包</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用嵌套风格定义包</span></span><br><span class="line"><span class="keyword">package</span> com&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">import</span> com.lzw.scala.<span class="type">Inner</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在外层包中定义单例对象</span></span><br><span class="line">  <span class="class"><span class="keyword">object</span> <span class="title">Outer</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> out: <span class="type">String</span> = <span class="string">&quot;out&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="type">Inner</span>.in)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">package</span> lzw&#123;</span><br><span class="line">    <span class="keyword">package</span> scala&#123;</span><br><span class="line">      <span class="comment">// 内层包中定义单例对象</span></span><br><span class="line">      <span class="class"><span class="keyword">object</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> in: <span class="type">String</span> = <span class="string">&quot;in&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">          println(<span class="type">Outer</span>.out)</span><br><span class="line">          <span class="type">Outer</span>.out = <span class="string">&quot;outer&quot;</span>  <span class="comment">//子包访问父包无需导包</span></span><br><span class="line">          println(<span class="type">Outer</span>.out)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在同一文件中定义不同的包</span></span><br><span class="line"><span class="keyword">package</span> aaa&#123;</span><br><span class="line">  <span class="keyword">package</span> bbb&#123;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">object</span> <span class="title">Test01_Package</span></span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">        <span class="keyword">import</span> com.lzw.scala.<span class="type">Inner</span></span><br><span class="line">        println(<span class="type">Inner</span>.in)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="包对象"><a href="#包对象" class="headerlink" title="包对象"></a>包对象</h3><p>在 Scala 中可以为每个包定义一个同名的包对象，定义在包对象中的成员，作为其对应包下所有 class 和 object 的共享变量，可以被直接访问。<br>1）定义<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658128058590-48027cd3-5ba0-4caf-a738-dea40db7417b.png#clientId=u4359b270-aa67-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=75&id=ua5e434d9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=75&originWidth=269&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7217&status=done&style=none&taskId=u3847a9c0-cdca-4b48-a63d-05f709817cc&title=&width=269" alt="image.png"><br>2）说明<br>（1）若使用 Java 的包管理风格，则包对象一般定义在其对应包下的 package.scala 文件中，包对象名与包名保持一致。<br>（2）如采用嵌套方式管理包，则包对象可与包定义在同一文件中，但是要保证包对象与包声明在同一作用域中。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658128382116-3bcc1b5d-b74e-46e5-bc59-483b040afefe.png#clientId=u4359b270-aa67-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=202&id=u25daf1f5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=202&originWidth=328&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7765&status=done&style=none&taskId=u091c0141-09ae-4e13-b81f-4d588f36397&title=&width=328" alt="image.png"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="class"><span class="keyword">object</span> <span class="title">chapter06</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 定义当前包共享的属性和方法</span></span><br><span class="line">  <span class="keyword">val</span> commonValue = <span class="string">&quot;Scala&quot;</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">commonMethod</span></span>() = &#123;</span><br><span class="line">    println(<span class="string">s&quot;我们在学习<span class="subst">$&#123;commonValue&#125;</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test02_PackageObject</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    commonMethod()</span><br><span class="line">    println(commonValue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="导包说明"><a href="#导包说明" class="headerlink" title="导包说明"></a>导包说明</h3><p>1）和 Java 一样，可以在顶部使用 import 导入，在这个文件中的所有类都可以使用。<br>2）局部导入：什么时候使用，什么时候导入。<strong>在其作用范围内都可以使用 **<br>3）通配符导入：import java.util._<br>4）给类起名：import java.util.{ArrayList&#x3D;&gt;JL}<br>5）导入</strong>相同包的**多个类：import java.util.{HashSet, ArrayList}<br>6）屏蔽类：import java.util.{ArrayList &#x3D;&gt;<em>,</em>}<br>7）导入包的绝对路径：new <em>root</em>.java.util.HashMap<br>说明<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658128905433-548d4700-c1e6-4951-be82-81dfa3c4e99b.png#clientId=u4359b270-aa67-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=478&id=uf266b3b2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=478&originWidth=716&originalType=binary&ratio=1&rotation=0&showTitle=false&size=79110&status=done&style=none&taskId=ub1ead886-cf87-4c77-8647-df988350978&title=&width=716" alt="image.png"><br>注意<br>Scala 中的三个默认导入分别是<br>import java.lang._<br>import scala._<br>import scala.Predef._</p>
<h2 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h2><p>类：可以看成一个模板<br>对象：表示具体的事物</p>
<h3 id="定义类"><a href="#定义类" class="headerlink" title="定义类"></a>定义类</h3><h4 id="基本语法-18"><a href="#基本语法-18" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658129004919-60448a1c-6321-47c2-9630-ad8660a3eafa.png#clientId=u4359b270-aa67-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=128&id=u6d9e5d4e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=128&originWidth=199&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7542&status=done&style=none&taskId=u658a7668-9a2b-48a8-8867-66825496f2c&title=&width=199" alt="image.png"><br>说明<br>（1）Scala 语法中，类并不声明为 public，所有这些类都具有公有可见性（即默认就是 public）<br>（2）一个 Scala 源文件可以包含多个类</p>
<h4 id="案例实操-32"><a href="#案例实操-32" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.beans.<span class="type">BeanProperty</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test03_Class</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 创建一个对象</span></span><br><span class="line">    <span class="keyword">val</span> student = <span class="keyword">new</span> <span class="type">Student</span>()</span><br><span class="line">    <span class="comment">//    student.name   // error, 不能访问private属性</span></span><br><span class="line">    println(student.age)</span><br><span class="line">    student.setAge(<span class="number">21</span>)</span><br><span class="line">    println(student.getAge)</span><br><span class="line">    println(student.sex)</span><br><span class="line">    student.sex = <span class="string">&quot;female&quot;</span></span><br><span class="line">    println(student.sex)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 定义属性</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">&quot;alice&quot;</span></span><br><span class="line">  <span class="meta">@BeanProperty</span></span><br><span class="line">  <span class="keyword">var</span> age: <span class="type">Int</span> = _</span><br><span class="line">  <span class="keyword">var</span> sex: <span class="type">String</span> = _</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p>属性是类的一个组成部分。</p>
<h4 id="基本语法-19"><a href="#基本语法-19" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658129313000-0701fcaa-34dc-456f-8d4c-d588c4847804.png#clientId=u4359b270-aa67-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=31&id=u81fa6acd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=31&originWidth=356&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8792&status=done&style=none&taskId=uac96955d-a50e-4abd-bdc7-0ee29deb595&title=&width=356" alt="image.png"><br><strong>注：</strong>Bean 属性（@BeanPropetry），可以自动生成规范的 setXxx&#x2F;getXxx 方法</p>
<h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><p>封装就是把抽象出的数据和对数据的操作封装在一起，数据被保护在内部，程序的其它 部分只有通过被授权的操作（成员方法），才能对数据进行操作。Java 封装操作如下，<br>（1）将属性进行私有化<br>（2）提供一个公共的 set 方法，用于对属性赋值<br>（3）提供一个公共的 get 方法，用于获取属性的值<br>Scala 中的 public 属性，底层实际为 private，并通过 get 方法（obj.field()）和 set 方法（obj.field_&#x3D;(value)）对其进行操作。所以 Scala 并不推荐将属性设为 private，再为其设置 public 的 get 和 set 方法的做法。但由于很多 Java 框架都利用反射调用 getXXX 和 setXXX 方 法，有时候为了和这些框架兼容，也会为 Scala 的属性设置 getXXX 和 setXXX 方法（通过 @BeanProperty 注解实现）。</p>
<h3 id="访问权限"><a href="#访问权限" class="headerlink" title="访问权限"></a>访问权限</h3><h4 id="说明-4"><a href="#说明-4" class="headerlink" title="说明"></a>说明</h4><p>在 Java 中，访问权限分为：public，private，protected 和默认。在 Scala 中，你可以通 过类似的修饰符达到同样的效果。但是使用上有区别。<br>（1）Scala 中属性和方法的默认访问权限为 public，但 Scala 中无 public 关键字。<br>（2）private 为私有权限，只在类的内部和伴生对象中可用。<br>（3）protected 为受保护权限，Scala 中受保护权限比 Java 中更严格，同类、子类可以访问，同包无法访问。<br>（4）private[包名]增加包访问权限，包名下的其他类也可以使用</p>
<h4 id="案例实操-33"><a href="#案例实操-33" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test04_ClassForAccess</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个父类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> idCard: <span class="type">String</span> = <span class="string">&quot;3523566&quot;</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">&quot;alice&quot;</span></span><br><span class="line">  <span class="keyword">var</span> sex: <span class="type">String</span> = <span class="string">&quot;female&quot;</span></span><br><span class="line">  <span class="keyword">private</span>[chapter06] <span class="keyword">var</span> age: <span class="type">Int</span> = <span class="number">18</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">s&quot;Person: <span class="subst">$idCard</span> <span class="subst">$name</span> <span class="subst">$sex</span> <span class="subst">$age</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test04_Access</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 创建对象</span></span><br><span class="line">    <span class="keyword">val</span> person: <span class="type">Person</span> = <span class="keyword">new</span> <span class="type">Person</span>()</span><br><span class="line">    <span class="comment">//    person.idCard    // error</span></span><br><span class="line">    <span class="comment">//    person.name    // error</span></span><br><span class="line">    println(person.age)</span><br><span class="line">    println(person.sex)</span><br><span class="line">    person.printInfo()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> worker: <span class="type">Worker</span> = <span class="keyword">new</span> <span class="type">Worker</span>()</span><br><span class="line">    worker.printInfo()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//    println(idCard)    // error</span></span><br><span class="line">    name = <span class="string">&quot;bob&quot;</span></span><br><span class="line">    age = <span class="number">25</span></span><br><span class="line">    sex = <span class="string">&quot;male&quot;</span></span><br><span class="line">    println(<span class="string">s&quot;Worker: <span class="subst">$name</span> <span class="subst">$sex</span> <span class="subst">$age</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>基本语法<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658130046198-0f4ab210-e351-4b28-b753-f494ddfab711.png#clientId=u4359b270-aa67-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=133&id=ufb0d315c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=133&originWidth=331&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13593&status=done&style=none&taskId=u51568909-75b1-4092-bc87-59bcf0d9133&title=&width=331" alt="image.png"></p>
<h3 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h3><p>基本语法<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658130122071-b82789f7-b6b8-4846-9c96-3e9ed018a480.png#clientId=u4359b270-aa67-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=39&id=u506e75bc&margin=%5Bobject%20Object%5D&name=image.png&originHeight=39&originWidth=326&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6658&status=done&style=none&taskId=u7856ba38-3a06-4a0e-924f-a7af6ef4ffb&title=&width=326" alt="image.png"><br>（1）val 修饰对象，不能改变对象的引用（即：内存地址），可以改变对象属性的值。<br>（2）var 修饰对象，可以修改对象的引用和修改对象的属性值<br>（3）自动推导变量类型不能多态，所以多态需要显示声明</p>
<h3 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a>构造器</h3><p>和 Java 一样，Scala 构造对象也需要调用构造方法，并且可以有任意多个构造方法。<br>Scala 类的构造器包括：<strong>主构造器和辅助构造器</strong></p>
<h4 id="基本语法-20"><a href="#基本语法-20" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658130215279-73430e15-72d4-4f0d-adbd-ea1a33aef3ce.png#clientId=u4359b270-aa67-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=312&id=ue686a15a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=312&originWidth=423&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32792&status=done&style=none&taskId=uf3abd63e-f08e-4ed0-88fa-07e9604b70b&title=&width=423" alt="image.png"><br>说明：<br>（1）辅助构造器，函数的名称 this，可以有多个，编译器通过参数的个数及类型<br>来区分。<br>（2）辅助构造方法不能直接构建对象，必须直接或者间接调用主构造方法。<br>（3）构造器调用其他另外的构造器，要求被调用构造器必须提前声明。</p>
<h4 id="案例实操-34"><a href="#案例实操-34" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test05_Constructor</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> studeng1 = <span class="keyword">new</span> <span class="type">Student1</span></span><br><span class="line">    studeng1.<span class="type">Student1</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> student2 = <span class="keyword">new</span> <span class="type">Student1</span>(<span class="string">&quot;alice&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> student3 = <span class="keyword">new</span> <span class="type">Student1</span>(<span class="string">&quot;bob&quot;</span>, <span class="number">25</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 定义属性</span></span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span> = _</span><br><span class="line">  <span class="keyword">var</span> age: <span class="type">Int</span> = _</span><br><span class="line"></span><br><span class="line">  println(<span class="string">&quot;1. 主构造方法被调用&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 声明辅助构造方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(name: <span class="type">String</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>() <span class="comment">//直接调用主构造器</span></span><br><span class="line">    println(<span class="string">&quot;2. 辅助构造方法一被调用&quot;</span>)</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    println(<span class="string">s&quot;name: <span class="subst">$name</span> age: <span class="subst">$age</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(name: <span class="type">String</span>, age: <span class="type">Int</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>(name) <span class="comment">//调用上面的辅助构造方法</span></span><br><span class="line">    println(<span class="string">&quot;3. 辅助构造方法二被调用&quot;</span>)</span><br><span class="line">    <span class="keyword">this</span>.age = age</span><br><span class="line">    println(<span class="string">s&quot;name: <span class="subst">$name</span> age: <span class="subst">$age</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">Student1</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;一般方法被调用&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="构造器参数"><a href="#构造器参数" class="headerlink" title="构造器参数"></a>构造器参数</h3><h4 id="说明-5"><a href="#说明-5" class="headerlink" title="说明"></a>说明</h4><p>Scala 类的主构造器函数的形参包括三种类型：未用任何修饰、var 修饰、val 修饰<br>（1）未用任何修饰符修饰，这个参数就是一个局部变量<br>（2）var 修饰参数，作为类的成员属性使用，可以修改<br>（3）val 修饰参数，作为类只读属性使用，不能修改</p>
<h4 id="案例实操-35"><a href="#案例实操-35" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test06_ConstructorParams</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> student2 = <span class="keyword">new</span> <span class="type">Student2</span></span><br><span class="line">    student2.name = <span class="string">&quot;alice&quot;</span></span><br><span class="line">    student2.age = <span class="number">18</span></span><br><span class="line">    println(<span class="string">s&quot;student2: name = <span class="subst">$&#123;student2.name&#125;</span>, age = <span class="subst">$&#123;student2.age&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> student3 = <span class="keyword">new</span> <span class="type">Student3</span>(<span class="string">&quot;lzw&quot;</span>,<span class="number">21</span>)</span><br><span class="line">    println(<span class="string">s&quot;student3: name = <span class="subst">$&#123;student3.name&#125;</span>, age = <span class="subst">$&#123;student3.age&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> student4 = <span class="keyword">new</span> <span class="type">Student4</span>(<span class="string">&quot;cary&quot;</span>, <span class="number">25</span>)</span><br><span class="line">    student4.printInfo()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> student5 = <span class="keyword">new</span> <span class="type">Student5</span>(<span class="string">&quot;bob&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    println(<span class="string">s&quot;student5: name = <span class="subst">$&#123;student5.name&#125;</span>, age = <span class="subst">$&#123;student5.age&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> student6 = <span class="keyword">new</span> <span class="type">Student6</span>(<span class="string">&quot;cary&quot;</span>, <span class="number">25</span>, <span class="string">&quot;Tsinghua&quot;</span>)</span><br><span class="line">    println(<span class="string">s&quot;student6: name = <span class="subst">$&#123;student6.name&#125;</span>, age = <span class="subst">$&#123;student6.age&#125;</span>&quot;</span>)</span><br><span class="line">    student6.printInfo()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义类</span></span><br><span class="line"><span class="comment">// 无参构造器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student2</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 单独定义属性</span></span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span> = _</span><br><span class="line">  <span class="keyword">var</span> age: <span class="type">Int</span> = _</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面定义等价于</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student3</span>(<span class="params">var name: <span class="type">String</span>, var age: <span class="type">Int</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主构造器参数无修饰</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student4</span>(<span class="params">name: <span class="type">String</span>, age: <span class="type">Int</span></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>()&#123;</span><br><span class="line">    println(<span class="string">s&quot;student4: name = <span class="subst">$&#123;name&#125;</span>, age = <span class="subst">$age</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student5</span>(<span class="params">val name: <span class="type">String</span>, val age: <span class="type">Int</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student6</span>(<span class="params">var name: <span class="type">String</span>, var age: <span class="type">Int</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> school: <span class="type">String</span> = _</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(name: <span class="type">String</span>, age: <span class="type">Int</span>, school: <span class="type">String</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>(name, age)</span><br><span class="line">    <span class="keyword">this</span>.school = school</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>()&#123;</span><br><span class="line">    println(<span class="string">s&quot;student6: name = <span class="subst">$&#123;name&#125;</span>, age = <span class="subst">$age</span>, school = <span class="subst">$school</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="继承和多态"><a href="#继承和多态" class="headerlink" title="继承和多态"></a>继承和多态</h2><h3 id="基本语法-21"><a href="#基本语法-21" class="headerlink" title="基本语法"></a>基本语法</h3><p>class **子类名 <strong>extends <strong>父类名</strong> { <strong>类体 <strong>}<br>（1）子类继承父类的</strong>属性</strong>和</strong>方法 **<br>（2）scala 是单继承</p>
<h3 id="案例实操-36"><a href="#案例实操-36" class="headerlink" title="案例实操"></a>案例实操</h3><p>（1）子类继承父类的<strong>属性</strong>和**方法 **<br>（2）继承的调用顺序：父类构造器-&gt;子类构造器</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test07_Inherit</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> student1 = <span class="keyword">new</span> <span class="type">Student7</span>(<span class="string">&quot;alice&quot;</span>, <span class="number">18</span>)</span><br><span class="line">    <span class="keyword">val</span> student2 = <span class="keyword">new</span> <span class="type">Student7</span>(<span class="string">&quot;bob&quot;</span>, <span class="number">20</span>, <span class="string">&quot;std001&quot;</span>)</span><br><span class="line"></span><br><span class="line">    student1.printInfo()</span><br><span class="line">    student2.printInfo()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个父类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person7</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span> = _</span><br><span class="line">  <span class="keyword">var</span> age: <span class="type">Int</span> = _</span><br><span class="line"></span><br><span class="line">  println(<span class="string">&quot;1. 父类的主构造器调用&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(name: <span class="type">String</span>, age: <span class="type">Int</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>()</span><br><span class="line">    println(<span class="string">&quot;2. 父类的辅助构造器调用&quot;</span>)</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = age</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">s&quot;Person: <span class="subst">$name</span> <span class="subst">$age</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student7</span>(<span class="params">name: <span class="type">String</span>, age: <span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Person7</span>(<span class="params">name, age</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> stdNo: <span class="type">String</span> = _</span><br><span class="line"></span><br><span class="line">  println(<span class="string">&quot;3. 子类的主构造器调用&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(name: <span class="type">String</span>, age: <span class="type">Int</span>, stdNo: <span class="type">String</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>(name,age)</span><br><span class="line">    println(<span class="string">&quot;4. 子类的辅助构造器调用&quot;</span>)</span><br><span class="line">    <span class="keyword">this</span>.stdNo = stdNo</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">s&quot;Student: <span class="subst">$name</span> <span class="subst">$age</span> <span class="subst">$stdNo</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）动态绑定<br>Scala 中属性和方法都是动态绑定，而 Java 中只有方法为动态绑定。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test07_Inherit</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> student1 = <span class="keyword">new</span> <span class="type">Student7</span>(<span class="string">&quot;alice&quot;</span>, <span class="number">18</span>)</span><br><span class="line">    <span class="keyword">val</span> student2 = <span class="keyword">new</span> <span class="type">Student7</span>(<span class="string">&quot;bob&quot;</span>, <span class="number">20</span>, <span class="string">&quot;std001&quot;</span>)</span><br><span class="line"></span><br><span class="line">    student1.printInfo()</span><br><span class="line">    student2.printInfo()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> teacher = <span class="keyword">new</span> <span class="type">Teacher</span></span><br><span class="line">    teacher.printInfo()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">personInfo</span></span>(person: <span class="type">Person7</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      person.printInfo()</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;=========================&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> person = <span class="keyword">new</span> <span class="type">Person7</span></span><br><span class="line">    personInfo(student1)</span><br><span class="line">    personInfo(teacher)</span><br><span class="line">    personInfo(person)</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个父类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person7</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span> = _</span><br><span class="line">  <span class="keyword">var</span> age: <span class="type">Int</span> = _</span><br><span class="line"></span><br><span class="line">  println(<span class="string">&quot;1. 父类的主构造器调用&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(name: <span class="type">String</span>, age: <span class="type">Int</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>()</span><br><span class="line">    println(<span class="string">&quot;2. 父类的辅助构造器调用&quot;</span>)</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = age</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">s&quot;Person: <span class="subst">$name</span> <span class="subst">$age</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student7</span>(<span class="params">name: <span class="type">String</span>, age: <span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Person7</span>(<span class="params">name, age</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> stdNo: <span class="type">String</span> = _</span><br><span class="line"></span><br><span class="line">  println(<span class="string">&quot;3. 子类的主构造器调用&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(name: <span class="type">String</span>, age: <span class="type">Int</span>, stdNo: <span class="type">String</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>(name,age)</span><br><span class="line">    println(<span class="string">&quot;4. 子类的辅助构造器调用&quot;</span>)</span><br><span class="line">    <span class="keyword">this</span>.stdNo = stdNo</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">s&quot;Student: <span class="subst">$name</span> <span class="subst">$age</span> <span class="subst">$stdNo</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> <span class="keyword">extends</span> <span class="title">Person7</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">s&quot;Teacher&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><h3 id="抽象属性和抽象方法"><a href="#抽象属性和抽象方法" class="headerlink" title="抽象属性和抽象方法"></a>抽象属性和抽象方法</h3><h4 id="基本语法-22"><a href="#基本语法-22" class="headerlink" title="基本语法"></a>基本语法</h4><p>（1）定义抽象类：abstract class Person{} &#x2F;&#x2F;通过 abstract 关键字标记抽象类<br>（2）定义抽象属性：val|var name:String &#x2F;&#x2F;一个属性没有初始化，就是抽象属性<br>（3）定义抽象方法：def hello():String &#x2F;&#x2F;只声明而没有实现的方法，就是抽象方法</p>
<h4 id="案例实操-37"><a href="#案例实操-37" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test09_AbstractClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> student = <span class="keyword">new</span> <span class="type">Student9</span></span><br><span class="line">    student.eat()</span><br><span class="line">    student.sleep()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Person9</span></span>&#123;</span><br><span class="line">  <span class="comment">// 非抽象属性</span></span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">&quot;person&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 抽象属性</span></span><br><span class="line">  <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 非抽象方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">eat</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;person eat&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 抽象方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sleep</span></span>(): <span class="type">Unit</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义具体的实现子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student9</span> <span class="keyword">extends</span> <span class="title">Person9</span></span>&#123;</span><br><span class="line">  <span class="comment">// 实现抽象属性和方法</span></span><br><span class="line">  <span class="keyword">var</span> age: <span class="type">Int</span> = <span class="number">18</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sleep</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;student sleep~~&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//重写非抽象属性和方法</span></span><br><span class="line">  <span class="comment">//override val name: String = &quot;student&quot; //错误</span></span><br><span class="line"></span><br><span class="line">  name = <span class="string">&quot;student&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">eat</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">super</span>.eat()</span><br><span class="line">    println(<span class="string">&quot;student eat&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="继承-amp-重写"><a href="#继承-amp-重写" class="headerlink" title="继承&amp;重写"></a>继承&amp;重写</h4><p>（1）如果父类为抽象类，那么子类需要将抽象的属性和方法实现，否则子类也需声明<br>为抽象类<br>（2）重写非抽象方法需要用 override 修饰，重写抽象方法则可以不加 override。<br>（3）子类中调用父类的方法使用 super 关键字<br>（4）子类对抽象属性进行实现，父类抽象属性可以用 var 修饰；<br>  子类对非抽象属性重写，父类非抽象属性只支持 val 类型，而不支持 var。<br>因为 var 修饰的为可变变量，子类继承之后就可以直接使用，没有必要重写</p>
<h3 id="匿名子类"><a href="#匿名子类" class="headerlink" title="匿名子类"></a>匿名子类</h3><h4 id="说明-6"><a href="#说明-6" class="headerlink" title="说明"></a>说明</h4><p>和 Java 一样，可以通过包含带有定义或重写的代码块的方式创建一个匿名的子类。</p>
<h4 id="案例实操-38"><a href="#案例实操-38" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test10_AnnoymousClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> person: <span class="type">Person10</span> = <span class="keyword">new</span> <span class="type">Person10</span> &#123;</span><br><span class="line">      <span class="keyword">override</span> <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">&quot;LiAng&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">eat</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">        println(<span class="string">&quot;person eat&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    println(person.name)</span><br><span class="line">    person.eat()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Person10</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">eat</span></span>(): <span class="type">Unit</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="单例对象（伴生对象）"><a href="#单例对象（伴生对象）" class="headerlink" title="单例对象（伴生对象）"></a>单例对象（伴生对象）</h2><p>Scala语言是完全面向对象的语言，所以并没有静态的操作（即在Scala中没有静态的概 念）。但是为了能够和Java语言交互（因为Java中有静态概念），就产生了一种特殊的对象 来模拟类对象，该对象为<strong>单例对象</strong>。若单例对象名与类名一致，则称该单例对象这个类的<strong>伴生对象</strong>，这个类的所有“静态”内容都可以放置在它的伴生对象中声明。</p>
<h3 id="单例对象语法"><a href="#单例对象语法" class="headerlink" title="单例对象语法"></a>单例对象语法</h3><h4 id="基本语法-23"><a href="#基本语法-23" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658141680836-75e33ce2-e052-49e4-86d7-bfdce89dfe27.png#clientId=ub24abab6-2b7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=103&id=ud53a7eaf&margin=%5Bobject%20Object%5D&name=image.png&originHeight=103&originWidth=241&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7637&status=done&style=none&taskId=ua05c8daa-f5ad-428d-8f8a-2e7d6e18b9e&title=&width=241" alt="image.png"></p>
<h4 id="说明-7"><a href="#说明-7" class="headerlink" title="说明"></a>说明</h4><p>（1）单例对象采用 object 关键字声明<br>（2）单例对象对应的类称之为伴生类，伴生对象的名称应该和伴生类名一致。<br>（3）单例对象中的属性和方法都可以通过伴生对象名（类名）直接调用访问。</p>
<h4 id="案例实操-39"><a href="#案例实操-39" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test12_Singleton</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> student1 = <span class="type">Student12</span>.getInstance()</span><br><span class="line">    student1.printInfo()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> student2 = <span class="type">Student12</span>.getInstance()</span><br><span class="line">    student2.printInfo()</span><br><span class="line"></span><br><span class="line">    println(student1)</span><br><span class="line">    println(student2)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student12</span> <span class="title">private</span>(<span class="params">val name: <span class="type">String</span>, val age: <span class="type">Int</span></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>()&#123;</span><br><span class="line">    println(<span class="string">s&quot;student: name = <span class="subst">$&#123;name&#125;</span>, age = <span class="subst">$age</span>, school = <span class="subst">$&#123;Student11.school&#125;</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 饿汉式</span></span><br><span class="line"><span class="comment">//object Student12 &#123;</span></span><br><span class="line"><span class="comment">//  private val student: Student12 = new Student12(&quot;alice&quot;, 18)</span></span><br><span class="line"><span class="comment">//  def getInstance(): Student12 = student</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒汉式</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Student12</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> student: <span class="type">Student12</span> = _</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getInstance</span></span>(): <span class="type">Student12</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (student == <span class="literal">null</span>)&#123;</span><br><span class="line">      <span class="comment">// 如果没有对象实例的话，就创建一个</span></span><br><span class="line">      student = <span class="keyword">new</span> <span class="type">Student12</span>(<span class="string">&quot;alice&quot;</span>, <span class="number">18</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    student</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="apply方法"><a href="#apply方法" class="headerlink" title="apply方法"></a>apply方法</h3><h4 id="说明-8"><a href="#说明-8" class="headerlink" title="说明"></a>说明</h4><p>（1）通过伴生对象的 apply 方法，实现不使用 new 方法创建对象。<br>（2）如果想让主构造器变成私有的，可以在()之前加上 private。<br>（3）apply 方法可以重载。<br>（4）Scala 中 obj(arg)的语句实际是在调用该对象的 apply 方法，即obj.apply(arg)。用以统一面向对象编程和函数式编程的风格。<br>（5）当使用 new 关键字构建对象时，调用的其实是类的构造方法，当直接使用类名构建对象时，调用的其实时伴生对象的 apply 方法。</p>
<h4 id="案例实操-40"><a href="#案例实操-40" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test11_Object</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"><span class="comment">//    val student = new Student11(&quot;alice&quot;,18)</span></span><br><span class="line"><span class="comment">//    student.printInfo()</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> student1 = <span class="type">Student11</span>.newStudent(<span class="string">&quot;alice&quot;</span>, <span class="number">18</span>)</span><br><span class="line">    student1.printInfo()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> student2 = <span class="type">Student11</span>.apply(<span class="string">&quot;bob&quot;</span>, <span class="number">19</span>)</span><br><span class="line">    student2.printInfo()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> student3 = <span class="type">Student11</span>(<span class="string">&quot;bob&quot;</span>, <span class="number">19</span>)</span><br><span class="line">    student3.printInfo()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student11</span> <span class="title">private</span> (<span class="params">val name: <span class="type">String</span>, val age: <span class="type">Int</span></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">printInfo</span></span>()&#123;</span><br><span class="line">    println(<span class="string">s&quot;student: name = <span class="subst">$&#123;name&#125;</span>, age = <span class="subst">$age</span>, school = <span class="subst">$&#123;Student11.school&#125;</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 伴生对象</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Student11</span></span>&#123;</span><br><span class="line">  <span class="keyword">val</span> school: <span class="type">String</span> = <span class="string">&quot;Tsinghua&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义一个类的对象实例的创建方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">newStudent</span></span>(name: <span class="type">String</span>, age: <span class="type">Int</span>): <span class="type">Student11</span> = <span class="keyword">new</span> <span class="type">Student11</span>(name, age)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(name: <span class="type">String</span>, age: <span class="type">Int</span>): <span class="type">Student11</span> = <span class="keyword">new</span> <span class="type">Student11</span>(name, age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="特质（Trait）"><a href="#特质（Trait）" class="headerlink" title="特质（Trait）"></a>特质（Trait）</h2><p>Scala 语言中，采用特质 trait（特征）来代替接口的概念，也就是说，多个类具有相同的特质（特征）时，就可以将这个特质（特征）独立出来，采用关键字 trait 声明。<br>Scala 中的 trait 中即<strong>可以有抽象属性和方法，也可以有具体的属性和方法</strong>，<strong>一个类可以混入（mixin）多个特质</strong>。这种感觉类似于 Java 中的抽象类。<br>Scala 引入 trait 特征，第一可以替代 Java 的接口，第二个也是对单继承机制的一种补充。</p>
<h3 id="特质声明"><a href="#特质声明" class="headerlink" title="特质声明"></a>特质声明</h3><h4 id="基本语法-24"><a href="#基本语法-24" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658141823726-52617713-05be-4d0a-8ee0-23f50bf9e119.png#clientId=ub24abab6-2b7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=77&id=u8e042939&margin=%5Bobject%20Object%5D&name=image.png&originHeight=77&originWidth=145&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4449&status=done&style=none&taskId=u5f15bf08-f20d-4954-8d29-76d13122a88&title=&width=145" alt="image.png"></p>
<h4 id="案例实操-41"><a href="#案例实操-41" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test13_Trait</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> student = <span class="keyword">new</span> <span class="type">Student13</span></span><br><span class="line">    student.sayHello()</span><br><span class="line">    student.study()</span><br><span class="line">    student.dating()</span><br><span class="line">    student.play()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个父类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person13</span> </span>&#123;</span><br><span class="line">  <span class="keyword">val</span> name: <span class="type">String</span> = <span class="string">&quot;person&quot;</span></span><br><span class="line">  <span class="keyword">var</span> age: <span class="type">Int</span> = <span class="number">18</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sayHello</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;hello from: &quot;</span> + name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">increase</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;person increase&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个特质</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Young</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 声明抽象和非抽象属性</span></span><br><span class="line">  <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">val</span> name: <span class="type">String</span> = <span class="string">&quot;young&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 声明抽象和非抽象的方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">play</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">s&quot;young people <span class="subst">$name</span> is playing&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dating</span></span>(): <span class="type">Unit</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student13</span> <span class="keyword">extends</span> <span class="title">Person13</span> <span class="keyword">with</span> <span class="title">Young</span></span>&#123;</span><br><span class="line">  <span class="comment">// 重写冲突的属性</span></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">val</span> name: <span class="type">String</span> = <span class="string">&quot;student&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 实现特质的抽象方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dating</span></span>(): <span class="type">Unit</span> = println(<span class="string">s&quot;student <span class="subst">$name</span> is dating&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">study</span></span>(): <span class="type">Unit</span> = println(<span class="string">s&quot;student <span class="subst">$name</span> is studying&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重写父类方法</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">sayHello</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">super</span>.sayHello()</span><br><span class="line">    println(<span class="string">s&quot;hello from: student <span class="subst">$name</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="特质基本语法"><a href="#特质基本语法" class="headerlink" title="特质基本语法"></a>特质基本语法</h3><p>一个类具有某种特质（特征），就意味着这个类满足了这个特质（特征）的所有要素，所以在使用时，也采用了 extends 关键字，如果有多个特质或存在父类，那么需要采用 with 关键字连接。</p>
<h4 id="基本语法-25"><a href="#基本语法-25" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658141860683-5d909907-cf06-4b26-8e4b-b25f7552f190.png#clientId=ub24abab6-2b7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=83&id=u938593ee&margin=%5Bobject%20Object%5D&name=image.png&originHeight=83&originWidth=660&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19537&status=done&style=none&taskId=uc5351547-ea25-4d92-ae1c-4b006887004&title=&width=660" alt="image.png"></p>
<h4 id="说明-9"><a href="#说明-9" class="headerlink" title="说明"></a>说明</h4><p>（1）类和特质的关系：使用继承的关系。<br>（2）当一个类去继承特质时，第一个连接词是 extends，后面是 with。<br>（3）如果一个类在同时继承特质和父类时，应当把父类写在 extends 后。</p>
<h4 id="案例实操-42"><a href="#案例实操-42" class="headerlink" title="案例实操"></a>案例实操</h4><p>（1）特质可以同时拥有抽象方法和具体方法<br>（2）一个类可以混入（mixin）多个特质<br>（3）所有的 Java 接口都可以当做 Scala 特质使用<br>（4）<strong>动态混入</strong>：可灵活的扩展类的功能<br><strong>（</strong>4.1**）动态混入：创建对象时混入 <strong>trait</strong>，而无需使类混入该 **trait<br>（4.2）如果混入的 trait 中有未实现的方法，则需要实现</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test14_TraitMixin</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> student = <span class="keyword">new</span> <span class="type">Student14</span></span><br><span class="line">    student.study()</span><br><span class="line">    student.increase()</span><br><span class="line"></span><br><span class="line">    student.play()</span><br><span class="line">    student.increase()</span><br><span class="line"></span><br><span class="line">    student.dating()</span><br><span class="line">    student.increase()</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;===========================&quot;</span>)</span><br><span class="line">    <span class="comment">// 动态混入</span></span><br><span class="line">    <span class="keyword">val</span> studentWithTalent = <span class="keyword">new</span> <span class="type">Student14</span> <span class="keyword">with</span> <span class="type">Talent</span>&#123;</span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">dancing</span></span>(): <span class="type">Unit</span> = println(<span class="string">&quot;student is good at dancing&quot;</span>)</span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">singing</span></span>(): <span class="type">Unit</span> = println(<span class="string">&quot;student is good at singing&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    studentWithTalent.sayHello()</span><br><span class="line">    studentWithTalent.play()</span><br><span class="line">    studentWithTalent.study()</span><br><span class="line">    studentWithTalent.dating()</span><br><span class="line">    studentWithTalent.dancing()</span><br><span class="line">    studentWithTalent.singing()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 再定义一个特质</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Knowledge</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> amount: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">increase</span></span>(): <span class="type">Unit</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Talent</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">singing</span></span>(): <span class="type">Unit</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dancing</span></span>(): <span class="type">Unit</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student14</span> <span class="keyword">extends</span> <span class="title">Person13</span> <span class="keyword">with</span> <span class="title">Young</span> <span class="keyword">with</span> <span class="title">Knowledge</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 重写冲突的属性</span></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">val</span> name: <span class="type">String</span> = <span class="string">&quot;student&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 实现抽象方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dating</span></span>(): <span class="type">Unit</span> = println(<span class="string">s&quot;student <span class="subst">$name</span> is dating&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">study</span></span>(): <span class="type">Unit</span> = println(<span class="string">s&quot;student <span class="subst">$name</span> is studying&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重写父类方法</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">sayHello</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">super</span>.sayHello()</span><br><span class="line">    println(<span class="string">s&quot;hello from: student <span class="subst">$name</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 实现特质中的抽象方法</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">increase</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    amount += <span class="number">1</span></span><br><span class="line">    println(<span class="string">s&quot;student <span class="subst">$name</span> knowledge increased: <span class="subst">$amount</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="特质叠加"><a href="#特质叠加" class="headerlink" title="特质叠加"></a>特质叠加</h3><p>由于一个类可以混入（mixin）多个 trait，且 trait 中可以有具体的属性和方法，若混入的特质中具有相同的方法（方法名，参数列表，返回值均相同），必然会出现继承冲突问题。冲突分为以下两种：<br>第一种，一个类（Sub）混入的两个 trait（TraitA，TraitB）中具有相同的具体方法，且两个 trait 之间没有任何关系，解决这类冲突问题，直接在类（Sub）中重写冲突方法。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658145653549-16292bee-4125-4153-849e-0ea64ddebe35.png#clientId=ub24abab6-2b7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=160&id=ua8425bc0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=160&originWidth=207&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6603&status=done&style=none&taskId=u4bb848f3-8e76-4450-8dab-4ae7c5d06d4&title=&width=207" alt="image.png"><br>第二种，一个类（Sub）混入的两个 trait（TraitA，TraitB）中具有相同的具体方法，且两个 trait 继承自相同的 trait（TraitC），及所谓的“钻石问题”，解决这类冲突问题，Scala 采用了<strong>特质叠加</strong>的策略。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658145676315-aaa6e5ef-3725-41ae-8fbc-8fcad3ec5de2.png#clientId=ub24abab6-2b7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=312&id=u4b704a5c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=312&originWidth=274&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39979&status=done&style=none&taskId=u667981e9-ae06-49f4-88c7-8bb3d7ba5b2&title=&width=274" alt="image.png"><br>所谓的<strong>特质叠加</strong>，就是将混入的多个 trait 中的冲突方法叠加起来</p>
<h3 id="特质叠加执行顺序"><a href="#特质叠加执行顺序" class="headerlink" title="特质叠加执行顺序"></a>特质叠加执行顺序</h3><p>普通的</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test15_TraitOverlying</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> student = <span class="keyword">new</span> <span class="type">Student15</span></span><br><span class="line">    student.increase()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Knowledge15</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> amount: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">increase</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;knowledge increased&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Talent15</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">singing</span></span>(): <span class="type">Unit</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dancing</span></span>(): <span class="type">Unit</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">increase</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;talent increased&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student15</span> <span class="keyword">extends</span> <span class="title">Person13</span> <span class="keyword">with</span> <span class="title">Talent15</span> <span class="keyword">with</span> <span class="title">Knowledge15</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">dancing</span></span>(): <span class="type">Unit</span> = println(<span class="string">&quot;dancing&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">singing</span></span>(): <span class="type">Unit</span> = println(<span class="string">&quot;singing&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">increase</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//super.increase() // 调用最后的Trait的 increase</span></span><br><span class="line">    <span class="keyword">super</span>[<span class="type">Person13</span>].increase()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>钻石问题特征叠加</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test15_TraitOverlying</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//钻石问题特征叠加</span></span><br><span class="line">    <span class="keyword">val</span> myFootBall = <span class="keyword">new</span> <span class="type">MyFootBall</span></span><br><span class="line">    println(myFootBall.describe())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义球类特征</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Ball</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">describe</span></span>(): <span class="type">String</span> = <span class="string">&quot;ball&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义颜色特征</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">ColorBall</span> <span class="keyword">extends</span> <span class="title">Ball</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> color: <span class="type">String</span> = <span class="string">&quot;red&quot;</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">describe</span></span>(): <span class="type">String</span> = color + <span class="string">&quot;-&quot;</span> + <span class="keyword">super</span>.describe()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义种类特征</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">CategoryBall</span> <span class="keyword">extends</span> <span class="title">Ball</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> category: <span class="type">String</span> = <span class="string">&quot;foot&quot;</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">describe</span></span>(): <span class="type">String</span> = category + <span class="string">&quot;-&quot;</span> + <span class="keyword">super</span>.describe()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个自定义球的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFootBall</span> <span class="keyword">extends</span> <span class="title">CategoryBall</span> <span class="keyword">with</span> <span class="title">ColorBall</span> </span>&#123;</span><br><span class="line">  <span class="comment">//override def describe(): String = &quot;my ball is a &quot; + super.describe() // my ball is a red-foot-ball</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">describe</span></span>(): <span class="type">String</span> = <span class="string">&quot;my ball is a &quot;</span> + <span class="keyword">super</span>[<span class="type">CategoryBall</span>].describe() <span class="comment">//my ball is a foot-ball</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当一个类混入多个特质的时候，scala 会对所有的特质及其父特质按照一定的顺序进行 排序，而此案例中的 super.describe()调用的实际上是排好序后的下一个特质中的 describe() 方法。排序规则如下：<img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658146986604-08864e22-f4e7-468c-bd92-9122da515300.png#clientId=ub24abab6-2b7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=391&id=u15461072&margin=%5Bobject%20Object%5D&name=image.png&originHeight=391&originWidth=769&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74371&status=done&style=none&taskId=ud3a7be3a-e0a1-49f6-a28e-fda22a6601f&title=&width=769" alt="image.png">**结论： **<br>（1）案例中的 super，不是表示其父特质对象，而是表示上述叠加顺序中的下一个特质， 即，MyClass **中的 **super <strong>指代 <strong>Color</strong>，</strong>Color <strong>中的 <strong>super <strong>指代</strong>Category</strong>，</strong>Category **中的 **super **指代 <strong>Ball</strong>。 **<br>（2）如果想要调用某个指定的混入特质中的方法，可以增加约束：super[]，例如super[Category].describe()。 </p>
<h3 id="特质和抽象类的区别"><a href="#特质和抽象类的区别" class="headerlink" title="特质和抽象类的区别"></a>特质和抽象类的区别</h3><p>1.优先使用特质。一个类扩展多个特质是很方便的，但却只能扩展一个抽象类。<br>2.如果你需要构造函数参数，使用抽象类。因为抽象类可以定义带参数的构造函数，而特质不行（有无参构造）。</p>
<h3 id="特质自身类型"><a href="#特质自身类型" class="headerlink" title="特质自身类型"></a>特质自身类型</h3><p>自身类型可实现依赖注入的功能。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test16_TraitSelfType</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> user = <span class="keyword">new</span> <span class="type">RegisterUser</span>(<span class="string">&quot;alice&quot;</span>, <span class="string">&quot;123456&quot;</span>)</span><br><span class="line">    user.insert()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">val name: <span class="type">String</span>, val password: <span class="type">String</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">  _: <span class="type">User</span> =&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向数据库插入数据</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">insert</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">s&quot;insert into db: <span class="subst">$&#123;this.name&#125;</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义注册用户类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterUser</span>(<span class="params">name: <span class="type">String</span>, password: <span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">User</span>(<span class="params">name, password</span>) <span class="keyword">with</span> <span class="title">UserDao</span></span></span><br></pre></td></tr></table></figure>

<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><h3 id="类型检查和转换"><a href="#类型检查和转换" class="headerlink" title="类型检查和转换"></a>类型检查和转换</h3><h4 id="说明-10"><a href="#说明-10" class="headerlink" title="说明"></a>说明</h4><p>（1）obj.isInstanceOf[T]：判断 obj 是不是 T 类型。<br>（2）obj.asInstanceOf[T]：将 obj 强转成 T 类型。<br>（3）classOf 获取对象的类名。</p>
<h4 id="案例实操-43"><a href="#案例实操-43" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test17_Extends</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 类型的检测和转换</span></span><br><span class="line">    <span class="keyword">val</span> student: <span class="type">Student17</span> = <span class="keyword">new</span> <span class="type">Student17</span>(<span class="string">&quot;alice&quot;</span>, <span class="number">18</span>)</span><br><span class="line">    student.study()</span><br><span class="line">    student.sayHi()</span><br><span class="line">    <span class="keyword">val</span> person: <span class="type">Person17</span> = <span class="keyword">new</span> <span class="type">Student17</span>(<span class="string">&quot;bob&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    person.sayHi()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//类型判断</span></span><br><span class="line">    println(<span class="string">&quot;student is Student17: &quot;</span> + student.isInstanceOf[<span class="type">Student17</span>])</span><br><span class="line">    println(<span class="string">&quot;student is Person17: &quot;</span> + student.isInstanceOf[<span class="type">Person17</span>])</span><br><span class="line">    println(<span class="string">&quot;person is Person17: &quot;</span> + person.isInstanceOf[<span class="type">Person17</span>])</span><br><span class="line">    println(<span class="string">&quot;person is Student: &quot;</span> + person.isInstanceOf[<span class="type">Student17</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> person2: <span class="type">Person17</span> = <span class="keyword">new</span> <span class="type">Person17</span>(<span class="string">&quot;cary&quot;</span>, <span class="number">35</span>)</span><br><span class="line">    println(<span class="string">&quot;person2 is Student17: &quot;</span> + person2.isInstanceOf[<span class="type">Student17</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">//类型转换</span></span><br><span class="line">    <span class="comment">// 类型转换</span></span><br><span class="line">    <span class="keyword">if</span> (person.isInstanceOf[<span class="type">Student17</span>])&#123;</span><br><span class="line">      <span class="keyword">val</span> newStudent = person.asInstanceOf[<span class="type">Student17</span>]</span><br><span class="line">      newStudent.study()</span><br><span class="line">    &#125;</span><br><span class="line">    println(classOf[<span class="type">Student17</span>])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person17</span>(<span class="params">val name: <span class="type">String</span>, val age: <span class="type">Int</span></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sayHi</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;hi from person &quot;</span> + name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student17</span>(<span class="params">name: <span class="type">String</span>, age: <span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Person17</span>(<span class="params">name, age</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">sayHi</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;hi from student &quot;</span> + name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">study</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;student study&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="枚举类和应用类"><a href="#枚举类和应用类" class="headerlink" title="枚举类和应用类"></a>枚举类和应用类</h3><h4 id="说明-11"><a href="#说明-11" class="headerlink" title="说明"></a>说明</h4><p>枚举类：需要继承 Enumeration<br>应用类：需要继承 App</p>
<h4 id="案例实操-44"><a href="#案例实操-44" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter06</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test17_Extends</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="type">WorkDay</span>.<span class="type">MONDAY</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义枚举类对象</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WorkDay</span> <span class="keyword">extends</span> <span class="title">Enumeration</span></span>&#123;</span><br><span class="line">  <span class="keyword">val</span> <span class="type">MONDAY</span> = <span class="type">Value</span>(<span class="number">1</span>,<span class="string">&quot;Monday&quot;</span>)</span><br><span class="line">  <span class="keyword">val</span> <span class="type">TUESDAY</span> = <span class="type">Value</span>(<span class="number">2</span>, <span class="string">&quot;TuesDay&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义应用类对象</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestApp</span> <span class="keyword">extends</span> <span class="title">App</span></span>&#123;</span><br><span class="line">  println(<span class="string">&quot;app start&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Type-定义新类型"><a href="#Type-定义新类型" class="headerlink" title="Type 定义新类型"></a>Type 定义新类型</h3><h4 id="说明-12"><a href="#说明-12" class="headerlink" title="说明"></a>说明</h4><p>使用 type 关键字可以定义新的数据数据类型名称，本质上就是类型的一个别名。</p>
<h4 id="案例实操-45"><a href="#案例实操-45" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TestApp</span> <span class="keyword">extends</span> <span class="title">App</span></span>&#123;</span><br><span class="line">  println(<span class="string">&quot;app start&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">type</span> <span class="title">MyString</span> </span>= <span class="type">String</span></span><br><span class="line">  <span class="keyword">val</span> a: <span class="type">MyString</span> = <span class="string">&quot;abc&quot;</span></span><br><span class="line">  println(a.getClass()) <span class="comment">//class java.lang.String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658191735153-40e5daf6-4234-4a73-8462-3fdadbdc7931.png#clientId=ua5479994-d267-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=109&id=ub8c5dc4d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=109&originWidth=623&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17202&status=done&style=none&taskId=u85d22258-38e6-44ef-8e06-0e0b43954f1&title=&width=623" alt="image.png"></p>
<h1 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h1><h2 id="集合简介"><a href="#集合简介" class="headerlink" title="集合简介"></a>集合简介</h2><p>1）Scala 的集合有三大类：序列 Seq、集 Set、映射 Map，所有的集合都扩展自 Iterable 特质。<br>2）对于几乎所有的集合类，Scala 都同时提供了<strong>可变</strong>和<strong>不可变</strong>的版本，分别位于以下两个包<br>不可变集合：scala.collection.immutable<br>可变集合： scala.collection.mutable<br>3）Scala 不可变集合，就是指该集合对象不可修改，每次修改就会返回一个新对象，而不会对原对象进行修改。类似于 java 中的 String 对象<br>4）可变集合，就是这个集合可以直接对原对象进行修改，而不会返回新的对象。类似于 java 中 StringBuilder 对象<br><strong>建议：在操作集合的时候，不可变集合用符号，可变集合用方法</strong></p>
<h3 id="不可变集合继承图"><a href="#不可变集合继承图" class="headerlink" title="不可变集合继承图"></a>不可变集合继承图</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658192076206-447c719c-343f-48d8-9b83-599ec3be0d7a.png#clientId=ua5479994-d267-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=649&id=uf6c32e9e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=649&originWidth=734&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66397&status=done&style=none&taskId=u3ab5c5f7-376e-4526-a787-5635ad513b0&title=&width=734" alt="image.png"><br>1）Set、Map 是 Java 中也有的集合<br>2）Seq 是 Java 没有的，我们发现 List 归属到 Seq 了，因此这里的 List 就和 Java 不是同一个概念了<br>3）我们前面的 for 循环有一个 1 to 3，就是 IndexedSeq 下的 Range<br>4）String 也是属于 IndexedSeq<br>5）我们发现经典的数据结构比如 Queue 和 Stack 被归属到 LinearSeq(线性序列)<br>6）大家注意 Scala 中的 Map 体系有一个 SortedMap，说明 Scala 的 Map 可以支持排序<br>7）IndexedSeq 和 LinearSeq 的区别：<br>（1）IndexedSeq 是通过索引来查找和定位，因此速度快，比如 String 就是一个索引集合，通过索引即可定位<br>（2）LinearSeq 是线型的，即有头尾的概念，这种数据结构一般是通过遍历来查找</p>
<h3 id="可变集合继承图"><a href="#可变集合继承图" class="headerlink" title="可变集合继承图"></a>可变集合继承图</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658192118017-da6df33a-0c73-4d2c-8e81-78d7d479b02a.png#clientId=ua5479994-d267-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=887&id=u297db905&margin=%5Bobject%20Object%5D&name=image.png&originHeight=887&originWidth=1301&originalType=binary&ratio=1&rotation=0&showTitle=false&size=202517&status=done&style=none&taskId=u17f6f558-cbb0-4ad2-9c02-3d1afdcad8d&title=&width=1301" alt="image.png"><br>（上图链接<br><a target="_blank" rel="noopener" href="https://img-blog.csdnimg.cn/827f92fc773149969cd20ebb8fd47147.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZ3VuX0s=,size_20,color_FFFFFF,t_70,g_se,x_16">https://img-blog.csdnimg.cn/827f92fc773149969cd20ebb8fd47147.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZ3VuX0s&#x3D;,size_20,color_FFFFFF,t_70,g_se,x_16</a>）</p>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><h3 id="不可变数组"><a href="#不可变数组" class="headerlink" title="不可变数组"></a>不可变数组</h3><h4 id="第一种方式定义数组"><a href="#第一种方式定义数组" class="headerlink" title="第一种方式定义数组"></a>第一种方式定义数组</h4><p>定义：val arr1 &#x3D; new Array<a href="10">Int</a><br>（1）new 是关键字<br>（2）[Int]是指定可以存放的数据类型，如果希望存放任意数据类型，则指定Any<br>（3）(10)，表示数组的大小，确定后就不可以变化</p>
<h4 id="第二种方式定义数组"><a href="#第二种方式定义数组" class="headerlink" title="第二种方式定义数组"></a>第二种方式定义数组</h4><p>定义：val arr1 &#x3D; Array(1, 2)<br>（1）在定义数组时，直接赋初始值<br>（2）使用 apply 方法创建数组对象</p>
<h4 id="案例实操-46"><a href="#案例实操-46" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test01_ImmutableArray</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1.创建数组</span></span><br><span class="line">    <span class="keyword">val</span> arr: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Int</span>](<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> arr2 = <span class="type">Array</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 访问元素</span></span><br><span class="line">    println(arr(<span class="number">0</span>)) <span class="comment">// 0</span></span><br><span class="line">    println(arr(<span class="number">1</span>)) <span class="comment">// 0</span></span><br><span class="line">    <span class="comment">//println(arr(5)) // java.lang.ArrayIndexOutOfBoundsException</span></span><br><span class="line"></span><br><span class="line">    arr(<span class="number">0</span>) = <span class="number">12</span></span><br><span class="line">    arr(<span class="number">1</span>) = <span class="number">57</span></span><br><span class="line">    println(arr(<span class="number">0</span>))</span><br><span class="line">    println(arr(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 数组的遍历</span></span><br><span class="line">    <span class="comment">// 1) 普通for循环</span></span><br><span class="line">    <span class="keyword">for</span>(i &lt;- <span class="number">0</span> until arr.length)&#123;</span><br><span class="line">      println(arr(i))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i &lt;- arr.indices)&#123;</span><br><span class="line">      println(arr(i))</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;---------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2) 直接遍历所有元素，增强for循环</span></span><br><span class="line">    <span class="keyword">for</span>(elem &lt;- arr2) println(elem)</span><br><span class="line">    println(<span class="string">&quot;---------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3) 迭代器</span></span><br><span class="line">    <span class="keyword">val</span> iter = arr2.iterator</span><br><span class="line">    <span class="keyword">while</span>(iter.hasNext)&#123;</span><br><span class="line">      println(iter.next())</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;---------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4) 调用foreach方法</span></span><br><span class="line">    arr2.foreach((elem: <span class="type">Int</span>) =&gt; println(elem))</span><br><span class="line"></span><br><span class="line">    arr.foreach( println )</span><br><span class="line"></span><br><span class="line">    println(arr2.mkString(<span class="string">&quot;--&quot;</span>)) <span class="comment">// 1--3--5--7--9</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 添加元素</span></span><br><span class="line">    <span class="keyword">val</span> newArr = arr2.:+(<span class="number">73</span>)</span><br><span class="line">    println(arr2.mkString(<span class="string">&quot;--&quot;</span>)) <span class="comment">// 1--3--5--7--9</span></span><br><span class="line">    println(newArr.mkString(<span class="string">&quot;--&quot;</span>)) <span class="comment">// 1--3--5--7--9--73</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> newArr2 = newArr.+:(<span class="number">30</span>)</span><br><span class="line">    println(newArr2.mkString(<span class="string">&quot;--&quot;</span>)) <span class="comment">// 30--1--3--5--7--9--73</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> newArr3 = newArr2 :+ <span class="number">15</span></span><br><span class="line">    <span class="keyword">val</span> newArr4 = <span class="number">19</span> +: <span class="number">29</span> +: newArr3 :+ <span class="number">26</span> :+ <span class="number">73</span></span><br><span class="line">    println(newArr4.mkString(<span class="string">&quot;, &quot;</span>)) <span class="comment">// 19, 29, 30, 1, 3, 5, 7, 9, 73, 15, 26, 73</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="可变数组"><a href="#可变数组" class="headerlink" title="可变数组"></a>可变数组</h3><h4 id="定义变长数组"><a href="#定义变长数组" class="headerlink" title="定义变长数组"></a>定义变长数组</h4><p>定义：val arr01 &#x3D; ArrayBuffer[Any](3, 2, 5)<br>（1）[Any]存放任意数据类型<br>（2）(3, 2, 5)初始化好的三个元素<br>（3）ArrayBuffer 需要引入 scala.collection.mutable.ArrayBuffer</p>
<h4 id="案例实操-47"><a href="#案例实操-47" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable.<span class="type">ArrayBuffer</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test02_ArrayBuffer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 创建可变数组</span></span><br><span class="line">    <span class="keyword">val</span> arr1: <span class="type">ArrayBuffer</span>[<span class="type">Int</span>] = <span class="keyword">new</span> <span class="type">ArrayBuffer</span>[<span class="type">Int</span>]()</span><br><span class="line">    <span class="keyword">val</span> arr2 = <span class="type">ArrayBuffer</span>(<span class="number">23</span>, <span class="number">57</span>, <span class="number">92</span>)</span><br><span class="line"></span><br><span class="line">    println(arr1)</span><br><span class="line">    println(arr2) <span class="comment">// ArrayBuffer(23, 57, 92)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 访问元素</span></span><br><span class="line">    <span class="comment">//    println(arr1(0))     // java.lang.IndexOutOfBoundsException</span></span><br><span class="line">    println(arr2(<span class="number">1</span>))</span><br><span class="line">    arr2(<span class="number">1</span>) = <span class="number">39</span></span><br><span class="line">    println(arr2(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;======================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 添加元素</span></span><br><span class="line">    <span class="keyword">val</span> newArr1 = arr1 :+ <span class="number">15</span></span><br><span class="line">    println(arr1) <span class="comment">// ArrayBuffer()</span></span><br><span class="line">    println(newArr1) <span class="comment">// ArrayBuffer(15)</span></span><br><span class="line">    println(arr1 == newArr1) <span class="comment">// false</span></span><br><span class="line">    println(<span class="string">&quot;-----------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> newArr2 = arr1 += <span class="number">19</span></span><br><span class="line">    println(arr1) <span class="comment">// ArrayBuffer(19)</span></span><br><span class="line">    println(newArr2) <span class="comment">// ArrayBuffer(19)</span></span><br><span class="line">    println(arr1 == newArr2) <span class="comment">// true</span></span><br><span class="line">    newArr2 += <span class="number">13</span></span><br><span class="line">    println(arr1) <span class="comment">// ArrayBuffer(19, 13)</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;-----------------&quot;</span>)</span><br><span class="line">    <span class="number">77</span> +=: arr1</span><br><span class="line">    println(arr1)</span><br><span class="line"></span><br><span class="line">    arr1.append(<span class="number">36</span>)</span><br><span class="line">    arr1.prepend(<span class="number">11</span>,<span class="number">76</span>) <span class="comment">// 前面添加</span></span><br><span class="line">    arr1.insert(<span class="number">1</span>,<span class="number">59</span>, <span class="number">24</span>) <span class="comment">// 在 index = 1 添加59, 24</span></span><br><span class="line">    println(arr1) <span class="comment">// ArrayBuffer(11, 59, 24, 76, 77, 19, 13, 36)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加数组</span></span><br><span class="line">    arr1.insertAll(<span class="number">2</span>, newArr1)</span><br><span class="line">    arr1.prependAll(newArr2)</span><br><span class="line">    println(arr1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 删除元素</span></span><br><span class="line">    arr1.remove(<span class="number">3</span>) <span class="comment">// 删除 index = 3 的元素</span></span><br><span class="line">    println(arr1)</span><br><span class="line"></span><br><span class="line">    arr1.remove(<span class="number">0</span>, <span class="number">10</span>) <span class="comment">// 删除 index = [0,10) 的元素</span></span><br><span class="line">    println(arr1)</span><br><span class="line"></span><br><span class="line">    arr1 -= <span class="number">13</span> <span class="comment">// 删除 元素 = 13</span></span><br><span class="line">    println(arr1)</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="不可变数组与可变数组的转换"><a href="#不可变数组与可变数组的转换" class="headerlink" title="不可变数组与可变数组的转换"></a>不可变数组与可变数组的转换</h3><h4 id="说明-13"><a href="#说明-13" class="headerlink" title="说明"></a>说明</h4><p>arr1.toBuffer &#x2F;&#x2F;**不可变数组转可变数组 **<br>arr2.toArray &#x2F;&#x2F;**可变数组转不可变数组 **<br>（1）arr2.toArray 返回结果才是一个不可变数组，arr2 本身没有变化<br>（2）arr1.toBuffer 返回结果才是一个可变数组，arr1 本身没有变化</p>
<h4 id="案例实操-48"><a href="#案例实操-48" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable</span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable.<span class="type">ArrayBuffer</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test02_ArrayBuffer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//  可变数组转换为不可变数组</span></span><br><span class="line">    <span class="keyword">val</span> arr: <span class="type">ArrayBuffer</span>[<span class="type">Int</span>] = <span class="type">ArrayBuffer</span>(<span class="number">23</span>, <span class="number">56</span>, <span class="number">98</span>)</span><br><span class="line">    <span class="keyword">val</span> newArr: <span class="type">Array</span>[<span class="type">Int</span>] = arr.toArray</span><br><span class="line">    println(newArr.mkString(<span class="string">&quot;, &quot;</span>))</span><br><span class="line">    println(arr)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  不可变数组转换为可变数组</span></span><br><span class="line">    <span class="keyword">val</span> buffer: mutable.<span class="type">Buffer</span>[<span class="type">Int</span>] = newArr.toBuffer</span><br><span class="line">    println(buffer)</span><br><span class="line">    println(newArr)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h3><h4 id="多维数组定义"><a href="#多维数组定义" class="headerlink" title="多维数组定义"></a>多维数组定义</h4><p>val arr &#x3D; Array.ofDim<a href="3,4">Double</a><br>说明：二维数组中有三个一维数组，每个一维数组中有四个元素</p>
<h4 id="案例实操-49"><a href="#案例实操-49" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test03_MulArray</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 创建二维数组</span></span><br><span class="line">    <span class="keyword">val</span> array = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](<span class="number">2</span>, <span class="number">3</span>) <span class="comment">// 2行3列</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//  2. 访问元素</span></span><br><span class="line">    array(<span class="number">0</span>)(<span class="number">2</span>) = <span class="number">19</span></span><br><span class="line">    array(<span class="number">1</span>)(<span class="number">0</span>) = <span class="number">25</span></span><br><span class="line"></span><br><span class="line">    println(array.mkString(<span class="string">&quot;, &quot;</span>))</span><br><span class="line">    <span class="keyword">for</span>(i &lt;- <span class="number">0</span> until array.length; j &lt;- <span class="number">0</span> until array(i).length)&#123;</span><br><span class="line">      println(array(i)(j))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i &lt;- array.indices; j &lt;- array(i).indices)&#123;</span><br><span class="line">      print(array(i)(j) + <span class="string">&quot;\t&quot;</span>)</span><br><span class="line">      <span class="keyword">if</span> (j == array(i).length - <span class="number">1</span>) println()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    array.foreach(line =&gt; line.foreach(println))</span><br><span class="line">    array.foreach(_.foreach(println))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="列表-List"><a href="#列表-List" class="headerlink" title="列表 List"></a>列表 List</h2><h3 id="不可变-List"><a href="#不可变-List" class="headerlink" title="不可变 List"></a>不可变 List</h3><h4 id="说明-14"><a href="#说明-14" class="headerlink" title="说明"></a>说明</h4><p>（1）List 默认为不可变集合<br>（2）创建一个 List（数据有顺序，可重复）<br>（3）遍历 List<br>（4）List 增加数据<br>（5）集合间合并：将一个整体拆成一个一个的个体，称为扁平化<br>（6）取指定数据<br>（7）空集合 Nil</p>
<h4 id="案例实操-50"><a href="#案例实操-50" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test04_List</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 创建一个List</span></span><br><span class="line">    <span class="keyword">val</span> list1 = <span class="type">List</span>(<span class="number">23</span>, <span class="number">65</span>, <span class="number">87</span>)</span><br><span class="line">    println(list1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 访问和遍历元素</span></span><br><span class="line">    println(list1(<span class="number">1</span>))</span><br><span class="line">    <span class="comment">// list1(1) = 12 错误</span></span><br><span class="line">    list1.foreach(println)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 添加元素</span></span><br><span class="line">    <span class="keyword">val</span> list2 = <span class="number">10</span> +: list1</span><br><span class="line">    <span class="keyword">val</span> list3 = list1 :+ <span class="number">23</span></span><br><span class="line">    println(list1) <span class="comment">// List(23, 65, 87)</span></span><br><span class="line">    println(list2) <span class="comment">// List(10, 23, 65, 87)</span></span><br><span class="line">    println(list3) <span class="comment">// List(23, 65, 87, 23)</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;==================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list4 = list2.::(<span class="number">51</span>)</span><br><span class="line">    println(list4) <span class="comment">// List(51, 10, 23, 65, 87)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list5 = <span class="type">Nil</span>.::(<span class="number">13</span>)</span><br><span class="line">    println(list5) <span class="comment">// List(13)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list6 = <span class="number">73</span> :: <span class="number">32</span> :: <span class="type">Nil</span></span><br><span class="line">    <span class="keyword">val</span> list7 = <span class="number">17</span> :: <span class="number">28</span> :: <span class="number">59</span> :: <span class="number">16</span> :: <span class="type">Nil</span></span><br><span class="line">    println(list7) <span class="comment">// List(17, 28, 59, 16)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 合并列表</span></span><br><span class="line">    <span class="keyword">val</span> list8 = list6 :: list7</span><br><span class="line">    println(list8) <span class="comment">// List(List(73, 32), 17, 28, 59, 16)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list9 = list6 ::: list7</span><br><span class="line">    println(list9) <span class="comment">// List(73, 32, 17, 28, 59, 16)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list10 = list6 ++ list7</span><br><span class="line">    println(list10) <span class="comment">// List(73, 32, 17, 28, 59, 16)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="可变-ListBuffer"><a href="#可变-ListBuffer" class="headerlink" title="可变 ListBuffer"></a>可变 ListBuffer</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable.<span class="type">ListBuffer</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test05_ListBuffer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 创建可变列表</span></span><br><span class="line">    <span class="keyword">val</span> list1: <span class="type">ListBuffer</span>[<span class="type">Int</span>] = <span class="keyword">new</span> <span class="type">ListBuffer</span>[<span class="type">Int</span>]()</span><br><span class="line">    <span class="keyword">val</span> list2 = <span class="type">ListBuffer</span>(<span class="number">12</span>, <span class="number">53</span>, <span class="number">75</span>)</span><br><span class="line"></span><br><span class="line">    println(list1) <span class="comment">// ListBuffer()</span></span><br><span class="line">    println(list2) <span class="comment">// ListBuffer(12, 53, 75)</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;==============&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 添加元素</span></span><br><span class="line">    list1.append(<span class="number">15</span>, <span class="number">62</span>)</span><br><span class="line">    list2.prepend(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    list1.insert(<span class="number">1</span>, <span class="number">19</span>, <span class="number">22</span>) <span class="comment">// 在 index = 1 的位置插入 19,22</span></span><br><span class="line"></span><br><span class="line">    println(list1) <span class="comment">// ListBuffer(15, 19, 22, 62)</span></span><br><span class="line">    println(list2) <span class="comment">// ListBuffer(20, 12, 53, 75)</span></span><br><span class="line"></span><br><span class="line">    <span class="number">31</span> +=: <span class="number">96</span> +=: list1 += <span class="number">25</span> += <span class="number">11</span></span><br><span class="line">    println(list1) <span class="comment">// ListBuffer(31, 96, 15, 19, 22, 62, 25, 11)</span></span><br><span class="line">    println(<span class="string">&quot;==============&quot;</span>)</span><br><span class="line">    <span class="comment">// 3. 合并list</span></span><br><span class="line">    <span class="keyword">val</span> list3 = list1 ++ list2</span><br><span class="line">    println(list1) <span class="comment">// ListBuffer(31, 96, 15, 19, 22, 62, 25, 11)</span></span><br><span class="line">    println(list2) <span class="comment">// ListBuffer(20, 12, 53, 75)</span></span><br><span class="line">    println(list3) <span class="comment">// ListBuffer(31, 96, 15, 19, 22, 62, 25, 11, 20, 12, 53, 75)</span></span><br><span class="line">    println(<span class="string">&quot;==============&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//    list1 ++=: list2 // 改变 list2</span></span><br><span class="line"><span class="comment">//    println(list1) // ListBuffer(20, 12, 53, 75)</span></span><br><span class="line"><span class="comment">//    println(list2) // ListBuffer(31, 96, 15, 19, 22, 62, 25, 11, 20, 12, 53, 75)</span></span><br><span class="line"></span><br><span class="line">    list1 ++= list2 <span class="comment">// 改变 list1</span></span><br><span class="line">    println(list1) <span class="comment">// ListBuffer(31, 96, 15, 19, 22, 62, 25, 11, 20, 12, 53, 75)</span></span><br><span class="line">    println(list2) <span class="comment">// ListBuffer(20, 12, 53, 75)</span></span><br><span class="line">    println(<span class="string">&quot;==============&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 修改元素</span></span><br><span class="line">    list2(<span class="number">3</span>) = <span class="number">30</span></span><br><span class="line">    list2.update(<span class="number">0</span>, <span class="number">89</span>)</span><br><span class="line">    println(list2) <span class="comment">// ListBuffer(89, 12, 53, 30)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 删除元素</span></span><br><span class="line">    list2.remove(<span class="number">2</span>)</span><br><span class="line">    list2 -= <span class="number">25</span></span><br><span class="line">    println(list2) <span class="comment">// ListBuffer(89, 12, 30)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Set集合"><a href="#Set集合" class="headerlink" title="Set集合"></a>Set集合</h2><p>默认情况下，Scala 使用的是不可变集合，如果你想使用可变集合，需要引用 scala.collection.mutable.Set 包。</p>
<h3 id="不可变-Set"><a href="#不可变-Set" class="headerlink" title="不可变 Set"></a>不可变 Set</h3><h4 id="说明-15"><a href="#说明-15" class="headerlink" title="说明"></a>说明</h4><p>（1）Set 默认是不可变集合，数据无序<br>（2）数据不可重复<br>（3）遍历集合</p>
<h4 id="案例实操-51"><a href="#案例实操-51" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test06_ImmutableSet</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 创建set</span></span><br><span class="line">    <span class="keyword">val</span> set1 = <span class="type">Set</span>(<span class="number">13</span>, <span class="number">23</span>, <span class="number">53</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">23</span>, <span class="number">78</span>)</span><br><span class="line">    println(set1) <span class="comment">// Set(78, 53, 13, 12, 23)</span></span><br><span class="line">    println(<span class="string">&quot;==================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 添加元素</span></span><br><span class="line">    <span class="keyword">val</span> set2 = set1 + <span class="number">129</span></span><br><span class="line">    println(set1) <span class="comment">// Set(78, 53, 13, 12, 23)</span></span><br><span class="line">    println(set2) <span class="comment">// Set(78, 53, 13, 129, 12, 23)</span></span><br><span class="line">    println(<span class="string">&quot;==================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 合并set</span></span><br><span class="line">    <span class="keyword">val</span> set3 = <span class="type">Set</span>(<span class="number">19</span>, <span class="number">13</span>, <span class="number">23</span>, <span class="number">53</span>, <span class="number">67</span>, <span class="number">99</span>)</span><br><span class="line">    <span class="keyword">val</span> set4 = set2 ++ set3</span><br><span class="line">    println(set2) <span class="comment">// Set(78, 53, 13, 129, 12, 23)</span></span><br><span class="line">    println(set3) <span class="comment">// Set(53, 13, 67, 99, 23, 19)</span></span><br><span class="line">    println(set4) <span class="comment">// Set(78, 53, 13, 129, 12, 67, 99, 23, 19)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 删除元素</span></span><br><span class="line">    <span class="keyword">val</span> set5 = set3 - <span class="number">13</span></span><br><span class="line">    println(set3) <span class="comment">// Set(53, 13, 67, 99, 23, 19)</span></span><br><span class="line">    println(set5) <span class="comment">// Set(53, 67, 99, 23, 19)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="可变-Set"><a href="#可变-Set" class="headerlink" title="可变 Set"></a>可变 Set</h3><h4 id="说明-16"><a href="#说明-16" class="headerlink" title="说明"></a>说明</h4><p>（1）创建可变集合 mutable.Set<br>（2）打印集合<br>（3）集合添加元素<br>（4）向集合中添加元素，返回一个新的 Set<br>（5）删除数据</p>
<h4 id="案例实操-52"><a href="#案例实操-52" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test07_MutableSet</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 创建set</span></span><br><span class="line">    <span class="keyword">val</span> set1: mutable.<span class="type">Set</span>[<span class="type">Int</span>] = mutable.<span class="type">Set</span>(<span class="number">13</span>, <span class="number">23</span>, <span class="number">53</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">23</span>, <span class="number">78</span>)</span><br><span class="line">    println(set1) <span class="comment">// Set(12, 78, 13, 53, 23)</span></span><br><span class="line">    println(<span class="string">&quot;==================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 添加元素</span></span><br><span class="line">    <span class="keyword">val</span> set2 = set1 + <span class="number">11</span></span><br><span class="line">    println(set1) <span class="comment">// Set(12, 78, 13, 53, 23)</span></span><br><span class="line">    println(set2) <span class="comment">// Set(12, 78, 13, 53, 11, 23)</span></span><br><span class="line"></span><br><span class="line">    set1 += <span class="number">11</span></span><br><span class="line">    println(set1) <span class="comment">// Set(12, 78, 13, 53, 11, 23)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> flag1 = set1.add(<span class="number">10</span>)</span><br><span class="line">    println(flag1) <span class="comment">// true</span></span><br><span class="line">    println(set1) <span class="comment">// Set(12, 78, 13, 53, 10, 11, 23)</span></span><br><span class="line">    <span class="keyword">val</span> flag2 = set1.add(<span class="number">10</span>)</span><br><span class="line">    println(flag2) <span class="comment">// false</span></span><br><span class="line">    println(set1) <span class="comment">// Set(12, 78, 13, 53, 10, 11, 23)</span></span><br><span class="line">    println(<span class="string">&quot;==================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 删除元素</span></span><br><span class="line">    set1 -= <span class="number">11</span></span><br><span class="line">    println(set1) <span class="comment">// Set(12, 78, 13, 53, 10, 23)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> flag3 = set1.remove(<span class="number">10</span>)</span><br><span class="line">    println(flag3) <span class="comment">// true</span></span><br><span class="line">    println(set1) <span class="comment">// Set(12, 78, 13, 53, 23)</span></span><br><span class="line">    <span class="keyword">val</span> flag4 = set1.remove(<span class="number">10</span>)</span><br><span class="line">    println(flag4) <span class="comment">// false</span></span><br><span class="line">    println(set1) <span class="comment">// Set(12, 78, 13, 53, 23)</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;==================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 合并两个Set</span></span><br><span class="line">    <span class="keyword">val</span> set3 = mutable.<span class="type">Set</span>(<span class="number">13</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">27</span>,<span class="number">98</span>,<span class="number">29</span>)</span><br><span class="line">    <span class="keyword">val</span> set4 = set1 ++ set3</span><br><span class="line">    println(set1) <span class="comment">// Set(12, 78, 13, 53, 23)</span></span><br><span class="line">    println(set3) <span class="comment">// Set(12, 27, 13, 29, 98)</span></span><br><span class="line">    println(set4) <span class="comment">// Set(12, 27, 78, 13, 53, 29, 98, 23)</span></span><br><span class="line"></span><br><span class="line">    set1 ++= set3</span><br><span class="line">    println(set1) <span class="comment">// Set(12, 27, 78, 13, 53, 29, 98, 23)</span></span><br><span class="line">    println(set3) <span class="comment">// Set(12, 27, 13, 29, 98)</span></span><br><span class="line">    println(<span class="string">&quot;==================&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Map-集合"><a href="#Map-集合" class="headerlink" title="Map 集合"></a>Map 集合</h2><p>Scala 中的 Map 和 Java 类似，<strong>也是一个散列表</strong>，它存储的内容也是键值对（key-value** **映射</p>
<h3 id="不可变-Map"><a href="#不可变-Map" class="headerlink" title="不可变 Map"></a>不可变 Map</h3><h4 id="说明-17"><a href="#说明-17" class="headerlink" title="说明"></a>说明</h4><p>（1）创建不可变集合 Map<br>（2）循环打印<br>（3）访问数据<br>（4）如果 key 不存在，返回 0 </p>
<h4 id="案例实操-53"><a href="#案例实操-53" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test08_ImmutableMap</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 创建map</span></span><br><span class="line">    <span class="keyword">val</span> map1: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Int</span>] = <span class="type">Map</span>(<span class="string">&quot;a&quot;</span> -&gt; <span class="number">13</span>, <span class="string">&quot;b&quot;</span> -&gt; <span class="number">25</span>, <span class="string">&quot;hello&quot;</span> -&gt; <span class="number">3</span>)</span><br><span class="line">    println(map1) <span class="comment">// Map(a -&gt; 13, b -&gt; 25, hello -&gt; 3)</span></span><br><span class="line">    println(map1.getClass)</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 遍历元素</span></span><br><span class="line">    map1.foreach(println)</span><br><span class="line">    map1.foreach( (kv: (<span class="type">String</span>, <span class="type">Int</span>)) =&gt; println(kv) )</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 取map中所有的key 或者 value</span></span><br><span class="line">    <span class="keyword">for</span> (key &lt;- map1.keys)&#123;</span><br><span class="line">      println(<span class="string">s&quot;<span class="subst">$key</span> ---&gt; <span class="subst">$&#123;map1.get(key)&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 访问某一个key的value</span></span><br><span class="line">    println(<span class="string">&quot;a: &quot;</span> + map1.get(<span class="string">&quot;a&quot;</span>).get) <span class="comment">// a: 13</span></span><br><span class="line">    println(<span class="string">&quot;c: &quot;</span> + map1.get(<span class="string">&quot;c&quot;</span>)) <span class="comment">// c: None</span></span><br><span class="line">    println(<span class="string">&quot;c: &quot;</span> + map1.getOrElse(<span class="string">&quot;c&quot;</span>, <span class="number">0</span>)) <span class="comment">//c: 0</span></span><br><span class="line"></span><br><span class="line">    println(map1(<span class="string">&quot;a&quot;</span>)) <span class="comment">// 13</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="可变-Map"><a href="#可变-Map" class="headerlink" title="可变 Map"></a>可变 Map</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test09_MutableMap</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 创建map</span></span><br><span class="line">    <span class="keyword">val</span> map1: mutable.<span class="type">Map</span>[<span class="type">String</span>, <span class="type">Int</span>] = mutable.<span class="type">Map</span>(<span class="string">&quot;a&quot;</span> -&gt; <span class="number">13</span>, <span class="string">&quot;b&quot;</span> -&gt; <span class="number">25</span>, <span class="string">&quot;hello&quot;</span> -&gt; <span class="number">3</span>)</span><br><span class="line">    println(map1)</span><br><span class="line">    println(map1.getClass)</span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 添加元素</span></span><br><span class="line">    map1.put(<span class="string">&quot;c&quot;</span>, <span class="number">5</span>)</span><br><span class="line">    map1.put(<span class="string">&quot;d&quot;</span>, <span class="number">9</span>)</span><br><span class="line">    println(map1) <span class="comment">// Map(b -&gt; 25, d -&gt; 9, a -&gt; 13, c -&gt; 5, hello -&gt; 3)</span></span><br><span class="line"></span><br><span class="line">    map1 += ((<span class="string">&quot;e&quot;</span>, <span class="number">7</span>))</span><br><span class="line">    println(map1) <span class="comment">// Map(e -&gt; 7, b -&gt; 25, d -&gt; 9, a -&gt; 13, c -&gt; 5, hello -&gt; 3)</span></span><br><span class="line">    println(<span class="string">&quot;====================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 删除元素</span></span><br><span class="line">    println(map1(<span class="string">&quot;c&quot;</span>)) <span class="comment">// 5</span></span><br><span class="line">    map1.remove(<span class="string">&quot;c&quot;</span>)</span><br><span class="line">    println(map1.getOrElse(<span class="string">&quot;c&quot;</span>, <span class="number">0</span>)) <span class="comment">// 0</span></span><br><span class="line">    map1 -= <span class="string">&quot;d&quot;</span></span><br><span class="line">    println(map1) <span class="comment">// Map(e -&gt; 7, b -&gt; 25, a -&gt; 13, hello -&gt; 3)</span></span><br><span class="line">    println(<span class="string">&quot;====================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 修改元素</span></span><br><span class="line">    map1.update(<span class="string">&quot;c&quot;</span>, <span class="number">5</span>) <span class="comment">// 等于插入</span></span><br><span class="line">    map1.update(<span class="string">&quot;e&quot;</span>, <span class="number">10</span>)</span><br><span class="line">    println(map1) <span class="comment">// Map(e -&gt; 10, b -&gt; 25, a -&gt; 13, c -&gt; 5, hello -&gt; 3)</span></span><br><span class="line">    println(<span class="string">&quot;====================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 合并两个Map</span></span><br><span class="line">    <span class="keyword">val</span> map2: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Int</span>] = <span class="type">Map</span>(<span class="string">&quot;aaa&quot;</span> -&gt; <span class="number">11</span>, <span class="string">&quot;b&quot;</span> -&gt; <span class="number">29</span>, <span class="string">&quot;hello&quot;</span> -&gt; <span class="number">5</span>)</span><br><span class="line">        map1 ++= map2</span><br><span class="line">    println(map1) <span class="comment">// Map(e -&gt; 10, aaa -&gt; 11, b -&gt; 29, a -&gt; 13, c -&gt; 5, hello -&gt; 5)</span></span><br><span class="line">    println(map2) <span class="comment">// Map(aaa -&gt; 11, b -&gt; 29, hello -&gt; 5)</span></span><br><span class="line">    println(<span class="string">&quot;---------------------------&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> map3: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Int</span>] = map2 ++ map1</span><br><span class="line">    println(map1)</span><br><span class="line">    println(map2)</span><br><span class="line">    println(map3) <span class="comment">// Map(e -&gt; 10, a -&gt; 13, b -&gt; 29, c -&gt; 5, hello -&gt; 5, aaa -&gt; 11)</span></span><br><span class="line">    println(map3.getClass) <span class="comment">// class scala.collection.immutable.HashMap$HashTrieMap 不可变</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h2><h3 id="说明-18"><a href="#说明-18" class="headerlink" title="说明"></a>说明</h3><p>元组也是可以理解为一个容器，可以存放各种相同或不同类型的数据。说的简单点，就是将多个无关的数据封装为一个整体，称为元组。<br>注意：元组中最大只能有 22 个元素。</p>
<h3 id="案例实操-54"><a href="#案例实操-54" class="headerlink" title="案例实操"></a>案例实操</h3><p>（1）声明元组的方式：(元素 1，元素 2，元素 3)<br>（2）访问元组<br>（3）Map 中的键值对其实就是元组,只不过元组的元素个数为 2，称之为对偶</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test10_Tuple</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 创建元组</span></span><br><span class="line">    <span class="keyword">val</span> tuple: (<span class="type">String</span>, <span class="type">Int</span>, <span class="type">Char</span>, <span class="type">Boolean</span>) = (<span class="string">&quot;hello&quot;</span>, <span class="number">100</span>, &#x27;a&#x27;, <span class="literal">true</span>)</span><br><span class="line">    println(tuple) <span class="comment">// (hello,100,a,true)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 访问数据</span></span><br><span class="line">    println(tuple._1)</span><br><span class="line">    println(tuple._2)</span><br><span class="line">    println(tuple._3)</span><br><span class="line">    println(tuple._4)</span><br><span class="line"></span><br><span class="line">    println(tuple.productElement(<span class="number">1</span>)) <span class="comment">// 100</span></span><br><span class="line">    println(<span class="string">&quot;====================&quot;</span>)</span><br><span class="line">    <span class="comment">// 3. 遍历元组数据</span></span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- tuple.productIterator)</span><br><span class="line">      println(elem)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;====================&quot;</span>)</span><br><span class="line">    <span class="comment">// 4. 嵌套元组</span></span><br><span class="line">    <span class="keyword">val</span> mulTuple = (<span class="number">12</span>, <span class="number">0.3</span>, <span class="string">&quot;hello&quot;</span>, (<span class="number">23</span>, <span class="string">&quot;scala&quot;</span>), <span class="number">29</span>)</span><br><span class="line">    println(mulTuple._4._2)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="集合常用函数"><a href="#集合常用函数" class="headerlink" title="集合常用函数"></a>集合常用函数</h2><h3 id="基本属性和常用操作"><a href="#基本属性和常用操作" class="headerlink" title="基本属性和常用操作"></a>基本属性和常用操作</h3><p>案例实操</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test11_CommonOp</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">89</span>)</span><br><span class="line">    <span class="keyword">val</span> set = <span class="type">Set</span>(<span class="number">23</span>,<span class="number">34</span>,<span class="number">423</span>,<span class="number">75</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （1）获取集合长度</span></span><br><span class="line">    println(list.length)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （2）获取集合大小</span></span><br><span class="line">    println(set.size)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;=&quot;</span>*<span class="number">20</span>)</span><br><span class="line">    <span class="comment">//    （3）循环遍历</span></span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- list)</span><br><span class="line">      println(elem)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;=&quot;</span>*<span class="number">20</span>)</span><br><span class="line">    set.foreach(println)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;=&quot;</span>*<span class="number">20</span>)</span><br><span class="line">    <span class="comment">//    （4）迭代器</span></span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- list.iterator) println(elem)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;====================&quot;</span>)</span><br><span class="line">    <span class="comment">//    （5）生成字符串</span></span><br><span class="line">    println(list)</span><br><span class="line">    println(set)</span><br><span class="line">    println(list.mkString(<span class="string">&quot;--&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （6）是否包含</span></span><br><span class="line">    println(list.contains(<span class="number">23</span>))</span><br><span class="line">    println(set.contains(<span class="number">23</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="衍生集合"><a href="#衍生集合" class="headerlink" title="衍生集合"></a>衍生集合</h3><p>案例实操</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test12_DerivedCollection</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> list1 = <span class="type">List</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">89</span>)</span><br><span class="line">    <span class="keyword">val</span> list2 = <span class="type">List</span>(<span class="number">3</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">45</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">19</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （1）获取集合的头</span></span><br><span class="line">    println(list1.head)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （2）获取集合的尾（不是头的就是尾）</span></span><br><span class="line">    println(list1.tail)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （3）集合最后一个数据</span></span><br><span class="line">    println(list2.last)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （4）集合初始数据（不包含最后一个）</span></span><br><span class="line">    println(list2.init)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （5）反转</span></span><br><span class="line">    println(list1.reverse)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （6）取前（后）n个元素</span></span><br><span class="line">    println(list1.take(<span class="number">3</span>))</span><br><span class="line">    println(list1.takeRight(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （7）去掉前（后）n个元素</span></span><br><span class="line">    println(list1.drop(<span class="number">3</span>))</span><br><span class="line">    println(list1.dropRight(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;=========================&quot;</span>)</span><br><span class="line">    <span class="comment">//    （8）并集</span></span><br><span class="line">    <span class="keyword">val</span> union = list1.union(list2)</span><br><span class="line">    println(<span class="string">&quot;union: &quot;</span> + union) <span class="comment">//list 不去重</span></span><br><span class="line">    println(list1 ::: list2)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果是set做并集，会去重</span></span><br><span class="line">    <span class="keyword">val</span> set1 = <span class="type">Set</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">89</span>)</span><br><span class="line">    <span class="keyword">val</span> set2 = <span class="type">Set</span>(<span class="number">3</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">45</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">19</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> union2 = set1.union(set2)</span><br><span class="line">    println(<span class="string">&quot;union2: &quot;</span> + union2)</span><br><span class="line">    println(set1 ++ set2)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line">    <span class="comment">//    （9）交集</span></span><br><span class="line">    <span class="keyword">val</span> intersection = list1.intersect(list2)</span><br><span class="line">    println(<span class="string">&quot;intersection: &quot;</span> + intersection)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line">    <span class="comment">//    （10）差集</span></span><br><span class="line">    <span class="keyword">val</span> diff1 = list1.diff(list2) <span class="comment">// 属于list1 不属于 list2的</span></span><br><span class="line">    <span class="keyword">val</span> diff2 = list2.diff(list1)</span><br><span class="line">    println(<span class="string">&quot;diff1: &quot;</span> + diff1) <span class="comment">// diff1: List(1, 5, 89)</span></span><br><span class="line">    println(<span class="string">&quot;diff2: &quot;</span> + diff2) <span class="comment">// diff2: List(45, 4, 8, 19)</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line">    <span class="comment">//    （11）拉链</span></span><br><span class="line">    println(<span class="string">&quot;zip: &quot;</span> + list1.zip(list2))</span><br><span class="line">    println(<span class="string">&quot;zip: &quot;</span> + list2.zip(list1))</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//    val list1 = List(1,3,5,7,2,89)</span></span><br><span class="line"><span class="comment">//    val list2 = List(3,7,2,45,4,8,19)</span></span><br><span class="line">    <span class="comment">//    （12）滑窗</span></span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- list1.sliding(<span class="number">3</span>))</span><br><span class="line">      println(elem)</span><br><span class="line">    println(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一组里有 4个元素，每次偏移2</span></span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- list2.sliding(<span class="number">4</span>, <span class="number">2</span>))</span><br><span class="line">      println(elem)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- list2.sliding(<span class="number">3</span>, <span class="number">3</span>))</span><br><span class="line">      println(elem)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="集合计算简单函数"><a href="#集合计算简单函数" class="headerlink" title="集合计算简单函数"></a>集合计算简单函数</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test13_SimpleFunction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">5</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">-3</span>,<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">val</span> list2 = <span class="type">List</span>((<span class="string">&quot;a&quot;</span>, <span class="number">5</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">1</span>), (<span class="string">&quot;c&quot;</span>, <span class="number">8</span>), (<span class="string">&quot;d&quot;</span>, <span class="number">2</span>), (<span class="string">&quot;e&quot;</span>, <span class="number">-3</span>), (<span class="string">&quot;f&quot;</span>, <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （1）求和</span></span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- list)&#123;</span><br><span class="line">      sum += elem</span><br><span class="line">    &#125;</span><br><span class="line">    println(sum)</span><br><span class="line">    println(list.sum)</span><br><span class="line">    println(<span class="string">&quot;=&quot;</span>*<span class="number">20</span>)</span><br><span class="line">    <span class="comment">//    （2）求乘积</span></span><br><span class="line">    println(list.product)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （3）最大值</span></span><br><span class="line">    println(list.max)</span><br><span class="line">    println(list2.maxBy( (tuple: (<span class="type">String</span>, <span class="type">Int</span>)) =&gt; tuple._2 ))</span><br><span class="line">    println(list2.maxBy( _._2 ))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （4）最小值</span></span><br><span class="line">    println(list.min)</span><br><span class="line">    println(list2.minBy(_._2))</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    （5）排序</span></span><br><span class="line">    <span class="comment">// 5.1 sorted</span></span><br><span class="line">    <span class="keyword">val</span> sortedList = list.sorted <span class="comment">// 从小到大</span></span><br><span class="line">    println(sortedList)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从大到小逆序排序</span></span><br><span class="line">    println(list.sorted.reverse)</span><br><span class="line">    <span class="comment">// 传入隐式参数</span></span><br><span class="line">    println(list.sorted(<span class="type">Ordering</span>[<span class="type">Int</span>].reverse))</span><br><span class="line"></span><br><span class="line">    println(list2.sorted)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.2 sortBy</span></span><br><span class="line">    println(list2.sortBy(_._2))</span><br><span class="line">    println(list2.sortBy(_._2)(<span class="type">Ordering</span>[<span class="type">Int</span>].reverse))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.3 sortWith</span></span><br><span class="line">    println(list.sortWith( (a: <span class="type">Int</span>, b: <span class="type">Int</span>) =&gt; &#123;a &lt; b&#125; ))</span><br><span class="line">    println(list.sortWith( _ &lt; _ ))</span><br><span class="line">    println(list.sortWith( _ &gt; _))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（1）sorted<br>对一个集合进行自然排序，通过传递隐式的 Ordering<br>（2）sortBy<br>对一个属性或多个属性进行排序，通过它的类型。<br>（3）sortWith<br>基于函数的排序，通过一个 comparator 函数，实现自定义排序的逻辑。</p>
<h3 id="集合计算高级函数"><a href="#集合计算高级函数" class="headerlink" title="集合计算高级函数"></a>集合计算高级函数</h3><h4 id="说明-19"><a href="#说明-19" class="headerlink" title="说明"></a>说明</h4><p>（1）过滤<br>遍历一个集合并从中获取满足指定条件的元素组成一个新的集合<br>（2）<strong>转化</strong>&#x2F;<strong>映射（</strong>map<strong>）</strong><br>将集合中的每一个元素映射到某一个函数<br>（3）扁平化<br>（4）扁平化+映射 注：flatMap 相当于先进行 map 操作，在进行 flatten 操作<br>集合中的每个元素的子元素映射到某个函数并返回新集合<br>（5）<strong>分组</strong>(group)<br>**按照指定的规则对集合的元素进行分组 **<br>（6）简化（归约）<br>（7）折叠</p>
<h4 id="案例实操-55"><a href="#案例实操-55" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test14_HighLevelFunction_Map</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 过滤</span></span><br><span class="line">    <span class="comment">// 选取偶数</span></span><br><span class="line">    <span class="keyword">val</span> evenList = list.filter((elem: <span class="type">Int</span>) =&gt; &#123;elem % <span class="number">2</span> == <span class="number">0</span>&#125;)</span><br><span class="line">    println(evenList) <span class="comment">// List(2, 4, 6, 8)</span></span><br><span class="line">    println(list.filter(_ % <span class="number">2</span> == <span class="number">1</span>)) <span class="comment">// List(1, 3, 5, 7, 9)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 映射map</span></span><br><span class="line">    <span class="comment">// 把集合中每个数乘2</span></span><br><span class="line">    println(list.map(_ * <span class="number">2</span>))</span><br><span class="line">    println(list.map( x =&gt; x * x))</span><br><span class="line">    println(<span class="string">&quot;=======================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 扁平化</span></span><br><span class="line">    <span class="keyword">val</span> nestedList: <span class="type">List</span>[<span class="type">List</span>[<span class="type">Int</span>]] = <span class="type">List</span>(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),<span class="type">List</span>(<span class="number">4</span>,<span class="number">5</span>),<span class="type">List</span>(<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>))</span><br><span class="line">    <span class="keyword">val</span> flatList = nestedList(<span class="number">0</span>) ::: nestedList(<span class="number">1</span>) ::: nestedList(<span class="number">2</span>)</span><br><span class="line">    println(flatList) <span class="comment">// List(1, 2, 3, 4, 5, 6, 7, 8, 9)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> flatList2 = nestedList.flatten</span><br><span class="line">    println(flatList2) <span class="comment">// List(1, 2, 3, 4, 5, 6, 7, 8, 9)</span></span><br><span class="line">    println(<span class="string">&quot;=======================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 扁平映射</span></span><br><span class="line">    <span class="comment">// 将一组字符串进行分词，并保存成单词的列表</span></span><br><span class="line">    <span class="keyword">val</span> strings: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">List</span>(<span class="string">&quot;hello world&quot;</span>, <span class="string">&quot;hello scala&quot;</span>, <span class="string">&quot;hello java&quot;</span>, <span class="string">&quot;we study&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> splitList: <span class="type">List</span>[<span class="type">Array</span>[<span class="type">String</span>]] = strings.map( _.split(<span class="string">&quot; &quot;</span>) )    <span class="comment">// 分词</span></span><br><span class="line">    <span class="keyword">var</span> flattenList = splitList.flatten <span class="comment">// 打散扁平化</span></span><br><span class="line">    println(flattenList) <span class="comment">// List(hello, world, hello, scala, hello, java, we, study)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> flatmapList = strings.flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">    println(flatmapList) <span class="comment">// List(hello, world, hello, scala, hello, java, we, study)</span></span><br><span class="line">    println(<span class="string">&quot;========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 分组groupBy</span></span><br><span class="line">    <span class="comment">// 分成奇偶两组</span></span><br><span class="line">    <span class="keyword">val</span> groupMap: <span class="type">Map</span>[<span class="type">Int</span>, <span class="type">List</span>[<span class="type">Int</span>]] = list.groupBy(_ % <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">val</span> groupMap2: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">List</span>[<span class="type">Int</span>]] = list.groupBy(data =&gt; <span class="keyword">if</span>(data % <span class="number">2</span> == <span class="number">0</span>) <span class="string">&quot;偶数&quot;</span> <span class="keyword">else</span> <span class="string">&quot;奇数&quot;</span>)</span><br><span class="line"></span><br><span class="line">    println(groupMap) <span class="comment">// Map(1 -&gt; List(1, 3, 5, 7, 9), 0 -&gt; List(2, 4, 6, 8))</span></span><br><span class="line">    println(groupMap2) <span class="comment">// Map(奇数 -&gt; List(1, 3, 5, 7, 9), 偶数 -&gt; List(2, 4, 6, 8))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给定一组词汇，按照单词的首字母进行分组</span></span><br><span class="line">    <span class="keyword">val</span> wordList = <span class="type">List</span>(<span class="string">&quot;china&quot;</span>, <span class="string">&quot;america&quot;</span>, <span class="string">&quot;alice&quot;</span>, <span class="string">&quot;canada&quot;</span>, <span class="string">&quot;cary&quot;</span>, <span class="string">&quot;bob&quot;</span>, <span class="string">&quot;japan&quot;</span>)</span><br><span class="line">    <span class="comment">// Map(b -&gt; List(bob), j -&gt; List(japan), a -&gt; List(america, alice), c -&gt; List(china, canada, cary))</span></span><br><span class="line">    println(wordList.groupBy( _.charAt(<span class="number">0</span>)))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test15_HighLevelFunction_Reduce</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. reduce 简化(规约)</span></span><br><span class="line">    println(list.reduce( _ + _ )) <span class="comment">// 10</span></span><br><span class="line">    println(list.reduceLeft(_ + _)) <span class="comment">// 10</span></span><br><span class="line">    println(list.reduceRight(_ + _)) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;===========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list2 = <span class="type">List</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">10</span>)</span><br><span class="line">    println(list2.reduce(_ - _))    <span class="comment">// -24</span></span><br><span class="line">    println(list2.reduceLeft(_ - _)) <span class="comment">// -24</span></span><br><span class="line">    println(list2.reduceRight(_ - _))    <span class="comment">// 3 - (4 - (5 - (8 - 10))), 6</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;===========================&quot;</span>)</span><br><span class="line">    <span class="comment">// 2. fold 折叠</span></span><br><span class="line">    println(list.fold(<span class="number">10</span>)(_ + _))     <span class="comment">// 10 + 1 + 2 + 3 + 4</span></span><br><span class="line">    println(list.foldLeft(<span class="number">10</span>)(_ - _))    <span class="comment">// 10 - 1 - 2 - 3 - 4</span></span><br><span class="line">    println(list2.foldRight(<span class="number">11</span>)(_ - _))    <span class="comment">// 3 - (4 - (5 - (8 - (10 - 11)))),  -5</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="合并Map里的数值"><a href="#合并Map里的数值" class="headerlink" title="合并Map里的数值"></a>合并Map里的数值</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test16_MergeMap</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> map1 = <span class="type">Map</span>(<span class="string">&quot;a&quot;</span> -&gt; <span class="number">1</span>, <span class="string">&quot;b&quot;</span> -&gt; <span class="number">3</span>, <span class="string">&quot;c&quot;</span> -&gt; <span class="number">6</span>)</span><br><span class="line">    <span class="keyword">val</span> map2 = mutable.<span class="type">Map</span>(<span class="string">&quot;a&quot;</span> -&gt; <span class="number">6</span>, <span class="string">&quot;b&quot;</span> -&gt; <span class="number">2</span>, <span class="string">&quot;c&quot;</span> -&gt; <span class="number">9</span>, <span class="string">&quot;d&quot;</span> -&gt; <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//println(map1 ++ map2) // Map(a -&gt; 6, b -&gt; 2, c -&gt; 9, d -&gt; 3)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> map3 = map1.foldLeft(map2)&#123;</span><br><span class="line">      (mergedMap, kv) =&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> key = kv._1</span><br><span class="line">        <span class="keyword">val</span> value = kv._2</span><br><span class="line">        mergedMap(key) = mergedMap.getOrElse(key,<span class="number">0</span>) + value</span><br><span class="line">        mergedMap</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    println(map3) <span class="comment">// Map(b -&gt; 5, d -&gt; 3, a -&gt; 7, c -&gt; 15)</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="普通-WordCount-案例"><a href="#普通-WordCount-案例" class="headerlink" title="普通 WordCount 案例"></a>普通 WordCount 案例</h3><h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><p>单词计数：将集合中出现的相同的单词，进行计数，取计数排名前三的结果</p>
<h4 id="案例实操-56"><a href="#案例实操-56" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test17_CommonWordCount</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> stringList: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">List</span>(</span><br><span class="line">      <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">      <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">      <span class="string">&quot;hello scala&quot;</span>,</span><br><span class="line">      <span class="string">&quot;hello spark from scala&quot;</span>,</span><br><span class="line">      <span class="string">&quot;hello flink from scala&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 对字符串进行切分，得到一个打散所有单词的列表</span></span><br><span class="line">    <span class="comment">//    val wordList1: List[Array[String]] = stringList.map(_.split(&quot; &quot;))</span></span><br><span class="line">    <span class="comment">//    val wordList2: List[String] = wordList1.flatten</span></span><br><span class="line">    <span class="comment">//    println(wordList2)</span></span><br><span class="line">    <span class="keyword">val</span> wordList = stringList.flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">    println(wordList)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 相同的单词进行分组</span></span><br><span class="line">    <span class="keyword">val</span> groupMap: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">List</span>[<span class="type">String</span>]] = wordList.groupBy(word =&gt; word) <span class="comment">//不能省略</span></span><br><span class="line">    println(groupMap)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 对分组之后的list取长度，得到每个单词的个数</span></span><br><span class="line">    <span class="keyword">val</span> countMap:<span class="type">Map</span>[<span class="type">String</span>, <span class="type">Int</span>] = groupMap.map(kv =&gt; (kv._1,kv._2.length))</span><br><span class="line">    println(countMap)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 将map转换为list，并排序取前3</span></span><br><span class="line">    <span class="keyword">val</span> sortList: <span class="type">List</span>[(<span class="type">String</span>,<span class="type">Int</span>)] = countMap.toList</span><br><span class="line">      .sortWith( _._2 &gt; _._2).take(<span class="number">3</span>)</span><br><span class="line">    println(sortList) <span class="comment">// List((hello,5), (scala,3), (from,2))</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="复杂-WordCount-案例"><a href="#复杂-WordCount-案例" class="headerlink" title="复杂 WordCount 案例"></a>复杂 WordCount 案例</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test18_ComplexWordCount</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> tupleList: <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">List</span>(</span><br><span class="line">      (<span class="string">&quot;hello&quot;</span>, <span class="number">1</span>),</span><br><span class="line">      (<span class="string">&quot;hello world&quot;</span>, <span class="number">2</span>),</span><br><span class="line">      (<span class="string">&quot;hello scala&quot;</span>, <span class="number">3</span>),</span><br><span class="line">      (<span class="string">&quot;hello spark from scala&quot;</span>, <span class="number">1</span>),</span><br><span class="line">      (<span class="string">&quot;hello flink from scala&quot;</span>, <span class="number">2</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 思路一：直接展开为普通版本</span></span><br><span class="line">    <span class="keyword">val</span> newStringList:<span class="type">List</span>[<span class="type">String</span>] = tupleList.map(</span><br><span class="line">      kv =&gt; &#123;</span><br><span class="line">        kv._1.trim + <span class="string">&quot; &quot;</span> * kv._2</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    println(newStringList)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接下来操作与普通版本完全一致</span></span><br><span class="line">    <span class="keyword">val</span> wordCountList: <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = newStringList</span><br><span class="line">      .flatMap(_.split(<span class="string">&quot; &quot;</span>))    <span class="comment">// 空格分词</span></span><br><span class="line">      .groupBy( word =&gt; word )     <span class="comment">// 按照单词分组</span></span><br><span class="line">      .map( kv =&gt; (kv._1, kv._2.size) )     <span class="comment">// 统计出每个单词的个数</span></span><br><span class="line">      .toList</span><br><span class="line">      .sortBy(_._2)(<span class="type">Ordering</span>[<span class="type">Int</span>].reverse)</span><br><span class="line">      .take(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    println(wordCountList)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;================================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 思路二：直接基于预统计的结果进行转换</span></span><br><span class="line">    <span class="comment">// 1. 将字符串打散为单词，并结合对应的个数包装成二元组</span></span><br><span class="line">    <span class="keyword">val</span> preCountList: <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = tupleList.flatMap(</span><br><span class="line">      tuple =&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> strings: <span class="type">Array</span>[<span class="type">String</span>] = tuple._1.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        strings.map( word =&gt; (word, tuple._2))</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    println(preCountList)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 对二元组按照单词进行分组</span></span><br><span class="line">    <span class="keyword">val</span> preCountMap: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Int</span>)]] = preCountList.groupBy( _._1 )</span><br><span class="line">    println(preCountMap)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 叠加每个单词预统计的个数值</span></span><br><span class="line">    <span class="keyword">val</span> countMap: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Int</span>] = preCountMap.mapValues(</span><br><span class="line">      tupleList =&gt; tupleList.map(_._2).sum</span><br><span class="line">    )</span><br><span class="line">    println(countMap)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 转换成list，排序取前3</span></span><br><span class="line">    <span class="keyword">val</span> countList = countMap.toList</span><br><span class="line">      .sortWith(_._2 &gt; _._2)</span><br><span class="line">      .take(<span class="number">3</span>)</span><br><span class="line">    println(countList)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><h3 id="说明-20"><a href="#说明-20" class="headerlink" title="说明"></a>说明</h3><p>Scala 也提供了队列（Queue）的数据结构，队列的特点就是先进先出。进队和出队的方法分别为 enqueue 和 dequeue。 </p>
<h3 id="案例实操-57"><a href="#案例实操-57" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.immutable.<span class="type">Queue</span></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test19_Queue</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 创建一个可变队列</span></span><br><span class="line">    <span class="keyword">val</span> queue: mutable.<span class="type">Queue</span>[<span class="type">String</span>] = <span class="keyword">new</span> mutable.<span class="type">Queue</span>[<span class="type">String</span>]()</span><br><span class="line"></span><br><span class="line">    queue.enqueue(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>) <span class="comment">// 入队</span></span><br><span class="line"></span><br><span class="line">    println(queue) <span class="comment">// 出队</span></span><br><span class="line">    println(queue.dequeue())</span><br><span class="line">    println(queue)</span><br><span class="line">    println(queue.dequeue())</span><br><span class="line">    println(queue)</span><br><span class="line"></span><br><span class="line">    queue.enqueue(<span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>)</span><br><span class="line"></span><br><span class="line">    println(queue)</span><br><span class="line">    println(queue.dequeue())</span><br><span class="line">    println(queue)</span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;==========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不可变队列</span></span><br><span class="line">    <span class="keyword">val</span> queue2: <span class="type">Queue</span>[<span class="type">String</span>] = <span class="type">Queue</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> queue3 = queue2.enqueue(<span class="string">&quot;d&quot;</span>)</span><br><span class="line">    println(queue2)</span><br><span class="line">    println(queue3)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="并行集合"><a href="#并行集合" class="headerlink" title="并行集合"></a>并行集合</h2><h3 id="说明-21"><a href="#说明-21" class="headerlink" title="说明"></a>说明</h3><p>Scala 为了充分使用多核 CPU，提供了并行集合（有别于前面的串行集合），用于多核环境的并行计算。</p>
<h3 id="案例实操-58"><a href="#案例实操-58" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter07</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.immutable</span><br><span class="line"><span class="keyword">import</span> scala.collection.parallel.immutable.<span class="type">ParSeq</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test20_Parallel</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> result: immutable.<span class="type">IndexedSeq</span>[<span class="type">Long</span>] = (<span class="number">1</span> to <span class="number">100</span>).map(</span><br><span class="line">      x =&gt; <span class="type">Thread</span>.currentThread.getId</span><br><span class="line">    )</span><br><span class="line">    println(result)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> result2: <span class="type">ParSeq</span>[<span class="type">Long</span>] = (<span class="number">1</span> to <span class="number">100</span>).par.map(</span><br><span class="line">      x =&gt; <span class="type">Thread</span>.currentThread.getId</span><br><span class="line">    )</span><br><span class="line">    println(result2)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h1><p>Scala 中的模式匹配类似于 Java 中的 switch 语法<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658228859018-7c114c5e-828e-4948-9291-e2f30342b11f.png#clientId=u5e065767-f324-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=204&id=uab669501&margin=%5Bobject%20Object%5D&name=image.png&originHeight=204&originWidth=371&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16672&status=done&style=none&taskId=u4734be3c-5243-47dd-8e39-57da8f89328&title=&width=371" alt="image.png"></p>
<h2 id="基本语法-26"><a href="#基本语法-26" class="headerlink" title="基本语法"></a>基本语法</h2><p>模式匹配语法中，采用 match 关键字声明，每个分支采用 case 关键字进行声明，当需要匹配时，会从第一个 case 分支开始，如果匹配成功，那么执行对应的逻辑代码，如果匹配不成功，继续执行下一个分支进行判断。如果所有 case 都不匹配，那么会执行 case _分支， 类似于 Java 中 default 语句。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter08</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test01_PatternMatchBase</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 基本定义语法</span></span><br><span class="line">    <span class="keyword">val</span> x: <span class="type">Int</span> = <span class="number">5</span></span><br><span class="line">    <span class="keyword">val</span> y: <span class="type">String</span> = x <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span> =&gt; <span class="string">&quot;one&quot;</span></span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span> =&gt; <span class="string">&quot;two&quot;</span></span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span> =&gt; <span class="string">&quot;three&quot;</span></span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="string">&quot;other&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(y)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 示例：用模式匹配实现简单二元运算</span></span><br><span class="line">    <span class="keyword">val</span> a = <span class="number">25</span></span><br><span class="line">    <span class="keyword">val</span> b = <span class="number">13</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">matchDualOp</span></span>(op: <span class="type">Char</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      op <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &#x27;+&#x27; =&gt; a + b</span><br><span class="line">        <span class="keyword">case</span> &#x27;-&#x27; =&gt; a - b</span><br><span class="line">        <span class="keyword">case</span> &#x27;*&#x27; =&gt; a * b</span><br><span class="line">        <span class="keyword">case</span> &#x27;/&#x27; =&gt; a / b</span><br><span class="line">        <span class="keyword">case</span> &#x27;%&#x27; =&gt; a % b</span><br><span class="line">        <span class="keyword">case</span> _ =&gt; <span class="number">-1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    println(matchDualOp(&#x27;+&#x27;)) <span class="comment">// 38</span></span><br><span class="line">    println(matchDualOp(&#x27;/&#x27;)) <span class="comment">// 1</span></span><br><span class="line">    println(matchDualOp(&#x27;\\&#x27;)) <span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">&quot;=========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明<br>（1）如果所有 case 都不匹配，那么会执行 case _ 分支，类似于 Java 中 default 语句，若此时没有 case _ 分支，那么会抛出 MatchError。<br>（2）每个 case 中，不需要使用 break 语句，自动中断 case。<br>（3）match case 语句可以匹配任何类型，而不只是字面量。<br>（4）&#x3D;&gt; 后面的代码块，直到下一个 case 语句之前的代码是<strong>作为一个整体执行</strong>，可以使用{}括起来，也可以不括。</p>
<h2 id="模式守卫"><a href="#模式守卫" class="headerlink" title="模式守卫"></a>模式守卫</h2><h3 id="说明-22"><a href="#说明-22" class="headerlink" title="说明"></a>说明</h3><p>如果想要表达匹配某个范围的数据，就需要在模式匹配中增加条件守卫。</p>
<h3 id="案例实操-59"><a href="#案例实操-59" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter08</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test01_PatternMatchBase</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 3. 模式守卫</span></span><br><span class="line">    <span class="comment">// 求一个整数的绝对值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">abs</span></span>(num: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">      num <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> i <span class="keyword">if</span> i &gt;= <span class="number">0</span> =&gt; i</span><br><span class="line">        <span class="keyword">case</span> i <span class="keyword">if</span> i &lt; <span class="number">0</span> =&gt; -i</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(abs(<span class="number">67</span>))</span><br><span class="line">    println(abs(<span class="number">0</span>))</span><br><span class="line">    println(abs(<span class="number">-24</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="模式匹配类型"><a href="#模式匹配类型" class="headerlink" title="模式匹配类型"></a>模式匹配类型</h2><h3 id="匹配常量"><a href="#匹配常量" class="headerlink" title="匹配常量"></a>匹配常量</h3><h4 id="说明-23"><a href="#说明-23" class="headerlink" title="说明"></a>说明</h4><p>Scala 中，模式匹配可以匹配所有的字面量，包括字符串，字符，数字，布尔值等等。</p>
<h4 id="案例实操-60"><a href="#案例实操-60" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter08</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test02_MatchTypes</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 匹配常量</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">describeConst</span></span>(x: <span class="type">Any</span>): <span class="type">String</span> = x <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span> =&gt; <span class="string">&quot;Int one&quot;</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;hello&quot;</span> =&gt; <span class="string">&quot;String hello&quot;</span></span><br><span class="line">      <span class="keyword">case</span> <span class="literal">true</span> =&gt; <span class="string">&quot;Boolean true&quot;</span></span><br><span class="line">      <span class="keyword">case</span> &#x27;+&#x27; =&gt; <span class="string">&quot;Char +&quot;</span></span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(describeConst(<span class="string">&quot;hello&quot;</span>))</span><br><span class="line">    println(describeConst(&#x27;+&#x27;))</span><br><span class="line">    println(describeConst(<span class="number">0.3</span>)) <span class="comment">// </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="匹配类型"><a href="#匹配类型" class="headerlink" title="匹配类型"></a>匹配类型</h3><h4 id="说明-24"><a href="#说明-24" class="headerlink" title="说明"></a>说明</h4><p>需要进行类型判断时，可以使用前文所学的 isInstanceOf[T]和 asInstanceOf[T]，也可使用模式匹配实现同样的功能。</p>
<h4 id="案例实操-61"><a href="#案例实操-61" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 匹配类型</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">describeType</span></span>(x: <span class="type">Any</span>): <span class="type">String</span> = x <span class="keyword">match</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> i: <span class="type">Int</span> =&gt; <span class="string">&quot;Int &quot;</span> + i</span><br><span class="line">  <span class="keyword">case</span> s: <span class="type">String</span> =&gt; <span class="string">&quot;String &quot;</span> + s</span><br><span class="line">  <span class="keyword">case</span> list: <span class="type">List</span>[<span class="type">String</span>] =&gt; <span class="string">&quot;List &quot;</span> + list</span><br><span class="line">  <span class="keyword">case</span> array: <span class="type">Array</span>[<span class="type">Int</span>] =&gt; <span class="string">&quot;Array[Int] &quot;</span> + array.mkString(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">  <span class="keyword">case</span> a =&gt; <span class="string">&quot;Something else: &quot;</span> + a</span><br><span class="line">&#125;</span><br><span class="line">println(describeType(<span class="number">35</span>))</span><br><span class="line">println(describeType(<span class="string">&quot;hello&quot;</span>))</span><br><span class="line">println(describeType(<span class="type">List</span>(<span class="string">&quot;hi&quot;</span>, <span class="string">&quot;hello&quot;</span>)))</span><br><span class="line">println(describeType(<span class="type">List</span>(<span class="number">2</span>, <span class="number">23</span>)))</span><br><span class="line">println(describeType(<span class="type">Array</span>(<span class="string">&quot;hi&quot;</span>, <span class="string">&quot;hello&quot;</span>)))</span><br><span class="line">println(describeType(<span class="type">Array</span>(<span class="number">2</span>, <span class="number">23</span>)))</span><br></pre></td></tr></table></figure>

<h3 id="匹配数组"><a href="#匹配数组" class="headerlink" title="匹配数组"></a>匹配数组</h3><h4 id="说明-25"><a href="#说明-25" class="headerlink" title="说明"></a>说明</h4><p>scala 模式匹配可以对集合进行精确的匹配，例如匹配只有两个元素的、且第一个元素为 0 的数组。</p>
<h4 id="案例实操-62"><a href="#案例实操-62" class="headerlink" title="案例实操"></a>案例实操</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. 匹配数组</span></span><br><span class="line"><span class="keyword">for</span>(arr &lt;- <span class="type">List</span>(</span><br><span class="line">  <span class="type">Array</span>(<span class="number">0</span>),</span><br><span class="line">  <span class="type">Array</span>(<span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="type">Array</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="type">Array</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="type">Array</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">15</span>),</span><br><span class="line">  <span class="type">Array</span>(<span class="string">&quot;hello&quot;</span>, <span class="number">1</span>, <span class="number">30</span>),</span><br><span class="line">)) &#123;</span><br><span class="line">  <span class="keyword">val</span> result = arr <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Array</span>(<span class="number">0</span>) =&gt; <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Array</span>(<span class="number">1</span>, <span class="number">0</span>) =&gt; <span class="string">&quot;Array(1, 0)&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Array</span>(x, y) =&gt; <span class="string">&quot;Array: &quot;</span> + x + <span class="string">&quot;, &quot;</span> + y    <span class="comment">// 匹配两元素数组</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Array</span>(<span class="number">0</span>, _*) =&gt; <span class="string">&quot;以0开头的数组&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Array</span>(x, <span class="number">1</span>, z) =&gt; <span class="string">&quot;中间为1的三元素数组&quot;</span></span><br><span class="line">    <span class="keyword">case</span> _ =&gt; <span class="string">&quot;something else&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  println(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="匹配列表"><a href="#匹配列表" class="headerlink" title="匹配列表"></a>匹配列表</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4. 匹配列表</span></span><br><span class="line"><span class="comment">// 方式一</span></span><br><span class="line"><span class="keyword">for</span> (list &lt;- <span class="type">List</span>(</span><br><span class="line">  <span class="type">List</span>(<span class="number">0</span>),</span><br><span class="line">  <span class="type">List</span>(<span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="type">List</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="type">List</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="type">List</span>(<span class="number">88</span>),</span><br><span class="line">  <span class="type">List</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">)) &#123;</span><br><span class="line">  <span class="keyword">val</span> result = list <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">List</span>(<span class="number">0</span>) =&gt; <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">List</span>(x, y) =&gt; <span class="string">&quot;List(x, y): &quot;</span> + x + <span class="string">&quot;, &quot;</span> + y</span><br><span class="line">    <span class="keyword">case</span> <span class="type">List</span>(<span class="number">0</span>, _*) =&gt; <span class="string">&quot;List(0, ...)&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">List</span>(a) =&gt; <span class="string">&quot;List(a): &quot;</span> + a</span><br><span class="line">    <span class="keyword">case</span> _ =&gt; <span class="string">&quot;something else&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  println(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二</span></span><br><span class="line"><span class="keyword">val</span> list1 = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">24</span>)</span><br><span class="line"><span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">24</span>)</span><br><span class="line">list1 <span class="keyword">match</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> first :: second :: rest =&gt; println(<span class="string">s&quot;first: <span class="subst">$first</span>, second: <span class="subst">$second</span>, rest: <span class="subst">$rest</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">case</span> _ =&gt; println(<span class="string">&quot;something else&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="匹配元组"><a href="#匹配元组" class="headerlink" title="匹配元组"></a>匹配元组</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5. 匹配元组</span></span><br><span class="line"><span class="keyword">for</span> (tuple &lt;- <span class="type">List</span>(</span><br><span class="line">  (<span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">  (<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">  (<span class="number">1</span>, <span class="number">23</span>, <span class="number">56</span>),</span><br><span class="line">  (<span class="string">&quot;hello&quot;</span>, <span class="literal">true</span>, <span class="number">0.5</span>)</span><br><span class="line">))&#123;</span><br><span class="line">  <span class="keyword">val</span> result = tuple <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> (a, b) =&gt; <span class="string">&quot;&quot;</span> + a + <span class="string">&quot;, &quot;</span> + b</span><br><span class="line">    <span class="keyword">case</span> (<span class="number">0</span>, _) =&gt; <span class="string">&quot;(0, _)&quot;</span></span><br><span class="line">    <span class="keyword">case</span> (a, <span class="number">1</span>, _) =&gt; <span class="string">&quot;(a, 1, _) &quot;</span> + a</span><br><span class="line">    <span class="keyword">case</span> (x, y, z) =&gt; <span class="string">&quot;(x, y, z) &quot;</span> + x + <span class="string">&quot; &quot;</span> + y + <span class="string">&quot; &quot;</span> + z</span><br><span class="line">    <span class="keyword">case</span> _ =&gt; <span class="string">&quot;something else&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  println(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>扩展</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter08</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test03_MatchTupleExtend</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 在变量声明时匹配</span></span><br><span class="line">    <span class="keyword">val</span> (x, y) = (<span class="number">10</span>, <span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    println(<span class="string">s&quot;x: <span class="subst">$x</span>, y: <span class="subst">$y</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> <span class="type">List</span>(first, second, _*) = <span class="type">List</span>(<span class="number">23</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">78</span>)</span><br><span class="line">    println(<span class="string">s&quot;first: <span class="subst">$first</span>, second: <span class="subst">$second</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> fir :: sec :: rest = <span class="type">List</span>(<span class="number">23</span>, <span class="number">15</span> , <span class="number">9</span>, <span class="number">78</span>)</span><br><span class="line">    println(<span class="string">s&quot;first: <span class="subst">$fir</span>, second: <span class="subst">$sec</span>, rest: <span class="subst">$rest</span>&quot;</span>)</span><br><span class="line">    println(<span class="string">&quot;=====================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. for推导式中进行模式匹配</span></span><br><span class="line">    <span class="keyword">val</span> list: <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">List</span>((<span class="string">&quot;a&quot;</span>, <span class="number">12</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">35</span>), (<span class="string">&quot;c&quot;</span>, <span class="number">27</span>), (<span class="string">&quot;a&quot;</span>, <span class="number">13</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.1 原本的遍历方式</span></span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- list)&#123;</span><br><span class="line">      println(elem._1 + <span class="string">&quot; &quot;</span> + elem._2)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.2 将List的元素直接定义为元组，对变量赋值</span></span><br><span class="line">    <span class="keyword">for</span> ((word, count) &lt;- list )&#123;</span><br><span class="line">      println(word + <span class="string">&quot;: &quot;</span> + count)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line">    <span class="comment">// 2.3 可以不考虑某个位置的变量，只遍历key或者value</span></span><br><span class="line">    <span class="keyword">for</span> ((word, _) &lt;- list)</span><br><span class="line">      println(word)</span><br><span class="line">    println(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line">    <span class="comment">// 2.4 可以指定某个位置的值必须是多少</span></span><br><span class="line">    <span class="keyword">for</span> ((<span class="string">&quot;a&quot;</span>, count) &lt;- list)&#123;</span><br><span class="line">      println(count)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="匹配对象及样例类"><a href="#匹配对象及样例类" class="headerlink" title="匹配对象及样例类"></a>匹配对象及样例类</h3><p>（1）匹配对象</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter08</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test04_MatchObject</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> student = <span class="keyword">new</span> <span class="type">Student</span>(<span class="string">&quot;alice&quot;</span>, <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对对象实例的内容进行匹配</span></span><br><span class="line">    <span class="keyword">val</span> result = student <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="type">Student</span>(<span class="string">&quot;alice&quot;</span>, <span class="number">18</span>) =&gt; <span class="string">&quot;Alice, 18&quot;</span></span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="string">&quot;Else&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">val name: <span class="type">String</span>, val age: <span class="type">Int</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义伴生对象</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(name: <span class="type">String</span>, age: <span class="type">Int</span>): <span class="type">Student</span> = <span class="keyword">new</span> <span class="type">Student</span>(name, age)</span><br><span class="line">  <span class="comment">// 必须实现一个unapply方法，用来对对象属性进行拆解</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">unapply</span></span>(student: <span class="type">Student</span>): <span class="type">Option</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = &#123;</span><br><span class="line">    <span class="keyword">if</span> (student == <span class="literal">null</span>)&#123;</span><br><span class="line">      <span class="type">None</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="type">Some</span>((student.name, student.age))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）样例类</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter08</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test05_MatchCaseClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> student1 = <span class="type">Student1</span>(<span class="string">&quot;alice&quot;</span>, <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对对象实例的内容进行匹配</span></span><br><span class="line">    <span class="keyword">val</span> result = student1 <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="type">Student1</span>(<span class="string">&quot;alice&quot;</span>, <span class="number">18</span>) =&gt; <span class="string">&quot;Alice, 18&quot;</span></span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="string">&quot;Else&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义样例类</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Student1</span>(<span class="params">name: <span class="type">String</span>, age: <span class="type">Int</span></span>)</span></span><br></pre></td></tr></table></figure>

<h2 id="偏函数中的模式匹配-了解"><a href="#偏函数中的模式匹配-了解" class="headerlink" title="偏函数中的模式匹配(了解)"></a>偏函数中的模式匹配(了解)</h2><p>偏函数也是函数的一种，通过偏函数我们可以方便的对输入参数做更精确的检查。例如该偏函数的输入类型为 List[Int]，而我们需要的是第一个元素是 0 的集合，这就是通过模式匹配实现的。</p>
<h3 id="偏函数定义"><a href="#偏函数定义" class="headerlink" title="偏函数定义"></a>偏函数定义</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658281059892-9d8de97d-9882-4fba-be2b-b9d0a8043ac8.png#clientId=uca83a800-b1ae-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=50&id=u3a40778e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=50&originWidth=495&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7823&status=done&style=none&taskId=u313ac1a9-b989-4e30-a248-cdfe8164f87&title=&width=495" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658281070321-07d78b2d-f22b-4941-92f4-bc6ccb708f5e.png#clientId=uca83a800-b1ae-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=207&id=u532383a3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=207&originWidth=524&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38404&status=done&style=none&taskId=ufe6220d1-03f9-4424-8c2d-1fa8db36d97&title=&width=524" alt="image.png"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter08</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test06_PartialFunction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> list: <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">List</span>((<span class="string">&quot;a&quot;</span>, <span class="number">12</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">35</span>), (<span class="string">&quot;c&quot;</span>, <span class="number">27</span>), (<span class="string">&quot;a&quot;</span>, <span class="number">13</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. map转换，实现key不变，value2倍</span></span><br><span class="line">    <span class="keyword">val</span> newList = list.map( tuple =&gt; (tuple._1, tuple._2 * <span class="number">2</span>) )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 用模式匹配对元组元素赋值，实现功能</span></span><br><span class="line">    <span class="keyword">val</span> newList2 = list.map(</span><br><span class="line">      tuple =&gt; &#123;</span><br><span class="line">        tuple <span class="keyword">match</span> &#123;</span><br><span class="line">          <span class="keyword">case</span> (word, count) =&gt; (word, count * <span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 省略lambda表达式的写法，进行简化</span></span><br><span class="line">    <span class="keyword">val</span> newList3 = list.map &#123;</span><br><span class="line">      <span class="keyword">case</span> (word, count) =&gt; (word, count * <span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(newList)</span><br><span class="line">    println(newList2)</span><br><span class="line">    println(newList3)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 偏函数的应用，求绝对值</span></span><br><span class="line">    <span class="comment">// 对输入数据分为不同的情形：正、负、0</span></span><br><span class="line">    <span class="comment">//                            输入Int，返回Int</span></span><br><span class="line">    <span class="keyword">val</span> positiveAbs: <span class="type">PartialFunction</span>[<span class="type">Int</span>, <span class="type">Int</span>] = &#123;</span><br><span class="line">      <span class="keyword">case</span> x <span class="keyword">if</span> x &gt; <span class="number">0</span> =&gt; x</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> negativeAbs: <span class="type">PartialFunction</span>[<span class="type">Int</span>, <span class="type">Int</span>] = &#123;</span><br><span class="line">      <span class="keyword">case</span> x <span class="keyword">if</span> x &lt; <span class="number">0</span> =&gt; -x</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> zeroAbs: <span class="type">PartialFunction</span>[<span class="type">Int</span>, <span class="type">Int</span>] = &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span> =&gt; <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">abs</span></span>(x: <span class="type">Int</span>): <span class="type">Int</span> = (positiveAbs orElse negativeAbs orElse zeroAbs) (x)</span><br><span class="line">    println(abs(<span class="number">-67</span>))</span><br><span class="line">    println(abs(<span class="number">35</span>))</span><br><span class="line">    println(abs(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h1><p>语法处理上和 Java <strong>类似</strong>，但是又不尽相同。</p>
<h2 id="Java-异常处理"><a href="#Java-异常处理" class="headerlink" title="Java 异常处理"></a>Java 异常处理</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658281611401-be877fea-8771-48a2-b36f-5edc496ef9cf.png#clientId=uca83a800-b1ae-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=308&id=ufa207d4e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=308&originWidth=388&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29636&status=done&style=none&taskId=uf1459c9a-42fc-485b-a73d-988e67caac5&title=&width=388" alt="image.png"><br>注意事项<br>（1）Java 语言按照 try—catch—finally 的方式来处理异常<br>（2）不管有没有异常捕获，都会执行 finally，因此通常可以在 finally 代码块中释放资源。<br>（3）可以有多个 catch，分别捕获对应的异常，这时需要把范围小的异常类写在前面，把范围大的异常类写在后面，否则编译错误。</p>
<h2 id="Scala-异常处理"><a href="#Scala-异常处理" class="headerlink" title="Scala 异常处理"></a>Scala 异常处理</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658281694689-08fa3553-844d-41b6-b62f-843b5e95e737.png#clientId=uca83a800-b1ae-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=341&id=u366cf957&margin=%5Bobject%20Object%5D&name=image.png&originHeight=341&originWidth=361&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33624&status=done&style=none&taskId=ub5989765-604c-4a76-b083-b5a070ad8e6&title=&width=361" alt="image.png"><br>1）我们将可疑代码封装在 try 块中。在 try 块之后使用了一个 catch 处理程序来捕获异常。如果发生任何异常，catch 处理程序将处理它，程序将不会异常终止。<br>2）Scala 的异常的工作机制和 Java 一样，但是 Scala 没有“checked（编译期）”异常，即 Scala 没有编译异常这个概念，异常都是在运行的时候捕获处理。<br>3）异常捕捉的机制与其他语言中一样，如果有异常发生，catch 子句是按次序捕捉的。因此，在 catch 子句中，越具体的异常越要靠前，越普遍的异常越靠后，如果把越普遍的异常写在前，把具体的异常写在后，在 Scala 中也不会报错，但这样是非常不好的编程风格。<br>4）finally 子句用于执行不管是正常处理还是有异常发生时都需要执行的步骤，一般用于对象的清理工作，这点和 Java 一样。<br>5）用 throw 关键字，抛出一个异常对象。所有异常都是 Throwable 的子类型。throw 表达式是有类型的，就是 Nothing，因为 Nothing 是所有类型的子类型，所以 throw 表达式可以用在需要类型的地方。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658281763232-b65f698b-0ec9-4418-8574-7221ab9effd6.png#clientId=uca83a800-b1ae-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=56&id=u7fd0072e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=56&originWidth=264&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6249&status=done&style=none&taskId=u73f3f43a-b615-4bad-8dd3-2d7e92cf216&title=&width=264" alt="image.png"><br>6）java 提供了 throws 关键字来声明异常。可以使用方法定义声明异常。它向调用者函数提供了此方法可能引发此异常的信息。它有助于调用函数处理并将该代码包含在 try-catch 块中，以避免程序异常终止。在 Scala 中，可以使用 throws 注解来声明异常。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658281805511-0b441a07-5ce5-4221-8b59-9df5464d35bb.png#clientId=uca83a800-b1ae-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=133&id=ud906eea5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=133&originWidth=350&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12258&status=done&style=none&taskId=u659e1026-eff1-48c4-9408-9f94f4c296e&title=&width=350" alt="image.png"></p>
<h1 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h1><p><strong>当编译器第一次编译失败的时候，会在当前的环境中查找能让代码编译通过的方法，用于将类型进行转换，实现二次编译。</strong></p>
<h2 id="隐式函数"><a href="#隐式函数" class="headerlink" title="隐式函数"></a>隐式函数</h2><p>隐式转换可以在不需改任何代码的情况下，扩展某个类的功能。</p>
<h2 id="隐式参数"><a href="#隐式参数" class="headerlink" title="隐式参数"></a>隐式参数</h2><p>普通方法或者函数中的参数可以通过 implicit 关键字声明为隐式参数，调用该方法时，就可以传入该参数，编译器会在相应的作用域寻找符合条件的隐式值。</p>
<h2 id="隐式类"><a href="#隐式类" class="headerlink" title="隐式类"></a>隐式类</h2><p>（1）其所带的构造参数有且只能有一个<br>（2）隐式类必须被定义在“类”或“伴生对象”或“包对象”里，即隐式类不能是<strong>顶级的</strong>。 </p>
<h2 id="隐式解析机制"><a href="#隐式解析机制" class="headerlink" title="隐式解析机制"></a>隐式解析机制</h2><h3 id="说明-26"><a href="#说明-26" class="headerlink" title="说明"></a>说明</h3><p>（1）首先会在当前代码作用域下查找隐式实体（隐式方法、隐式类、隐式对象）。（一般是这种情况）<br>（2）如果第一条规则查找隐式实体失败，会继续在隐式参数的类型的作用域里查找。类型的作用域是指与<strong>该类型相关联的全部伴生对象</strong>以及<strong>该类型所在包的包对象</strong>。 </p>
<h3 id="案例实操-63"><a href="#案例实操-63" class="headerlink" title="案例实操"></a>案例实操</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter09plus</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test02_Implicit</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> new12 = <span class="keyword">new</span> <span class="type">MyRichInt</span>(<span class="number">12</span>)</span><br><span class="line">    println(new12.myMax(<span class="number">15</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 隐式函数</span></span><br><span class="line">    <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">convert</span></span>(num: <span class="type">Int</span>): <span class="type">MyRichInt</span> = <span class="keyword">new</span> <span class="type">MyRichInt</span>(num)</span><br><span class="line">    println(<span class="number">12.</span>myMax(<span class="number">15</span>))</span><br><span class="line">    println(<span class="string">&quot;============================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 隐式类</span></span><br><span class="line">    <span class="keyword">implicit</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRichInt2</span>(<span class="params">val self: <span class="type">Int</span></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 自定义比较大小的方法</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">myMax2</span></span>(n: <span class="type">Int</span>): <span class="type">Int</span> = <span class="keyword">if</span> ( n &lt; self ) self <span class="keyword">else</span> n</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">myMin2</span></span>(n: <span class="type">Int</span>): <span class="type">Int</span> = <span class="keyword">if</span> ( n &lt; self ) n <span class="keyword">else</span> self</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="number">12.</span>myMin2(<span class="number">15</span>))</span><br><span class="line">    println(<span class="string">&quot;============================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 隐式参数</span></span><br><span class="line">    <span class="keyword">implicit</span> <span class="keyword">val</span> str1: <span class="type">String</span> = <span class="string">&quot;alice&quot;</span></span><br><span class="line">    <span class="comment">//implicit val str2: String = &quot;alice2&quot;</span></span><br><span class="line">    <span class="keyword">implicit</span> <span class="keyword">val</span> num: <span class="type">Int</span> = <span class="number">18</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sayHello</span></span>()(<span class="keyword">implicit</span> name: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;hello, &quot;</span> + name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sayHi</span></span>(<span class="keyword">implicit</span> name: <span class="type">String</span> = <span class="string">&quot;LiAng&quot;</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;hi, &quot;</span> + name)</span><br><span class="line">    &#125;</span><br><span class="line">    sayHello</span><br><span class="line">    sayHi</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 简便写法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hiAge</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;hi, &quot;</span> + implicitly[<span class="type">Int</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    hiAge()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRichInt</span>(<span class="params">val self: <span class="type">Int</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 自定义比较大小的方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">myMax</span></span>(n: <span class="type">Int</span>): <span class="type">Int</span> = <span class="keyword">if</span> ( n &lt; self ) self <span class="keyword">else</span> n</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">myMin</span></span>(n: <span class="type">Int</span>): <span class="type">Int</span> = <span class="keyword">if</span> ( n &lt; self ) n <span class="keyword">else</span> self</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h1><h2 id="协变和逆变"><a href="#协变和逆变" class="headerlink" title="协变和逆变"></a>协变和逆变</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658285790156-1d084da3-1401-4222-86fc-7fad221e38fe.png#clientId=uca83a800-b1ae-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=162&id=u346e5767&margin=%5Bobject%20Object%5D&name=image.png&originHeight=162&originWidth=175&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10731&status=done&style=none&taskId=u6a1d9913-7ee3-401e-a446-eaab0eb54f8&title=&width=175" alt="image.png"></p>
<h3 id="说明-27"><a href="#说明-27" class="headerlink" title="说明"></a>说明</h3><p>协变：Son 是 Father 的子类，则 MyList[Son] 也作为 MyList[Father]的“子类”。<br>逆变：Son 是 Father 的子类，则 MyList[Son]作为 MyList[Father]的“父类”。<br>不变：Son 是 Father 的子类，则 MyList[Father]与 MyList[Son]“无父子关系”。</p>
<h2 id="泛型上下限"><a href="#泛型上下限" class="headerlink" title="泛型上下限"></a>泛型上下限</h2><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658289743557-13a43d99-8a4a-4e0b-a4d9-f47d0fdd2d99.png#clientId=uca83a800-b1ae-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=124&id=ubc3ed756&margin=%5Bobject%20Object%5D&name=image.png&originHeight=124&originWidth=283&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11942&status=done&style=none&taskId=u69a243d4-9ac1-4f75-b59f-02b41466df6&title=&width=283" alt="image.png"></p>
<h3 id="说明-28"><a href="#说明-28" class="headerlink" title="说明"></a>说明</h3><p>泛型的上下限的作用是对传入的泛型进行限定。</p>
<h2 id="上下文限定"><a href="#上下文限定" class="headerlink" title="上下文限定"></a>上下文限定</h2><h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/26046076/1658289809409-4436dcf4-d0b0-4207-be09-a0e319576022.png#clientId=uca83a800-b1ae-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=32&id=ub51959a0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=32&originWidth=508&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6932&status=done&style=none&taskId=uaed349fd-ff4d-4eb6-8bf0-442ad240a1d&title=&width=508" alt="image.png"></p>
<h3 id="说明-29"><a href="#说明-29" class="headerlink" title="说明"></a>说明</h3><p>上下文限定是将泛型和隐式转换的结合产物，以下两者功能相同，使用上下文限定[A : Ordering]之后，方法内无法使用隐式参数名调用隐式参数，需要通过 implicitly[Ordering[A]] 获取隐式变量，如果此时无法查找到对应类型的隐式变量，会发生出错误。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter09plus</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test03_Generics</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 1. 协变和逆变</span></span><br><span class="line">    <span class="keyword">val</span> child: <span class="type">Parent</span> = <span class="keyword">new</span> <span class="type">Child</span></span><br><span class="line">    <span class="comment">//val childList: MyCollection[Parent] = new MyCollection[Child]</span></span><br><span class="line">    <span class="keyword">val</span> childList: <span class="type">MyCollection</span>[<span class="type">SubChild</span>] = <span class="keyword">new</span> <span class="type">MyCollection</span>[<span class="type">Child</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 上下限</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span></span>[<span class="type">A</span> &lt;: <span class="type">Child</span>](a: <span class="type">A</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(a.getClass.getName)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// test[Parent](new Child) // 错误</span></span><br><span class="line">    test[<span class="type">Child</span>](<span class="keyword">new</span> <span class="type">Child</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义继承关系</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubChild</span> <span class="keyword">extends</span> <span class="title">Child</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义带泛型的集合类型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCollection</span>[-<span class="type">E</span>] </span>&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/20/Spring5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LiAng">
      <meta itemprop="description" content="永远相信美好的事情即将发生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiAng的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/20/Spring5/" class="post-title-link" itemprop="url">Spring5</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-20 21:12:08 / 修改时间：21:24:08" itemprop="dateCreated datePublished" datetime="2022-07-20T21:12:08+08:00">2022-07-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring5"><a href="#Spring5" class="headerlink" title="Spring5"></a>Spring5</h1><h1 id="第一章-Spring5基本介绍"><a href="#第一章-Spring5基本介绍" class="headerlink" title="第一章 Spring5基本介绍"></a>第一章 Spring5基本介绍</h1><h2 id="官方资料"><a href="#官方资料" class="headerlink" title="官方资料"></a>官方资料</h2><h3 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h3><p><a target="_blank" rel="noopener" href="https://spring.io/">https://spring.io/</a>		</p>
<h3 id="Spring5下载"><a href="#Spring5下载" class="headerlink" title="Spring5下载"></a>Spring5下载</h3><p>1.进入该网站</p>
<p><a target="_blank" rel="noopener" href="https://repo.spring.io/">https://repo.spring.io</a></p>
<p>2.找到Artifacts</p>
<img src="\images\Spring5.assets\image-20220606085147170.png" alt="image-20220606085147170" style="zoom: 67%;" />

<p>3.点开release</p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606085226240.png" alt="image-20220606085226240" style="zoom: 80%;" />

<p>4.在release中找到org下的 springframework</p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606085316723.png" alt="image-20220606085316723" style="zoom:67%;" />

<p>5.然后找到spring，右侧会出现下载地址 <a target="_blank" rel="noopener" href="https://repo.spring.io/ui/native/release/org/springframework/spring/">https://repo.spring.io/ui/native/release/org/springframework/spring/</a></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606085406607.png" alt="image-20220606085406607"></p>
<p>6.找到需要的版本进行下载</p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606085547670.png" alt="image-20220606085547670" style="zoom: 80%;" />

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606085648344.png" alt="image-20220606085648344"></p>
<p>​		（离线文档也在里面）</p>
<h3 id="在线文档"><a href="#在线文档" class="headerlink" title="在线文档"></a>在线文档</h3><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/">https://docs.spring.io/spring-framework/docs/current/reference/html/</a></p>
<h2 id="核心内容"><a href="#核心内容" class="headerlink" title="核心内容"></a>核心内容</h2><img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606090728558.png" alt="image-20220606090728558" style="zoom:67%;" />

<ol>
<li>Spring 核心学习内容 IOC、AOP、jdbcTemplate、声明式事务。</li>
<li>IOC：控制反转，可以管理 java 对象。（重难点）</li>
<li>AOP：切面编程。（重难点）</li>
<li>JDBCTemplate：是 spring 提供一套访问数据库的技术，应用性强，相对好理解。</li>
<li>声明式事务：基于 ioc&#x2F;aop 实现事务管理。</li>
</ol>
<h2 id="重要概念"><a href="#重要概念" class="headerlink" title="重要概念"></a>重要概念</h2><ol>
<li><strong>Spring 可以整合其他的框架（Spring是管理框架的框架）。</strong></li>
<li><strong>Spring 有两个核心的概念：IOC 和 AOP。</strong></li>
<li><strong>IOC [Inversion Of Control 反转控制]</strong></li>
<li><strong>DI—Dependency Injection 依赖注入，可以理解成是 IOC 的另外叫法。</strong></li>
<li><strong>Spring 最大的价值，通过配置，给程序提供需要使用的web 层[Servlet(Action&#x2F;Controller)]&#x2F;Service&#x2F;Dao&#x2F;[JavaBean&#x2F;entity]对象，这个是核心价值所在，也是 IOC 的具体体现，实现解耦。</strong></li>
</ol>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606091226545.png" alt="image-20220606091226545" style="zoom: 67%;" />

<p><strong>传统的开发模式</strong></p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606091356788.png" alt="image-20220606091356788" style="zoom:80%;" />

<ol>
<li>程序员编写程序，在程序中读取配置信息。</li>
<li>创建对象, new Object()&#x2F;&#x2F;反射</li>
<li>使用对象完成任务</li>
</ol>
<p><strong>IOC 的开发模式</strong> [EmpAction EmpService EmpDao Emp]</p>
<p>容器—-&gt;程序 &#x2F;&#x2F;容器创建好对象，程序直接使用。</p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606091654286.png" alt="image-20220606091654286" style="zoom: 80%;" />

<ol>
<li>Spring 根据配置文件 xml&#x2F;注解，创建对象， 并放入到容器(ConcurrentHashMap等)中，并且可以完成对象之间的依赖。</li>
<li>当需要使用某个对象实例的时候，就直接从容器中获取即可。</li>
<li>程序员可以更加关注如何使用对象完成相应的业务。(以前是 new … &#x3D;&#x3D;&gt; 注解&#x2F;配置 方式)</li>
<li>DI—Dependency Injection 依赖注入，可以理解成是 IOC 的另外叫法。</li>
<li>Spring 最大的价值，通过配置，给程序提供需要使用的 web 层[Servlet(Action&#x2F;Controller)]&#x2F;Service&#x2F;Dao&#x2F;[JavaBean&#x2F;entity]对象，这个是核心价值所在，也是 ioc 的具体体现，实现解耦。</li>
</ol>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><h3 id="需求说明"><a href="#需求说明" class="headerlink" title="需求说明"></a>需求说明</h3><p>​		通过 Spring 的方式[配置文件]，获取 JavaBean: Monster 的对象，并给该的对象属性赋 值，输出该对象信息。</p>
<p><strong>注意：创建好java工程后，要引入相关的spring5基本包</strong></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606094933528.png" alt="image-20220606094933528"></p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606095253566.png" alt="image-20220606095253566" style="zoom: 80%;" />

<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Monster</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer monsterID;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String skill;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//无参构造器一定要写，Spring反射创建对象时需要使用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Monster</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Monster</span><span class="params">(Integer monsterID, String name, String skill)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.monsterID = monsterID;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.skill = skill;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getMonsterID</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> monsterID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMonsterID</span><span class="params">(Integer monsterID)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.monsterID = monsterID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSkill</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> skill;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSkill</span><span class="params">(String skill)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.skill = skill;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Monster&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;monsterID=&quot;</span> + monsterID +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, skill=&#x27;&quot;</span> + skill + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建spring的配置文件"><a href="#创建spring的配置文件" class="headerlink" title="创建spring的配置文件"></a>创建spring的配置文件</h4><img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606095714158.png" alt="image-20220606095714158" style="zoom: 80%;" />

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606095751103.png" alt="image-20220606095751103"></p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606095834123.png" alt="image-20220606095834123"  />

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606095914335.png" alt="image-20220606095914335"></p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606095944659.png" alt="image-20220606095944659"  />

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">   1. 配置monster对象/javabean</span></span><br><span class="line"><span class="comment">   2. 在beans中可以配置多个bean</span></span><br><span class="line"><span class="comment">   3. bean表示就是一个java对象</span></span><br><span class="line"><span class="comment">   4. class属性是用于指定类的全路径-&gt;spring底层使用反射创建</span></span><br><span class="line"><span class="comment">   5. id属性表示该java对象在spring容器中的id, 通过id可以获取到对象</span></span><br><span class="line"><span class="comment">   6. &lt;property name=&quot;monsterId&quot; value=&quot;100&quot;&gt; 用于给该对象的属性赋值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span> <span class="attr">id</span>=<span class="string">&quot;monster01&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterID&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;牛魔王&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;蛮牛冲撞&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span> <span class="attr">id</span>=<span class="string">&quot;monster02&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterID&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;牛魔王~&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;芭蕉扇~&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="获取Monster对象"><a href="#获取Monster对象" class="headerlink" title="获取Monster对象"></a>获取Monster对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBeanTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMonster</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建容器 ApplicationContext</span></span><br><span class="line">        <span class="comment">//2. 该容器和容器配置文件关联</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 通过getBean获取对应的对象</span></span><br><span class="line">        <span class="comment">//   默认返回的是Object , 但是运行类型是Monster</span></span><br><span class="line">        <span class="comment">//Object monster01 = ioc.getBean(&quot;monster01&quot;);</span></span><br><span class="line">        <span class="type">Monster</span> <span class="variable">monster01</span> <span class="operator">=</span> (Monster)ioc.getBean(<span class="string">&quot;monster01&quot;</span>);</span><br><span class="line">        <span class="comment">//4. 输出</span></span><br><span class="line">        System.out.println(<span class="string">&quot;monster01=&quot;</span> + monster01 + <span class="string">&quot; 运行类型=&quot;</span> + monster01.getClass());</span><br><span class="line">        System.out.println(<span class="string">&quot;monster01=&quot;</span> + monster01 + <span class="string">&quot;属性name=&quot;</span> + monster01.getName() + <span class="string">&quot;，monserid=&quot;</span> + monster01.getMonsterID());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 也可以再获取的时候，直接指定Class类型, 可以直接获取</span></span><br><span class="line">        <span class="type">Monster</span> <span class="variable">monster02</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster01&quot;</span>, Monster.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;monster02=&quot;</span> + monster02 + <span class="string">&quot; 运行类型=&quot;</span> + monster02.getClass());</span><br><span class="line">        System.out.println(<span class="string">&quot;monster02=&quot;</span> + monster02 + <span class="string">&quot;属性name=&quot;</span> + monster02.getName());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项和细节"><a href="#注意事项和细节" class="headerlink" title="注意事项和细节"></a>注意事项和细节</h3><h4 id="1-怎么读取到了-beans-xml"><a href="#1-怎么读取到了-beans-xml" class="headerlink" title="1.怎么读取到了 beans.xml"></a>1.怎么读取到了 beans.xml</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>读取的是out目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="built_in">this</span>.getClass().getResource(<span class="string">&quot;/&quot;</span>).getPath());</span><br><span class="line">System.out.println(file);<span class="comment">//E:\VIP\AllDemo\Spring5\spring\out\production\spring</span></span><br></pre></td></tr></table></figure>

<h4 id="2-debug查看spring容器结构"><a href="#2-debug查看spring容器结构" class="headerlink" title="2.debug查看spring容器结构"></a>2.debug查看spring容器结构</h4><p>注意：配置debugger</p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606102901613.png" alt="image-20220606102901613" style="zoom:80%;" />

<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606105540124.png" alt="image-20220606105540124" style="zoom:80%;" />

<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606105851533.png" alt="image-20220606105851533" style="zoom:80%;" />

<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606105949615.png" alt="image-20220606105949615" style="zoom:80%;" />

<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606110819525.png" alt="image-20220606110819525" style="zoom:80%;" />



<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606111207895.png" alt="image-20220606111207895" style="zoom:80%;" />

<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606111359543.png" alt="image-20220606111359543" style="zoom:80%;" />

<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606111442171.png" alt="image-20220606111442171" style="zoom:80%;" />

<h4 id="3-查看容器注入了哪些bean对象"><a href="#3-查看容器注入了哪些bean对象" class="headerlink" title="3.查看容器注入了哪些bean对象"></a>3.查看容器注入了哪些bean对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String[] beanDefinitionNames = ioc.getBeanDefinitionNames();</span><br><span class="line"><span class="keyword">for</span> (String beanDefinitionName : beanDefinitionNames) &#123;</span><br><span class="line">	System.out.println(beanDefinitionName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606112058276.png" alt="image-20220606112058276"></p>
<h2 id="手动实现简单的Spring基于xml配置的程序"><a href="#手动实现简单的Spring基于xml配置的程序" class="headerlink" title="手动实现简单的Spring基于xml配置的程序"></a>手动实现简单的Spring基于xml配置的程序</h2><h3 id="需求说明-1"><a href="#需求说明-1" class="headerlink" title="需求说明"></a>需求说明</h3><p>​		自己写（模拟）一个简单的 Spring 容器，通过读取 beans.xml，获取第 1 个 JavaBean: Monster 的 对象，并给该的对象属性赋值，放入到容器中，输出该对象信息。</p>
<h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606141707615.png" alt="image-20220606141707615"></p>
<h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><p>​		记得导入dom4j包。beans.xml ，Monster.java 和上文中的一样。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.lzwapplicationcontext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.bean.Monster;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Document;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.DocumentException;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Element;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.SAXReader;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 1. 这个程序用于实现Spring的一个简单容器机制</span></span><br><span class="line"><span class="comment"> * 2. 后面我们还会详细实现</span></span><br><span class="line"><span class="comment"> * 3. 这里我们实现如何将beans.xml文件进行解析，并生成对象,放入容器中</span></span><br><span class="line"><span class="comment"> * 4. 提供一个方法 getBean(id) 返回对应的对象</span></span><br><span class="line"><span class="comment"> * 5. 这里仅仅只是理解Spring容器的机制</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LzwApplicationContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ConcurrentHashMap&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="comment">//接收一个容器的配置文件 比如 beans.xml, 该文件默认在src</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LzwApplicationContext</span><span class="params">(String iocBeanXmlFile)</span> <span class="keyword">throws</span> DocumentException, ClassNotFoundException, IllegalAccessException, InstantiationException &#123;</span><br><span class="line">        <span class="comment">//1. 得到类加载路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getResource(<span class="string">&quot;/&quot;</span>).getPath();</span><br><span class="line">        <span class="comment">//2. 创建 Saxreader</span></span><br><span class="line">        <span class="type">SAXReader</span> <span class="variable">saxReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">        <span class="comment">//3. 得到Document对象</span></span><br><span class="line">        <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> saxReader.read(<span class="keyword">new</span> <span class="title class_">File</span>(path + iocBeanXmlFile));</span><br><span class="line">        <span class="comment">//4. 得到rootDocument</span></span><br><span class="line">        <span class="type">Element</span> <span class="variable">rootElement</span> <span class="operator">=</span> document.getRootElement();</span><br><span class="line">        <span class="comment">//5. 得到第一个bean-monster01</span></span><br><span class="line">        <span class="type">Element</span> <span class="variable">bean</span> <span class="operator">=</span> (Element) rootElement.elements(<span class="string">&quot;bean&quot;</span>).get(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//6. 获取到第一个bean-monster01的相关属性</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> bean.attributeValue(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">classFullPath</span> <span class="operator">=</span> bean.attributeValue(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">        List&lt;Element&gt; property = bean.elements(<span class="string">&quot;property&quot;</span>);</span><br><span class="line">        <span class="comment">//遍历-&gt;简化直接获取</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">monsterID</span> <span class="operator">=</span> Integer.parseInt(property.get(<span class="number">0</span>).attributeValue(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> property.get(<span class="number">1</span>).attributeValue(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">skill</span> <span class="operator">=</span> property.get(<span class="number">2</span>).attributeValue(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">        <span class="comment">//7. 使用反射创建对象</span></span><br><span class="line">        Class&lt;?&gt; aClass = Class.forName(classFullPath);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">o</span> <span class="operator">=</span> (Monster) aClass.newInstance();</span><br><span class="line">        <span class="comment">//给o对象赋值</span></span><br><span class="line">        <span class="comment">//反射来赋值=&gt; 这里简化，直接赋值-&gt;目的就是先理解流程</span></span><br><span class="line">        <span class="comment">//这里的方法就是setter方法</span></span><br><span class="line">        <span class="comment">//Method[] declaredMethods = aClass.getDeclaredMethods();</span></span><br><span class="line">        <span class="comment">//for (Method declaredMethod : declaredMethods) &#123;</span></span><br><span class="line">        <span class="comment">//    declaredMethod.invoke();</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">        o.setMonsterID(monsterID);</span><br><span class="line">        o.setName(name);</span><br><span class="line">        o.setSkill(skill);</span><br><span class="line">        <span class="comment">//8. 将创建好的对象放入到singletonObjects</span></span><br><span class="line">        singletonObjects.put(id, o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> singletonObjects.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> DocumentException, IllegalAccessException, InstantiationException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">LzwApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LzwApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster01&quot;</span>);</span><br><span class="line">        System.out.println(bean);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606144605182.png" alt="image-20220606144605182"></p>
<h2 id="Spring-原生容器底层结构"><a href="#Spring-原生容器底层结构" class="headerlink" title="Spring 原生容器底层结构"></a>Spring 原生容器底层结构</h2><p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606144822631.png" alt="image-20220606144822631"></p>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><p>在 beans.xml 中，我们注入 2 个 Monster 对象，但是不指定 id，如下</p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606145433580.png" alt="image-20220606145433580"></p>
<p>​	（1）运行会不会报错</p>
<p>​	答：不会报错，会正常运行。</p>
<p>​	（2）如果不报错，你能否找到分配的 id，并获得到该对象。</p>
<p>​	答：系统会默认分配 id，分配 id 的规则是 全类名#0 , 全类名#1。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Monster</span> <span class="variable">monster01</span> <span class="operator">=</span> (Monster)ioc.getBean(<span class="string">&quot;com.lzw.spring.bean.Monster#0&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606145916773.png" alt="image-20220606145916773"></p>
<hr>


<h1 id="第二章-Spring管理Bean-IOC"><a href="#第二章-Spring管理Bean-IOC" class="headerlink" title="第二章 Spring管理Bean-IOC"></a>第二章 Spring管理Bean-IOC</h1><h2 id="Spring-配置-x2F-管理-bean-介绍"><a href="#Spring-配置-x2F-管理-bean-介绍" class="headerlink" title="Spring 配置&#x2F;管理 bean 介绍"></a>Spring 配置&#x2F;管理 bean 介绍</h2><h3 id="Bean-管理包括两方面"><a href="#Bean-管理包括两方面" class="headerlink" title="Bean 管理包括两方面"></a>Bean 管理包括两方面</h3><ol>
<li>创建 bean 对象  2. 给 bean 注入属性</li>
</ol>
<h3 id="Bean-配置方式"><a href="#Bean-配置方式" class="headerlink" title="Bean 配置方式"></a>Bean 配置方式</h3><ol>
<li>基于 xml 文件配置方式  2. 基于注解方式</li>
</ol>
<h2 id="基于-XML-配置-bean"><a href="#基于-XML-配置-bean" class="headerlink" title="基于 XML 配置 bean"></a>基于 XML 配置 bean</h2><h3 id="通过id来获取-bean"><a href="#通过id来获取-bean" class="headerlink" title="通过id来获取 bean"></a>通过id来获取 bean</h3><p>​		Spring5基本介绍这一章中都是通过id来获取 bean，在此不再赘述。</p>
<h3 id="通过类型来获取-bean"><a href="#通过类型来获取-bean" class="headerlink" title="通过类型来获取 bean"></a>通过类型来获取 bean</h3><h4 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置Monster,通过类型来获取--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">           1.当我们给某个bean对象设置属性的时候</span></span><br><span class="line"><span class="comment">           2.底层是使用对应的setter方法完成的, 比如setName()</span></span><br><span class="line"><span class="comment">           3.如果没有这个方法，就会报错</span></span><br><span class="line"><span class="comment">       --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterID&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;牛魔王&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;蛮牛冲撞&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过Bean类型来获取对象</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBeanByType</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">       <span class="comment">//直接传入class类型</span></span><br><span class="line">       <span class="type">Monster</span> <span class="variable">bean</span> <span class="operator">=</span> ioc.getBean(Monster.class);</span><br><span class="line">       System.out.println(bean);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="细节说明"><a href="#细节说明" class="headerlink" title="细节说明"></a>细节说明</h4><ol>
<li>按类型来获取 bean，要求 ioc 容器中的同一个类的 bean 只能有一个，否则会抛出异常 NoUniqueBeanDefinitionException。</li>
</ol>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606155733023.png" alt="image-20220606155733023"></p>
<ol start="2">
<li><p>这种方式的应用场景：比如 XxxAction&#x2F;Servlet&#x2F;Controller，或 XxxService 等在一个线程中只需要一个对象实例(单例)的情况。</p>
</li>
<li><p>在容器配置文件(比如 beans.xml)中给属性赋值， 底层是通过 setter 方法完成的，这也是为什么我们需要提供 setter 方法的原因。</p>
</li>
</ol>
<h3 id="通过构造器配置-bean"><a href="#通过构造器配置-bean" class="headerlink" title="通过构造器配置 bean"></a>通过构造器配置 bean</h3><h4 id="代码实现-3"><a href="#代码实现-3" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  配置Monster对象，并且指定构造器</span></span><br><span class="line"><span class="comment">     1. constructor-arg标签可以指定使用构造器的参数</span></span><br><span class="line"><span class="comment">     2. index表示构造器的第几个参数 从0开始计算的</span></span><br><span class="line"><span class="comment">     3. 除了可以通过index 还可以通过 name / type 来指定参数方式</span></span><br><span class="line"><span class="comment">     4. 解除大家的疑惑, 类的构造器，不能有完全相同类型和顺序的构造器，所以可以通过type来指定</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster03&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;白骨精&quot;</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;吸血&quot;</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster04&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span> <span class="attr">name</span>=<span class="string">&quot;monsterID&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;白骨精&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;吸血~&quot;</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster05&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;300&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.Integer&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;白骨精~&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;吸血~~&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过构造器来设置属性</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBeanByConstructor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">monster03</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster03&quot;</span>,Monster.class);</span><br><span class="line">        System.out.println(monster03);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="细节说明-1"><a href="#细节说明-1" class="headerlink" title="细节说明"></a>细节说明</h4><ol>
<li>通过 index 属性来区分是第几个参数。2. 通过 type 属性来区分是什么类型(按照顺序)。</li>
</ol>
<h3 id="通过-p-名称空间配置-bean"><a href="#通过-p-名称空间配置-bean" class="headerlink" title="通过 p 名称空间配置 bean"></a>通过 p 名称空间配置 bean</h3><p>报错的时候，需要添加xmlns</p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606172244501.png" alt="image-20220606172244501" style="zoom:80%;" />

<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606172317833.png" alt="image-20220606172317833" style="zoom:80%;" />

<h4 id="代码实现-4"><a href="#代码实现-4" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster06&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">p:monsterID</span>=<span class="string">&quot;500&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">p:name</span>=<span class="string">&quot;红孩儿&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">p:skill</span>=<span class="string">&quot;喷火&quot;</span></span></span><br><span class="line"><span class="tag">   /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通p名称空间来设置属性</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBeanByP</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">monster06</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster06&quot;</span>,Monster.class);</span><br><span class="line">        System.out.println(monster06);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="引用-x2F-注入其它-bean-对象"><a href="#引用-x2F-注入其它-bean-对象" class="headerlink" title="引用&#x2F;注入其它 bean 对象"></a>引用&#x2F;注入其它 bean 对象</h3><p>​		在 spring 的 ioc 容器, 可以通过 ref 来实现 bean 对象的<strong>相互引用</strong>。</p>
<h4 id="代码实现-5"><a href="#代码实现-5" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.dao;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * DAO对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberDAOImpl</span> &#123;</span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MemberDAOImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MemberDAOImpl 构造器...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MemberDAOImpl add()方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.dao.MemberDAOImpl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * Service类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberServiceImpl</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MemberDAOImpl memberDAO;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MemberDAOImpl <span class="title function_">getMemberDAO</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memberDAO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemberDAO</span><span class="params">(MemberDAOImpl memberDAO)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.memberDAO = memberDAO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MemberServiceImpl add() 被调用&quot;</span>);</span><br><span class="line">        memberDAO.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置MemberDAOImpl对象</span></span><br><span class="line"><span class="comment">       1. ref=&quot;memberDAO&quot;表示  MemberServiceImpl对象属性memberDAO引用的对象是id=memberDAO的对象</span></span><br><span class="line"><span class="comment">       2. 这里就体现出spring容器的依赖注入</span></span><br><span class="line"><span class="comment">       3. 注意再spring容器中, 他是作为一个整体来执行的, 即如果你引用到一个bean对象, 对你配置的顺序没有要求</span></span><br><span class="line"><span class="comment">       4. 建议还是按顺序，好处是阅读的时候，比较方便</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.dao.MemberDAOImpl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;memberDAO&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--配置MemberServiceImpl--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.service.MemberServiceImpl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;memberService&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;memberDAO&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;memberDAO&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过ref设置bean属性</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanByRef</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">MemberServiceImpl</span> <span class="variable">monsterService</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;memberService&quot;</span>, MemberServiceImpl.class);</span><br><span class="line">        monsterService.add();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606174010325.png" alt="image-20220606174010325"></p>
<h3 id="引用-x2F-注入内部-bean-对象"><a href="#引用-x2F-注入内部-bean-对象" class="headerlink" title="引用&#x2F;注入内部 bean 对象"></a>引用&#x2F;注入内部 bean 对象</h3><h4 id="代码实现-6"><a href="#代码实现-6" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置MemberServiceImpl对象-使用内部bean--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.service.MemberServiceImpl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;memberService2&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--自己配置一个内部bean--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;memberDAO&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.5lzw.spring.dao.MemberDAOImpl&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过内部bean设置属性</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanByPro</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">MemberServiceImpl</span> <span class="variable">monsterServi5ce2</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;memberService2&quot;</span>, MemberServiceImpl.class);</span><br><span class="line">        monsterService2.add();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="引用-x2F-注入集合-x2F-数组类型"><a href="#引用-x2F-注入集合-x2F-数组类型" class="headerlink" title="引用&#x2F;注入集合&#x2F;数组类型"></a>引用&#x2F;注入集合&#x2F;数组类型</h3><h4 id="代码实现-7"><a href="#代码实现-7" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Master</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">//主人名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Monster&gt; monsterList;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Monster&gt; monsterMap;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Monster&gt; monsterSet;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String[] monsterName;</span><br><span class="line">    <span class="comment">//这个 Properties 是 Hashtable 的子类 , 是 key-value 的形式</span></span><br><span class="line">    <span class="comment">//这里 Properties key 和 value 都是 String</span></span><br><span class="line">    <span class="keyword">private</span> Properties pros;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Master</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Master</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Monster&gt; <span class="title function_">getMonsterList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> monsterList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMonsterList</span><span class="params">(List&lt;Monster&gt; monsterList)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.monsterList = monsterList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Monster&gt; <span class="title function_">getMonsterMap</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> monsterMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMonsterMap</span><span class="params">(Map&lt;String, Monster&gt; monsterMap)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.monsterMap = monsterMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Monster&gt; <span class="title function_">getMonsterSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> monsterSet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMonsterSet</span><span class="params">(Set&lt;Monster&gt; monsterSet)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.monsterSet = monsterSet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getMonsterName() &#123;</span><br><span class="line">        <span class="keyword">return</span> monsterName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMonsterName</span><span class="params">(String[] monsterName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.monsterName = monsterName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Properties <span class="title function_">getPros</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pros;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPros</span><span class="params">(Properties pros)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pros = pros;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Master&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, monsterList=&quot;</span> + monsterList +</span><br><span class="line">                <span class="string">&quot;, monsterMap=&quot;</span> + monsterMap +</span><br><span class="line">                <span class="string">&quot;, monsterSet=&quot;</span> + monsterSet +</span><br><span class="line">                <span class="string">&quot;, monsterName=&quot;</span> + Arrays.toString(monsterName) +</span><br><span class="line">                <span class="string">&quot;, pros=&quot;</span> + pros +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置Master对象</span></span><br><span class="line"><span class="comment">       体会 spring 容器配置特点 依赖注入-非常灵活</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Master&quot;</span> <span class="attr">id</span>=<span class="string">&quot;master&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;太上老君&quot;</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--给list属性赋值--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterList&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--引用其他bean--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster01&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster02&quot;</span>/&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--内部bean--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;老鼠精&quot;</span>/&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterID&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;吃粮食&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--给map属性赋值--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterMap&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">key</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">value</span>&gt;</span>monster03<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                   <span class="comment">&lt;!--这里使用外部bean引入--&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster03&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">key</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">value</span>&gt;</span>monster04<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster04&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--给set属性赋值--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterSet&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster05&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster06&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;金角大王&quot;</span>/&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;吐水&quot;</span>/&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterID&quot;</span> <span class="attr">value</span>=<span class="string">&quot;666&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--给数组属性赋值</span></span><br><span class="line"><span class="comment">           array标签中使用 value 还是 bean , ref .. 要根据你的业务决定</span></span><br><span class="line"><span class="comment">       --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterName&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>小妖怪<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>大妖怪<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>老妖怪<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--给Properties属性赋值 结构k(String)-v(String)--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;pros&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;username&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;ip&quot;</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanByCollection</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">    <span class="type">Master</span> <span class="variable">master</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;master&quot;</span>, Master.class);</span><br><span class="line">    System.out.println(master);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="细节说明-2"><a href="#细节说明-2" class="headerlink" title="细节说明"></a>细节说明</h4><ol>
<li>主要掌握List&#x2F;Map&#x2F;Properties三种集合的使用</li>
<li>Properties集合的特点。</li>
</ol>
<p>​	（1）Properties 是 Hashtable 的子类 , 是 key-value 的形式。（2）key 和 value 都是 String。</p>
<h3 id="通过-util-名称空间创建-list"><a href="#通过-util-名称空间创建-list" class="headerlink" title="通过 util 名称空间创建 list"></a>通过 util 名称空间创建 list</h3><h4 id="代码实现-8"><a href="#代码实现-8" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookStore</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; bookList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookStore</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getBookList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookList</span><span class="params">(List&lt;String&gt; bookList)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookList = bookList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BookStore&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;bookList=&quot;</span> + bookList +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定义一个util:list 并且指定id 可以达到数据复用</span></span><br><span class="line"><span class="comment">   在使用util:list 名称空间时候，需要引入相应的标签, 一般来说通过alt+enter会自动加入</span></span><br><span class="line"><span class="comment">   , 如果没有就手动添加一下即可.</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;myBookList&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">value</span>&gt;</span>三国演义<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">value</span>&gt;</span>红楼梦<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">value</span>&gt;</span>西游记<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">value</span>&gt;</span>水浒传<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--配置BookStore对象--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.BookStore&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bookStore&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookList&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;myBookList&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过util:list名称空间给属性赋值</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanByUtilList</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">BookStore</span> <span class="variable">bookStore</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;bookStore&quot;</span>, BookStore.class);</span><br><span class="line">        System.out.println(bookStore);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="级联属性赋值"><a href="#级联属性赋值" class="headerlink" title="级联属性赋值"></a>级联属性赋值</h3><p>​		spring 的 ioc 容器, 可以直接给对象属性的属性赋值， 即级联属性赋值。</p>
<h4 id="代码实现-9"><a href="#代码实现-9" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 部门类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dept</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Dept</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Dept&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 员工类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Dept dept;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Emp</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dept <span class="title function_">getDept</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDept</span><span class="params">(Dept dept)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dept = dept;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Emp&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, dept=&quot;</span> + dept +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置Dept对象--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Dept&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dept&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--配置Emp对象--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Emp&quot;</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jack&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dept&quot;</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--这里我希望给dept的name属性指定值[级联属性赋值]--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept.name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Java开发部门&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给属性进行级联赋值</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanByRelation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;emp&quot;</span>, Emp.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;emp=&quot;</span> + emp);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220614194740319.png" alt="image-20220614194740319"></p>
<h3 id="通过静态工厂获取bean"><a href="#通过静态工厂获取bean" class="headerlink" title="通过静态工厂获取bean"></a>通过静态工厂获取bean</h3><p>​		在 spring 的 ioc 容器，可以通过静态工厂获取 bean 对象。</p>
<h4 id="代码实现-10"><a href="#代码实现-10" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.bean.Monster;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 静态工厂类-可以返回Monster对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyStaticFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Monster&gt; monsterMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用static代码块进行初始化</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        monsterMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Monster&gt;();</span><br><span class="line">        monsterMap.put(<span class="string">&quot;monster_01&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">100</span>, <span class="string">&quot;黄袍怪&quot;</span>, <span class="string">&quot;一阳指&quot;</span>));</span><br><span class="line">        monsterMap.put(<span class="string">&quot;monster_02&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">200</span>, <span class="string">&quot;九头金雕&quot;</span>, <span class="string">&quot;如来神掌&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提供一个方法，返回Monster对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Monster <span class="title function_">getMonster</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> monsterMap.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置monster对象,通过静态工厂获取</span></span><br><span class="line"><span class="comment">      1. 通过静态工厂获取/配置bean</span></span><br><span class="line"><span class="comment">      2. class 是静态工厂类的全路径</span></span><br><span class="line"><span class="comment">      3. factory-method 表示是指定静态工厂类的哪个方法返回对象</span></span><br><span class="line"><span class="comment">      4. constructor-arg value=&quot;monster02&quot; value是指定要返回静态工厂的哪个对象</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;my_monster01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.factory.MyStaticFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getMonster&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;monster_02&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;my_monster02&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.factory.MyStaticFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getMonster&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;monster_02&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过静态工厂获取bean</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBeanByStaticFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">my_monster01</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;my_monster01&quot;</span>, Monster.class);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">my_monster02</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;my_monster02&quot;</span>, Monster.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;my_monster01=&quot;</span> + my_monster01);</span><br><span class="line">        System.out.println(my_monster01 == my_monster02);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220614194723400.png" alt="image-20220614194723400"></p>
<h3 id="通过实例工厂获取对象"><a href="#通过实例工厂获取对象" class="headerlink" title="通过实例工厂获取对象"></a>通过实例工厂获取对象</h3><p>​		在 spring 的 ioc 容器，可以通过实例工厂获取 bean 对象。</p>
<h4 id="代码实现-11"><a href="#代码实现-11" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.bean.Monster;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 实例工厂类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInstanceFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Monster&gt; monster_map;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过普通代码块进行初始化</span></span><br><span class="line">    &#123;</span><br><span class="line">        monster_map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        monster_map.put(<span class="string">&quot;monster_03&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">300</span>, <span class="string">&quot;牛魔王~&quot;</span>, <span class="string">&quot;芭蕉扇~&quot;</span>));</span><br><span class="line">        monster_map.put(<span class="string">&quot;monster_04&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">400</span>, <span class="string">&quot;狐狸精~&quot;</span>, <span class="string">&quot;美人计~&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//写一个方法返回Monster对象</span></span><br><span class="line">    <span class="keyword">public</span> Monster <span class="title function_">getMonster</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> monster_map.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置2个实例工厂对象--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.factory.MyInstanceFactory&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myInstanceFactory&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.factory.MyInstanceFactory&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myInstanceFactory2&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--配置monster对象, 通过实例工厂</span></span><br><span class="line"><span class="comment">       1. factory-bean 指定使用哪个实例工厂对象返回bean</span></span><br><span class="line"><span class="comment">       2. factory-method 指定使用实例工厂对象的哪个方法返回bean</span></span><br><span class="line"><span class="comment">       3. constructor-arg value=&quot;monster03&quot; 指定获取到实例工厂中的哪个monster</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;my_monster03&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;myInstanceFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getMonster&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;monster_03&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;my_monster04&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;myInstanceFactory2&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getMonster&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;monster_03&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过实例工厂获取bean</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBeanByInstanceFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">my_monster03</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;my_monster03&quot;</span>, Monster.class);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">my_monster04</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;my_monster04&quot;</span>, Monster.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;my_monster03=&quot;</span> + my_monster03);</span><br><span class="line">        System.out.println(<span class="string">&quot;my_monster04=&quot;</span> + my_monster04);</span><br><span class="line">        System.out.println(my_monster03 == my_monster04);<span class="comment">//false</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220614194707616.png" alt="image-20220614194707616"></p>
<h3 id="通过-FactoryBean-获取对象-重点"><a href="#通过-FactoryBean-获取对象-重点" class="headerlink" title="通过 FactoryBean 获取对象(重点)"></a>通过 FactoryBean 获取对象(重点)</h3><p>​		在 spring 的 ioc 容器，通过 FactoryBean 获取 bean 对象(重点)。</p>
<h4 id="代码实现-12"><a href="#代码实现-12" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.bean.Monster;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 是一个FactoryBean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Monster&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这个就是你配置时候，指定要获取的对象对应key</span></span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Monster&gt; monster_map;</span><br><span class="line"></span><br><span class="line">    &#123;   <span class="comment">//代码块，完成初始化</span></span><br><span class="line">        monster_map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        monster_map.put(<span class="string">&quot;monster03&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">300</span>, <span class="string">&quot;牛魔王~&quot;</span>, <span class="string">&quot;芭蕉扇~&quot;</span>));</span><br><span class="line">        monster_map.put(<span class="string">&quot;monster04&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">400</span>, <span class="string">&quot;狐狸精~&quot;</span>, <span class="string">&quot;美人计~&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Monster <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> monster_map.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Monster.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;<span class="comment">//这里指定返回是否是单例</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置monster对象，通过FactoryBean获取</span></span><br><span class="line"><span class="comment">      1. class 指定使用的FactoryBean</span></span><br><span class="line"><span class="comment">      2. key表示就是 MyFactoryBean 属性key</span></span><br><span class="line"><span class="comment">      3. value就是你要获取的对象对应key</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;my_monster05&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.factory.MyFactoryBean&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;key&quot;</span> <span class="attr">value</span>=<span class="string">&quot;monster04&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过FactoryBean获取bean</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBeanByFactoryBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">my_monster05</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;my_monster05&quot;</span>, Monster.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;my_monster05=&quot;</span> + my_monster05);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220614194646489.png" alt="image-20220614194646489"></p>
<h3 id="bean-配置信息重用-继承"><a href="#bean-配置信息重用-继承" class="headerlink" title="bean 配置信息重用(继承)"></a>bean 配置信息重用(继承)</h3><p>​		在 spring 的 ioc 容器，提供了一种继承的方式来实现 bean 配置信息的重用。</p>
<h4 id="代码实现-13"><a href="#代码实现-13" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置Monster对象--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster10&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterID&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;蜈蚣精&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;蜇人&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      1. 配置Monster对象</span></span><br><span class="line"><span class="comment">      2.但是这个对象的属性值和 id=&quot;monster10&quot;对象属性一样</span></span><br><span class="line"><span class="comment">      3.parent=&quot;monster10&quot; 指定当前这个配置的对象的属性值从 id=monster10的对象来</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster11&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;monster10&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--配置Monster对象</span></span><br><span class="line"><span class="comment">       1. 如果bean指定了 abstract=&quot;true&quot;, 表示该bean对象, 是用于被继承</span></span><br><span class="line"><span class="comment">       2. 本身这个bean就不能被获取/实例化</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster12&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterID&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;蜈蚣精~&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;蜇人~&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster13&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;monster12&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置Bean通过继承</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBeanByExtends</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">monster11</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster11&quot;</span>, Monster.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;monster11=&quot;</span> + monster11);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">monster13</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster13&quot;</span>, Monster.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;monster13=&quot;</span> + monster13);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220614194618378.png" alt="image-20220614194618378"></p>
<h3 id="bean-创建顺序"><a href="#bean-创建顺序" class="headerlink" title="bean 创建顺序"></a>bean 创建顺序</h3><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><ol>
<li>在 spring 的 ioc 容器，默认是按照配置的顺序创建 bean 对象</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.bean.Student&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;department01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.bean.Department&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>​		会先创建 student01 这个 bean 对象，然后创建 department01 这个 bean 对象。</p>
<ol start="2">
<li>如果这样配置</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.bean.Student&quot;</span> <span class="attr">depends-on</span>=<span class="string">&quot;department01&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;department01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.bean.Department&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>​		会先创建 department01 对象，再创建 student01 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Department</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Department</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Department() 被执行...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student()构造器被执行..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220606195913588.png" alt="image-20220606195913588"></p>
<p>​		1在默认情况下，bean创建的顺序是按照配置顺序来的。但如果增加了 depends-on 属性，这时就会先创建有这个属性的bean。</p>
<h4 id="两个问题"><a href="#两个问题" class="headerlink" title="两个问题"></a>两个问题</h4><ol>
<li>看下面的配置，请问两个 bean 创建的顺序是什么？并分析执行流程。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.dao.MemberDAOImpl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;memberDAO&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.service.MemberServiceImpl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;memberService&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;memberDAO&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;memberDAO&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	（1）先创建 id&#x3D;memberDAO</p>
<p>​	（2）再创建 id &#x3D; memberService</p>
<p>​	（3）调用 memberServiceImpl.setMemberDAO() 完成引用</p>
<ol start="2">
<li>看下面的配置，请问两个 bean 创建的顺序是什么？并分析执行流程。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.service.MemberServiceImpl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;memberService&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;memberDAO&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;memberDAO&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.dao.MemberDAOImpl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;memberDAO&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	（1）先创建 id &#x3D; memberService</p>
<p>​	（2）再创建 id&#x3D;memberDAO</p>
<p>​	（3）调用 memberServiceImpl.setMemberDAO() 完成引用</p>
<h3 id="bean-对象的单例和多例-重要"><a href="#bean-对象的单例和多例-重要" class="headerlink" title="bean 对象的单例和多例(重要)"></a>bean 对象的单例和多例(重要)</h3><h4 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h4><p>​		在 spring 的 ioc 容器，在默认是按照单例创建的，即配置一个 bean 对象后，ioc 容器只会创建一个 bean 实例。 </p>
<p>​		如果我们希望 ioc 容器配置的某个 bean 对象，是以多个实例形式创建的则可以通过配置 scope&#x3D;”prototype” 来指定。</p>
<h4 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Cat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Cat()构造器执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Cat&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置Cat对象</span></span><br><span class="line"><span class="comment">      1. 在默认情况下 scope属性是 singleton</span></span><br><span class="line"><span class="comment">      2. 在ioc容器中, 只有一个这个bean对象</span></span><br><span class="line"><span class="comment">      3. 当程序员执行getBean时, 返回的的是同一个对象</span></span><br><span class="line"><span class="comment">      4. 如果我们希望每次getBean返回一个新的Bean对象，则可以scope=&quot;prototype&quot;</span></span><br><span class="line"><span class="comment">      5. 如果bean的配置是 scope=&quot;singleton&quot; lazy-init=&quot;true&quot; 这时,ioc容器就不会提前创建该对象,</span></span><br><span class="line"><span class="comment">      而是当执行getBean方法的时候，才会创建对象</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Cat&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小花猫&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试Scope</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBeanScope</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Cat</span> <span class="variable">cat</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;cat&quot;</span>, Cat.class);</span><br><span class="line">        <span class="type">Cat</span> <span class="variable">cat2</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;cat&quot;</span>, Cat.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;cat=&quot;</span> + cat);</span><br><span class="line">        System.out.println(<span class="string">&quot;cat2=&quot;</span> + cat2);</span><br><span class="line">        System.out.println(cat == cat2);<span class="comment">//false</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用细节"><a href="#使用细节" class="headerlink" title="使用细节"></a>使用细节</h4><ol>
<li><p>默认是单例 singleton，在启动容器时，默认就会创建，并放入到 singletonObjects 集合。</p>
</li>
<li><p>当</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure>

<p> 设置为多实例机制后, 该 bean 是在 getBean()时才创建。</p>
</li>
<li><p>如果是单例singleton，同时希望在getBean时才创建，可以指定懒加载 lazy-init&#x3D;”true” (注意默认是 false)。</p>
</li>
<li><p>通常情况下，lazy-init 就使用默认值 false，在开发看来，用空间换时间是值得的，除非有特殊的要求。</p>
</li>
<li><p>如果 scope&#x3D;”prototype” 这时 lazy-init 属性的值不管是 ture，还是 false 都是在 getBean 时候，才创建对象。</p>
</li>
</ol>
<h3 id="bean-的生命周期"><a href="#bean-的生命周期" class="headerlink" title="bean 的生命周期"></a>bean 的生命周期</h3><h4 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h4><p>bean 对象创建是由 JVM 完成的，然后执行如下方法。</p>
<ol>
<li>执行构造器</li>
<li>执行 set 相关方法 </li>
<li>调用 bean 的初始化的方法（需要配置）</li>
<li>使用 bean</li>
<li>当容器关闭时候，调用 bean 的销毁方法（需要配置）</li>
</ol>
<h4 id="代码演示-1"><a href="#代码演示-1" class="headerlink" title="代码演示"></a>代码演示</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">House</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;House() 构造器...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;House setName()=&quot;</span> + name);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1. 这个方法是程序员来编写的.</span></span><br><span class="line">    <span class="comment">//2. 根据自己的业务逻辑来写.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;House init()..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1. 这个方法是程序员来编写的.</span></span><br><span class="line">    <span class="comment">//2. 根据自己的业务逻辑来写.</span></span><br><span class="line">    <span class="comment">//3. 名字也不是固定的</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;House destroy()..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;House&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置House对象，演示整个Bean的生命周期</span></span><br><span class="line"><span class="comment">       1. init-method=&quot;init&quot; 指定bean的初始化方法 , 在setter方法后执行</span></span><br><span class="line"><span class="comment">       2. init方法执行的时机，由spring容器来控制</span></span><br><span class="line"><span class="comment">       3. destroy-method=&quot;destroy&quot; 指定bean的销毁方法, 在容器关闭的时候执行</span></span><br><span class="line"><span class="comment">       4. destroy方法执行的时机，由spring容器来控制</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.House&quot;</span> <span class="attr">id</span>=<span class="string">&quot;house&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;大豪宅&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试Bean的生命周期</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBeanLife</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">House</span> <span class="variable">house</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;house&quot;</span>, House.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;house=&quot;</span> + house);</span><br><span class="line">        <span class="comment">//关闭容器</span></span><br><span class="line">        <span class="comment">//1. ioc的编译类型 ApplicationContext , 运行类型 ClassPathXmlApplicationContext</span></span><br><span class="line">        <span class="comment">//2. 因为ClassPathXmlApplicationContext 实现了 ConfigurableApplicationContext</span></span><br><span class="line">        <span class="comment">//3. ClassPathXmlApplicationContext 是有close</span></span><br><span class="line">        <span class="comment">//4. 将ioc 转成ClassPathXmlApplicationContext，再调用close</span></span><br><span class="line">        <span class="comment">//ioc.close();</span></span><br><span class="line">        <span class="comment">//关闭ioc容器.</span></span><br><span class="line">        ((ClassPathXmlApplicationContext)ioc).close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220614201718169.png" alt="image-20220614201718169"></p>
<h4 id="使用细节-1"><a href="#使用细节-1" class="headerlink" title="使用细节"></a>使用细节</h4><ol>
<li>初始化 init 方法和 destory 方法，是程序员来指定。2. 销毁方法就是当关闭容器时，才会被调用。</li>
</ol>
<h3 id="配置-bean-的后置处理器-重难点"><a href="#配置-bean-的后置处理器-重难点" class="headerlink" title="*配置 bean 的后置处理器(重难点)"></a>*配置 bean 的后置处理器(重难点)</h3><h4 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h4><ol>
<li>在 spring 的 ioc 容器，可以配置 bean 的后置处理器。 </li>
<li>该处理器&#x2F;对象会在 <strong>bean 初始化方法</strong>(init)调用前和初始化方法调用后被调用 。</li>
<li>程序员可以在后置处理器中编写自己的代码。</li>
</ol>
<h4 id="代码演示-2"><a href="#代码演示-2" class="headerlink" title="代码演示"></a>代码演示</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 这是一个后置处理器, 需要实现 BeanPostProcessor接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 什么时候被调用：在Bean的init方法前被调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean 传入的在IOC容器中创建/配置Bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName 传入的在IOC容器中创建/配置Bean的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  程序员对传入的bean 进行修改/处理【如果有需要的话】 ,返回</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postProcessBeforeInitialization().. bean=&quot;</span> + bean + <span class="string">&quot; beanName=&quot;</span> + beanName);</span><br><span class="line">        <span class="comment">//初步体验案例: 如果类型是House的统一改成 上海豪宅</span></span><br><span class="line">        <span class="comment">//对多个对象进行处理/编程==&gt;切面编程</span></span><br><span class="line">        <span class="keyword">if</span>(bean <span class="keyword">instanceof</span> House) &#123;</span><br><span class="line">            ((House)bean).setName(<span class="string">&quot;上海豪宅~&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 什么时候被调用: 在Bean的init方法后被调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean  传入的在IOC容器中创建/配置Bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName 传入的在IOC容器中创建/配置Bean的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 程序员对传入的bean 进行修改/处理【如果有需要的话】 ,返回</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postProcessAfterInitialization().. bean=&quot;</span> + bean + <span class="string">&quot; beanName=&quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>beans02.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置House对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.House&quot;</span> <span class="attr">id</span>=<span class="string">&quot;house&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;大豪宅&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.House&quot;</span> <span class="attr">id</span>=<span class="string">&quot;house02&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;香港豪宅&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置后置处理器对象</span></span><br><span class="line"><span class="comment">       1. 在beans02.xml 容器配置文件 配置了 MyBeanPostProcessor</span></span><br><span class="line"><span class="comment">       2. 这时后置处理器对象，就会作用在该容器创建的Bean对象</span></span><br><span class="line"><span class="comment">       3. 已经是针对所有对象编程-&gt;切面编程AOP</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.MyBeanPostProcessor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myBeanPostProcessor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBeanPostProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans02.xml&quot;</span>);</span><br><span class="line">       <span class="type">House</span> <span class="variable">house</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;house&quot;</span>, House.class);</span><br><span class="line">       System.out.println(<span class="string">&quot;house=&quot;</span> + house);</span><br><span class="line">       <span class="type">House</span> <span class="variable">house02</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;house02&quot;</span>, House.class);</span><br><span class="line">       System.out.println(<span class="string">&quot;使用house02=&quot;</span> + house02);</span><br><span class="line">       ((ConfigurableApplicationContext)ioc).close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606220745721.png" alt="image-20220606220745721" style="zoom:80%;" />

<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220606221613181.png" alt="image-20220606221613181" style="zoom:80%;" />

<h4 id="其他说明"><a href="#其他说明" class="headerlink" title="其他说明"></a>其他说明</h4><p>1、怎么执行到这个方法？&#x3D;&gt; 使用 AOP(反射+动态代理+IO+容器+注解) 。</p>
<p>2、有什么用？&#x3D;&gt; 可以对 IOC 容器中所有的对象进行统一处理，比如 日志处理&#x2F;权限的校 验&#x2F;安全的验证&#x2F;事务管理。</p>
<p>​	–初步体验案例：如果类型是 House 的统一改成 上海豪宅 。</p>
<p>3、针对容器的所有对象吗？是的&#x3D;&gt;切面编程特点 。</p>
<p>4、后面会手动实现这个底层机制。</p>
<h3 id="通过属性文件给-bean-注入值"><a href="#通过属性文件给-bean-注入值" class="headerlink" title="通过属性文件给 bean 注入值"></a>通过属性文件给 bean 注入值</h3><h4 id="说明-4"><a href="#说明-4" class="headerlink" title="说明"></a>说明</h4><p>​		在 spring 的 ioc 容器，通过属性文件给 bean 注入值。</p>
<h4 id="代码演示-3"><a href="#代码演示-3" class="headerlink" title="代码演示"></a>代码演示</h4><p>myproperties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">monsterId</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">jack</span></span><br><span class="line"><span class="attr">skill</span>=<span class="string">hello</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--指定属性文件在哪里</span></span><br><span class="line"><span class="comment">        location=&quot;classpath:my.properties&quot; 指定文件位置需要带上 classpath</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:my.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置Monster对象</span></span><br><span class="line"><span class="comment">        1.通过属性文件给monster对象的属性赋值</span></span><br><span class="line"><span class="comment">        2.这时我们的属性值通过$&#123;属性名&#125;</span></span><br><span class="line"><span class="comment">        3.这里的属性名 就是 my.properties文件中的key</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span> <span class="attr">id</span>=<span class="string">&quot;monster1000&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterID&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;monsterId&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;skill&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;name&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过属性文件给bean属性赋值</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanByFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans03.xml&quot;</span>);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">monster1000</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster1000&quot;</span>, Monster.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;monster1000=&quot;</span> + monster1000);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>​		如果properites配置文件中有中文，访问站长工具（<a target="_blank" rel="noopener" href="https://tool.chinaz.com/%EF%BC%89%E8%BF%9B%E8%A1%8CUnicode%E8%BF%9B%E8%A1%8C%E8%BD%AC%E7%A0%81%EF%BC%8C%E5%B0%86%E8%BD%AC%E5%90%8E%E7%9A%84%E7%BC%96%E7%A0%81%E5%A4%8D%E5%88%B6%E5%88%B0properties%E6%96%87%E4%BB%B6%E4%B8%AD%E3%80%82">https://tool.chinaz.com/）进行Unicode进行转码，将转后的编码复制到properties文件中。</a></p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220607193414294.png" alt="image-20220607193414294" style="zoom:80%;" />

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220607193656928.png" alt="image-20220607193656928"></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220607193734081.png" alt="image-20220607193734081"></p>
<h3 id="基于-XML-的-bean-的自动装配"><a href="#基于-XML-的-bean-的自动装配" class="headerlink" title="基于 XML 的 bean 的自动装配"></a>基于 XML 的 bean 的自动装配</h3><h4 id="代码演示-4"><a href="#代码演示-4" class="headerlink" title="代码演示"></a>代码演示</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.dao;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * DAO类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;保存 一个订单...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.dao.OrderDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * OrderService</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> OrderDao orderDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> OrderDao <span class="title function_">getOrderDao</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrderDao</span><span class="params">(OrderDao orderDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderDao = orderDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.service.OrderService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 这里的Action就是 Servlet-&gt;充当Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderAction</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> OrderService <span class="title function_">getOrderService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrderService</span><span class="params">(OrderService orderService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderService = orderService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置OrderDao对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.dao.OrderDao&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orderDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置OrderService对象</span></span><br><span class="line"><span class="comment">    1. autowire=&quot;byType&quot; 表示 在创建 orderService时</span></span><br><span class="line"><span class="comment">       通过类型的方式 给对象属性 自动完成赋值/引用</span></span><br><span class="line"><span class="comment">    2. 比如OrderService 对象有 private OrderDao orderDao</span></span><br><span class="line"><span class="comment">    3. 就会在容器中去找有没有 OrderDao类型对象</span></span><br><span class="line"><span class="comment">    4. 如果有，就会自动的装配, 如果是按照 byType 方式来装配, 这个容器中，不能有两个OrderDao类型对象</span></span><br><span class="line"><span class="comment">    5. 如果对象没有属性,  autowire就没有必要写</span></span><br><span class="line"><span class="comment">    6. 其它类推..</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    7. 如果设置的是 autowire=&quot;byName&quot; 表示通过名字完成自动装配</span></span><br><span class="line"><span class="comment">    8. 比如下面的 autowire=&quot;byName&quot; class=&quot;com.lzw.spring.service.OrderService&quot;</span></span><br><span class="line"><span class="comment">       1) 先看 OrderService 属性 private OrderDao orderDao(并不是根据这个&quot;orderDao&quot;为id进行装配)</span></span><br><span class="line"><span class="comment">       2) 再根据这个属性的setXxx()方法的 xxx 来找对象id(是根据这里的&quot;xxx&quot;来装配)</span></span><br><span class="line"><span class="comment">       3) public void setOrderDao() 就会找id=orderDao对象来进行自动装配(这里的&quot;orderDao&quot;就是2中的xxx)</span></span><br><span class="line"><span class="comment">       4) 如果没有就装配失败</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.service.OrderService&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orderService&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;bean autowire=&quot;byName&quot; class=&quot;com.lzw.spring.service.OrderService&quot; id=&quot;orderService&quot;/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置OrderAction--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.web.OrderAction&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orderAction&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;bean autowire=&quot;byName&quot; class=&quot;com.lzw.spring.web.OrderAction&quot; id=&quot;orderAction&quot;/&gt;--&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过自动装配来对属性赋值</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanByAutowire</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans03.xml&quot;</span>);</span><br><span class="line">        <span class="type">OrderAction</span> <span class="variable">orderAction</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;orderAction&quot;</span>, OrderAction.class);</span><br><span class="line">        <span class="comment">//验证是否自动装配上OrderService</span></span><br><span class="line">        System.out.println(orderAction.getOrderService());</span><br><span class="line">        <span class="comment">//验证是否自动装配上OrderDao</span></span><br><span class="line">        System.out.println(orderAction.getOrderService().getOrderDao());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring-EL-表达式配置Bean-了解"><a href="#Spring-EL-表达式配置Bean-了解" class="headerlink" title="Spring EL 表达式配置Bean(了解)"></a>Spring EL 表达式配置Bean(了解)</h3><h4 id="说明-5"><a href="#说明-5" class="headerlink" title="说明"></a>说明</h4><ol>
<li><p>Spring Expression Language，Spring 表达式语言，简称 SpEL。支持运行时查询并可以操作对象。</p>
</li>
<li><p>和 EL 表达式一样，SpEL 根据 JavaBean 风格的 getXxx()、setXxx()方法定义的属性访问对象。</p>
</li>
<li><p>SpEL 使用#{…}作为定界符，所有在大框号中的字符都将被认为是 SpEL 表达式。 </p>
</li>
<li><p>不是重点，如果看到有人这样使用，能看懂即可。</p>
</li>
</ol>
<h4 id="代码演示-5"><a href="#代码演示-5" class="headerlink" title="代码演示"></a>代码演示</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 2022/6/7 22:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpELBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Monster monster;</span><br><span class="line">    <span class="keyword">private</span> String monsterName;</span><br><span class="line">    <span class="keyword">private</span> String crySound; <span class="comment">//叫声</span></span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> Double result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SpELBean</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Monster <span class="title function_">getMonster</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> monster;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMonster</span><span class="params">(Monster monster)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.monster = monster;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMonsterName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> monsterName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMonsterName</span><span class="params">(String monsterName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.monsterName = monsterName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCrySound</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> crySound;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCrySound</span><span class="params">(String crySound)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.crySound = crySound;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBookName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookName</span><span class="params">(String bookName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookName = bookName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getResult</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setResult</span><span class="params">(Double result)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.result = result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//cry 方法会返回字符串</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">cry</span><span class="params">(String sound)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;发出 &quot;</span> + sound + <span class="string">&quot;叫声...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//read 返回字符串</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">read</span><span class="params">(String bookName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;正在看 &quot;</span> + bookName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SpELBean&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, monster=&quot;</span> + monster +</span><br><span class="line">                <span class="string">&quot;, monsterName=&#x27;&quot;</span> + monsterName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, crySound=&#x27;&quot;</span> + crySound + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, bookName=&#x27;&quot;</span> + bookName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, result=&quot;</span> + result +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置一个monster对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterID&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;蜈蚣精~&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;蜇人~&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring el 表达式使用</span></span><br><span class="line"><span class="comment">        通过spel给bean的属性赋值</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;spELBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.bean.SpELBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- sp el 给字面量 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;&#x27;LiAng&#x27;&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- sp el 引用其它bean --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monster&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;monster01&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- sp el 引用其它bean的属性值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;monster01.name&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- sp el 调用普通方法(返回值)  赋值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;crySound&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;spELBean.cry(&#x27;喵喵的..&#x27;)&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- sp el 调用静态方法(返回值) 赋值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;T(com.lzw.spring.bean.SpELBean).read(&#x27;天龙八部&#x27;)&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- sp el 通过运算赋值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;result&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;89*1.2&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过spring el 对属性赋值</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanBySpel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans04.xml&quot;</span>);</span><br><span class="line">        <span class="type">SpELBean</span> <span class="variable">spELBean</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;spELBean&quot;</span>, SpELBean.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;spELBean=&quot;</span> + spELBean);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="基于注解配置-bean-重点"><a href="#基于注解配置-bean-重点" class="headerlink" title="*基于注解配置 bean(重点)"></a>*基于注解配置 bean(重点)</h2><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><h4 id="说明-6"><a href="#说明-6" class="headerlink" title="说明"></a>说明</h4><h5 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h5><p>​		基于注解的方式配置 bean，主要是项目开发中的组件，比如 Controller、Service 和 Dao。</p>
<h5 id="组件注解的形式："><a href="#组件注解的形式：" class="headerlink" title="组件注解的形式："></a>组件注解的形式：</h5><ol>
<li><strong>@Component</strong> 表示当前注解标识的是一个组件 。</li>
<li><strong>@Controller</strong> 表示当前注解标识的是一个控制器，通常用于 Servlet 。</li>
<li><strong>@Service</strong> 表示当前注解标识的是一个处理业务逻辑的类，通常用于 Service 类。</li>
<li><strong>@Repository</strong> 表示当前注解标识的是一个持久化层的类，通常用于 Dao 类。</li>
</ol>
<h4 id="快速入门-1"><a href="#快速入门-1" class="headerlink" title="快速入门"></a>快速入门</h4><p>​		使用注解的方式来配置 Controller &#x2F; Service &#x2F; Respository &#x2F; Component。</p>
<p>​		首先要引入 spring-aop-5.3.8.jar。</p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220608212912194.png" alt="image-20220608212912194"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Service</span> 标识该类是一个Service类/对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Controller</span> 标识该类是一个控制器Controller, 通常这个类是一个Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAction</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Component</span> 标识该类是一个组件, 是一个通用的注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(value = &quot;lzw1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyComponent</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置容器要扫描的包</span></span><br><span class="line"><span class="comment">      1. component-scan 要对指定包下的类进行扫描, 并创建对象到容器</span></span><br><span class="line"><span class="comment">      2. base-package 指定要扫描的包</span></span><br><span class="line"><span class="comment">      3. 含义是当spring容器创建/初始化时，就会扫描com.lzw.spring.component包</span></span><br><span class="line"><span class="comment">         下的所有的 有注解 @Controller / @Service / @Repository / @Component类</span></span><br><span class="line"><span class="comment">         将其实例化，生成对象，放入到ioc容器</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.component&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过注解来配置Bean</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanByAnnotation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans05.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> ioc.getBean(UserDao.class);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> ioc.getBean(UserService.class);</span><br><span class="line">        <span class="type">UserAction</span> <span class="variable">userAction</span> <span class="operator">=</span> ioc.getBean(UserAction.class);</span><br><span class="line">        <span class="type">MyComponent</span> <span class="variable">myComponent</span> <span class="operator">=</span> ioc.getBean(MyComponent.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;userDao=&quot;</span> + userDao);</span><br><span class="line">        System.out.println(<span class="string">&quot;userService=&quot;</span> + userService);</span><br><span class="line">        System.out.println(<span class="string">&quot;userAction=&quot;</span> + userAction);</span><br><span class="line">        System.out.println(<span class="string">&quot;myComponent=&quot;</span> + myComponent);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="注意事项和细节说明"><a href="#注意事项和细节说明" class="headerlink" title="注意事项和细节说明"></a>注意事项和细节说明</h4><ol>
<li>需要导入 spring-aop-5.3.8.jar。</li>
<li>必须在 Spring 配置文件中指定”自动扫描的包”，IOC 容器才能够检测到当前项目中哪些类被标识了注解， 注意导入 context 名称空间。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.component&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!--resource-pattern=&quot;User*.class&quot; 表示只扫描com.lzw.spring.component 和它的子包下的User打头的类--&gt;</span></span><br></pre></td></tr></table></figure>

<p>​		可以使用通配符 * 来指定 ，比如 com.lzw.spring.* 表示。</p>
<ol start="3">
<li><p>Spring 的 IOC 容器不能检测一个使用了@Controller 注解的类到底是不是一个真正的控制器。注解的名称是用于程序员自己识别当前标识的是什么组件。其它的@Service @Repository 也是一样的道理 [也就是说 Spring 的 IOC 容器只要检查到注解就会生成对象， 但是这个注解的含义 Spring 不会识别，注解是给程序员编程方便看的]。</p>
</li>
<li><pre><code class="xml">&lt;context:component-scan base-package=&quot;com.lzw.spring.component&quot; resource-pattern=&quot;User*.class&quot;/&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   resource-pattern=&quot;User*.class&quot;：表示只扫描满足要求的类[使用的少，不想扫描，不写注解就可以，知道这个知识点即可]。</span><br><span class="line"></span><br><span class="line">5. 排除哪些类，以 annotaion 注解为例。</span><br><span class="line"></span><br><span class="line">   ```xml</span><br><span class="line">   	&lt;!--</span><br><span class="line">          需求：如果我们希望排除某个包/子包下的某种类型的注解，可以通过exclude-filter来指定</span><br><span class="line">          1. context:exclude-filter 指定要排除哪些类</span><br><span class="line">          2. type 指定排除方式 annotation表示按照注解来排除</span><br><span class="line">          3. expression=&quot;org.springframework.stereotype.Service&quot; 指定要排除的注解的全路径</span><br><span class="line">      --&gt;</span><br><span class="line">       &lt;context:component-scan base-package=&quot;com.lzw.spring.component&quot;&gt;</span><br><span class="line">           &lt;context:exclude-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Service&quot;/&gt;</span><br><span class="line">           &lt;context:exclude-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Repository&quot;/&gt;</span><br><span class="line">       &lt;/context:component-scan&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>指定自动扫描哪些注解类。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  需求：如果我们希望按照自己的规则，来扫描包/子包下的某些注解, 可以通过 include-filter</span></span><br><span class="line"><span class="comment">  1. use-default-filters=&quot;false&quot; 表示不使用默认的过滤机制/扫描机制</span></span><br><span class="line"><span class="comment">  2. context:include-filter 表示要去扫描哪些类</span></span><br><span class="line"><span class="comment">  3. type=&quot;annotation&quot; 按照注解方式来扫描/过滤</span></span><br><span class="line"><span class="comment">  4. expression=&quot;org.springframework.stereotype.Service&quot; 指定要扫描的注解的全路径</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.component&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Service&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Repository&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>默认情况：标记注解后，类名首字母小写作为 id 的值。也可以使用注解的 value 属性指定 id 值，并且 value 可以省略。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220608222952390.png" alt="image-20220608222952390"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 使用 <span class="doctag">@Repository</span> 标识该类是一个Repository 即是一个持久化层的类/对象</span></span><br><span class="line"><span class="comment"> * 1. 标记注解后，类名首字母小写作为id的值(默认)</span></span><br><span class="line"><span class="comment"> * 2. value = &quot;lzwUserDao&quot; 使用指定的 lzwUserDao作为UserDao对象的id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository(value = &quot;lzwUserDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220608223553407.png" alt="image-20220608223553407"></p>
<ol start="8">
<li>扩展-@Controller 、@Service、@Component 区别 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/454638478">https://zhuanlan.zhihu.com/p/454638478</a></li>
</ol>
<h3 id="手动开发简单的-Spring-基于注解配置的程序"><a href="#手动开发简单的-Spring-基于注解配置的程序" class="headerlink" title="手动开发简单的 Spring 基于注解配置的程序"></a>手动开发简单的 Spring 基于注解配置的程序</h3><h4 id="需求说明-2"><a href="#需求说明-2" class="headerlink" title="需求说明"></a>需求说明</h4><ol>
<li><p>自己写一个简单的Spring容器，通过读取类的注解 (@Component @Controller @Service @Reponsitory)，将对象注入到 IOC 容器。</p>
</li>
<li><p>也就是说，不使用 Spring 原生框架，我们自己使用 IO+Annotaion+反射+集合 技术实现，打通 Spring 注解方式开发的技术痛点。</p>
</li>
</ol>
<h4 id="思路分析-1"><a href="#思路分析-1" class="headerlink" title="思路分析"></a>思路分析</h4><p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609091031508.png" alt="image-20220609091031508"></p>
<h4 id="1-搭建基本结构并获取的扫描包"><a href="#1-搭建基本结构并获取的扫描包" class="headerlink" title="1. 搭建基本结构并获取的扫描包"></a>1. 搭建基本结构并获取的扫描包</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 1. <span class="doctag">@Target</span>(ElementType.TYPE)指定我们的 ComponentScan注解 可以修饰 Type程序元素</span></span><br><span class="line"><span class="comment"> * 2. <span class="doctag">@Retention</span>(RetentionPolicy.RUNTIME) 指定 ComponentScan注解 保留范围</span></span><br><span class="line"><span class="comment"> * 3. String value() default &quot;&quot;; 表示 ComponentScan 可以传入 value属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ComponentScan &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.annotation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 这是一个配置类，作用类似于原生Spring的 beans.xml 容器配置文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &quot;com.lzw.spring.component&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LzwSpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * LzwSpringApplicationContext 类的作用类似Spring原生ioc容器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LzwSpringApplicationContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Class configClass;</span><br><span class="line">    <span class="comment">//ioc 存放的就是通过反射创建的对象（基于注解方式）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Object&gt; ioc = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();<span class="comment">//singletonObjects</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LzwSpringApplicationContext</span><span class="params">(Class configClass)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.configClass = configClass;</span><br><span class="line">        <span class="comment">//System.out.println(&quot;this.configClass = &quot; + this.configClass);</span></span><br><span class="line">        <span class="comment">//获取要扫描的包</span></span><br><span class="line">        <span class="comment">//1. 先得到 LzwSpringConfig 配置的 @ComponentScan(value = &quot;com.lzw.spring.component&quot;)</span></span><br><span class="line">        <span class="type">ComponentScan</span> <span class="variable">componentScan</span> <span class="operator">=</span> (ComponentScan)<span class="built_in">this</span>.configClass.getDeclaredAnnotation(ComponentScan.class);</span><br><span class="line">        <span class="comment">//2. 通过 componentScan的value =&gt; 即要扫描的包</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> componentScan.value();</span><br><span class="line">        System.out.println(<span class="string">&quot;要扫描的包 = &quot;</span> + path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-获取扫描包下所有-class-文件"><a href="#2-获取扫描包下所有-class-文件" class="headerlink" title="2. 获取扫描包下所有.class 文件"></a>2. 获取扫描包下所有.class 文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.lzwapplicationcontext.LzwApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * LzwSpringApplicationContext 类的作用类似Spring原生ioc容器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LzwSpringApplicationContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Class configClass;</span><br><span class="line">    <span class="comment">//ioc 存放的就是通过反射创建的对象（基于注解方式）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Object&gt; ioc = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();<span class="comment">//singletonObjects</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LzwSpringApplicationContext</span><span class="params">(Class configClass)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.configClass = configClass;</span><br><span class="line">        <span class="comment">//System.out.println(&quot;this.configClass = &quot; + this.configClass);</span></span><br><span class="line">        <span class="comment">//获取要扫描的包</span></span><br><span class="line">        <span class="comment">//1. 先得到 LzwSpringConfig 配置的 @ComponentScan(value = &quot;com.lzw.spring.component&quot;)</span></span><br><span class="line">        <span class="type">ComponentScan</span> <span class="variable">componentScan</span> <span class="operator">=</span> (ComponentScan)<span class="built_in">this</span>.configClass.getDeclaredAnnotation(ComponentScan.class);</span><br><span class="line">        <span class="comment">//2. 通过 componentScan的value =&gt; 即要扫描的包</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> componentScan.value();</span><br><span class="line">        System.out.println(<span class="string">&quot;要扫描的包 = &quot;</span> + path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到要扫描的包下的所有资源(.class)</span></span><br><span class="line">        <span class="comment">//1. 先得到类的加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> LzwApplicationContext.class.getClassLoader();</span><br><span class="line">        <span class="comment">//2. 通过类的加载器获取到要扫描的包的资源 url 类似路径</span></span><br><span class="line">        path = path.replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;/&quot;</span>);<span class="comment">//一定要把 .  替换为 /</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">resource</span> <span class="operator">=</span> classLoader.getResource(path);</span><br><span class="line">        <span class="comment">//System.out.println(&quot;resource = &quot; + resource);</span></span><br><span class="line">        <span class="comment">//3. 将要加载的资源(.class) 路径下的文件进行遍历 =&gt; io</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(resource.getFile());</span><br><span class="line">        <span class="keyword">if</span>(file.isDirectory())&#123;</span><br><span class="line">            File[] files = file.listFiles();</span><br><span class="line">            <span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;===================&quot;</span>);</span><br><span class="line">                System.out.println(f.getAbsolutePath());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-获取全类名-反射对象-放入容器"><a href="#3-获取全类名-反射对象-放入容器" class="headerlink" title="3.  获取全类名 反射对象 放入容器"></a>3.  获取全类名 反射对象 放入容器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.lzwapplicationcontext.LzwApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * LzwSpringApplicationContext 类的作用类似Spring原生ioc容器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LzwSpringApplicationContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Class configClass;</span><br><span class="line">    <span class="comment">//ioc 存放的就是通过反射创建的对象（基于注解方式）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Object&gt; ioc = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();<span class="comment">//singletonObjects</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LzwSpringApplicationContext</span><span class="params">(Class configClass)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.configClass = configClass;</span><br><span class="line">        <span class="comment">//System.out.println(&quot;this.configClass = &quot; + this.configClass);</span></span><br><span class="line">        <span class="comment">//获取要扫描的包</span></span><br><span class="line">        <span class="comment">//1. 先得到 LzwSpringConfig 配置的 @ComponentScan(value = &quot;com.lzw.spring.component&quot;)</span></span><br><span class="line">        <span class="type">ComponentScan</span> <span class="variable">componentScan</span> <span class="operator">=</span> (ComponentScan)<span class="built_in">this</span>.configClass.getDeclaredAnnotation(ComponentScan.class);</span><br><span class="line">        <span class="comment">//2. 通过 componentScan的value =&gt; 即要扫描的包</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> componentScan.value();</span><br><span class="line">        System.out.println(<span class="string">&quot;要扫描的包 = &quot;</span> + path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到要扫描的包下的所有资源(.class)</span></span><br><span class="line">        <span class="comment">//1. 先得到类的加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> LzwApplicationContext.class.getClassLoader();</span><br><span class="line">        <span class="comment">//2. 通过类的加载器获取到要扫描的包的资源 url 类似路径</span></span><br><span class="line">        path = path.replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;/&quot;</span>);<span class="comment">//一定要把 .  替换为 /</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">resource</span> <span class="operator">=</span> classLoader.getResource(path);</span><br><span class="line">        <span class="comment">//System.out.println(&quot;resource = &quot; + resource);</span></span><br><span class="line">        <span class="comment">//3. 将要加载的资源(.class) 路径下的文件进行遍历 =&gt; io</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(resource.getFile());</span><br><span class="line">        <span class="keyword">if</span>(file.isDirectory())&#123;</span><br><span class="line">            File[] files = file.listFiles();</span><br><span class="line">            <span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">                <span class="comment">//System.out.println(&quot;===================&quot;);</span></span><br><span class="line">                <span class="comment">//System.out.println(f.getAbsolutePath());</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//E:\VIP\AllDemo\Spring5\spring\out\production\spring\com\lzw\spring\component\MyComponent.class</span></span><br><span class="line">                <span class="comment">//获取到 com.lzw.spring.component.MyComponent</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">fileAbsolutePath</span> <span class="operator">=</span> f.getAbsolutePath();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//这里我们只处理 .class文件</span></span><br><span class="line">                <span class="keyword">if</span>(fileAbsolutePath.endsWith(<span class="string">&quot;.class&quot;</span>)) &#123;</span><br><span class="line">                    <span class="comment">//1. 获取到类名</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> fileAbsolutePath.substring(fileAbsolutePath.lastIndexOf(<span class="string">&quot;\\&quot;</span>) + <span class="number">1</span>, fileAbsolutePath.indexOf(<span class="string">&quot;.class&quot;</span>));</span><br><span class="line">                    <span class="comment">//System.out.println(&quot;className = &quot; + className);</span></span><br><span class="line">                    <span class="comment">//2. 获取类的完整路径（全类名）</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">classFullName</span> <span class="operator">=</span> path.replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>) + <span class="string">&quot;.&quot;</span> + className;</span><br><span class="line">                    <span class="comment">//System.out.println(&quot;classFullName = &quot; + classFullName);</span></span><br><span class="line">                    <span class="comment">//3. 判断该类是不是需要注入容器, 就看该类是不是有注解 @Component @Service..</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">//这时，我们就得到了该类的 Class对象</span></span><br><span class="line">                        <span class="comment">//Class.forName(classFullName)。forName()获得完整类的信息，loadClass()轻量级。</span></span><br><span class="line">                        <span class="comment">//1. Class clazz = Class.forName(classFullName) 可以反射加载类</span></span><br><span class="line">                        <span class="comment">//2. classLoader.loadClass(classFullName); 可以反射类的Class</span></span><br><span class="line">                        <span class="comment">//3. 区别是 : (1)方式会调用该类的静态方法, (2)方法不会</span></span><br><span class="line">                        <span class="comment">//4. aClass.isAnnotationPresent(Component.class) 判断该类是否有 @Component</span></span><br><span class="line">                        Class&lt;?&gt; aClass = classLoader.loadClass(classFullName);</span><br><span class="line">                        <span class="keyword">if</span>(aClass.isAnnotationPresent(Component.class) || aClass.isAnnotationPresent(Controller.class)</span><br><span class="line">                                || aClass.isAnnotationPresent(Service.class)||aClass.isAnnotationPresent(Repository.class))&#123;</span><br><span class="line">                            <span class="comment">//这时就可以反射对象，并放入到容器中</span></span><br><span class="line">                            Class&lt;?&gt; clazz = Class.forName(classFullName);</span><br><span class="line">                            <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line">                            <span class="comment">//放入到容器中，将类名的首字母小写作为id</span></span><br><span class="line"></span><br><span class="line">                            ioc.put(StringUtils.uncapitalize(className),instance);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//编写方法返回对容器中对象</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ioc.get(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.component.MyComponent;</span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.component.UserAction;</span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.component.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.component.UserService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LzwSpringApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LzwSpringApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LzwSpringApplicationContext</span>(LzwSpringConfig.class);</span><br><span class="line">        <span class="type">UserAction</span> <span class="variable">userAction</span> <span class="operator">=</span> (UserAction) ioc.getBean(<span class="string">&quot;userAction&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userAction&quot;</span> + userAction);</span><br><span class="line">        <span class="type">MyComponent</span> <span class="variable">myComponent</span> <span class="operator">=</span> (MyComponent) ioc.getBean(<span class="string">&quot;myComponent&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;myComponent&quot;</span> + myComponent);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) ioc.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userService=&quot;</span> + userService);</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> (UserDao) ioc.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userDao=&quot;</span> + userDao);</span><br><span class="line">        System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609102334694.png" alt="image-20220609102334694"></p>
<h4 id="注意事项和细节说明-1"><a href="#注意事项和细节说明-1" class="headerlink" title="注意事项和细节说明"></a>注意事项和细节说明</h4><p>​		还可以通过@Component(value &#x3D; “xx”) @Controller(value &#x3D; “yy”) @Service(value &#x3D; “zz”) 中指定的 value，给 bean 分配 id。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(fileAbsolutePath.endsWith(<span class="string">&quot;.class&quot;</span>)) &#123;</span><br><span class="line">                   <span class="comment">//1. 获取到类名</span></span><br><span class="line">                   <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> fileAbsolutePath.substring(fileAbsolutePath.lastIndexOf(<span class="string">&quot;\\&quot;</span>) + <span class="number">1</span>, fileAbsolutePath.indexOf(<span class="string">&quot;.class&quot;</span>));</span><br><span class="line">                   <span class="comment">//System.out.println(&quot;className = &quot; + className);</span></span><br><span class="line">                   <span class="comment">//2. 获取类的完整路径（全类名）</span></span><br><span class="line">                   <span class="type">String</span> <span class="variable">classFullName</span> <span class="operator">=</span> path.replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>) + <span class="string">&quot;.&quot;</span> + className;</span><br><span class="line">                   <span class="comment">//System.out.println(&quot;classFullName = &quot; + classFullName);</span></span><br><span class="line">                   <span class="comment">//3. 判断该类是不是需要注入容器, 就看该类是不是有注解 @Component @Service..</span></span><br><span class="line">                   <span class="keyword">try</span> &#123;</span><br><span class="line">                       <span class="comment">//这时，我们就得到了该类的 Class对象</span></span><br><span class="line">                       <span class="comment">//Class.forName(classFullName)。forName()获得完整类的信息，loadClass()轻量级。</span></span><br><span class="line">                       <span class="comment">//1. Class clazz = Class.forName(classFullName) 可以反射加载类</span></span><br><span class="line">                       <span class="comment">//2. classLoader.loadClass(classFullName); 可以反射类的Class</span></span><br><span class="line">                       <span class="comment">//3. 区别是 : (1)方式会调用该类的静态方法, (2)方法不会</span></span><br><span class="line">                       <span class="comment">//4. aClass.isAnnotationPresent(Component.class) 判断该类是否有 @Component</span></span><br><span class="line">                       Class&lt;?&gt; aClass = classLoader.loadClass(classFullName);</span><br><span class="line">                       <span class="keyword">if</span>(aClass.isAnnotationPresent(Component.class) || aClass.isAnnotationPresent(Controller.class)</span><br><span class="line">                               || aClass.isAnnotationPresent(Service.class)||aClass.isAnnotationPresent(Repository.class))&#123;</span><br><span class="line"></span><br><span class="line">                           <span class="comment">//演示一个Component注解指定value，分配id</span></span><br><span class="line">                           <span class="keyword">if</span>(aClass.isAnnotationPresent(Component.class))&#123;</span><br><span class="line">                               <span class="comment">//获取到该注解</span></span><br><span class="line">                               <span class="type">Component</span> <span class="variable">component</span> <span class="operator">=</span> aClass.getDeclaredAnnotation(Component.class);</span><br><span class="line">                               <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> component.value();</span><br><span class="line">                               <span class="keyword">if</span>(!<span class="string">&quot;&quot;</span>.endsWith(id))&#123;</span><br><span class="line">                                   className = id;<span class="comment">//替换</span></span><br><span class="line">                               &#125;</span><br><span class="line">                           &#125;</span><br><span class="line"></span><br><span class="line">                           <span class="comment">//这时就可以反射对象，并放入到容器中</span></span><br><span class="line">                           Class&lt;?&gt; clazz = Class.forName(classFullName);</span><br><span class="line">                           <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line">                           <span class="comment">//放入到容器中，将类名的首字母小写作为id</span></span><br><span class="line"></span><br><span class="line">                           ioc.put(StringUtils.uncapitalize(className),instance);</span><br><span class="line">                       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                   &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                       e.printStackTrace();</span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line">               &#125;</span><br></pre></td></tr></table></figure>

<h3 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h3><h4 id="AutoWired"><a href="#AutoWired" class="headerlink" title="@AutoWired"></a>@AutoWired</h4><ol>
<li><p>基于注解配置 bean，也可实现自动装配，使用的注解是：@AutoWired 或者 @Resource。</p>
</li>
<li><p>@AutoWired 的规则说明</p>
<p>（1）在 IOC 容器中查找待装配的组件的类型，如果有唯一的 bean 匹配，则使用该 bean 装配</p>
<p>（2）如果待装配的类型对应的 bean 在 IOC 容器中有多个，则使用待装配的属性的属性名作为 id 值再进行查找，找到就装配，找不到就抛异常。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Service</span> 标识该类是一个Service类/对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hi</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserService hi()~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Controller</span> 标识该类是一个控制器Controller, 通常这个类是一个Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAction</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService200;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayOk</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserAction 的sayOK()&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userAction 装配的 userService属性=&quot;</span> + userService200);</span><br><span class="line">        userService200.hi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.component&quot;</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--配置两个UserService对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.component.UserService&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userService200&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;bean class=&quot;com.lzw.spring.component.UserService&quot; id=&quot;userService300&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过注解来配置Bean</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProByAutowired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans06.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;ioc容器中的userService=&quot;</span> + userService);</span><br><span class="line"></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService200</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;userService200&quot;</span>, UserService.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;ioc容器中的userService200=&quot;</span> + userService200);</span><br><span class="line">        <span class="type">UserAction</span> <span class="variable">userAction</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;userAction&quot;</span>, UserAction.class);</span><br><span class="line">        <span class="comment">//System.out.println(&quot;userAction=&quot; + userAction);</span></span><br><span class="line">        userAction.sayOk();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220614221321789.png" alt="image-20220614221321789"></p>
<h4 id="Resource"><a href="#Resource" class="headerlink" title="@Resource"></a>@Resource</h4><ol start="3">
<li><p>@Resource 的规则说明</p>
<p>（1）@Resource 有两个属性是比较重要的，分是 name 和 type，Spring 将@Resource 注解的 name 属性解析为 bean 的名字，而 type 属性则解析为 bean 的类型。所以如果使用 name 属性，则使用 byName 的自动注入策略，而使用 type 属性时则使用 byType 自动注入策略。</p>
<p>（2）如果@Resource 没有指定 name 和 type，则先使用byName注入策略，如果匹配不上，再使用 byType 策略，如果都不成功，就会报错。</p>
<p>（3）如果@Resource 指定type，并且对应的 bean 在 IOC 容器中有多个，则会继续使用待装配的属性的属性名作为 id 值进行查找，找到就装配，找不到就抛异常。</p>
</li>
<li><p>建议：不管是@Autowired 还是 @Resource 都保证属性名是规范的写法就可以注入。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Controller</span> 标识该类是一个控制器Controller, 通常这个类是一个Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAction</span> &#123;</span><br><span class="line">    <span class="comment">// @Resource(name = &quot;userService&quot;) 表示装配id=userService的对象</span></span><br><span class="line">    <span class="comment">//@Resource(name = &quot;userService200&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// @Resource(type = UserService.class) 表示按照 UserService类型进行装配，这时要求容器中只能有一个这样类型的对象</span></span><br><span class="line">    <span class="comment">//@Resource(type = UserService.class)</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService200;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayOk</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserAction 的sayOK()&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userAction 装配的 userService属性=&quot;</span> + userService200);</span><br><span class="line">        userService200.hi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.component&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置两个UserService对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.component.UserService&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userService200&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;bean class=&quot;com.lzw.spring.component.UserService&quot; id=&quot;userService300&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过注解来配置Bean</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProByAutowired</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans06.xml&quot;</span>);</span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;ioc容器中的userService=&quot;</span> + userService);</span><br><span class="line"></span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService200</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;userService200&quot;</span>, UserService.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;ioc容器中的userService200=&quot;</span> + userService200);</span><br><span class="line">    <span class="type">UserAction</span> <span class="variable">userAction</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;userAction&quot;</span>, UserAction.class);</span><br><span class="line">    <span class="comment">//System.out.println(&quot;userAction=&quot; + userAction);</span></span><br><span class="line">    userAction.sayOk();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220614222835992.png" alt="image-20220614222835992"></p>
<h4 id="Autowired-和-Qualifier组合"><a href="#Autowired-和-Qualifier组合" class="headerlink" title="@Autowired 和 @Qualifier组合"></a>@Autowired 和 @Qualifier组合</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Controller</span> 标识该类是一个控制器Controller, 通常这个类是一个Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAction</span> &#123;</span><br><span class="line">    <span class="comment">//指定id进行组装, 也可以使用@Autowired 和 @Qualifier(value = &quot;userService200&quot;)</span></span><br><span class="line">    <span class="comment">//这时，是装配的 id=userService200 , 需要两个注解都需要写上</span></span><br><span class="line">    <span class="comment">//等价于 @Resource(name = &quot;userService200&quot;)</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(value = &quot;userService200&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayOk</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserAction 的sayOK()&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userAction 装配的 userService属性=&quot;</span> + userService);</span><br><span class="line">        userService.hi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220614223140240.png" alt="image-20220614223140240"></p>
<h3 id="泛型依赖注入"><a href="#泛型依赖注入" class="headerlink" title="泛型依赖注入"></a>泛型依赖注入</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><ol>
<li>为了更好的管理有继承和相互依赖的 bean 的自动装配，spring 还提供基于泛型依赖的注入机制 。</li>
<li>在继承关系复杂情况下，泛型依赖注入就会有很大的优越性。</li>
</ol>
<h4 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h4><h5 id="各个类关系图"><a href="#各个类关系图" class="headerlink" title="各个类关系图"></a>各个类关系图</h5><img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220609144836871.png" alt="image-20220609144836871" style="zoom:80%;" />

<p>​		传统方法是将 PhoneDao &#x2F;BookDao 自动装配到 BookService&#x2F;PhoneSerive 中，当这种继承关系多时，就比较麻烦，可以使用 spring 提供的泛型依赖注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.depinjection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.depinjection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Phone</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Dao层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.depinjection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 自定义泛型类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseDao</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=====================================================</span></span><br><span class="line"><span class="keyword">package</span> com.lzw.spring.depinjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDao</span> <span class="keyword">extends</span> <span class="title class_">BaseDao</span>&lt;Book&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDao 的 save()..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=====================================================</span></span><br><span class="line"><span class="keyword">package</span> com.lzw.spring.depinjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhoneDao</span> <span class="keyword">extends</span> <span class="title class_">BaseDao</span>&lt;Phone&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;PhoneDao 的 save()..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.depinjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 自定义泛型类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseService</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BaseDao&lt;T&gt; baseDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        baseDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=====================================================</span></span><br><span class="line"><span class="keyword">package</span> com.lzw.spring.depinjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> <span class="keyword">extends</span> <span class="title class_">BaseService</span>&lt;Book&gt; &#123;</span><br><span class="line">    <span class="comment">//并没有写属性</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=====================================================</span></span><br><span class="line"><span class="keyword">package</span> com.lzw.spring.depinjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhoneService</span> <span class="keyword">extends</span> <span class="title class_">BaseService</span>&lt;Phone&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.depinjection&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过泛型依赖来配置Bean</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProByDependencyInjection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans07.xml&quot;</span>);</span><br><span class="line">        <span class="type">PhoneService</span> <span class="variable">phoneService</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;phoneService&quot;</span>, PhoneService.class);</span><br><span class="line">        phoneService.save();</span><br><span class="line">        System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220615095233033.png" alt="image-20220615095233033"></p>
<hr>


<h1 id="第三章-AOP"><a href="#第三章-AOP" class="headerlink" title="第三章 AOP"></a>第三章 AOP</h1><h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p>​		AOP 讲解：spring-framework-5.3.8&#x2F;docs&#x2F;reference&#x2F;html&#x2F;core.html#aop </p>
<p>​		AOP API：spring-framework-5.3.8&#x2F;docs&#x2F;javadoc-api&#x2F;index.html</p>
<h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><h3 id="需求说明-3"><a href="#需求说明-3" class="headerlink" title="需求说明"></a>需求说明</h3><ol>
<li>有 Vehicle(交通工具接口，有一个 run 方法)，下面有两个实现类 Car 和 Ship 。</li>
<li>当运行 Car 对象 的 run 方法和 Ship 对象的 run 方法时，输入如下内容, 注意观察前后 有统一的输出。</li>
</ol>
<h3 id="解决方案-传统方式"><a href="#解决方案-传统方式" class="headerlink" title="解决方案-传统方式"></a>解决方案-传统方式</h3><h5 id="代码实现-14"><a href="#代码实现-14" class="headerlink" title="代码实现"></a>代码实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.proxy2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 接口，该接口有run方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=====================================================</span></span><br><span class="line"><span class="keyword">package</span> com.lzw.spring.proxy2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;交通工具开始运行了....&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;小汽车在路上 running....&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;交通工具停止运行了....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=====================================================</span></span><br><span class="line"><span class="keyword">package</span> com.lzw.spring.proxy2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ship</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;交通工具开始运行了....&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;大轮船在水上 running....&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;交通工具停止运行了....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.proxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestVehicle</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">ship</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ship</span>();</span><br><span class="line">        ship.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><p>​		代码冗余，其实就是单个对象的调用，并没有很好的解决。</p>
<h3 id="解决方案-动态代理方式"><a href="#解决方案-动态代理方式" class="headerlink" title="解决方案-动态代理方式!!!!!"></a>解决方案-动态代理方式!!!!!</h3><h4 id="代码实现-15"><a href="#代码实现-15" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.proxy2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//System.out.println(&quot;交通工具开始运行了....&quot;);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;小汽车在路上 running....&quot;</span>);</span><br><span class="line">        <span class="comment">//System.out.println(&quot;交通工具停止运行了....&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.proxy2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ship</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//System.out.println(&quot;交通工具开始运行了....&quot;);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;大轮船在水上 running....&quot;</span>);</span><br><span class="line">        <span class="comment">//System.out.println(&quot;交通工具停止运行了....&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.proxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * VehicleProxyProvider 该类可以返回一个代理对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VehicleProxyProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个属性</span></span><br><span class="line">    <span class="comment">//target_vehicle 表示真正要执行的对象，</span></span><br><span class="line">    <span class="comment">//该对象的类实现了Vehicle接口</span></span><br><span class="line">    <span class="keyword">private</span> Vehicle target_vehicle;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VehicleProxyProvider</span><span class="params">(Vehicle target_vehicle)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target_vehicle = target_vehicle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//编写一个方法，可以返回一个代理对象</span></span><br><span class="line">    <span class="comment">//1.这个方法非常重要，理解有一定难度</span></span><br><span class="line">    <span class="keyword">public</span> Vehicle <span class="title function_">getProxy</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> target_vehicle.getClass().getClassLoader();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到要代理的对象/被执行对象 的接口信息,底层是通过接口来完成调用</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = target_vehicle.getClass().getInterfaces();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建InvocationHandler 对象</span></span><br><span class="line">        <span class="comment">//因为 InvocationHandler 是接口，所以我们可以通过匿名对象的方式来创建该对象</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * public interface InvocationHandler &#123;</span></span><br><span class="line"><span class="comment">         *  public Object invoke(Object proxy, Method method, Object[] args)</span></span><br><span class="line"><span class="comment">         *         throws Throwable;</span></span><br><span class="line"><span class="comment">         * &#125;</span></span><br><span class="line"><span class="comment">         * invoke 方法是将来执行我们的target_vehicle的方法时，会调用到</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * invoke 方法是将来执行我们的target_vehicle的方法时，会调用到</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> o 表示代理对象</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method 就是通过代理对象调用方法时，的哪个方法 代理对象.run()</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> args : 表示调用 代理对象.run(xx) 传入的参数</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> 表示 代理对象.run(xx) 执行后的结果.</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object o, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;交通工具开始运行了....&quot;</span>);</span><br><span class="line">                <span class="comment">//method 是：public abstract void com.lzw.spring.proxy2.Vehicle.run()</span></span><br><span class="line">                <span class="comment">//target_vehicle 是：Ship对象</span></span><br><span class="line">                <span class="comment">//args 是null</span></span><br><span class="line">                <span class="comment">//这里通过反射+动态绑定机制，就会执行到被代理对象的方法</span></span><br><span class="line">                <span class="comment">//执行完毕就返回</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target_vehicle, args);</span><br><span class="line">                System.out.println(<span class="string">&quot;交通工具停止运行了....&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            public static Object newProxyInstance(ClassLoader loader,</span></span><br><span class="line"><span class="comment">                                          Class&lt;?&gt;[] interfaces,</span></span><br><span class="line"><span class="comment">                                          InvocationHandler h)</span></span><br><span class="line"><span class="comment">          1. Proxy.newProxyInstance() 可以返回一个代理对象</span></span><br><span class="line"><span class="comment">          2. ClassLoader loader: 类的加载器.</span></span><br><span class="line"><span class="comment">          3. Class&lt;?&gt;[] interfaces 就是将来要代理的对象的接口信息</span></span><br><span class="line"><span class="comment">          4. InvocationHandler h 调用处理器/对象 有一个非常重要的方法invoke</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">proxy</span> <span class="operator">=</span> (Vehicle)Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.proxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestVehicle</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">ship</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ship</span>();</span><br><span class="line">        ship.run();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">proxyRun</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">ship</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ship</span>();</span><br><span class="line">        <span class="comment">//创建VehicleProxyProvider对象, 并且我们传入的要代理的对象</span></span><br><span class="line">        <span class="type">VehicleProxyProvider</span> <span class="variable">vehicleProxyProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VehicleProxyProvider</span>(ship);</span><br><span class="line">        <span class="comment">//获取代理对象，该对象可以代理执行方法</span></span><br><span class="line">        <span class="comment">//1. proxy 编译类型 Vehicle</span></span><br><span class="line">        <span class="comment">//2. 运行类型 是代理类型 class com.sun.proxy.$Proxy9</span></span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">proxy</span> <span class="operator">=</span> vehicleProxyProvider.getProxy();</span><br><span class="line">        System.out.println(<span class="string">&quot;proxy的编译类型是 Vehicle&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;proxy的运行类型是 &quot;</span> + proxy.getClass());</span><br><span class="line">        <span class="comment">//下面家解读怎么 执行到 代理对象的 public Object invoke(Object o, Method method, Object[] args)</span></span><br><span class="line">        <span class="comment">//proxy的编译类型是 Vehicle, 运行类型是 class com.sun.proxy.$Proxy9</span></span><br><span class="line">        <span class="comment">//所以当执行run方法时，会执行到 代理对象的invoke</span></span><br><span class="line">        <span class="comment">//如何体现动态 [1. 被代理的对象 2. 方法]</span></span><br><span class="line">        proxy.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">proxyRun</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">Vehicle</span> <span class="variable">ship</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ship</span>();</span><br><span class="line">       <span class="comment">//创建VehicleProxyProvider对象, 并且我们传入的要代理的对象</span></span><br><span class="line">       <span class="type">VehicleProxyProvider</span> <span class="variable">vehicleProxyProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VehicleProxyProvider</span>(ship);</span><br><span class="line">       <span class="comment">//获取代理对象，该对象可以代理执行方法</span></span><br><span class="line">       <span class="comment">//1. proxy 编译类型 Vehicle</span></span><br><span class="line">       <span class="comment">//2. 运行类型 是代理类型 class com.sun.proxy.$Proxy9</span></span><br><span class="line">       <span class="type">Vehicle</span> <span class="variable">proxy</span> <span class="operator">=</span> vehicleProxyProvider.getProxy();</span><br><span class="line">       System.out.println(<span class="string">&quot;proxy的编译类型是 Vehicle&quot;</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;proxy的运行类型是 &quot;</span> + proxy.getClass());</span><br><span class="line">       <span class="comment">//下面家解读怎么 执行到 代理对象的 public Object invoke(Object o, Method method, Object[] args)</span></span><br><span class="line">       <span class="comment">//proxy的编译类型是 Vehicle, 运行类型是 class com.sun.proxy.$Proxy9</span></span><br><span class="line">       <span class="comment">//所以当执行run方法时，会执行到 代理对象的invoke</span></span><br><span class="line">       proxy.run();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220615102956423.png" alt="image-20220615102956423"></p>
<h2 id="动态代理深入"><a href="#动态代理深入" class="headerlink" title="动态代理深入"></a>动态代理深入</h2><h3 id="需求说明-4"><a href="#需求说明-4" class="headerlink" title="需求说明"></a>需求说明</h3><p>​		有一个 SmartAnimal 接口，可以完成简单的加减法, 要求在执行 getSum()和 getSub() 时，输出执行前，执行过程，执行后的日志输出，请思考如何实现。</p>
<p>getSum()如下，getSub()类似</p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220609162420151.png" alt="image-20220609162420151" style="zoom:80%;" />

<h3 id="传统方式实现"><a href="#传统方式实现" class="headerlink" title="传统方式实现"></a>传统方式实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmartAnimal</span> &#123;</span><br><span class="line">    <span class="type">float</span> <span class="title function_">getSum</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span>;</span><br><span class="line">    <span class="type">float</span> <span class="title function_">getSub</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartDog</span> <span class="keyword">implements</span> <span class="title class_">SmartAnimal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getSum</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;日志--方法名--getSum 方法开始--参数：&quot;</span> + i + <span class="string">&quot;,&quot;</span> + j);</span><br><span class="line">        <span class="type">float</span> <span class="variable">result</span> <span class="operator">=</span> i + j;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法内部打印：result=&quot;</span> + result);</span><br><span class="line">        System.out.println(<span class="string">&quot;日志--方法名--getSum 方法结束--结果：result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getSub</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;日志--方法名--getSub 方法开始--参数：&quot;</span> + i + <span class="string">&quot;,&quot;</span> + j);</span><br><span class="line">        <span class="type">float</span> <span class="variable">result</span> <span class="operator">=</span> i - j;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法内部打印：result=&quot;</span> + result);</span><br><span class="line">        System.out.println(<span class="string">&quot;日志--方法名--getSub 方法结束--结果：result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">smartDogTest</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SmartDog</span> <span class="variable">smartDog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmartDog</span>();</span><br><span class="line">        smartDog.getSum(<span class="number">10.0f</span>,<span class="number">2.0f</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;=================&quot;</span>);</span><br><span class="line">        smartDog.getSub(<span class="number">10.0f</span>,<span class="number">2.0f</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优点：实现简单。缺点：日志代码维护不方便，代码复用性差。</p>
<h3 id="动态代理实现"><a href="#动态代理实现" class="headerlink" title="动态代理实现"></a>动态代理实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartDog</span> <span class="keyword">implements</span> <span class="title class_">SmartAnimal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getSum</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span> &#123;</span><br><span class="line">        <span class="comment">//System.out.println(&quot;日志--方法名--getSum 方法开始--参数：&quot; + i + &quot;,&quot; + j);</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">result</span> <span class="operator">=</span> i + j;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法内部打印：result=&quot;</span> + result);</span><br><span class="line">        <span class="comment">//System.out.println(&quot;日志--方法名--getSum 方法结束--结果：result=&quot; + result);</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getSub</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span> &#123;</span><br><span class="line">        <span class="comment">//System.out.println(&quot;日志--方法名--getSub 方法开始--参数：&quot; + i + &quot;,&quot; + j);</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">result</span> <span class="operator">=</span> i - j;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法内部打印：result=&quot;</span> + result);</span><br><span class="line">        <span class="comment">//System.out.println(&quot;日志--方法名--getSub 方法结束--结果：result=&quot; + result);</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProxyProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义我们要执行的目标对象，该对象需要实现 SmartAnimal</span></span><br><span class="line">    <span class="keyword">private</span> SmartAnimal target_animal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyProxyProvider</span><span class="params">(SmartAnimal target_animal)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target_animal = target_animal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法 可以返回代理对象，该代理对象可以执行目标对象</span></span><br><span class="line">    <span class="keyword">public</span> SmartAnimal <span class="title function_">getProxy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.先得到类加载器/对象</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> target_animal.getClass().getClassLoader();</span><br><span class="line">        <span class="comment">//2.得到执行目标对象的接口信息</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = target_animal.getClass().getInterfaces();</span><br><span class="line">        <span class="comment">//3.创建 InvocationHandler</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object o, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;方法执行前-日志--方法名--&quot;</span>+ method.getName() + <span class="string">&quot; 方法开始--参数：&quot;</span> + Arrays.asList(args));</span><br><span class="line">                    result = method.invoke(target_animal, args);</span><br><span class="line">                    <span class="comment">//从AOP看，也是一个横切关注点-返回通知</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;方法执行正常后-日志--方法名--&quot;</span>+ method.getName() + <span class="string">&quot; 方法结束--结果：result=&quot;</span> + result);</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    <span class="comment">//如果反射执行方法时，出现异常，就会进入到catch&#123;&#125;</span></span><br><span class="line">                    <span class="comment">//从AOP看，也是一个横切关注点-异常通知</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;方法执行异常-日志--方法名--&quot;</span> + method.getName() + <span class="string">&quot;-异常类型=&quot;</span> + e.getClass().getName());</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;<span class="comment">//不管是否出现异常，最终都会执行到finally&#123;&#125;</span></span><br><span class="line">                    <span class="comment">//从AOP角度看，也是一个横切关注点-最终通知</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;日志--方法名：&quot;</span> + method.getName() + <span class="string">&quot;--方法最终结束&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建代理对象</span></span><br><span class="line">        <span class="type">SmartAnimal</span> <span class="variable">proxy</span> <span class="operator">=</span> (SmartAnimal)Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">smartDogTestByProxy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SmartDog</span> <span class="variable">smartDog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmartDog</span>();</span><br><span class="line">        <span class="type">MyProxyProvider</span> <span class="variable">myProxyProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyProxyProvider</span>(smartDog);</span><br><span class="line">        <span class="type">SmartAnimal</span> <span class="variable">proxy</span> <span class="operator">=</span> myProxyProvider.getProxy();</span><br><span class="line">        <span class="type">float</span> <span class="variable">sum</span> <span class="operator">=</span> proxy.getSum(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;==========================================&quot;</span>);</span><br><span class="line">        proxy.getSub(<span class="number">10</span>,<span class="number">2</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609165941755.png" alt="image-20220609165941755"></p>
<h2 id="问题再次出现"><a href="#问题再次出现" class="headerlink" title="问题再次出现"></a>问题再次出现</h2><h3 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h3><p>​		在 MyProxyProvider.java 中，我们的输出语句功能比较弱，在实际开发中，我们希望是以一个方法的形式，嵌入到真正执行的目标方法前，怎么办?</p>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220609170233458.png" alt="image-20220609170233458" style="zoom:80%;" />

<h3 id="土方法解决"><a href="#土方法解决" class="headerlink" title="土方法解决"></a>土方法解决</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.proxy3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProxyProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义我们要执行的目标对象，该对象需要实现 SmartAnimal</span></span><br><span class="line">    <span class="keyword">private</span> SmartAnimal target_animal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyProxyProvider</span><span class="params">(SmartAnimal target_animal)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target_animal = target_animal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//我们自己定义一个方法，在目标对象执行前执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Object proxy, Method method, Object[] args)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before-方法执行前-日志--方法名--&quot;</span>+ method.getName() + <span class="string">&quot; 方法开始--参数：&quot;</span> + Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//我们自己定义一个方法，在目标对象执行后执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(Method method, Object result)</span>&#123;</span><br><span class="line">        <span class="comment">//从AOP看，也是一个横切关注点-返回通知</span></span><br><span class="line">        System.out.println(<span class="string">&quot;after-方法执行正常后-日志--方法名--&quot;</span>+ method.getName() + <span class="string">&quot; 方法结束--结果：result=&quot;</span> + result);    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法 可以返回代理对象，该代理对象可以执行目标对象</span></span><br><span class="line">    <span class="keyword">public</span> SmartAnimal <span class="title function_">getProxy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.先得到类加载器/对象</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> target_animal.getClass().getClassLoader();</span><br><span class="line">        <span class="comment">//2.得到执行目标对象的接口信息</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = target_animal.getClass().getInterfaces();</span><br><span class="line">        <span class="comment">//3.创建 InvocationHandler</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    before(proxy, method, args);</span><br><span class="line">                    result = method.invoke(target_animal, args);</span><br><span class="line">                    after(method,result);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    <span class="comment">//如果反射执行方法时，出现异常，就会进入到catch&#123;&#125;</span></span><br><span class="line">                    <span class="comment">//从AOP看，也是一个横切关注点-异常通知</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;方法执行异常-日志--方法名--&quot;</span> + method.getName() + <span class="string">&quot;-异常类型=&quot;</span> + e.getClass().getName());</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;<span class="comment">//不管是否出现异常，最终都会执行到finally&#123;&#125;</span></span><br><span class="line">                    <span class="comment">//从AOP角度看，也是一个横切关注点-最终通知</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;日志--方法名：&quot;</span> + method.getName() + <span class="string">&quot;--方法最终结束&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//创建代理对象</span></span><br><span class="line">        <span class="type">SmartAnimal</span> <span class="variable">proxy</span> <span class="operator">=</span> (SmartAnimal)Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>问题：耦合度高</p>
<h3 id="对土方法解耦-开发简易的AOP类"><a href="#对土方法解耦-开发简易的AOP类" class="headerlink" title="对土方法解耦-开发简易的AOP类"></a>对土方法解耦-开发简易的AOP类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.proxy3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 我们自己编写一个极简的AOP类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LzwAOP</span> &#123;</span><br><span class="line">    <span class="comment">//我们自己定义一个方法，在目标对象执行前执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Object proxy, Method method, Object[] args)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;LzwAOP-方法执行前-日志--方法名--&quot;</span>+ method.getName() + <span class="string">&quot; 方法开始--参数：&quot;</span> + Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//我们自己定义一个方法，在目标对象执行后执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(Method method, Object result)</span>&#123;</span><br><span class="line">        <span class="comment">//从AOP看，也是一个横切关注点-返回通知</span></span><br><span class="line">        System.out.println(<span class="string">&quot;LzwAOP-方法执行正常后-日志--方法名--&quot;</span>+ method.getName() + <span class="string">&quot; 方法结束--结果：result=&quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.proxy3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 2022/6/9 16:29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProxyProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义我们要执行的目标对象，该对象需要实现 SmartAnimal</span></span><br><span class="line">    <span class="keyword">private</span> SmartAnimal target_animal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyProxyProvider</span><span class="params">(SmartAnimal target_animal)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target_animal = target_animal;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法 可以返回代理对象，该代理对象可以执行目标对象</span></span><br><span class="line">    <span class="keyword">public</span> SmartAnimal <span class="title function_">getProxy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.先得到类加载器/对象</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> target_animal.getClass().getClassLoader();</span><br><span class="line">        <span class="comment">//2.得到执行目标对象的接口信息</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = target_animal.getClass().getInterfaces();</span><br><span class="line">        <span class="comment">//3.创建 InvocationHandler</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    LzwAOP.before(proxy, method, args);</span><br><span class="line">                    result = method.invoke(target_animal, args);</span><br><span class="line">                    LzwAOP.after(method,result);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    <span class="comment">//如果反射执行方法时，出现异常，就会进入到catch&#123;&#125;</span></span><br><span class="line">                    <span class="comment">//从AOP看，也是一个横切关注点-异常通知</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;方法执行异常-日志--方法名--&quot;</span> + method.getName() + <span class="string">&quot;-异常类型=&quot;</span> + e.getClass().getName());</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;<span class="comment">//不管是否出现异常，最终都会执行到finally&#123;&#125;</span></span><br><span class="line">                    <span class="comment">//从AOP角度看，也是一个横切关注点-最终通知</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;日志--方法名：&quot;</span> + method.getName() + <span class="string">&quot;--方法最终结束&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//创建代理对象</span></span><br><span class="line">        <span class="type">SmartAnimal</span> <span class="variable">proxy</span> <span class="operator">=</span> (SmartAnimal)Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609181633378.png" alt="image-20220609181633378"></p>
<p>问题：土方法：不够灵活，复用性差，还是一种硬编码（因为没有注解和反射支撑）</p>
<h2 id="AOP的基本介绍"><a href="#AOP的基本介绍" class="headerlink" title="AOP的基本介绍"></a>AOP的基本介绍</h2><p>​		AOP 的全称(aspect oriented programming) ，面向切面编程。</p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609182308637.png" alt="image-20220609182308637"></p>
<h2 id="AOP的快速入门"><a href="#AOP的快速入门" class="headerlink" title="AOP的快速入门"></a>AOP的快速入门</h2><h3 id="说明-7"><a href="#说明-7" class="headerlink" title="说明"></a>说明</h3><ol>
<li><p>需要引入核心的aspect包。</p>
</li>
<li><p>在切面类中声明通知方法</p>
</li>
</ol>
<p>（1）前置通知：**@Before<strong>（2）返回通知：</strong>@AfterReturning<strong>（3）异常通知：</strong>@AfterThrowing<strong>（4）后置通知：</strong>@After<strong>（5）环绕通知：</strong>@Around**</p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609200915310.png" alt="image-20220609200915310"></p>
<h3 id="代码实现-16"><a href="#代码实现-16" class="headerlink" title="代码实现"></a>代码实现</h3><p>​		导入需要的包.</p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609201157564.png" alt="image-20220609201157564"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmartAnimal</span> &#123;</span><br><span class="line">    <span class="type">float</span> <span class="title function_">getSum</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span>;</span><br><span class="line">    <span class="type">float</span> <span class="title function_">getSub</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.aop.proxy3.SmartAnimal;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//使用@Component 当spring容器启动时，将SmartDog注入到容器中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartDog</span> <span class="keyword">implements</span> <span class="title class_">SmartAnimal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getSum</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span> &#123;</span><br><span class="line">        <span class="type">float</span> <span class="variable">result</span> <span class="operator">=</span> i + j;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法内部打印：result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getSub</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span> &#123;</span><br><span class="line">        <span class="type">float</span> <span class="variable">result</span> <span class="operator">=</span> i - j;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法内部打印：result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​		下面的SmartAnimalAspect作用就是接管切面编程，此时原来的MyProxyProvider类就可以拿掉了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 切面类，类似于以前自己写的 MyProxyProvider，功能肯定强大很多</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//表示是一个切面类[底层切面编程的支撑(动态代理+反射+动态绑定)]</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//会注入SmartAnimalAspect到容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartAnimalAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//希望将f1方法切入到 SmartDog-getSum()前执行-前置通知</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. <span class="doctag">@Before</span> 表示前置通知：即在我们的目标对象执行方法前执行</span></span><br><span class="line"><span class="comment">     * 2. value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float)</span></span><br><span class="line"><span class="comment">     * 指定切入到哪个类的哪个方法  形式是: 访问修饰符 返回类型 全类名.方法名(形参列表)</span></span><br><span class="line"><span class="comment">     * 3. showBeginLog方法可以理解成就是一个切入方法, 这个方法名是可以程序员指定  比如:showBeginLog</span></span><br><span class="line"><span class="comment">     * 4. JoinPoint joinPoint 在底层执行时，由AspectJ切面框架，会给该切入方法传入 joinPoint对象</span></span><br><span class="line"><span class="comment">     * , 通过该对象，程序员可以获取到 相关信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f1</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="comment">//通过连接点对象joinPoint 可以获取方法签名</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;切面类f1()-方法执行前-日志--方法名--&quot;</span>+ signature.getName() + <span class="string">&quot;-参数：&quot;</span> + Arrays.asList(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回通知；即把f2方法切入到目标对象正常执行完毕后的地方</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;切面类f2()-方法执行正常结束-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//异常通知；即把f3方法切入到目标对象方法执行异常的catch&#123;&#125;</span></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f3</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;切面类f3()-方法执行异常-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//最终通知；即把f4方法切入到目标方法执行后(不管是否发生异常，都要执行 finally&#123;&#125;)</span></span><br><span class="line">    <span class="meta">@After(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f4</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;切面类f4()-方法最终执行完毕-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.aop.aspectj&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启基于注解的AOP功能--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspectjTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">smartDogTestByProxy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//得到spring容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans08.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//这里我们需要通过接口类型来获取到注入的SmartDog对象=&gt;就是代理对象</span></span><br><span class="line">        <span class="type">SmartAnimal</span> <span class="variable">smartAnimal</span> <span class="operator">=</span> ioc.getBean(SmartAnimal.class);</span><br><span class="line">        <span class="comment">//SmartDog smartDog = ioc.getBean(SmartDog.class);</span></span><br><span class="line">        smartAnimal.getSum(<span class="number">10</span>,<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//System.out.println(&quot;smartAnimal运行类型：&quot; + smartAnimal.getClass());//class com.sun.proxy.$Proxy17</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="细节说明-3"><a href="#细节说明-3" class="headerlink" title="细节说明"></a>细节说明</h3><ol>
<li><p>关于切面类方法命名可以自己规范一下，比如 showBeginLog()，showSuccessEndLog()，showExceptionLog()，showFinallyEndLog()。</p>
</li>
<li><p>切入表达式的更多配置，比如使用模糊配置。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(value=&quot;execution(* com.lzw.aop.proxy.SmartDog.*(..))&quot;)</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>表示所有访问权限，所有包的下所有有类的所方法，都会被执行该前置通知方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(value=&quot;execution(* *.*(..))&quot;)</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>当 spring 容器开启了 基于注解的AOP功能，我们获取注入的对象，需要以接口的类型来获取，因为你注入的对象.getClass() 已经是代理类型了。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启基于注解的AOP功能--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>当 spring 容器开启了基于注解的 AOP 功能，我们获取注入的对象，也可以通过 id 来获取，但是也要转成接口类型。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">smartDogTestByProxy</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//得到spring容器</span></span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans08.xml&quot;</span>);</span><br><span class="line">       <span class="comment">//这里我们需要通过接口类型来获取到注入的SmartDog对象=&gt;就是代理对象</span></span><br><span class="line">       <span class="type">SmartAnimal</span> <span class="variable">smartAnimal</span> <span class="operator">=</span> (SmartAnimal)ioc.getBean(<span class="string">&quot;smartDog&quot;</span>);<span class="comment">//使用的id获取</span></span><br><span class="line">       smartAnimal.getSum(<span class="number">10</span>,<span class="number">2</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="作业-1"><a href="#作业-1" class="headerlink" title="作业"></a>作业</h3><ol>
<li>有接口 UsbInterface (方法 work) </li>
<li>实现子类 Phone 和 Camera 实现 UsbInterface </li>
<li>请在 SmartAnimalAspect 切面类，写一个方法(可输出日志信息) 等作为前置通知，在 Phone 和 Camera 对象执行 work 方法前调用 </li>
<li>其它返回通知，异常通知，后置通知，也可以加入</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UsbInterface</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//===========================================</span></span><br><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//把Phone对象当做一个组件注入容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Phone</span> <span class="keyword">implements</span> <span class="title class_">UsbInterface</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Phone work()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//===========================================</span></span><br><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Camera</span> <span class="keyword">implements</span> <span class="title class_">UsbInterface</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Camera work()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//表示是一个切面类[底层切面编程的支撑(动态代理+反射+动态绑定)]</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//会注入SmartAnimalAspect到容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartAnimalAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Before(value = &quot;execution(public void com.lzw.spring.aop.aspectj.UsbInterface.work())&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hi</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="comment">//通过连接点对象joinPoint 可以获取方法签名</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;切面类前置通知--日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>beans.xml文件和上述beans08.xml文件相同</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">smartUsbTestByProxy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans08.xml&quot;</span>);</span><br><span class="line">        <span class="type">UsbInterface</span> <span class="variable">phone</span> <span class="operator">=</span> (UsbInterface) ioc.getBean(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">        <span class="type">UsbInterface</span> <span class="variable">camera</span> <span class="operator">=</span> (UsbInterface) ioc.getBean(<span class="string">&quot;camera&quot;</span>);</span><br><span class="line">        phone.work();</span><br><span class="line">        System.out.println(<span class="string">&quot;================&quot;</span>);</span><br><span class="line">        camera.work();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="AOP-切入表达式"><a href="#AOP-切入表达式" class="headerlink" title="AOP-切入表达式"></a>AOP-切入表达式</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>​		通过表达式的方式定位一个或多个具体的连接点。</p>
<h3 id="语法细节"><a href="#语法细节" class="headerlink" title="语法细节"></a>语法细节</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution([权限修饰符] [返回值类型] [简单类名/全类名] [方法名]([参数列表]))</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609213925500.png" alt="image-20220609213925500"></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609214122225.png" alt="image-20220609214122225"></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609214204005.png" alt="image-20220609214204005"></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609214235962.png" alt="image-20220609214235962"></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609214255540.png" alt="image-20220609214255540"></p>
<p>​		在AspectJ中，切入点表达式可以通过过 “&amp;&amp;”、“||”，“!“ 等操作符结合起来。</p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220609214408078.png" alt="image-20220609214408078"></p>
<h3 id="注意事项和细节-1"><a href="#注意事项和细节-1" class="headerlink" title="注意事项和细节"></a>注意事项和细节</h3><ol>
<li>切入表达式也可以指向类的方法，这时切入表达式会对该类&#x2F;对象生效。 </li>
<li>切入表达式也可以指向接口的方法，这时切入表达式会对实现了接口的类&#x2F;对象生效。</li>
<li>切入表达式也可以对没有实现接口的类，进行切入。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Car run()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//表示是一个切面类[底层切面编程的支撑(动态代理+反射+动态绑定)]</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//会注入SmartAnimalAspect到容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartAnimalAspect</span> &#123;</span><br><span class="line">    <span class="comment">//给Car配置一个前置通知</span></span><br><span class="line">    <span class="meta">@Before(value = &quot;execution(public void Car.run())&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">readyRun</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;切面类readyRun--日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans08.xml&quot;</span>);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> ioc.getBean(Car.class);</span><br><span class="line">        <span class="comment">//说明: car对象仍然是代理对象</span></span><br><span class="line">        System.out.println(<span class="string">&quot;car的运行类型=&quot;</span> + car.getClass());<span class="comment">//class com.lzw.spring.aop.aspectj.Car$$EnhancerBySpringCGLIB$$11073d67</span></span><br><span class="line">        car.run();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>动态代理 jdk 的 Proxy 与 Spring 的 CGlib 。<a target="_blank" rel="noopener" href="https://www.cnblogs.com/threeAgePie/p/15832586.html%E3%80%82">https://www.cnblogs.com/threeAgePie/p/15832586.html。</a></li>
</ol>
<p>​	（1）JDK动态代理是面向接口的，只能增强实现类中接口中存在的方法。CGlib是面向父类的，可以增强父类的所有方法。</p>
<p>​	（2）JDK得到的对象是JDK代理对象实例，而CGlib得到的对象是被代理对象的子类。</p>
<h2 id="AOP-JoinPoint"><a href="#AOP-JoinPoint" class="headerlink" title="AOP-JoinPoint"></a>AOP-JoinPoint</h2><p>​		通过 JoinPoint 可以获取到调用方法的签名。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span>&#123; </span><br><span class="line">    joinPoint.getSignature().getName(); <span class="comment">// 获取目标方法名 </span></span><br><span class="line">    joinPoint.getSignature().getDeclaringType().getSimpleName(); <span class="comment">// 获取目标方法所属 类的简单类名 	</span></span><br><span class="line">    joinPoint.getSignature().getDeclaringTypeName(); <span class="comment">// 获取目标方法所属类的类名 </span></span><br><span class="line">    joinPoint.getSignature().getModifiers(); <span class="comment">// 获取目标方法声明类型数字(public、private、 protected)</span></span><br><span class="line">    Object[] args = joinPoint.getArgs(); <span class="comment">// 获取传入目标方法的参数，返回一个数组 </span></span><br><span class="line">    joinPoint.getTarget(); <span class="comment">// 获取被代理的对象 </span></span><br><span class="line">    joinPoint.getThis(); <span class="comment">// 获取代理对象自己</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AOP-返回通知获取结果"><a href="#AOP-返回通知获取结果" class="headerlink" title="AOP-返回通知获取结果"></a>AOP-返回通知获取结果</h2><p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220610083351786.png" alt="image-20220610083351786"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 如果我们希望把目标方法执行的结果，返回给切入方法</span></span><br><span class="line">   <span class="comment">//2. 可以在 @AfterReturning 增加属性 , 比如 returning = &quot;res&quot;</span></span><br><span class="line">   <span class="comment">//3. 同时在切入方法增加 Object res</span></span><br><span class="line">   <span class="comment">//4. 注意: returning = &quot;res&quot; 和 Object res 的 res名字一致</span></span><br><span class="line">   <span class="comment">//@AfterReturning(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;, returning = &quot;res&quot;)</span></span><br><span class="line">   <span class="comment">//使用切入点</span></span><br><span class="line">   <span class="meta">@AfterReturning(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;,</span></span><br><span class="line"><span class="meta">           returning = &quot;res&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showSuccessEndLog</span><span class="params">(JoinPoint joinPoint, Object res)</span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;获取到的结果是：&quot;</span> + res);</span><br><span class="line">       <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">       System.out.println(<span class="string">&quot;切面类f2()-方法执行正常结束-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220610083720255.png" alt="image-20220610083720255"></p>
<h2 id="AOP-异常通知中获取异常"><a href="#AOP-异常通知中获取异常" class="headerlink" title="AOP-异常通知中获取异常"></a>AOP-异常通知中获取异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;,</span></span><br><span class="line"><span class="meta">           throwing = &quot;throwable&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showExceptionLog</span><span class="params">(JoinPoint joinPoint, Throwable throwable)</span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;获取到的异常信息：&quot;</span> + throwable);</span><br><span class="line">       <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">       System.out.println(<span class="string">&quot;切面类f3()-方法执行异常-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220610084244646.png" alt="image-20220610084244646"></p>
<h2 id="AOP-环绕通知【了解】"><a href="#AOP-环绕通知【了解】" class="headerlink" title="AOP-环绕通知【了解】"></a>AOP-环绕通知【了解】</h2><p>​		环绕通知可以完成其它四个通知要做的事情。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 切面类，类似于以前自己写的 MyProxyProvider，功能肯定强大很多</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//表示是一个切面类[底层切面编程的支撑(动态代理+反射+动态绑定)]</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//会注入SmartAnimalAspect2到容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartAnimalAspect2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//演示环绕通知的使用-了解</span></span><br><span class="line">    <span class="comment">//1. @Around: 表示这是一个环绕通知[完成其它四个通知的功能]</span></span><br><span class="line">    <span class="comment">//2. value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float)) 切入点表达式</span></span><br><span class="line">    <span class="comment">//3. doAround 表示要切入的方法 - 调用结构 try-catch-finally</span></span><br><span class="line">    <span class="meta">@Around(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.相当于前置通知完成的事情</span></span><br><span class="line">            Object[] args = joinPoint.getArgs();</span><br><span class="line">            List&lt;Object&gt; argList = Arrays.asList(args);</span><br><span class="line">            System.out.println(<span class="string">&quot;AOP环绕通知[-前置通知]&quot;</span> + methodName + <span class="string">&quot;方法开始了--参数有：&quot;</span> + argList);</span><br><span class="line">            <span class="comment">//在环绕通知中一定要调用joinPoint.proceed()来执行目标方法</span></span><br><span class="line">            result = joinPoint.proceed();</span><br><span class="line">            <span class="comment">//2.相当于返回通知完成的事情</span></span><br><span class="line">            System.out.println(<span class="string">&quot;AOP环绕通知[-返回通知]&quot;</span> + methodName + <span class="string">&quot;方法结束了--结果是：&quot;</span> + result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            <span class="comment">//3.相当于异常通知完成的事情</span></span><br><span class="line">            System.out.println(<span class="string">&quot;AOP环绕通知[-异常通知]&quot;</span> + methodName + <span class="string">&quot;方法抛异常了--异常对象：&quot;</span> + throwable);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//4.相当于最终通知完成的事情</span></span><br><span class="line">            System.out.println(<span class="string">&quot;AOP环绕通知[-后置通知]&quot;</span> + methodName + <span class="string">&quot;方法最终结束了...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDoAround</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">//得到spring容器</span></span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans08.xml&quot;</span>);</span><br><span class="line">       <span class="type">SmartAnimal</span> <span class="variable">smartAnimal</span> <span class="operator">=</span> ioc.getBean(SmartAnimal.class);</span><br><span class="line">       smartAnimal.getSum(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220610085347806.png" alt="image-20220610085347806"></p>
<h2 id="AOP-切入点表达式重用"><a href="#AOP-切入点表达式重用" class="headerlink" title="AOP-切入点表达式重用"></a>AOP-切入点表达式重用</h2><p>​		为了统一管理切入点表达式，可以使用切入点表达式重用技术。</p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220610090550793.png" alt="image-20220610090550793"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 使用切入点表达式重用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//表示是一个切面类[底层切面编程的支撑(动态代理+反射+动态绑定)]</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//会注入SmartAnimalAspect到容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartAnimalAspect</span> &#123;</span><br><span class="line">    <span class="comment">//定义一个切入点，在后面使用时可以直接引用，提高了复用性</span></span><br><span class="line">    <span class="meta">@Pointcut(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mePointCut</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用切入点</span></span><br><span class="line">    <span class="meta">@Before(value = &quot;mePointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showBeginLog</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="comment">//通过连接点对象joinPoint 可以获取方法签名</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;切面类f1()[使用myPointCut()]-方法执行前-日志--方法名--&quot;</span>+ signature.getName() + <span class="string">&quot;-参数：&quot;</span> + Arrays.asList(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用切入点</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;mePointCut()&quot;, returning = &quot;res&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showSuccessEndLog</span><span class="params">(JoinPoint joinPoint, Object res)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取到的结果是：&quot;</span> + res);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;切面类f2()-方法执行正常结束-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用切入点</span></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;mePointCut()&quot;, throwing = &quot;throwable&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showExceptionLog</span><span class="params">(JoinPoint joinPoint, Throwable throwable)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取到的异常信息：&quot;</span> + throwable);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;切面类f3()-方法执行异常-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用切入点</span></span><br><span class="line">    <span class="meta">@After(value = &quot;mePointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showFinallyEndLog</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;切面类f4()-方法最终执行完毕-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AOP-切面优先级问题"><a href="#AOP-切面优先级问题" class="headerlink" title="AOP-切面优先级问题"></a>AOP-切面优先级问题</h2><p>​		如果同一个方法，有多个切面在同一个切入点切入，那么执行的优先级如何控制。</p>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p>​		@order(value&#x3D;n) 来控制 n 值越小，优先级越高。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Order(value = 2)</span><span class="comment">//表示该切面类执行的顺序，value的值越小，优先级越高</span></span><br><span class="line"><span class="meta">@Aspect</span> </span><br><span class="line"><span class="meta">@Component</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartAnimalAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个切入点，在后面使用时可以直接引用，提高了复用性</span></span><br><span class="line">    <span class="meta">@Pointcut(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mePointCut</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(value = &quot;mePointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showBeginLog</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="comment">//通过连接点对象joinPoint 可以获取方法签名</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect-切面类f1()[使用myPointCut()]-方法执行前-日志--方法名--&quot;</span>+ signature.getName() + <span class="string">&quot;-参数：&quot;</span> + Arrays.asList(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;mePointCut()&quot;, returning = &quot;res&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showSuccessEndLog</span><span class="params">(JoinPoint joinPoint, Object res)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取到的结果是：&quot;</span> + res);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect-切面类f2()-方法执行正常结束-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;mePointCut()&quot;, throwing = &quot;throwable&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showExceptionLog</span><span class="params">(JoinPoint joinPoint, Throwable throwable)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取到的异常信息：&quot;</span> + throwable);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect-切面类f3()-方法执行异常-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用切入点</span></span><br><span class="line">    <span class="meta">@After(value = &quot;mePointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showFinallyEndLog</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect-切面类f4()-方法最终执行完毕-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Order(value = 1)</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartAnimalAspect3</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(value = &quot;execution(public float SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showBeginLog</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="comment">//通过连接点对象joinPoint 可以获取方法签名</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect3-切面类f1()-方法执行前-日志--方法名--&quot;</span>+ signature.getName() + <span class="string">&quot;-参数：&quot;</span> + Arrays.asList(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;,</span></span><br><span class="line"><span class="meta">            returning = &quot;res&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showSuccessEndLog</span><span class="params">(JoinPoint joinPoint, Object res)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取到的结果是：&quot;</span> + res);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect3-切面类f2()-方法执行正常结束-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;,</span></span><br><span class="line"><span class="meta">            throwing = &quot;throwable&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showExceptionLog</span><span class="params">(JoinPoint joinPoint, Throwable throwable)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取到的异常信息：&quot;</span> + throwable);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect3-切面类f3()-方法执行异常-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(value = &quot;execution(public float com.lzw.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showFinallyEndLog</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect3-切面类f4()-方法最终执行完毕-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">smartDogTestByProxy</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans08.xml&quot;</span>);</span><br><span class="line">       <span class="type">SmartAnimal</span> <span class="variable">smartAnimal</span> <span class="operator">=</span> ioc.getBean(SmartAnimal.class);</span><br><span class="line">       smartAnimal.getSum(<span class="number">10</span>,<span class="number">2</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220610091829779.png" alt="image-20220610091829779"></p>
<p>​		后执行的，会被先执行的包裹起来。</p>
<h3 id="注意事项和细节说明-2"><a href="#注意事项和细节说明-2" class="headerlink" title="注意事项和细节说明"></a>注意事项和细节说明</h3><ol>
<li>不能理解成：优先级高的每个消息通知都先执行，这个和方法调用机制(和 Filter 过滤器 链式调用类似)。</li>
<li>执行顺序</li>
</ol>
<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220610091958816.png" alt="image-20220610091958816" style="zoom:80%;" />

<h2 id="AOP-基于-XML-配置-AOP"><a href="#AOP-基于-XML-配置-AOP" class="headerlink" title="AOP-基于 XML 配置 AOP"></a>AOP-基于 XML 配置 AOP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.xml;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmartAnimal</span> &#123;</span><br><span class="line">    <span class="type">float</span> <span class="title function_">getSum</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span>;</span><br><span class="line">    <span class="type">float</span> <span class="title function_">getSub</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.xml;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartDog</span> <span class="keyword">implements</span> <span class="title class_">SmartAnimal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getSum</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span> &#123;</span><br><span class="line">        <span class="type">float</span> <span class="variable">result</span> <span class="operator">=</span> i + j;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法内部打印：result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getSub</span><span class="params">(<span class="type">float</span> i, <span class="type">float</span> j)</span> &#123;</span><br><span class="line">        <span class="type">float</span> <span class="variable">result</span> <span class="operator">=</span> i - j;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法内部打印：result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.xml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> * 这是我们开发的一个切面类，不用注解，而是使用XML配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartAnimalAspect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showBeginLog</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="comment">//通过连接点对象joinPoint 可以获取方法签名</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect-XML配置-切面类f1()-方法执行前-日志--方法名--&quot;</span>+ signature.getName() + <span class="string">&quot;-参数：&quot;</span> + Arrays.asList(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showSuccessEndLog</span><span class="params">(JoinPoint joinPoint, Object res)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取到的结果是：&quot;</span> + res);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect-切面类f2()-方法执行正常结束-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showExceptionLog</span><span class="params">(JoinPoint joinPoint, Throwable throwable)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取到的异常信息：&quot;</span> + throwable);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect-切面类f3()-方法执行异常-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showFinallyEndLog</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect-切面类f4()-方法最终执行完毕-日志--方法名--&quot;</span>+ signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--使用XML配置，完成AOP编程--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置一个切面类-bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.aop.xml.SmartAnimalAspect&quot;</span> <span class="attr">id</span>=<span class="string">&quot;smartAnimalAspect&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置一个SmartDog对象-bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.aop.xml.SmartDog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;smartDog&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置切面类, 细节一定要引入 xmlns:aop--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切入点--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;myPointCut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(public float com.lzw.spring.aop.xml.SmartDog.getSum(float, float))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切面的前置，返回, 异常, 最终通知--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;smartAnimalAspect&quot;</span> <span class="attr">order</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置前置通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;showBeginLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointCut&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--返回通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;showSuccessEndLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointCut&quot;</span> <span class="attr">returning</span>=<span class="string">&quot;res&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--异常通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;showExceptionLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointCut&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;throwable&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--最终通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;showFinallyEndLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointCut&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置环绕通知--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;aop:around method=&quot;&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.xml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspectjXMLTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAspectByXML</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans09.xml&quot;</span>);</span><br><span class="line">        <span class="type">SmartAnimal</span> <span class="variable">smartAnimal</span> <span class="operator">=</span> ioc.getBean(SmartAnimal.class);</span><br><span class="line">        smartAnimal.getSum(<span class="number">10</span>,<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="作业-2"><a href="#作业-2" class="headerlink" title="作业"></a>作业</h2><ol>
<li><p>请编写一个 Cal 接口 </p>
<p>方法 cal1(int n) 计算 1+2..+n </p>
<p>方法 cal2(int n) 计算 1 * 2 * … * n </p>
</li>
<li><p>实现类 MyCal implements Cal </p>
</li>
<li><p>请分别使用注解方式 &#x2F; XML 配置方式 完成 AOP 编程 </p>
<p>(1) 在执行 cal1 前打印开始执行的时间，在 执行完后打印时间 </p>
<p>(2) 在执行 cal2 前打印开始执行的时间，在 执行完后打印时间</p>
</li>
</ol>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220610105312062.png" alt="image-20220610105312062"></p>
<h3 id="注解方式"><a href="#注解方式" class="headerlink" title="注解方式"></a>注解方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.homework;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cal1</span><span class="params">(<span class="type">int</span> n)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cal2</span><span class="params">(<span class="type">int</span> n)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.homework;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCal</span> <span class="keyword">implements</span> <span class="title class_">Cal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cal1</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n ; i++) &#123;</span><br><span class="line">            res += i;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;cal1 res = &quot;</span> + res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cal2</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n ; i++) &#123;</span><br><span class="line">            res *= i;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;cal2 res = &quot;</span> + res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.homework;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCalAOP</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(value = &quot;execution(public void MyCal.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myPointCut</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(value = &quot;myPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startCal</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;开始执行计算 &quot;</span> + System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;myPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">endCal</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;结束执行计算 &quot;</span> + System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.aop.homework&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启基于注解的AOP功能--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.homework;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMyCalAOP</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans10.xml&quot;</span>);</span><br><span class="line">        <span class="type">Cal</span> <span class="variable">bean</span> <span class="operator">=</span> ioc.getBean(Cal.class);</span><br><span class="line">        bean.cal1(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;=============================&quot;</span>);</span><br><span class="line">        bean.cal2(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="XML配置方式"><a href="#XML配置方式" class="headerlink" title="XML配置方式"></a>XML配置方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.homework.xml;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cal1</span><span class="params">(<span class="type">int</span> n)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cal2</span><span class="params">(<span class="type">int</span> n)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.homework.xml;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCal</span> <span class="keyword">implements</span> <span class="title class_">Cal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cal1</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n ; i++) &#123;</span><br><span class="line">            res += i;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;cal1 res = &quot;</span> + res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cal2</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n ; i++) &#123;</span><br><span class="line">            res *= i;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;cal2 res = &quot;</span> + res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.lzw.spring.aop.homework.xml;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author LiAng</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class MyCalAOP &#123;</span><br><span class="line">    public void startCal()&#123;</span><br><span class="line">        System.out.println(&quot;基于xml配置开始执行计算 &quot; + System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void endCal()&#123;</span><br><span class="line">        System.out.println(&quot;基于xml配置结束执行计算 &quot; + System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置MyCalAOP-bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.aop.homework.xml.MyCalAOP&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myCalAOP&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置MyCal-bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lzw.spring.aop.homework.xml.MyCal&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myCal&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置切面类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;myPointCut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(public void com.lzw.spring.aop.homework.xml.MyCal.*(int))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myCalAOP&quot;</span> <span class="attr">order</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;startCal&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointCut&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;endCal&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointCut&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.aop.homework.xml;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMyCalAOP</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans11.xml&quot;</span>);</span><br><span class="line">        <span class="type">Cal</span> <span class="variable">bean</span> <span class="operator">=</span> ioc.getBean(Cal.class);</span><br><span class="line">        bean.cal1(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;=============================&quot;</span>);</span><br><span class="line">        bean.cal2(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>


<h1 id="第四章-JdbcTemplate"><a href="#第四章-JdbcTemplate" class="headerlink" title="第四章 JdbcTemplate"></a>第四章 JdbcTemplate</h1><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>如果程序员就希望使用 spring 框架来做项目，spring 框架如何处理对数据库的操作呢？</p>
<p>​		方案 1：使用前面做项目开发的 JdbcUtils 类 。</p>
<p>​		方案 2：其实 spring 提供了一个操作数据库(表)功能强大的类 JdbcTemplate 。我们可以同 ioc 容器来配置一个 jdbcTemplate 对象，使用它来完成对数据库表的各种操作。</p>
<h2 id="官方文档-1"><a href="#官方文档-1" class="headerlink" title="官方文档"></a>官方文档</h2><p>JdbcTemplate APIs : &#x2F;spring-framework-5.3.8&#x2F;docs&#x2F;javadoc-api&#x2F;index.html</p>
<h2 id="JdbcTemplate-介绍"><a href="#JdbcTemplate-介绍" class="headerlink" title="JdbcTemplate-介绍"></a>JdbcTemplate-介绍</h2><ol>
<li>通过 Spring 可以配置数据源，从而完成对数据表的操作 。</li>
<li>JdbcTemplate 是 Spring 提供的访问数据库的技术。可以将 JDBC 的常用操作封装为模板方法。</li>
</ol>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220611172851866.png" alt="image-20220611172851866"></p>
<h2 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h2><h3 id="正确得到数据源"><a href="#正确得到数据源" class="headerlink" title="正确得到数据源"></a>正确得到数据源</h3><h4 id="先引入JdbcTemplate需要的jar包。"><a href="#先引入JdbcTemplate需要的jar包。" class="headerlink" title="先引入JdbcTemplate需要的jar包。"></a>先引入JdbcTemplate需要的jar包。</h4><p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220611173023389.png" alt="image-20220611173023389"></p>
<h4 id="创建数据库spring和表monster"><a href="#创建数据库spring和表monster" class="headerlink" title="创建数据库spring和表monster"></a>创建数据库spring和表monster</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库 </span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE spring</span><br><span class="line"><span class="comment">-- 创建表 monster </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> monster(</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY, </span><br><span class="line">    `name` <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">	skill <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">)CHARSET<span class="operator">=</span>utf8 </span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> monster <span class="keyword">VALUES</span>(<span class="number">100</span>, <span class="string">&#x27;青牛怪&#x27;</span>, <span class="string">&#x27;吐火&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> monster <span class="keyword">VALUES</span>(<span class="number">200</span>, <span class="string">&#x27;黄袍怪&#x27;</span>, <span class="string">&#x27;吐烟&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> monster <span class="keyword">VALUES</span>(<span class="number">300</span>, <span class="string">&#x27;蜘蛛怪&#x27;</span>, <span class="string">&#x27;吐丝&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="创建配置文件-src-x2F-jdbc-properties"><a href="#创建配置文件-src-x2F-jdbc-properties" class="headerlink" title="创建配置文件 src&#x2F;jdbc.properties"></a>创建配置文件 src&#x2F;jdbc.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.userName</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">jdbc.driverClass</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/spring</span></span><br></pre></td></tr></table></figure>

<h4 id="创建配置文件-src-x2F-JdbcTemplate-ioc-xml"><a href="#创建配置文件-src-x2F-JdbcTemplate-ioc-xml" class="headerlink" title="创建配置文件 src&#x2F;JdbcTemplate_ioc.xml"></a>创建配置文件 src&#x2F;JdbcTemplate_ioc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 引入外部属性文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.userName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClass&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="测试是否可以正确得到数据源"><a href="#测试是否可以正确得到数据源" class="headerlink" title="测试是否可以正确得到数据源"></a>测试是否可以正确得到数据源</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTemplateTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDatasourceByJdbcTemplate</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">//获取容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;JdbcTemplate_ioc.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> ioc.getBean(DataSource.class);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">        System.out.println(<span class="string">&quot;获取到connection = &quot;</span> + connection);</span><br><span class="line">        connection.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220611175217274.png" alt="image-20220611175217274"></p>
<h3 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h3><h4 id="配置-JdbcTemplate-ioc-xml"><a href="#配置-JdbcTemplate-ioc-xml" class="headerlink" title="配置 JdbcTemplate_ioc.xml"></a>配置 JdbcTemplate_ioc.xml</h4><p>将数据源分配给 JdbcTemplate bean。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置JdbcTemplate对象--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--给JdbcTemplate对象配置dataSource--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="修改-JdbcTemplateTest-java"><a href="#修改-JdbcTemplateTest-java" class="headerlink" title="修改 JdbcTemplateTest.java"></a>修改 JdbcTemplateTest.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试通过JdbcTemplate对象完成添加数据	</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addDataByJdbcTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;JdbcTemplate_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="comment">//获取JdbcTemplate对象</span></span><br><span class="line">       <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> ioc.getBean(JdbcTemplate.class);</span><br><span class="line">       <span class="comment">//1. 添加方式1</span></span><br><span class="line">       <span class="comment">//String sql = &quot;Insert into monster Value(400, &#x27;红孩儿&#x27;, &#x27;枪法&#x27;)&quot;;</span></span><br><span class="line">       <span class="comment">//jdbcTemplate.execute(sql);</span></span><br><span class="line">       <span class="comment">//2. 添加方式2</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;INSERT INTO monster VALUES(?, ?, ?)&quot;</span>;</span><br><span class="line">       <span class="comment">//affected表示 执行后表受影响的记录数</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">affected</span> <span class="operator">=</span> jdbcTemplate.update(sql, <span class="number">500</span>, <span class="string">&quot;红孩儿2&quot;</span>, <span class="string">&quot;枪法2&quot;</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;添加成功 affected = &quot;</span> + affected);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><p>修改 JdbcTemplateTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试通过JdbcTemplate对象完成修改数据</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateDataByJdbcTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;JdbcTemplate_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="comment">//获取JdbcTemplate对象</span></span><br><span class="line">       <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> ioc.getBean(JdbcTemplate.class);</span><br><span class="line">       <span class="comment">//组织SQL</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE monster SET skill=? WHERE id=?&quot;</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">affected</span> <span class="operator">=</span> jdbcTemplate.update(sql, <span class="string">&quot;美人计&quot;</span>, <span class="number">300</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;update ok affected= &quot;</span> + affected);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="批量添加数据"><a href="#批量添加数据" class="headerlink" title="批量添加数据"></a>批量添加数据</h3><p>修改 JdbcTemplateTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//批量添加两个monster</span></span><br><span class="line">   <span class="comment">//这里有一个使用API的技巧</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 1. 对于某个类， 有很多API, 使用的步骤</span></span><br><span class="line"><span class="comment">    * 2. 使用技巧（1） 先确定API名字 (2) 根据API提供相应的参数 [组织参数]</span></span><br><span class="line"><span class="comment">    *    (3) 把自己的调用思路清晰 (4) 根据API, 可以推测类似的用法和功能</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * batch add data</span></span><br><span class="line"><span class="comment">    * 批量添加二个monster 白蛇精和青蛇精-update(sql,List&lt;Object[]&gt;)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBatchDataByJdbcTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;JdbcTemplate_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="comment">//得到JdbcTemplate bean</span></span><br><span class="line">       <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> ioc.getBean(JdbcTemplate.class);<span class="comment">//添加..</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//1. 先确定,猜测API名称 batchUpdate[如果出现问题，才重新玩]</span></span><br><span class="line">       <span class="comment">//public int[] batchUpdate(String sql, List&lt;Object[]&gt; batchArgs)&#123;&#125;</span></span><br><span class="line">       <span class="comment">//2. 准备参数</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;INSERT INTO monster VALUES(?, ?, ?)&quot;</span>;</span><br><span class="line">       List&lt;Object[]&gt; batchArgs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       batchArgs.add(<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="number">600</span>, <span class="string">&quot;老鼠精&quot;</span>, <span class="string">&quot;偷吃粮食&quot;</span>&#125;);</span><br><span class="line">       batchArgs.add(<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="number">700</span>, <span class="string">&quot;老猫精&quot;</span>, <span class="string">&quot;抓老鼠&quot;</span>&#125;);</span><br><span class="line">       <span class="comment">//3. 调用</span></span><br><span class="line">       <span class="comment">//说明：返回结果是一个数组，每个元素对应上面的sql语句对表的影响记录数</span></span><br><span class="line">       <span class="type">int</span>[] ints = jdbcTemplate.batchUpdate(sql, batchArgs);</span><br><span class="line">       <span class="comment">//输出</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> anInt : ints) &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;anInt=&quot;</span> + anInt);</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(<span class="string">&quot;batch add ok..&quot;</span>);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询单条数据并封装成对象"><a href="#查询单条数据并封装成对象" class="headerlink" title="查询单条数据并封装成对象"></a>查询单条数据并封装成对象</h3><p>这里的Monster还是使用的第一章中的Monster类。</p>
<p>修改 JdbcTemplateTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询id=100的monster并封装到Monster实体对象[在实际开发中，非常有用]</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectDataByJdbcTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;JdbcTemplate_ioc.xml&quot;</span>);</span><br><span class="line">    <span class="comment">//得到JdbcTemplate bean</span></span><br><span class="line">    <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> ioc.getBean(JdbcTemplate.class);</span><br><span class="line">    <span class="comment">//组织SQL</span></span><br><span class="line">    <span class="comment">//通过BeanPropertyRowMapper获取rowmapper 是一个接口，可以将查询的结果，封装到你指定的Monster对象中.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//1. 确定API ： queryForObject()</span></span><br><span class="line">    <span class="comment">//public &lt;T&gt; T queryForObject(String sql, RowMapper&lt;T&gt; rowMapper, @Nullable Object... args)</span></span><br><span class="line">    <span class="comment">//2.准备参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT id AS monsterID, NAME, skill FROM monster WHERE id = 100&quot;</span>;</span><br><span class="line">    <span class="comment">//使用RowMapper 接口对返回的数据，进行一个封装-&gt;底层使用的反射-&gt;setter</span></span><br><span class="line">    <span class="comment">//这里有一个细节: 你查询的记录的表的字段需要和 Monster的对象字段名保持一致</span></span><br><span class="line">    RowMapper&lt;Monster&gt; rowMapper = <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Monster.class);</span><br><span class="line">    <span class="comment">//jdbcTemplate</span></span><br><span class="line">    <span class="type">Monster</span> <span class="variable">monster</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, rowMapper);</span><br><span class="line">    System.out.println(<span class="string">&quot;monster= &quot;</span> + monster);</span><br><span class="line">    System.out.println(<span class="string">&quot;查询ok&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询多条数据并封装成对象集合"><a href="#查询多条数据并封装成对象集合" class="headerlink" title="查询多条数据并封装成对象集合"></a>查询多条数据并封装成对象集合</h3><p>修改 JdbcTemplateTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 查询多条记录</span></span><br><span class="line"><span class="comment">    * 查询id&gt;=100的monster并封装到Monster实体对象</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectMulDataByJdbcTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span></span><br><span class="line">               <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;JdbcTemplate_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="comment">//得到JdbcTemplate bean</span></span><br><span class="line">       <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> ioc.getBean(JdbcTemplate.class);</span><br><span class="line">       <span class="comment">//组织SQL</span></span><br><span class="line">       <span class="comment">//通过BeanPropertyRowMapper获取rowmapper 是一个接口，可以将查询的结果，封装到你指定的Monster对象中.</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//1.    确定API</span></span><br><span class="line">       <span class="comment">//public &lt;T&gt; T query(String sql, RowMapper&lt;T&gt; rowMapper, Object... args)&#123;&#125;</span></span><br><span class="line">       <span class="comment">//2. 组织参数</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT id AS monsterId, NAME, skill FROM monster WHERE id &gt;= ?&quot;</span>;</span><br><span class="line">       RowMapper&lt;Monster&gt; rowMapper = <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Monster.class);</span><br><span class="line">       <span class="comment">//3.调用</span></span><br><span class="line">       List&lt;Monster&gt; monsterList = jdbcTemplate.query(sql, rowMapper, <span class="number">100</span>);</span><br><span class="line">       <span class="keyword">for</span> (Monster monster : monsterList) &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;monster= &quot;</span> + monster);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询返回结果只有一行一列的数据"><a href="#查询返回结果只有一行一列的数据" class="headerlink" title="查询返回结果只有一行一列的数据"></a>查询返回结果只有一行一列的数据</h3><p>修改 JdbcTemplateTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 查询返回结果只有一行一列的值，比如查询id=100的怪物名</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectScalarByJdbcTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span></span><br><span class="line">              <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;JdbcTemplate_ioc.xml&quot;</span>);</span><br><span class="line">      <span class="comment">//得到JdbcTemplate bean</span></span><br><span class="line">      <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> ioc.getBean(JdbcTemplate.class);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//1. 确定API</span></span><br><span class="line">      <span class="comment">//public &lt;T&gt; T queryForObject(String sql, Class&lt;T&gt; requiredType)</span></span><br><span class="line">      <span class="comment">//2. 提供参数</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT NAME FROM monster WHERE id = 100&quot;</span>;</span><br><span class="line">      <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, String.class);</span><br><span class="line">      System.out.println(<span class="string">&quot;返回name= &quot;</span> + name);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-Map-传入具名参数完成添加操作"><a href="#使用-Map-传入具名参数完成添加操作" class="headerlink" title="使用 Map 传入具名参数完成添加操作"></a>使用 Map 传入具名参数完成添加操作</h3><h4 id="修改-JdbcTemplate-ioc-xml"><a href="#修改-JdbcTemplate-ioc-xml" class="headerlink" title="修改 JdbcTemplate_ioc.xml"></a>修改 JdbcTemplate_ioc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置NamedParameterJdbcTemplate对象--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate&quot;</span> <span class="attr">id</span>=<span class="string">&quot;namedParameterJdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--通过构造器，设置数据源--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="修改-JdbcTemplateTest-java-1"><a href="#修改-JdbcTemplateTest-java-1" class="headerlink" title="修改 JdbcTemplateTest.java"></a>修改 JdbcTemplateTest.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使用Map传入具名参数完成操作，比如添加 螃蟹精.:name 就是具名参数形式需要使用NamedParameterJdbcTemplate 类,</span></span><br><span class="line"><span class="comment">    * 语句形式: String sql = &quot;INSERT INTO monster VALUES(:my_id, :name, :skill)&quot;;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDataByNamedParameterJdbcTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;JdbcTemplate_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="comment">//得到NamedParameterJdbcTemplate bean</span></span><br><span class="line">       <span class="type">NamedParameterJdbcTemplate</span> <span class="variable">namedParameterJdbcTemplate</span> <span class="operator">=</span> ioc.getBean(NamedParameterJdbcTemplate.class);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//1. 确定使用API</span></span><br><span class="line">       <span class="comment">//public int update(String sql, Map&lt;String, ?&gt; paramMap)</span></span><br><span class="line">       <span class="comment">//2. 准备参数 [:my_id, :name, :skill] 要求按照规定的名字来设置参数</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into monster values(:id, :name, :skill)&quot;</span>;</span><br><span class="line">       Map&lt;String, Object&gt; paramMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//给paramMap填写数据</span></span><br><span class="line">       paramMap.put(<span class="string">&quot;id&quot;</span>, <span class="number">800</span>);</span><br><span class="line">       paramMap.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;蚂蚁精&quot;</span>);</span><br><span class="line">       paramMap.put(<span class="string">&quot;skill&quot;</span>, <span class="string">&quot;喜欢打洞&quot;</span>);</span><br><span class="line">       <span class="comment">//3. 调用</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">affected</span> <span class="operator">=</span> namedParameterJdbcTemplate.update(sql, paramMap);</span><br><span class="line">       System.out.println(<span class="string">&quot;add ok affected=&quot;</span> + affected);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220611192753526.png" alt="image-20220611192753526"></p>
<h3 id="使用-sqlparametersoruce-来传入具名参数完成添加操作"><a href="#使用-sqlparametersoruce-来传入具名参数完成添加操作" class="headerlink" title="使用 sqlparametersoruce 来传入具名参数完成添加操作"></a>使用 sqlparametersoruce 来传入具名参数完成添加操作</h3><p>修改 JdbcTemplateTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用sqlparametersoruce 来传入具名参数,还是添加一个Monster 狐狸精</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operDataBySqlparametersoruce</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;JdbcTemplate_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="comment">//得到NamedParameterJdbcTemplate bean</span></span><br><span class="line">       <span class="type">NamedParameterJdbcTemplate</span> <span class="variable">namedParameterJdbcTemplate</span> <span class="operator">=</span> ioc.getBean(NamedParameterJdbcTemplate.class);</span><br><span class="line">       <span class="comment">//确定API</span></span><br><span class="line">       <span class="comment">//public int update(String sql, SqlParameterSource paramSource)</span></span><br><span class="line">       <span class="comment">//public BeanPropertySqlParameterSource(Object object)</span></span><br><span class="line">       <span class="comment">//准备参数</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;INSERT INTO monster VALUES(:monsterID, :name, :skill)&quot;</span>;</span><br><span class="line">       <span class="type">Monster</span> <span class="variable">monster</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">900</span>, <span class="string">&quot;大象精&quot;</span>, <span class="string">&quot;搬运木头&quot;</span>);</span><br><span class="line">       <span class="type">SqlParameterSource</span> <span class="variable">sqlParameterSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanPropertySqlParameterSource</span>(monster);</span><br><span class="line">       <span class="comment">//3. 调用</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">affected</span> <span class="operator">=</span> namedParameterJdbcTemplate.update(sql, sqlParameterSource);</span><br><span class="line">       System.out.println(<span class="string">&quot;add ok affected=&quot;</span> + affected);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220611192837530.png" alt="image-20220611192837530"></p>
<h3 id="Dao-对象使用-JdbcTemplate-完成对数据的操作"><a href="#Dao-对象使用-JdbcTemplate-完成对数据的操作" class="headerlink" title="Dao 对象使用 JdbcTemplate 完成对数据的操作"></a>Dao 对象使用 JdbcTemplate 完成对数据的操作</h3><h4 id="创建-MonsterDao-java"><a href="#创建-MonsterDao-java" class="headerlink" title="创建 MonsterDao.java"></a>创建 MonsterDao.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.jdbctemplate.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.bean.Monster;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">//将MonsterDao注入到Spring容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonsterDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入一个属性</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//完成保存任务</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Monster monster)</span>&#123;</span><br><span class="line">        <span class="comment">//组织sql</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into monster values(?,?,?)&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">affected</span> <span class="operator">=</span> jdbcTemplate.update(sql, monster.getMonsterID(), monster.getName(), monster.getSkill());</span><br><span class="line">        System.out.println(<span class="string">&quot;affected = &quot;</span> + affected);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="修改-JdbcTemplate-ioc-xml-1"><a href="#修改-JdbcTemplate-ioc-xml-1" class="headerlink" title="修改 JdbcTemplate_ioc.xml"></a>修改 JdbcTemplate_ioc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置要扫描的包--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.jdbctemplate.dao&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="修改-JdbcTemplateTest-java-2"><a href="#修改-JdbcTemplateTest-java-2" class="headerlink" title="修改 JdbcTemplateTest.java"></a>修改 JdbcTemplateTest.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试MonsterDAO</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">monsterDaoSave</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;JdbcTemplate_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="type">MonsterDao</span> <span class="variable">monsterDao</span> <span class="operator">=</span> ioc.getBean(MonsterDao.class);</span><br><span class="line">       <span class="type">Monster</span> <span class="variable">monster</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">1000</span>, <span class="string">&quot;小鸭精&quot;</span>, <span class="string">&quot;吃鱼&quot;</span>);</span><br><span class="line">       monsterDao.save(monster);</span><br><span class="line">       System.out.println(<span class="string">&quot;MonsterDAO保存 ok ..&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<hr>


<h1 id="第五章-声明式事务"><a href="#第五章-声明式事务" class="headerlink" title="第五章 声明式事务"></a>第五章 声明式事务</h1><h2 id="事务分类"><a href="#事务分类" class="headerlink" title="事务分类"></a>事务分类</h2><ol>
<li><p>编程式事务</p>
</li>
<li><p><strong>声明式事务</strong></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JdbcUtils.getConnection(); </span><br><span class="line"><span class="keyword">try</span> &#123;<span class="comment">//1. 先设置事务不要自动提交 </span></span><br><span class="line">       connection.setAutoCommint(<span class="literal">false</span>); </span><br><span class="line">       <span class="comment">//2. 进行各种 crud </span></span><br><span class="line">       <span class="comment">//多个表的修改，添加 ，删除 </span></span><br><span class="line">       <span class="comment">//3. 提交 </span></span><br><span class="line">       connection.commit(); </span><br><span class="line">   &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">       <span class="comment">//4. 回滚</span></span><br><span class="line">       conection.rollback(); </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="声明式事务"><a href="#声明式事务" class="headerlink" title="声明式事务"></a>声明式事务</h2><h3 id="需求-1"><a href="#需求-1" class="headerlink" title="需求"></a>需求</h3><p>我们需要去处理用户购买商品的业务逻辑</p>
<p>分析：当一个用户要去购买商品应该包含三个步骤</p>
<ol>
<li>通过商品 id 获取价格。</li>
<li>购买商品(某人购买商品，修改用户的余额) 。</li>
<li>修改库存量 。</li>
<li>其实大家可以看到，这时，我们需要涉及到三张表商品表，用户表，商品存量表。 应该使用事务处理。</li>
</ol>
<h3 id="传统的编程式事务分析"><a href="#传统的编程式事务分析" class="headerlink" title="传统的编程式事务分析"></a>传统的编程式事务分析</h3><ol>
<li><p>使用传统的编程事务来处理，将代码写到一起[缺点: 代码冗余，效率低，不利于扩展, 优 点是简单，好理解]。</p>
</li>
<li><p>使用 Spring 的声明式事务处理， 可以将上面三个子步骤分别写成一个方法，然后统一 管理[这个是 Spring 很牛的地方，在开发使用的很多，优点是无代码冗余，效率高，扩展方便， 缺点是理解较困难]&#x3D;&#x3D;&gt; 底层使用 AOP (动态代理+动态绑定+反射+注解)。</p>
</li>
</ol>
<h3 id="声明式事务使用"><a href="#声明式事务使用" class="headerlink" title="声明式事务使用"></a>声明式事务使用</h3><h4 id="先创建商品系统的数据库和表"><a href="#先创建商品系统的数据库和表" class="headerlink" title="先创建商品系统的数据库和表"></a>先创建商品系统的数据库和表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 演示声明式事务创建的表 </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `user_account`( </span><br><span class="line">    user_id <span class="type">INT</span> UNSIGNED <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT, </span><br><span class="line">    user_name <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>, </span><br><span class="line">    money <span class="keyword">DOUBLE</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0.0</span> </span><br><span class="line">)CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_account` <span class="keyword">VALUES</span>(<span class="keyword">NULL</span>,<span class="string">&#x27;张三&#x27;</span>, <span class="number">1000</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_account` <span class="keyword">VALUES</span>(<span class="keyword">NULL</span>,<span class="string">&#x27;李四&#x27;</span>, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `goods`(</span><br><span class="line">    goods_id <span class="type">INT</span> UNSIGNED <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT, </span><br><span class="line">    goods_name <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>, </span><br><span class="line">    price <span class="keyword">DOUBLE</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0.0</span> </span><br><span class="line">)CHARSET<span class="operator">=</span>utf8 ;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `goods` <span class="keyword">VALUES</span>(<span class="keyword">NULL</span>,<span class="string">&#x27;小风扇&#x27;</span>, <span class="number">10.00</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `goods` <span class="keyword">VALUES</span>(<span class="keyword">NULL</span>,<span class="string">&#x27;小台灯&#x27;</span>, <span class="number">12.00</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `goods` <span class="keyword">VALUES</span>(<span class="keyword">NULL</span>,<span class="string">&#x27;可口可乐&#x27;</span>, <span class="number">3.00</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `goods_amount`( </span><br><span class="line">    goods_id <span class="type">INT</span> UNSIGNED <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT, </span><br><span class="line">    goods_num <span class="type">INT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">0</span> </span><br><span class="line">)CHARSET<span class="operator">=</span>utf8 ;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `goods_amount` <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">200</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `goods_amount` <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `goods_amount` <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="number">15</span>);</span><br></pre></td></tr></table></figure>

<h4 id="创建GoodsDao"><a href="#创建GoodsDao" class="headerlink" title="创建GoodsDao"></a>创建GoodsDao</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.tx.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GoodsDao</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据商品id,返回对应的价格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Float <span class="title function_">queryPriceById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT price From goods Where goods_id=?&quot;</span>;</span><br><span class="line">        <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, Float.class, id);</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户的余额 [减少用户余额]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user_id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBalance</span><span class="params">(Integer user_id, Float money)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE user_account SET money=money-? Where user_id=?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql, money, user_id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改商品库存 [减少]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goods_id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAmount</span><span class="params">(Integer goods_id, <span class="type">int</span> amount)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE goods_amount SET goods_num=goods_num-? Where goods_id=?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql, amount , goods_id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建src-tx-ioc-xml"><a href="#创建src-tx-ioc-xml" class="headerlink" title="创建src\tx_ioc.xml"></a>创建src\tx_ioc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置要扫描的包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.tx.dao&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--引入外部的jdbc.properties文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置数据源对象-DataSoruce--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给数据源对象配置属性值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.userName&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClass&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置JdbcTemplate对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给JdbcTemplate对象配置dataSource--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="创建TxTest-进行测试"><a href="#创建TxTest-进行测试" class="headerlink" title="创建TxTest 进行测试"></a>创建TxTest 进行测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.tx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.tx.dao.GoodsDao;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TxTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryPriceByIdTest</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取到容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;tx_ioc.xml&quot;</span>);</span><br><span class="line">        <span class="type">GoodsDao</span> <span class="variable">goodsDao</span> <span class="operator">=</span> ioc.getBean(GoodsDao.class);</span><br><span class="line">        <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;id=1 的price=&quot;</span> + price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//获取到容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;tx_ioc.xml&quot;</span>);</span><br><span class="line">        <span class="type">GoodsDao</span> <span class="variable">goodsDao</span> <span class="operator">=</span> ioc.getBean(GoodsDao.class);</span><br><span class="line">        goodsDao.updateBalance(<span class="number">1</span>, <span class="number">1.0F</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;减少用户余额成功~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAmount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//获取到容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;tx_ioc.xml&quot;</span>);</span><br><span class="line">        <span class="type">GoodsDao</span> <span class="variable">goodsDao</span> <span class="operator">=</span> ioc.getBean(GoodsDao.class);</span><br><span class="line">        goodsDao.updateAmount(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;减少库存成功...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建GoodsService"><a href="#创建GoodsService" class="headerlink" title="创建GoodsService"></a>创建GoodsService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.tx.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.tx.dao.GoodsDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span> <span class="comment">//将 GoodsService对象注入到spring容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GoodsService</span> &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> GoodsDao goodsDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//编写一个方法，完成用户购买商品的业务, 这里主要是讲解事务管理</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId  用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goodsId 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount  购买数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoods</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> goodsId, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">//输出购买的相关信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;用户购买信息 userId=&quot;</span> + userId + <span class="string">&quot; goodsId=&quot;</span> + goodsId + <span class="string">&quot; 购买数量=&quot;</span> + amount);</span><br><span class="line">        <span class="comment">//1.得到商品的价格</span></span><br><span class="line">        <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById(userId);</span><br><span class="line">        <span class="comment">//2. 减少用户的余额</span></span><br><span class="line">        goodsDao.updateBalance(userId, price * amount);</span><br><span class="line">        <span class="comment">//3. 减少库存量</span></span><br><span class="line">        goodsDao.updateAmount(goodsId, amount);</span><br><span class="line">        System.out.println(<span class="string">&quot;用户购买成功~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="修改tx-ioc-xml"><a href="#修改tx-ioc-xml" class="headerlink" title="修改tx_ioc.xml"></a>修改tx_ioc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.tx.service&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="修改GoodsDao，让操作发生异常"><a href="#修改GoodsDao，让操作发生异常" class="headerlink" title="修改GoodsDao，让操作发生异常"></a>修改GoodsDao，让操作发生异常</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 修改商品库存 [减少]</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> goods_id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> amount</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAmount</span><span class="params">(Integer goods_id, <span class="type">int</span> amount)</span>&#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATEX goods_amount SET goods_num=goods_num-? Where goods_id=?&quot;</span>;</span><br><span class="line">       jdbcTemplate.update(sql, amount , goods_id);</span><br><span class="line">   &#125;	</span><br></pre></td></tr></table></figure>

<h4 id="修改TxTest-进行测试"><a href="#修改TxTest-进行测试" class="headerlink" title="修改TxTest 进行测试"></a>修改TxTest 进行测试</h4><p>验证不使用事务就会出现数据不一致现象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试用户购买商品业务</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsTest</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;tx_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="type">GoodsService</span> <span class="variable">goodsService</span> <span class="operator">=</span> ioc.getBean(GoodsService.class);</span><br><span class="line">       goodsService.buyGoods(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<hr>


<h4 id="修改GoodsService"><a href="#修改GoodsService" class="headerlink" title="修改GoodsService"></a>修改GoodsService</h4><p>加入声明式事务注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Transactional</span> 注解解读</span></span><br><span class="line"><span class="comment">    * 1. 使用<span class="doctag">@Transactional</span> 可以进行声明式事务控制</span></span><br><span class="line"><span class="comment">    * 2. 即将标识的方法中的，对数据库的操作作为一个事务管理</span></span><br><span class="line"><span class="comment">    * 3. <span class="doctag">@Transactional</span> 底层使用的仍然是AOP机制</span></span><br><span class="line"><span class="comment">    * 4. 底层是使用动态代理对象来调用buyGoodsByTx</span></span><br><span class="line"><span class="comment">    * 5. 在执行buyGoodsByTx() 方法 先调用 事务管理器的 doBegin() , 调用 buyGoodsByTx()</span></span><br><span class="line"><span class="comment">    *    如果执行没有发生异常，则调用 事务管理器的 doCommit(), 如果发生异常 调用事务管理器的 doRollback()</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> goodsId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> amount</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Transactional</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTx</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> goodsId, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">       <span class="comment">//输出购买的相关信息</span></span><br><span class="line">       System.out.println(<span class="string">&quot;用户购买信息 userId=&quot;</span> + userId + <span class="string">&quot; goodsId=&quot;</span> + goodsId + <span class="string">&quot; 购买数量=&quot;</span> + amount);</span><br><span class="line">       <span class="comment">//1.得到商品的价格</span></span><br><span class="line">       <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById(userId);</span><br><span class="line">       <span class="comment">//2. 减少用户的余额</span></span><br><span class="line">       goodsDao.updateBalance(userId, price * amount);</span><br><span class="line">       <span class="comment">//3. 减少库存量</span></span><br><span class="line">       goodsDao.updateAmount(goodsId, amount);</span><br><span class="line">       System.out.println(<span class="string">&quot;用户购买成功~&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="修改tx-ioc-xml-1"><a href="#修改tx-ioc-xml-1" class="headerlink" title="修改tx_ioc.xml"></a>修改tx_ioc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置事务管理器-对象</span></span><br><span class="line"><span class="comment">   1. DataSourceTransactionManager 这个对象是进行事务管理-debug源码</span></span><br><span class="line"><span class="comment">   2. 一定要配置数据源属性，这样指定该事务管理器 是对哪个数据源进行事务控制</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--配置启动基于注解的声明式事务管理功能--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="修改TxTest-进行测试-1"><a href="#修改TxTest-进行测试-1" class="headerlink" title="修改TxTest 进行测试"></a>修改TxTest 进行测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试用户购买商品业务</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTxTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//获取到容器</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;tx_ioc.xml&quot;</span>);</span><br><span class="line">    <span class="type">GoodsService</span> <span class="variable">goodsService</span> <span class="operator">=</span> ioc.getBean(GoodsService.class);</span><br><span class="line">    goodsService.buyGoodsByTx(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);<span class="comment">//这里我们调用的是进行了事务声明的方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="声明式事务机制-Debug"><a href="#声明式事务机制-Debug" class="headerlink" title="声明式事务机制-Debug"></a>声明式事务机制-Debug</h3><h4 id="doBegin"><a href="#doBegin" class="headerlink" title="doBegin"></a>doBegin</h4><p><strong>protected void doBegin(Object transaction, TransactionDefinition definition)中</strong></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612100840040.png" alt="image-20220612100840040"></p>
<h4 id="doCommit"><a href="#doCommit" class="headerlink" title="doCommit"></a>doCommit</h4><p><strong>protected void doCommit(DefaultTransactionStatus status)中</strong></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612101007683.png" alt="image-20220612101007683"></p>
<h4 id="doRollback"><a href="#doRollback" class="headerlink" title="doRollback"></a>doRollback</h4><p><strong>protected void doRollback(DefaultTransactionStatus status)中</strong></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612101122874.png" alt="image-20220612101122874"></p>
<h2 id="事务的传播机制"><a href="#事务的传播机制" class="headerlink" title="事务的传播机制"></a>事务的传播机制</h2><p>事务的传播机制说明</p>
<ol>
<li><p>当有多个事务处理并存时，如何控制? </p>
</li>
<li><p>比如用户去购买两次商品(使用不同的方法)，每个方法都是一个事务，那么如何控制呢?</p>
</li>
<li><p>这个就是事务的传播机制，看一个具体的案例(如图)</p>
</li>
</ol>
<p>​         <img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220612104455297.png" alt="image-20220612104455297" style="zoom:50%;" /><img src="D:\Study\VIP\主流框架\Spring5\笔记\Spring5.assets\image-20220612104514261.png" alt="image-20220612104514261" style="zoom:50%;" /></p>
<h3 id="事务传播机制种类"><a href="#事务传播机制种类" class="headerlink" title="事务传播机制种类"></a>事务传播机制种类</h3><p>事务传播的属性&#x2F;种类一览图</p>
<table>
<thead>
<tr>
<th>传播属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>REQUIRED</td>
<td>如果有事务在运行，当前的方法就在这个事务内运行，否则，就启动一个新的事务，并在自己的事务内运行</td>
</tr>
<tr>
<td>REQUIREDS_NEW</td>
<td>当前的方法必须启动新事务，并在它自己的事务内运行.如果有事务正在运行，应该将它挂起</td>
</tr>
<tr>
<td>SUPPORTS</td>
<td>如果有事务在运行，当前的方法就在这个事务内运行。否则它可以不运行在事务中</td>
</tr>
<tr>
<td>NOT_SUPPORTED</td>
<td>当前的方法不应该运行在事务中，如果有运行的事务，将它挂起</td>
</tr>
<tr>
<td>MANDATORY</td>
<td>当前的方法必须运行在事务内部，如果没有正在运行的事务，就抛出异常</td>
</tr>
<tr>
<td>NEVER</td>
<td>当前的方法不应该运行在事务中，如果有运行的事务，就抛出异常</td>
</tr>
<tr>
<td>NESTED</td>
<td>如果有事务在运行，当前的方法就应该在这个事务的嵌套事务内运行。否则，就启动一个新的事务，并在它自己的事务内运行</td>
</tr>
</tbody></table>
<p>事务传播的属性&#x2F;种类机制分析</p>
<p>重点分析了 REQUIRED 和 REQUIRED_NEW 两种事务传播属性</p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612110035641.png" alt="image-20220612110035641"></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612110047056.png" alt="image-20220612110047056"></p>
<p>REQUIRES_NEW 和 REQUIRED 在处理事务的策略</p>
<ol>
<li>如果设置为 REQUIRES_NEW，buyGoods2 如果错误，不会影响到 buyGoods()反之亦然，即它们的<strong>事务是独立的</strong>。</li>
<li>如果设置为 REQUIRED，buyGoods2 和 buyGoods 是一个整体，只要有方法的事务错误，那么两个方法都不会执行成功。</li>
</ol>
<h3 id="事务的传播机制的设置方法"><a href="#事务的传播机制的设置方法" class="headerlink" title="事务的传播机制的设置方法"></a>事务的传播机制的设置方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation= Propagation.REQUIRES_NEW)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTx</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> goodsId, <span class="type">int</span> amount)</span> </span><br></pre></td></tr></table></figure>

<h3 id="事务的传播机制应用实例"><a href="#事务的传播机制应用实例" class="headerlink" title="事务的传播机制应用实例"></a>事务的传播机制应用实例</h3><h4 id="修改-GoodsDao"><a href="#修改-GoodsDao" class="headerlink" title="修改 GoodsDao"></a>修改 GoodsDao</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据商品id,返回对应的价格</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> Float <span class="title function_">queryPriceById2</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT price From goods Where goods_id=?&quot;</span>;</span><br><span class="line">       <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, Float.class, id);</span><br><span class="line">       <span class="keyword">return</span> price;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 修改用户的余额 [减少用户余额]</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> user_id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBalance2</span><span class="params">(Integer user_id, Float money)</span> &#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE user_account SET money=money-? Where user_id=?&quot;</span>;</span><br><span class="line">       jdbcTemplate.update(sql, money, user_id);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 修改商品库存 [减少]</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> goods_id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> amount</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAmount2</span><span class="params">(Integer goods_id, <span class="type">int</span> amount)</span>&#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE goods_amount SET goods_num=goods_num-? Where goods_id=?&quot;</span>;</span><br><span class="line">       jdbcTemplate.update(sql, amount , goods_id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="修改-GoodsService"><a href="#修改-GoodsService" class="headerlink" title="修改 GoodsService"></a>修改 GoodsService</h4><p>增加 buyGoodsByTx2()，使用默认的传播机制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.tx.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.tx.dao.GoodsDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span> <span class="comment">//将 GoodsService对象注入到spring容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GoodsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义属性GoodsDao</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> GoodsDao goodsDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//编写一个方法，完成用户购买商品的业务, 这里主要是讲解事务管理</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId  用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goodsId 商品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount  购买数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoods</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> goodsId, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">//输出购买的相关信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;用户购买信息 userId=&quot;</span> + userId + <span class="string">&quot; goodsId=&quot;</span> + goodsId + <span class="string">&quot; 购买数量=&quot;</span> + amount);</span><br><span class="line">        <span class="comment">//1.得到商品的价格</span></span><br><span class="line">        <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById(goodsId);</span><br><span class="line">        <span class="comment">//2. 减少用户的余额</span></span><br><span class="line">        goodsDao.updateBalance(userId, price * amount);</span><br><span class="line">        <span class="comment">//3. 减少库存量</span></span><br><span class="line">        goodsDao.updateAmount(goodsId, amount);</span><br><span class="line">        System.out.println(<span class="string">&quot;用户购买成功~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTx</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> goodsId, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">//输出购买的相关信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;用户购买信息 userId=&quot;</span> + userId + <span class="string">&quot; goodsId=&quot;</span> + goodsId + <span class="string">&quot; 购买数量=&quot;</span> + amount);</span><br><span class="line">        <span class="comment">//1.得到商品的价格</span></span><br><span class="line">        <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById(userId);</span><br><span class="line">        <span class="comment">//2. 减少用户的余额</span></span><br><span class="line">        goodsDao.updateBalance(userId, price * amount);</span><br><span class="line">        <span class="comment">//3. 减少库存量</span></span><br><span class="line">        goodsDao.updateAmount(goodsId, amount);</span><br><span class="line">        System.out.println(<span class="string">&quot;用户购买成功~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这个方法是第二套进行商品购买的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goodsId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTx2</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> goodsId, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">//输出购买的相关信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;用户购买信息 userId=&quot;</span> + userId + <span class="string">&quot; goodsId=&quot;</span> + goodsId + <span class="string">&quot; 购买数量=&quot;</span> + amount);</span><br><span class="line">        <span class="comment">//1.得到商品的价格</span></span><br><span class="line">        <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById2(userId);</span><br><span class="line">        <span class="comment">//2. 减少用户的余额</span></span><br><span class="line">        goodsDao.updateBalance2(userId, price * amount);</span><br><span class="line">        <span class="comment">//3. 减少库存量</span></span><br><span class="line">        goodsDao.updateAmount2(goodsId, amount);</span><br><span class="line">        System.out.println(<span class="string">&quot;用户购买成功~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建-MultiplyService"><a href="#创建-MultiplyService" class="headerlink" title="创建  MultiplyService"></a>创建  MultiplyService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.tx.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplyService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> GoodsService goodsService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. multiBuyGoodsByTx 方法中 有两次购买商品操作</span></span><br><span class="line"><span class="comment">     * 2. buyGoodsByTx 和 buyGoodsByTx2 都是声明式事务</span></span><br><span class="line"><span class="comment">     * 3. 当前 buyGoodsByTx 和 buyGoodsByTx2 使用的传播属性是默认的 REQUIRED</span></span><br><span class="line"><span class="comment">     * [会当做整体事务管理，比如 buyGoodsByTx 成功，但是buyGoodsByTx2失败，</span></span><br><span class="line"><span class="comment">     * 会造成整个事务失败，即会回滚buyGoodsByTx]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">multiBuyGoodsByTx</span><span class="params">()</span>&#123;</span><br><span class="line">        goodsService.buyGoodsByTx(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        goodsService.buyGoodsByTx2(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="修改-GoodsDao-1"><a href="#修改-GoodsDao-1" class="headerlink" title="修改 GoodsDao"></a>修改 GoodsDao</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAmount2</span><span class="params">(Integer goods_id, <span class="type">int</span> amount)</span>&#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATEX goods_amount SET goods_num=goods_num-? Where goods_id=?&quot;</span>;</span><br><span class="line">       jdbcTemplate.update(sql, amount , goods_id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="修改-TxTest-并测试"><a href="#修改-TxTest-并测试" class="headerlink" title="修改 TxTest 并测试"></a>修改 TxTest 并测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试事务传播机制</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">multiBuyGoodsByTxTest</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;tx_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="type">MultiplyService</span> <span class="variable">multiplyService</span> <span class="operator">=</span> ioc.getBean(MultiplyService.class);</span><br><span class="line">       multiplyService.multiBuyGoodsByTx();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>​		<strong>可以验证：为 REQUIRED buyGoodsByTx 和 buyGoodsByTx2 是整体，只要有方法的事务错误，那么两个方法都不会执行成功。</strong></p>
<hr>


<h4 id="修改-GoodsService-1"><a href="#修改-GoodsService-1" class="headerlink" title="修改  GoodsService"></a>修改  GoodsService</h4><p>更改传播机制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation= Propagation.REQUIRES_NEW)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTx</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> goodsId, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">       <span class="comment">//输出购买的相关信息</span></span><br><span class="line">       System.out.println(<span class="string">&quot;用户购买信息 userId=&quot;</span> + userId + <span class="string">&quot; goodsId=&quot;</span> + goodsId + <span class="string">&quot; 购买数量=&quot;</span> + amount);</span><br><span class="line">       <span class="comment">//1.得到商品的价格</span></span><br><span class="line">       <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById(userId);</span><br><span class="line">       <span class="comment">//2. 减少用户的余额</span></span><br><span class="line">       goodsDao.updateBalance(userId, price * amount);</span><br><span class="line">       <span class="comment">//3. 减少库存量</span></span><br><span class="line">       goodsDao.updateAmount(goodsId, amount);</span><br><span class="line">       System.out.println(<span class="string">&quot;用户购买成功~&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Transactional(propagation= Propagation.REQUIRES_NEW)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTx2</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> goodsId, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">       <span class="comment">//输出购买的相关信息</span></span><br><span class="line">       System.out.println(<span class="string">&quot;用户购买信息 userId=&quot;</span> + userId + <span class="string">&quot; goodsId=&quot;</span> + goodsId + <span class="string">&quot; 购买数量=&quot;</span> + amount);</span><br><span class="line">       <span class="comment">//1.得到商品的价格</span></span><br><span class="line">       <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById2(userId);</span><br><span class="line">       <span class="comment">//2. 减少用户的余额</span></span><br><span class="line">       goodsDao.updateBalance2(userId, price * amount);</span><br><span class="line">       <span class="comment">//3. 减少库存量</span></span><br><span class="line">       goodsDao.updateAmount2(goodsId, amount);</span><br><span class="line">       System.out.println(<span class="string">&quot;用户购买成功~&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="再次进行测试"><a href="#再次进行测试" class="headerlink" title="再次进行测试"></a>再次进行测试</h4><p>​		<strong>可以验证：设置为 REQUIRES_NEW buyGoodsByTx 如果错误，不会影响到 buyGoodsByTx02()反之亦然，也就 是说它们的事务是独立的。</strong></p>
<h2 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h2><p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612112931664.png" alt="image-20220612112931664"></p>
<h3 id="事务隔离级别说明"><a href="#事务隔离级别说明" class="headerlink" title="事务隔离级别说明"></a>事务隔离级别说明</h3><ol>
<li>默认的隔离级别，就是 mysql 数据库默认的隔离级别一般为 REPEATABLE_READ。</li>
<li>看源码可知 Isolation.DEFAULT 是 ：Use the default isolation level of the underlying datastore。</li>
<li>查看数据库默认的隔离级别 SELECT @@global.tx_isolation。</li>
</ol>
<h3 id="事务隔离级别的设置和测试"><a href="#事务隔离级别的设置和测试" class="headerlink" title="事务隔离级别的设置和测试"></a>事务隔离级别的设置和测试</h3><h4 id="修改-GoodsService-2"><a href="#修改-GoodsService-2" class="headerlink" title="修改 GoodsService"></a>修改 GoodsService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 1. 在默认情况下，声明式事务的隔离级别是 REPEATABLE_READ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Transactional</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTxISOLATION</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//查询两次商品价格</span></span><br><span class="line">       <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById(<span class="number">1</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;第一次查询的价格 = &quot;</span> + price);</span><br><span class="line"></span><br><span class="line">       <span class="type">Float</span> <span class="variable">price2</span> <span class="operator">=</span> goodsDao.queryPriceById(<span class="number">1</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;第二次查询的价格 = &quot;</span> + price2);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<img src="D:\Github\will-liang.github.io\source\_posts\Spring5.assets\image-20220612114221236.png" alt="image-20220612114221236" style="zoom:80%;" />

<h4 id="修改-TxTest"><a href="#修改-TxTest" class="headerlink" title="修改 TxTest"></a>修改 TxTest</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试声明式事务的隔离级别</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTxISOLATIONTest</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;tx_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="type">GoodsService</span> <span class="variable">goodsService</span> <span class="operator">=</span> ioc.getBean(GoodsService.class);</span><br><span class="line"></span><br><span class="line">       goodsService.buyGoodsByTxISOLATION();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>断点调试时走到断点处，执行sql语句</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> goods <span class="keyword">set</span> price<span class="operator">=</span><span class="number">8</span> <span class="keyword">where</span> goods_id<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612114515969.png" alt="image-20220612114515969"></p>
<h4 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h4><p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612114607701.png" alt="image-20220612114607701"><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612114631031.png" alt="image-20220612114631031"></p>
<p><strong>在默认隔离级别(REPEATABLE_READ)下，两次读取的价格一样。</strong></p>
<h4 id="修改-GoodsService-3"><a href="#修改-GoodsService-3" class="headerlink" title="修改 GoodsService"></a>修改 GoodsService</h4><p>测试 READ_COMMITTED 隔离级别情况</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 1. 在默认情况下，声明式事务的隔离级别是 REPEATABLE_READ</span></span><br><span class="line"><span class="comment">    * 2. 我们将buyGoodsByTxISOLATION 的隔离界别设置为 Isolation.READ_COMMITTED</span></span><br><span class="line"><span class="comment">    * ，表示只要是提交的数据，在当前事务是可以读取最新数据的。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Transactional(isolation = Isolation.READ_COMMITTED)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTxISOLATION</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//查询两次商品价格</span></span><br><span class="line">       <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById(<span class="number">1</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;第一次查询的价格 = &quot;</span> + price);</span><br><span class="line"></span><br><span class="line">       <span class="type">Float</span> <span class="variable">price2</span> <span class="operator">=</span> goodsDao.queryPriceById(<span class="number">1</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;第二次查询的价格 = &quot;</span> + price2);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>继续使用断点调试</strong></p>
<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220615193856967.png" alt="image-20220615193856967"></p>
<p><strong>断点调试时走到断点处，执行sql语句</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> goods <span class="keyword">set</span> price<span class="operator">=</span><span class="number">10</span> <span class="keyword">where</span> goods_id<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="测试结果-1"><a href="#测试结果-1" class="headerlink" title="测试结果"></a>测试结果</h4><p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612115110915.png" alt="image-20220612115110915"><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612115122340.png" alt="image-20220612115122340"></p>
<p><strong>在 READ_COMMITTED 隔离级别下，两次读取的价格不一样</strong>。</p>
<h3 id="事务的超时回滚"><a href="#事务的超时回滚" class="headerlink" title="事务的超时回滚"></a>事务的超时回滚</h3><h4 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h4><ol>
<li>如果一个事务执行的时间超过某个时间限制，就让该事务回滚。 </li>
<li>可以通过设置事务超时回顾来实现。</li>
</ol>
<h4 id="修改-GoodsService-4"><a href="#修改-GoodsService-4" class="headerlink" title="修改 GoodsService"></a>修改 GoodsService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 1. <span class="doctag">@Transactional</span>(timeout = 2)</span></span><br><span class="line"><span class="comment">    * 2. timeout = 2 表示 buyGoodsByTxTimeout 如果执行时间超过了2秒</span></span><br><span class="line"><span class="comment">    *    ，该事务就进行回滚</span></span><br><span class="line"><span class="comment">    * 3. 如果没有设置 timeout，默认为-1，表示使用事务的默认超时时间，或者不支持</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Transactional(timeout = 2)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTxTimeout</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> goodsId, <span class="type">int</span> amount)</span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;用户购买信息 userId=&quot;</span> + userId + <span class="string">&quot; goodsId=&quot;</span> + goodsId + <span class="string">&quot; 购买数量=&quot;</span> + amount);</span><br><span class="line">       <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> goodsDao.queryPriceById(userId);</span><br><span class="line">       goodsDao.updateBalance(userId, price * amount);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//模拟超时</span></span><br><span class="line">       System.out.println(<span class="string">&quot;==========计时开始==========&quot;</span>);</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           Thread.sleep(<span class="number">4000</span>);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(<span class="string">&quot;==========4秒结束==========&quot;</span>);</span><br><span class="line"></span><br><span class="line">       goodsDao.updateAmount(goodsId, amount);</span><br><span class="line">       System.out.println(<span class="string">&quot;用户购买成功~&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="修改-TxTest-测试"><a href="#修改-TxTest-测试" class="headerlink" title="修改 TxTest 测试"></a>修改 TxTest 测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试 timeout 属性</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoodsByTxTimeoutTest</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;tx_ioc.xml&quot;</span>);</span><br><span class="line">       <span class="type">GoodsService</span> <span class="variable">goodsService</span> <span class="operator">=</span> ioc.getBean(GoodsService.class);</span><br><span class="line">       goodsService.buyGoodsByTxTimeout(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612120531002.png" alt="image-20220612120531002"></p>
<h2 id="作业-3"><a href="#作业-3" class="headerlink" title="作业"></a>作业</h2><h3 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h3><p>模拟一个用户银行转账购买淘宝商品的的业务模块，数据表&#x2F;dao&#x2F;service 自己设计。使用注解完成。</p>
<p>​		seller[卖家]	buyer[买家]	goods[商品表[库存量]]	taoBao[提取入账成交额的 10%]</p>
<h3 id="代码实现-17"><a href="#代码实现-17" class="headerlink" title="代码实现"></a>代码实现</h3><h4 id="创建-TaoBaoGoodsDao"><a href="#创建-TaoBaoGoodsDao" class="headerlink" title="创建 TaoBaoGoodsDao"></a>创建 TaoBaoGoodsDao</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.tx.homework.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">//将TaoBaoGoodsDao-对象注入到spring容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaoBaoGoodsDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据商品id,返回对应的价格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Float <span class="title function_">queryPriceById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT price From goods_taobao Where goods_id=?&quot;</span>;</span><br><span class="line">        <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, Float.class, id);</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户的余额 [减少用户余额]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> buyer_id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBalance</span><span class="params">(Integer buyer_id, Float money)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE buyer SET money=money-? Where buyer_id=?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql, money, buyer_id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改商家的余额</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> seller_id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateSellerBalance</span><span class="params">(Integer seller_id, Float money)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE seller SET money=money+? Where seller_id=?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql, money*<span class="number">0.9</span>, seller_id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改商品库存 [减少]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goods_id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAmount</span><span class="params">(Integer goods_id, <span class="type">int</span> amount)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE goods_taobao SET goods_num=goods_num-? Where goods_id=?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql, amount , goods_id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加taobao记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> seller_id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> buyer_id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goods_id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateTaobao</span><span class="params">(Integer seller_id, Integer buyer_id, Integer goods_id, Float money)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;INSERT INTO `taobao` VALUES(NULL,?,?,?,?)&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql, seller_id, buyer_id, goods_id, money*<span class="number">0.1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建-TaoBaoGoodsService"><a href="#创建-TaoBaoGoodsService" class="headerlink" title="创建 TaoBaoGoodsService"></a>创建 TaoBaoGoodsService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.tx.homework.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.tx.homework.dao.TaoBaoGoodsDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaoBaoGoodsService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TaoBaoGoodsDao taoBaoGoodsDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyGoods</span><span class="params">(<span class="type">int</span> buyer_id, <span class="type">int</span> seller_id, <span class="type">int</span> goods_id, <span class="type">int</span> amount)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====================用户购买信息=====================&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;买家id： &quot;</span> + buyer_id);</span><br><span class="line">        System.out.println(<span class="string">&quot;卖家id： &quot;</span> + seller_id);</span><br><span class="line">        System.out.println(<span class="string">&quot;商品id： &quot;</span> + buyer_id);</span><br><span class="line">        System.out.println(<span class="string">&quot;数量id： &quot;</span> + buyer_id);</span><br><span class="line">        <span class="comment">//1.得到商品单价</span></span><br><span class="line">        <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> taoBaoGoodsDao.queryPriceById(goods_id);</span><br><span class="line">        System.out.println(<span class="string">&quot;商品单价：&quot;</span> + price);</span><br><span class="line">        System.out.println(<span class="string">&quot;======================================================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.修改用户的余额</span></span><br><span class="line">        taoBaoGoodsDao.updateBalance(buyer_id, price*amount);</span><br><span class="line">        <span class="comment">//3.修改商家的余额</span></span><br><span class="line">        taoBaoGoodsDao.updateSellerBalance(seller_id, price*amount);</span><br><span class="line">        <span class="comment">//4.修改商品库存</span></span><br><span class="line">        taoBaoGoodsDao.updateAmount(goods_id, amount);</span><br><span class="line">        <span class="comment">//5.修改taobao表</span></span><br><span class="line">        taoBaoGoodsDao.updateTaobao(seller_id, buyer_id, goods_id, price*amount);</span><br><span class="line">        System.out.println(<span class="string">&quot;用户购买成功~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置-shopping-ioc-xml"><a href="#配置-shopping-ioc-xml" class="headerlink" title="配置 shopping_ioc.xml"></a>配置 shopping_ioc.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置要扫描的包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.tx.homework.dao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lzw.spring.tx.homework.service&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--引入外部的jdbc.properties文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置数据源对象-DataSoruce--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给数据源对象配置属性值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.userName&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClass&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置JdbcTemplate对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给JdbcTemplate对象配置dataSource--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理器-对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置启动基于注解的声明式事务管理功能--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="创建-Test-测试"><a href="#创建-Test-测试" class="headerlink" title="创建 Test 测试"></a>创建 Test 测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzw.spring.tx.homework;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lzw.spring.tx.homework.service.TaoBaoGoodsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> LiAng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;shopping_ioc.xml&quot;</span>);</span><br><span class="line">        <span class="type">TaoBaoGoodsService</span> <span class="variable">taoBaoGoodsService</span> <span class="operator">=</span> ioc.getBean(TaoBaoGoodsService.class);</span><br><span class="line">        taoBaoGoodsService.buyGoods(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><p><img src="D:\Github\will-liang.github.io\source_posts\Spring5.assets\image-20220612154406633.png" alt="image-20220612154406633"></p>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="LiAng"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">LiAng</p>
  <div class="site-description" itemprop="description">永远相信美好的事情即将发生</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Will-Liang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Will-Liang" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://baidu.com/" title="https:&#x2F;&#x2F;baidu.com" rel="noopener" target="_blank">百度</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022-07 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiAng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共57.6k字</span>
</div>



    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
